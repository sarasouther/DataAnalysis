# Spatial data

Working with Spatial Data
Introduction: Why Spatial Data Matters in Ecology

Almost all ecological data has a spatial component
"Everything is related to everything else, but near things are more related than distant things" (Tobler's First Law)
Spatial context influences sampling, analysis, and interpretation
Ignoring spatial structure can lead to pseudoreplication and biased inference

Types of Spatial Data
Vector data

Points — sample locations, species occurrences, sensor stations
Lines — transects, streams, roads, animal movement paths
Polygons — study area boundaries, habitat patches, management units

Raster data

Grid cells with continuous values
Examples: elevation (DEMs), temperature, precipitation, NDVI, land cover
Resolution matters: cell size determines detail and file size

When to use which

Vector for discrete features and sample locations
Raster for continuous environmental surfaces
Many analyses require both

Visual comparison: Same landscape represented as vector vs. raster
Common Spatial File Formats
Vector formats
FormatExtensionProsConsShapefile.shp (+ .dbf, .shx, .prj)Universal compatibilityMultiple files, 2GB limit, field name limitsGeoPackage.gpkgSingle file, no size limit, modernLess universal (but growing)GeoJSON.geojsonHuman-readable, web-friendlyLarge file sizes, less preciseKML/KMZ.kml/.kmzGoogle Earth compatibleLimited attribute supportGPS Exchange.gpxGPS device standardLimited to points/tracks
Raster formats
FormatExtensionProsConsGeoTIFF.tifUniversal, supports metadataCan be largeASCII Grid.ascHuman-readableVery large, slowNetCDF.ncGreat for time series, climate dataComplex structureERDAS Imagine.imgCommon in remote sensingProprietary
Recommendation: GeoPackage for vector, GeoTIFF for raster when possible
Coordinate Reference Systems (CRS)
Why CRS matters

The Earth is round; maps are flat
Different systems optimize for different purposes
Mismatched CRS = misaligned data = errors

Geographic vs. Projected CRS
Geographic (unprojected)

Units: degrees (latitude/longitude)
Common system: WGS84 (EPSG:4326)
Good for: storing raw coordinates, GPS data, global datasets
Limitation: distances and areas distorted

Projected

Units: meters or feet
Examples: UTM zones, State Plane, Albers Equal Area
Good for: measuring distances, calculating areas, local/regional analysis
Limitation: distortion increases away from projection center

EPSG codes

Standardized numeric codes for CRS
Common codes to know:

4326 = WGS84 (GPS coordinates)
4269 = NAD83 (North America)
32612 = UTM Zone 12N (Arizona/Utah region)



How to check CRS in R
st_crs(my_shapefile)
crs(my_raster)
Transforming between CRS
st_transform(my_data, crs = 32612)
project(my_raster, "EPSG:32612")
Common CRS problems and solutions

Data won't overlay → check and match CRS
Distance calculations wrong → project to appropriate local CRS
Area calculations wrong → use equal-area projection
"NA" or missing CRS → assign with st_set_crs() (only if you know the correct CRS!)

Reading and Writing Spatial Data in R
The sf package (vector data)

Modern standard, tidy-friendly
st_read() and st_write()
Works with dplyr verbs

library(sf)

# Read
plots <- st_read("sampling_plots.shp")
study_area <- st_read("boundary.gpkg")

# Check structure
class(plots)
st_geometry_type(plots)
st_crs(plots)

# Write
st_write(plots, "output.gpkg")
The terra package (raster data)

Successor to raster package
rast() to read, writeRaster() to write

library(terra)

# Read
elevation <- rast("dem.tif")

# Check properties
res(elevation)
ext(elevation)
crs(elevation)

# Write
writeRaster(elevation, "output.tif")
Worked example: Load study area boundary, sampling points, and elevation raster; verify all share the same CRS
Basic Spatial Operations
Vector operations

Buffering — st_buffer()
Clipping/intersection — st_intersection()
Spatial joins — st_join()
Calculating area — st_area()
Calculating distances — st_distance()

Raster operations

Cropping — crop()
Masking — mask()
Extracting values at points — extract()
Resampling — resample()
Reclassifying — classify()

Vector-raster interactions

Extract raster values at point locations
Zonal statistics within polygons
Converting between formats

Worked example: Extract elevation, slope, and aspect values for vegetation sampling plots
Visualizing Spatial Data
Quick plots for exploration
plot(st_geometry(study_area))
plot(elevation)
Publication-quality maps with ggplot2 + sf
ggplot() +
  geom_sf(data = study_area, fill = "lightgray") +
  geom_sf(data = plots, aes(color = treatment)) +
  theme_minimal()
Adding basemaps

ggmap for Google/Stamen tiles
maptiles for OpenStreetMap

Interactive maps with leaflet or mapview

Great for data exploration and sharing
mapview(plots)

Spatial Autocorrelation
What is spatial autocorrelation?

Nearby locations tend to have similar values
Positive autocorrelation: similar values cluster (most common in ecology)
Negative autocorrelation: dissimilar values cluster (rare)
Zero autocorrelation: spatial randomness

Why it matters for statistics

Violates independence assumption
Inflates effective sample size
Increases Type I error (false positives)
Standard errors are too small

Ecological examples

Soil nutrients clustered by parent material
Species abundance clustered by dispersal limitation
Disease prevalence clustered by transmission

Detecting spatial autocorrelation
Visual methods

Map residuals from your model
Look for spatial clustering of positive/negative residuals

Moran's I

Most common test
Ranges from -1 (dispersed) to +1 (clustered), 0 = random
Requires defining spatial neighbors/weights

library(spdep)

# Create neighbor list
coords <- st_coordinates(plots)
nb <- dnearneigh(coords, d1 = 0, d2 = 1000)  # neighbors within 1km
weights <- nb2listw(nb, style = "W")

# Test residuals
moran.test(residuals(my_model), weights)
Variograms

Shows how variance changes with distance
Useful for determining range of autocorrelation
Key parameters: nugget, sill, range

library(gstat)
vario <- variogram(response ~ 1, data = plots)
plot(vario)
Correlograms

Moran's I calculated at multiple distance classes
Shows at what scales autocorrelation occurs

Dealing with Spatial Autocorrelation
Design-based solutions (prevention)

Increase spacing between samples
Stratified or systematic sampling
GRTS sampling (balances spatial spread)

Model-based solutions (accommodation)
Include spatial covariates

Add coordinates as predictors (crude but sometimes sufficient)
Add spatially-structured environmental variables

Spatial regression models

Spatial lag models — autocorrelation in response
Spatial error models — autocorrelation in residuals
spatialreg package

Geostatistical models

Model the correlation structure explicitly
Kriging for prediction
gstat package

Mixed models with spatial correlation

Add spatial correlation structure to residuals
nlme::lme() with correlation = corSpatial()
glmmTMB with spatial random effects

Generalized Least Squares

gls() with spatial correlation structures

Decision framework: When to worry about spatial autocorrelation

Always check residuals spatially
If significant autocorrelation exists, consider:

Scale of autocorrelation vs. scale of inference
Purpose of model (prediction vs. hypothesis testing)
Available sample size for more complex models



Special Considerations for Ecological Field Data
GPS accuracy and precision

Consumer GPS: ± 3-5 meters typical
Differential GPS: sub-meter
Canopy cover reduces accuracy
Always record metadata about GPS equipment

Datum shifts

NAD27 vs NAD83 can differ by tens of meters
Always document and verify datum

Scale and extent

Grain: finest spatial resolution
Extent: total area covered
Ecological patterns are scale-dependent
Match analysis scale to question scale

Edge effects

Sampling near boundaries can bias results
Buffer study areas when possible

Modifiable Areal Unit Problem (MAUP)

Results can change depending on how you aggregate spatial data
Be consistent and justify choices

Key Takeaways

Always check and document your CRS
Match CRS before combining datasets
Use projected CRS for distance and area calculations
Spatial autocorrelation violates independence — check your residuals
Prevention (good sampling design) is easier than cure (complex models)
The sf and terra packages are your friends

Test Your Knowledge
Conceptual questions

What is the difference between geographic and projected coordinate systems?
Why does spatial autocorrelation inflate Type I error rates?
When would you use vector vs. raster data?

Applied exercises

Given two datasets that won't overlay, diagnose the CRS problem
Calculate Moran's I on model residuals and interpret results
Create a variogram and identify the range of spatial autocorrelation

Assignment
For your project data:

Document the CRS of all spatial datasets
Create a map showing sampling locations and study area
If applicable, extract environmental covariates from rasters at your sample points
After fitting a preliminary model, map residuals and test for spatial autocorrelation
Discuss implications for your analysis