<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 17 Integral Population Models | Applied Statistics for the Natural Sciences</title>
  <meta name="description" content="Chapter 17 Integral Population Models | Applied Statistics for the Natural Sciences" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 17 Integral Population Models | Applied Statistics for the Natural Sciences" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="sarasouther/DataAnalysis" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 Integral Population Models | Applied Statistics for the Natural Sciences" />
  
  
  

<meta name="author" content="Sara Souther" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="population-sensation.html"/>
<link rel="next" href="spatial-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.11/grViz.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Statistics for the Natural Sciences</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#using-r-in-this-course"><i class="fa fa-check"></i><b>1.2</b> Using R in This Course</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#what-you-need-to-use-r"><i class="fa fa-check"></i><b>1.2.1</b> What you need to use R</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#create-an-r-file"><i class="fa fa-check"></i><b>1.2.2</b> Create an R file</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#using-working-directories-and-opening-files"><i class="fa fa-check"></i><b>1.2.3</b> Using working directories and opening files</a></li>
<li class="chapter" data-level="1.2.4" data-path="index.html"><a href="index.html#r-packages"><i class="fa fa-check"></i><b>1.2.4</b> R Packages</a></li>
<li class="chapter" data-level="1.2.5" data-path="index.html"><a href="index.html#other-information-about-r-code"><i class="fa fa-check"></i><b>1.2.5</b> Other information about R code</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#getting-started"><i class="fa fa-check"></i><b>1.3</b> Getting started</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html"><i class="fa fa-check"></i><b>2</b> Back to the basics</a>
<ul>
<li class="chapter" data-level="2.1" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#what-can-statistics-tell-us"><i class="fa fa-check"></i><b>2.1</b> What can statistics tell us?</a></li>
<li class="chapter" data-level="2.2" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#the-frequentist-framework"><i class="fa fa-check"></i><b>2.2</b> The Frequentist Framework</a></li>
<li class="chapter" data-level="2.3" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#bayesian-statistics"><i class="fa fa-check"></i><b>2.3</b> Bayesian statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#when-might-you-choose-bayesian-statistics"><i class="fa fa-check"></i><b>2.3.1</b> When might you choose Bayesian statistics?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#fundaments-of-frequentist-statistics"><i class="fa fa-check"></i><b>2.4</b> Fundaments of frequentist statistics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#statistical-error"><i class="fa fa-check"></i><b>2.4.1</b> Statistical error</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#what-is-a-model"><i class="fa fa-check"></i><b>2.5</b> What is a model?</a></li>
<li class="chapter" data-level="2.6" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#test-your-knowledge"><i class="fa fa-check"></i><b>2.6</b> Test your knowledge!</a></li>
<li class="chapter" data-level="2.7" data-path="back-to-the-basics.html"><a href="back-to-the-basics.html#assignment"><i class="fa fa-check"></i><b>2.7</b> Assignment</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html"><i class="fa fa-check"></i><b>3</b> Data Types and Why They Matter</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#linking-data-types-to-distributions"><i class="fa fa-check"></i><b>3.1</b> Linking Data Types to Distributions</a></li>
<li class="chapter" data-level="3.2" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#overview-of-common-statistical-distributions"><i class="fa fa-check"></i><b>3.2</b> Overview of Common Statistical Distributions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#the-normal-distribution"><i class="fa fa-check"></i><b>3.2.1</b> The Normal Distribution</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#the-binomial-distribution-outcomes-are-success-or-failure"><i class="fa fa-check"></i><b>3.2.2</b> The Binomial Distribution: Outcomes are “success” or “failure”</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#the-poisson-distribution-counts-from-random-events"><i class="fa fa-check"></i><b>3.2.3</b> The Poisson Distribution: Counts from random events</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#the-negative-binomial-distribution-overdispersed-counts"><i class="fa fa-check"></i><b>3.2.4</b> The Negative Binomial Distribution: Overdispersed counts</a></li>
<li class="chapter" data-level="3.2.5" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#the-uniform-distribution-all-values-equally-likely"><i class="fa fa-check"></i><b>3.2.5</b> The Uniform Distribution: All values equally likely</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#key-takeaways"><i class="fa fa-check"></i><b>3.3</b> Key takeaways</a></li>
<li class="chapter" data-level="3.4" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#test-your-knowledge-1"><i class="fa fa-check"></i><b>3.4</b> Test your knowledge!</a></li>
<li class="chapter" data-level="3.5" data-path="data-types-and-why-they-matter.html"><a href="data-types-and-why-they-matter.html#assignment-1"><i class="fa fa-check"></i><b>3.5</b> Assignment</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html"><i class="fa fa-check"></i><b>4</b> Randomness and probability</a>
<ul>
<li class="chapter" data-level="4.1" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#the-sample-point-method"><i class="fa fa-check"></i><b>4.1</b> The sample point method</a></li>
<li class="chapter" data-level="4.2" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#combinatorials"><i class="fa fa-check"></i><b>4.2</b> Combinatorials</a></li>
<li class="chapter" data-level="4.3" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#union-and-intersection-of-events"><i class="fa fa-check"></i><b>4.3</b> Union and intersection of events</a></li>
<li class="chapter" data-level="4.4" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#conditional-probability"><i class="fa fa-check"></i><b>4.4</b> Conditional probability</a></li>
<li class="chapter" data-level="4.5" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#multiplicative-law-of-probability-of-independent-events"><i class="fa fa-check"></i><b>4.5</b> Multiplicative Law of Probability of Independent Events</a></li>
<li class="chapter" data-level="4.6" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#additive-law-of-probability-of-mutually-exclusive-events"><i class="fa fa-check"></i><b>4.6</b> Additive Law of Probability of Mutually Exclusive Events</a></li>
<li class="chapter" data-level="4.7" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#general-additive-law-of-probability"><i class="fa fa-check"></i><b>4.7</b> General Additive Law of Probability</a></li>
<li class="chapter" data-level="4.8" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#key-concepts"><i class="fa fa-check"></i><b>4.8</b> Key concepts</a></li>
<li class="chapter" data-level="4.9" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#practice-problems"><i class="fa fa-check"></i><b>4.9</b> Practice problems</a></li>
<li class="chapter" data-level="4.10" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#expected-value-of-a-fair-die-roll"><i class="fa fa-check"></i><b>4.10</b> Expected value of a fair die roll</a></li>
<li class="chapter" data-level="4.11" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#variance-of-a-fair-die-roll"><i class="fa fa-check"></i><b>4.11</b> Variance of a fair die roll</a></li>
<li class="chapter" data-level="4.12" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#take-many-samples-and-calculate-means"><i class="fa fa-check"></i><b>4.12</b> Take many samples and calculate means</a></li>
<li class="chapter" data-level="4.13" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#uniform-population"><i class="fa fa-check"></i><b>4.13</b> Uniform population</a></li>
<li class="chapter" data-level="4.14" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#exponential-population-highly-skewed"><i class="fa fa-check"></i><b>4.14</b> Exponential population (highly skewed)</a></li>
<li class="chapter" data-level="4.15" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#ppositive-pposdiseasepdisease-pposno-diseasepno-disease"><i class="fa fa-check"></i><b>4.15</b> P(positive) = P(pos|disease)<em>P(disease) + P(pos|no disease)</em>P(no disease)</a></li>
<li class="chapter" data-level="4.16" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#pdisease-positive-pposdisease-pdisease-ppositive"><i class="fa fa-check"></i><b>4.16</b> P(disease | positive) = P(pos|disease) * P(disease) / P(positive)</a></li>
<li class="chapter" data-level="4.17" data-path="randomness-and-probability.html"><a href="randomness-and-probability.html#probability-of-9-or-10-heads-in-10-flips-of-fair-coin"><i class="fa fa-check"></i><b>4.17</b> Probability of 9 or 10 heads in 10 flips of fair coin</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-exploration-and-assumption-checking.html"><a href="data-exploration-and-assumption-checking.html"><i class="fa fa-check"></i><b>5</b> Data Exploration and Assumption Checking</a></li>
<li class="chapter" data-level="6" data-path="ecological-sampling.html"><a href="ecological-sampling.html"><i class="fa fa-check"></i><b>6</b> Ecological sampling</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ecological-sampling.html"><a href="ecological-sampling.html#background"><i class="fa fa-check"></i><b>6.1</b> Background</a></li>
<li class="chapter" data-level="6.2" data-path="ecological-sampling.html"><a href="ecological-sampling.html#sampling-approaches"><i class="fa fa-check"></i><b>6.2</b> Sampling approaches</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ecological-sampling.html"><a href="ecological-sampling.html#random-sampling"><i class="fa fa-check"></i><b>6.2.1</b> Random sampling</a></li>
<li class="chapter" data-level="6.2.2" data-path="ecological-sampling.html"><a href="ecological-sampling.html#stratified-random-sampling"><i class="fa fa-check"></i><b>6.2.2</b> Stratified random sampling</a></li>
<li class="chapter" data-level="6.2.3" data-path="ecological-sampling.html"><a href="ecological-sampling.html#gridded-random-sampling"><i class="fa fa-check"></i><b>6.2.3</b> Gridded random sampling</a></li>
<li class="chapter" data-level="6.2.4" data-path="ecological-sampling.html"><a href="ecological-sampling.html#random-cluster-sampling"><i class="fa fa-check"></i><b>6.2.4</b> Random cluster sampling</a></li>
<li class="chapter" data-level="6.2.5" data-path="ecological-sampling.html"><a href="ecological-sampling.html#grts-sampling-generalized-random-tessellation-stratified-sampling"><i class="fa fa-check"></i><b>6.2.5</b> GRTS Sampling (Generalized Random-Tessellation Stratified Sampling)</a></li>
<li class="chapter" data-level="6.2.6" data-path="ecological-sampling.html"><a href="ecological-sampling.html#understanding-design-weights"><i class="fa fa-check"></i><b>6.2.6</b> Understanding Design Weights</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ecological-sampling.html"><a href="ecological-sampling.html#systematic-sampling"><i class="fa fa-check"></i><b>6.3</b> Systematic Sampling</a></li>
<li class="chapter" data-level="6.4" data-path="ecological-sampling.html"><a href="ecological-sampling.html#adaptive-sampling-sampling-rare-or-patchy-species"><i class="fa fa-check"></i><b>6.4</b> Adaptive Sampling (Sampling Rare or Patchy Species)</a></li>
<li class="chapter" data-level="6.5" data-path="ecological-sampling.html"><a href="ecological-sampling.html#imperfect-detection-in-ecological-sampling"><i class="fa fa-check"></i><b>6.5</b> Imperfect Detection in Ecological Sampling</a></li>
<li class="chapter" data-level="6.6" data-path="ecological-sampling.html"><a href="ecological-sampling.html#temporal-sampling-and-study-designs-through-time"><i class="fa fa-check"></i><b>6.6</b> Temporal Sampling and Study Designs Through Time</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="ecological-sampling.html"><a href="ecological-sampling.html#sampling-panels"><i class="fa fa-check"></i><b>6.6.1</b> Sampling Panels</a></li>
<li class="chapter" data-level="6.6.2" data-path="ecological-sampling.html"><a href="ecological-sampling.html#baci-designs-beforeaftercontrolimpact"><i class="fa fa-check"></i><b>6.6.2</b> BACI Designs (Before–After–Control–Impact)</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="ecological-sampling.html"><a href="ecological-sampling.html#plot-shapes-sizes-and-transects"><i class="fa fa-check"></i><b>6.7</b> Plot shapes, sizes, and transects</a></li>
<li class="chapter" data-level="6.8" data-path="ecological-sampling.html"><a href="ecological-sampling.html#distance-sampling-and-point-counts"><i class="fa fa-check"></i><b>6.8</b> Distance Sampling and Point Counts</a></li>
<li class="chapter" data-level="6.9" data-path="ecological-sampling.html"><a href="ecological-sampling.html#reducing-sampling-error"><i class="fa fa-check"></i><b>6.9</b> Reducing sampling error</a></li>
<li class="chapter" data-level="6.10" data-path="ecological-sampling.html"><a href="ecological-sampling.html#sample-size-determination-in-ecology-effect-sizes-and-precision"><i class="fa fa-check"></i><b>6.10</b> Sample Size Determination in Ecology: Effect Sizes and Precision</a></li>
<li class="chapter" data-level="6.11" data-path="ecological-sampling.html"><a href="ecological-sampling.html#variables-of-interest"><i class="fa fa-check"></i><b>6.11</b> Variables of interest</a></li>
<li class="chapter" data-level="6.12" data-path="ecological-sampling.html"><a href="ecological-sampling.html#test-your-knowledge-2"><i class="fa fa-check"></i><b>6.12</b> Test your knowledge</a></li>
<li class="chapter" data-level="6.13" data-path="ecological-sampling.html"><a href="ecological-sampling.html#assignment-2"><i class="fa fa-check"></i><b>6.13</b> Assignment</a>
<ul>
<li class="chapter" data-level="6.13.1" data-path="ecological-sampling.html"><a href="ecological-sampling.html#example-methods-sampling-design"><i class="fa fa-check"></i><b>6.13.1</b> Example Methods: Sampling Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="power-analysis.html"><a href="power-analysis.html"><i class="fa fa-check"></i><b>7</b> Power analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="power-analysis.html"><a href="power-analysis.html#prework"><i class="fa fa-check"></i><b>7.1</b> Prework</a></li>
<li class="chapter" data-level="7.2" data-path="power-analysis.html"><a href="power-analysis.html#statistical-power"><i class="fa fa-check"></i><b>7.2</b> Statistical power</a></li>
<li class="chapter" data-level="7.3" data-path="power-analysis.html"><a href="power-analysis.html#describing-data"><i class="fa fa-check"></i><b>7.3</b> Describing data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html"><i class="fa fa-check"></i><b>8</b> Selecting statistical tests</a>
<ul>
<li class="chapter" data-level="8.1" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#a-foray-into-statistics"><i class="fa fa-check"></i><b>8.1</b> A foray into statistics</a></li>
<li class="chapter" data-level="8.2" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#pick-the-explanatory-and-response-variable"><i class="fa fa-check"></i><b>8.2</b> Pick the explanatory and response variable</a></li>
<li class="chapter" data-level="8.3" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#variable-types-refresher"><i class="fa fa-check"></i><b>8.3</b> Variable types refresher</a></li>
<li class="chapter" data-level="8.4" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#more-examples"><i class="fa fa-check"></i><b>8.4</b> More examples</a></li>
<li class="chapter" data-level="8.5" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#the-decision-matrix"><i class="fa fa-check"></i><b>8.5</b> The decision matrix</a></li>
<li class="chapter" data-level="8.6" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#a-note-on-assumptions"><i class="fa fa-check"></i><b>8.6</b> A note on assumptions</a></li>
<li class="chapter" data-level="8.7" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#learning-goals"><i class="fa fa-check"></i><b>8.7</b> Learning goals</a></li>
<li class="chapter" data-level="8.8" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#downloads-for-this-class"><i class="fa fa-check"></i><b>8.8</b> Downloads for this class</a></li>
<li class="chapter" data-level="8.9" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#in-class-practice"><i class="fa fa-check"></i><b>8.9</b> In-class practice</a></li>
<li class="chapter" data-level="8.10" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#assignment-choosing-and-running-the-right-test"><i class="fa fa-check"></i><b>8.10</b> Assignment: Choosing and Running the Right Test</a>
<ul>
<li class="chapter" data-level="8.10.1" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#deliverables"><i class="fa fa-check"></i><b>8.10.1</b> Deliverables</a></li>
</ul></li>
<li class="chapter" data-level="8.11" data-path="selecting-statistical-tests.html"><a href="selecting-statistical-tests.html#statistical-analyses-for-your-species-interaction-lab"><i class="fa fa-check"></i><b>8.11</b> Statistical analyses for your species interaction lab</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html"><i class="fa fa-check"></i><b>9</b> Basic statistical testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#a-short-statistical-review"><i class="fa fa-check"></i><b>9.1</b> A short statistical review</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#what-can-statistics-tell-us-1"><i class="fa fa-check"></i><b>9.1.1</b> What can statistics tell us?</a></li>
<li class="chapter" data-level="9.1.2" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#sampling-populations"><i class="fa fa-check"></i><b>9.1.2</b> Sampling populations</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#hypothesis-testing-review"><i class="fa fa-check"></i><b>9.2</b> Hypothesis testing review</a></li>
<li class="chapter" data-level="9.3" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#downloads-for-this-module"><i class="fa fa-check"></i><b>9.3</b> Downloads for this module</a></li>
<li class="chapter" data-level="9.4" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#objectives"><i class="fa fa-check"></i><b>9.4</b> Objectives</a></li>
<li class="chapter" data-level="9.5" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#tailed-tests"><i class="fa fa-check"></i><b>9.5</b> Tailed tests</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#generate-hypotheses"><i class="fa fa-check"></i><b>9.5.1</b> Generate hypotheses</a></li>
<li class="chapter" data-level="9.5.2" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#calculate-a-test-statistic"><i class="fa fa-check"></i><b>9.5.2</b> Calculate a test statistic</a></li>
<li class="chapter" data-level="9.5.3" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#determine-the-p-value"><i class="fa fa-check"></i><b>9.5.3</b> Determine the p-value</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#drawing-conclusions-from-statistics"><i class="fa fa-check"></i><b>9.6</b> Drawing conclusions from statistics</a></li>
<li class="chapter" data-level="9.7" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#reporting-results"><i class="fa fa-check"></i><b>9.7</b> Reporting results</a></li>
<li class="chapter" data-level="9.8" data-path="basic-statistical-testing.html"><a href="basic-statistical-testing.html#assignment-3"><i class="fa fa-check"></i><b>9.8</b> Assignment</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="generalized-linear-models-glms.html"><a href="generalized-linear-models-glms.html"><i class="fa fa-check"></i><b>10</b> Generalized Linear Models (GLMs)</a>
<ul>
<li class="chapter" data-level="10.1" data-path="generalized-linear-models-glms.html"><a href="generalized-linear-models-glms.html#linear-models"><i class="fa fa-check"></i><b>10.1</b> Linear models</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html"><i class="fa fa-check"></i><b>11</b> Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="11.1" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#link-functions"><i class="fa fa-check"></i><b>11.1</b> Link functions</a></li>
<li class="chapter" data-level="11.2" data-path="generalized-linear-models.html"><a href="generalized-linear-models.html#glms-in-r"><i class="fa fa-check"></i><b>11.2</b> GLMs in R</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="mixed-effects-models.html"><a href="mixed-effects-models.html"><i class="fa fa-check"></i><b>12</b> Mixed Effects Models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mixed-effects-models.html"><a href="mixed-effects-models.html#examples-in-r"><i class="fa fa-check"></i><b>12.1</b> Examples in R</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="before-after-control-impact.html"><a href="before-after-control-impact.html"><i class="fa fa-check"></i><b>13</b> Before-After-Control-Impact</a>
<ul>
<li class="chapter" data-level="13.1" data-path="before-after-control-impact.html"><a href="before-after-control-impact.html#which-design"><i class="fa fa-check"></i><b>13.1</b> Which design</a></li>
<li class="chapter" data-level="13.2" data-path="before-after-control-impact.html"><a href="before-after-control-impact.html#baci-design-2"><i class="fa fa-check"></i><b>13.2</b> BACI Design 2</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="time-is-a-flat-circle.html"><a href="time-is-a-flat-circle.html"><i class="fa fa-check"></i><b>14</b> Time is a flat circle</a></li>
<li class="chapter" data-level="15" data-path="bootstrapping-and-resampling.html"><a href="bootstrapping-and-resampling.html"><i class="fa fa-check"></i><b>15</b> Bootstrapping and resampling</a></li>
<li class="chapter" data-level="16" data-path="population-sensation.html"><a href="population-sensation.html"><i class="fa fa-check"></i><b>16</b> Population sensation</a>
<ul>
<li class="chapter" data-level="16.1" data-path="population-sensation.html"><a href="population-sensation.html#population-characteristics"><i class="fa fa-check"></i><b>16.1</b> Population characteristics</a></li>
<li class="chapter" data-level="16.2" data-path="population-sensation.html"><a href="population-sensation.html#planning-a-census"><i class="fa fa-check"></i><b>16.2</b> Planning a census</a></li>
<li class="chapter" data-level="16.3" data-path="population-sensation.html"><a href="population-sensation.html#life-cycle-diagrams"><i class="fa fa-check"></i><b>16.3</b> Life cycle diagrams</a></li>
<li class="chapter" data-level="16.4" data-path="population-sensation.html"><a href="population-sensation.html#population-demographic-models"><i class="fa fa-check"></i><b>16.4</b> Population demographic models</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="population-sensation.html"><a href="population-sensation.html#unstructured-models"><i class="fa fa-check"></i><b>16.4.1</b> Unstructured Models</a></li>
<li class="chapter" data-level="16.4.2" data-path="population-sensation.html"><a href="population-sensation.html#structured-models"><i class="fa fa-check"></i><b>16.4.2</b> Structured Models</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="population-sensation.html"><a href="population-sensation.html#integral-projection-models"><i class="fa fa-check"></i><b>16.5</b> Integral projection models</a></li>
<li class="chapter" data-level="16.6" data-path="population-sensation.html"><a href="population-sensation.html#population-dynamics"><i class="fa fa-check"></i><b>16.6</b> Population dynamics</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="population-sensation.html"><a href="population-sensation.html#population-growth-rate"><i class="fa fa-check"></i><b>16.6.1</b> Population growth rate</a></li>
<li class="chapter" data-level="16.6.2" data-path="population-sensation.html"><a href="population-sensation.html#stable-stage-distribution"><i class="fa fa-check"></i><b>16.6.2</b> Stable stage distribution</a></li>
<li class="chapter" data-level="16.6.3" data-path="population-sensation.html"><a href="population-sensation.html#reproductive-value"><i class="fa fa-check"></i><b>16.6.3</b> Reproductive value</a></li>
<li class="chapter" data-level="16.6.4" data-path="population-sensation.html"><a href="population-sensation.html#sensitivities-absolute-effects"><i class="fa fa-check"></i><b>16.6.4</b> Sensitivities: absolute effects</a></li>
<li class="chapter" data-level="16.6.5" data-path="population-sensation.html"><a href="population-sensation.html#elasticities-proportional-effects"><i class="fa fa-check"></i><b>16.6.5</b> Elasticities: proportional effects</a></li>
<li class="chapter" data-level="16.6.6" data-path="population-sensation.html"><a href="population-sensation.html#beyond-asymptotic-dynamics-transient-behavior"><i class="fa fa-check"></i><b>16.6.6</b> Beyond asymptotic dynamics: transient behavior</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="population-sensation.html"><a href="population-sensation.html#chapter-summary"><i class="fa fa-check"></i><b>16.7</b> Chapter summary</a></li>
<li class="chapter" data-level="16.8" data-path="population-sensation.html"><a href="population-sensation.html#test-your-knowledge-3"><i class="fa fa-check"></i><b>16.8</b> Test your knowledge</a></li>
<li class="chapter" data-level="16.9" data-path="population-sensation.html"><a href="population-sensation.html#assignment-4"><i class="fa fa-check"></i><b>16.9</b> Assignment</a>
<ul>
<li class="chapter" data-level="16.9.1" data-path="population-sensation.html"><a href="population-sensation.html#your-task"><i class="fa fa-check"></i><b>16.9.1</b> Your task</a></li>
<li class="chapter" data-level="16.9.2" data-path="population-sensation.html"><a href="population-sensation.html#guidelines"><i class="fa fa-check"></i><b>16.9.2</b> Guidelines</a></li>
<li class="chapter" data-level="16.9.3" data-path="population-sensation.html"><a href="population-sensation.html#what-to-submit"><i class="fa fa-check"></i><b>16.9.3</b> What to submit</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="integral-population-models.html"><a href="integral-population-models.html"><i class="fa fa-check"></i><b>17</b> Integral Population Models</a>
<ul>
<li class="chapter" data-level="17.1" data-path="integral-population-models.html"><a href="integral-population-models.html#case-study-modeling-an-endangered-hawaiian-plant"><i class="fa fa-check"></i><b>17.1</b> Case Study: Modeling an Endangered Hawaiian Plant</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="integral-population-models.html"><a href="integral-population-models.html#why-model-s.-lanceolata-populations"><i class="fa fa-check"></i><b>17.1.1</b> Why model S. lanceolata populations?</a></li>
<li class="chapter" data-level="17.1.2" data-path="integral-population-models.html"><a href="integral-population-models.html#the-management-question"><i class="fa fa-check"></i><b>17.1.2</b> The management question:</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="integral-population-models.html"><a href="integral-population-models.html#designing-a-demographic-census-timing-and-measurements"><i class="fa fa-check"></i><b>17.2</b> Designing a Demographic Census: Timing and Measurements</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="integral-population-models.html"><a href="integral-population-models.html#principle-1-census-timing-must-align-with-the-organisms-life-cycle"><i class="fa fa-check"></i><b>17.2.1</b> Principle 1: Census Timing Must Align with the Organism’s Life Cycle</a></li>
<li class="chapter" data-level="17.2.2" data-path="integral-population-models.html"><a href="integral-population-models.html#principle-2-measurements-must-link-to-vital-rates"><i class="fa fa-check"></i><b>17.2.2</b> Principle 2: Measurements Must Link to Vital Rates</a></li>
<li class="chapter" data-level="17.2.3" data-path="integral-population-models.html"><a href="integral-population-models.html#principle-3-track-individual-fates-through-time"><i class="fa fa-check"></i><b>17.2.3</b> Principle 3: Track Individual Fates Through Time</a></li>
<li class="chapter" data-level="17.2.4" data-path="integral-population-models.html"><a href="integral-population-models.html#principle-4-document-context-and-threats"><i class="fa fa-check"></i><b>17.2.4</b> Principle 4: Document Context and Threats</a></li>
<li class="chapter" data-level="17.2.5" data-path="integral-population-models.html"><a href="integral-population-models.html#understanding-state-variables-in-ipms"><i class="fa fa-check"></i><b>17.2.5</b> Understanding State Variables in IPMs</a></li>
<li class="chapter" data-level="17.2.6" data-path="integral-population-models.html"><a href="integral-population-models.html#explore-potential-state-variables"><i class="fa fa-check"></i><b>17.2.6</b> Explore Potential State Variables</a></li>
<li class="chapter" data-level="17.2.7" data-path="integral-population-models.html"><a href="integral-population-models.html#visualize-distribution-of-candidate-state-variables"><i class="fa fa-check"></i><b>17.2.7</b> Visualize Distribution of Candidate State Variables</a></li>
<li class="chapter" data-level="17.2.8" data-path="integral-population-models.html"><a href="integral-population-models.html#selecting-our-state-variable"><i class="fa fa-check"></i><b>17.2.8</b> Selecting Our State Variable</a></li>
<li class="chapter" data-level="17.2.9" data-path="integral-population-models.html"><a href="integral-population-models.html#the-dimensionality-problem"><i class="fa fa-check"></i><b>17.2.9</b> The dimensionality problem</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="integral-population-models.html"><a href="integral-population-models.html#packages-and-approaches-to-creating-ipms"><i class="fa fa-check"></i><b>17.3</b> Packages and approaches to creating IPMs</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="integral-population-models.html"><a href="integral-population-models.html#ipmr-a-modern-flexible-ipm-framework"><i class="fa fa-check"></i><b>17.3.1</b> ipmr: a modern, flexible IPM framework</a></li>
<li class="chapter" data-level="17.3.2" data-path="integral-population-models.html"><a href="integral-population-models.html#ipmpack-a-more-automated-ipm-workflow"><i class="fa fa-check"></i><b>17.3.2</b> IPMpack: a more automated IPM workflow</a></li>
<li class="chapter" data-level="17.3.3" data-path="integral-population-models.html"><a href="integral-population-models.html#hand-coded-ipms-maximum-transparency"><i class="fa fa-check"></i><b>17.3.3</b> Hand-coded IPMs: maximum transparency</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="integral-population-models.html"><a href="integral-population-models.html#building-an-ipm-structuring-linear-models-variable-transformations-and-dealing-with-outliers"><i class="fa fa-check"></i><b>17.4</b> Building an IPM: Structuring linear models, variable transformations, and dealing with outliers</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="integral-population-models.html"><a href="integral-population-models.html#variable-transformations-and-scale"><i class="fa fa-check"></i><b>17.4.1</b> Variable transformations and scale</a></li>
<li class="chapter" data-level="17.4.2" data-path="integral-population-models.html"><a href="integral-population-models.html#dealing-with-zeros-missing-values-and-outliers"><i class="fa fa-check"></i><b>17.4.2</b> Dealing with zeros, missing values, and outliers</a></li>
<li class="chapter" data-level="17.4.3" data-path="integral-population-models.html"><a href="integral-population-models.html#parallel-ipm-workflows"><i class="fa fa-check"></i><b>17.4.3</b> Parallel IPM workflows</a></li>
<li class="chapter" data-level="17.4.4" data-path="integral-population-models.html"><a href="integral-population-models.html#growth-transitions"><i class="fa fa-check"></i><b>17.4.4</b> Growth transitions</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="integral-population-models.html"><a href="integral-population-models.html#constructing-a-transition-matrix"><i class="fa fa-check"></i><b>17.5</b> Constructing a transition matrix</a></li>
<li class="chapter" data-level="17.6" data-path="integral-population-models.html"><a href="integral-population-models.html#building-an-ipm-boundary-points-mesh-points-and-step-size"><i class="fa fa-check"></i><b>17.6</b> Building an IPM: Boundary points, mesh points, and step size</a></li>
<li class="chapter" data-level="17.7" data-path="integral-population-models.html"><a href="integral-population-models.html#model-evaluation-eviction"><i class="fa fa-check"></i><b>17.7</b> Model Evaluation: Eviction</a>
<ul>
<li class="chapter" data-level="17.7.1" data-path="integral-population-models.html"><a href="integral-population-models.html#why-eviction-matters"><i class="fa fa-check"></i><b>17.7.1</b> Why Eviction Matters</a></li>
<li class="chapter" data-level="17.7.2" data-path="integral-population-models.html"><a href="integral-population-models.html#eviction-correction-strategies"><i class="fa fa-check"></i><b>17.7.2</b> Eviction Correction Strategies</a></li>
<li class="chapter" data-level="17.7.3" data-path="integral-population-models.html"><a href="integral-population-models.html#summary"><i class="fa fa-check"></i><b>17.7.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="17.8" data-path="integral-population-models.html"><a href="integral-population-models.html#estimating-population-dynamics-parameters"><i class="fa fa-check"></i><b>17.8</b> Estimating population dynamics parameters</a></li>
<li class="chapter" data-level="17.9" data-path="integral-population-models.html"><a href="integral-population-models.html#calculating-confidence-intervals"><i class="fa fa-check"></i><b>17.9</b> Calculating confidence intervals</a></li>
<li class="chapter" data-level="17.10" data-path="integral-population-models.html"><a href="integral-population-models.html#putting-this-all-together-in-code-form"><i class="fa fa-check"></i><b>17.10</b> Putting this all together in code form!</a></li>
<li class="chapter" data-level="17.11" data-path="integral-population-models.html"><a href="integral-population-models.html#test-your-knowledge-4"><i class="fa fa-check"></i><b>17.11</b> Test your knowledge</a></li>
<li class="chapter" data-level="17.12" data-path="integral-population-models.html"><a href="integral-population-models.html#assignment-5"><i class="fa fa-check"></i><b>17.12</b> Assignment</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>18</b> Spatial data</a></li>
<li class="chapter" data-level="19" data-path="read.html"><a href="read.html"><i class="fa fa-check"></i><b>19</b> Read</a></li>
<li class="chapter" data-level="20" data-path="check-structure.html"><a href="check-structure.html"><i class="fa fa-check"></i><b>20</b> Check structure</a></li>
<li class="chapter" data-level="21" data-path="write.html"><a href="write.html"><i class="fa fa-check"></i><b>21</b> Write</a></li>
<li class="chapter" data-level="22" data-path="read-1.html"><a href="read-1.html"><i class="fa fa-check"></i><b>22</b> Read</a></li>
<li class="chapter" data-level="23" data-path="check-properties.html"><a href="check-properties.html"><i class="fa fa-check"></i><b>23</b> Check properties</a></li>
<li class="chapter" data-level="24" data-path="write-1.html"><a href="write-1.html"><i class="fa fa-check"></i><b>24</b> Write</a></li>
<li class="chapter" data-level="25" data-path="create-neighbor-list.html"><a href="create-neighbor-list.html"><i class="fa fa-check"></i><b>25</b> Create neighbor list</a></li>
<li class="chapter" data-level="26" data-path="test-residuals.html"><a href="test-residuals.html"><i class="fa fa-check"></i><b>26</b> Test residuals</a></li>
<li class="chapter" data-level="27" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html"><i class="fa fa-check"></i><b>27</b> Species Distribution Modeling</a>
<ul>
<li class="chapter" data-level="27.1" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#introduction-1"><i class="fa fa-check"></i><b>27.1</b> Introduction</a></li>
<li class="chapter" data-level="27.2" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#a-brief-review-of-niche-theory"><i class="fa fa-check"></i><b>27.2</b> A brief review of niche theory</a></li>
<li class="chapter" data-level="27.3" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#downloads-for-this-lab"><i class="fa fa-check"></i><b>27.3</b> Downloads for this lab</a></li>
<li class="chapter" data-level="27.4" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#objectives-1"><i class="fa fa-check"></i><b>27.4</b> Objectives</a></li>
<li class="chapter" data-level="27.5" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#methods"><i class="fa fa-check"></i><b>27.5</b> Methods</a>
<ul>
<li class="chapter" data-level="27.5.1" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#lets-get-modeling"><i class="fa fa-check"></i><b>27.5.1</b> Let’s get modeling</a></li>
<li class="chapter" data-level="27.5.2" data-path="species-distribution-modeling.html"><a href="species-distribution-modeling.html#run-the-r-code"><i class="fa fa-check"></i><b>27.5.2</b> Run the R code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="28" data-path="diversity-statistics.html"><a href="diversity-statistics.html"><i class="fa fa-check"></i><b>28</b> Diversity statistics</a>
<ul>
<li class="chapter" data-level="28.1" data-path="diversity-statistics.html"><a href="diversity-statistics.html#inext"><i class="fa fa-check"></i><b>28.1</b> iNext</a></li>
<li class="chapter" data-level="28.2" data-path="diversity-statistics.html"><a href="diversity-statistics.html#coveragebased-re-sampling-curves"><i class="fa fa-check"></i><b>28.2</b> Coverage‐based R/E sampling curves</a></li>
<li class="chapter" data-level="28.3" data-path="diversity-statistics.html"><a href="diversity-statistics.html#data-manipulation"><i class="fa fa-check"></i><b>28.3</b> Data manipulation</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ordination-station.html"><a href="ordination-station.html"><i class="fa fa-check"></i><b>29</b> Ordination station</a></li>
<li class="chapter" data-level="30" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html"><i class="fa fa-check"></i><b>30</b> What are structural equation models?</a>
<ul>
<li class="chapter" data-level="30.0.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#when-should-you-use-sem"><i class="fa fa-check"></i><b>30.0.1</b> When Should You Use SEM?</a></li>
<li class="chapter" data-level="30.0.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#how-is-sem-different-from-multiple-regression"><i class="fa fa-check"></i><b>30.0.2</b> How is SEM Different from Multiple Regression?</a></li>
<li class="chapter" data-level="30.0.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#summary-1"><i class="fa fa-check"></i><b>30.0.3</b> Summary</a></li>
<li class="chapter" data-level="30.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#anatomy-of-a-structural-equation-model"><i class="fa fa-check"></i><b>30.1</b> Anatomy of a Structural Equation Model</a>
<ul>
<li class="chapter" data-level="30.1.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#types-of-variables"><i class="fa fa-check"></i><b>30.1.1</b> Types of Variables</a></li>
<li class="chapter" data-level="30.1.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#path-diagrams"><i class="fa fa-check"></i><b>30.1.2</b> Path Diagrams</a></li>
</ul></li>
<li class="chapter" data-level="30.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#building-multivariate-models"><i class="fa fa-check"></i><b>30.2</b> Building Multivariate Models</a>
<ul>
<li class="chapter" data-level="30.2.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#what-is-causality"><i class="fa fa-check"></i><b>30.2.1</b> What is Causality?</a></li>
<li class="chapter" data-level="30.2.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#why-move-beyond-multiple-regression"><i class="fa fa-check"></i><b>30.2.2</b> Why move beyond Multiple Regression?</a></li>
<li class="chapter" data-level="30.2.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#meta-modeling-your-system"><i class="fa fa-check"></i><b>30.2.3</b> Meta-Modeling Your System</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#from-concept-to-model"><i class="fa fa-check"></i><b>30.3</b> From Concept to Model</a></li>
<li class="chapter" data-level="30.4" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#common-structures-in-causal-diagrams"><i class="fa fa-check"></i><b>30.4</b> Common Structures in Causal Diagrams</a>
<ul>
<li class="chapter" data-level="30.4.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chains-mediation-paths"><i class="fa fa-check"></i><b>30.4.1</b> Chains (Mediation Paths)</a></li>
<li class="chapter" data-level="30.4.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#colliders"><i class="fa fa-check"></i><b>30.4.2</b> Colliders</a></li>
<li class="chapter" data-level="30.4.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#forks-confounding-paths"><i class="fa fa-check"></i><b>30.4.3</b> Forks (Confounding Paths)</a></li>
<li class="chapter" data-level="30.4.4" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#descendants-of-colliders"><i class="fa fa-check"></i><b>30.4.4</b> Descendants of Colliders</a></li>
<li class="chapter" data-level="30.4.5" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#summary-of-strcutures"><i class="fa fa-check"></i><b>30.4.5</b> Summary of strcutures</a></li>
<li class="chapter" data-level="30.4.6" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#identifying-causality"><i class="fa fa-check"></i><b>30.4.6</b> Identifying Causality</a></li>
<li class="chapter" data-level="30.4.7" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#backdoor-criterion"><i class="fa fa-check"></i><b>30.4.7</b> Backdoor Criterion</a></li>
<li class="chapter" data-level="30.4.8" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#frontdoor-criterion"><i class="fa fa-check"></i><b>30.4.8</b> Frontdoor Criterion</a></li>
<li class="chapter" data-level="30.4.9" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#build-your-own-dag-sem-case-study-on-pollinator-impacts-of-vegetation-management"><i class="fa fa-check"></i><b>30.4.9</b> Build your own DAG: SEM Case Study on Pollinator Impacts of Vegetation Management</a></li>
<li class="chapter" data-level="30.4.10" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#adjustment-sets"><i class="fa fa-check"></i><b>30.4.10</b> Adjustment Sets</a></li>
</ul></li>
<li class="chapter" data-level="30.5" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-5-covariance-based-estimation-in-sem"><i class="fa fa-check"></i><b>30.5</b> Chapter 5: Covariance-Based Estimation in SEM</a>
<ul>
<li class="chapter" data-level="30.5.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#what-is-covariance-based-sem"><i class="fa fa-check"></i><b>30.5.1</b> What is Covariance-Based SEM?</a></li>
<li class="chapter" data-level="30.5.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>30.5.2</b> Maximum Likelihood Estimation</a></li>
<li class="chapter" data-level="30.5.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#assumptions-behind-ml-estimation"><i class="fa fa-check"></i><b>30.5.3</b> Assumptions Behind ML Estimation</a></li>
<li class="chapter" data-level="30.5.4" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#identifiability"><i class="fa fa-check"></i><b>30.5.4</b> Identifiability</a></li>
<li class="chapter" data-level="30.5.5" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#degrees-of-freedom"><i class="fa fa-check"></i><b>30.5.5</b> Degrees of Freedom</a></li>
<li class="chapter" data-level="30.5.6" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#sample-size-considerations"><i class="fa fa-check"></i><b>30.5.6</b> Sample Size Considerations</a></li>
<li class="chapter" data-level="30.5.7" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#summary-2"><i class="fa fa-check"></i><b>30.5.7</b> Summary</a></li>
<li class="chapter" data-level="30.5.8" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-6-structural-equation-modeling-in-r-with-lavaan"><i class="fa fa-check"></i><b>30.5.8</b> Chapter 6: Structural Equation Modeling in R with lavaan</a></li>
</ul></li>
<li class="chapter" data-level="30.6" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#getting-started-with-lavaan-model-specification-estimation-and-interpretation"><i class="fa fa-check"></i><b>30.6</b> Getting Started with lavaan – Model Specification, Estimation, and Interpretation</a>
<ul>
<li class="chapter" data-level="30.6.1" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-7assessing-fit-and-normality"><i class="fa fa-check"></i><b>30.6.1</b> Chapter 7:Assessing Fit and Normality</a></li>
<li class="chapter" data-level="30.6.2" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-8-comparing-models-and-testing-mediation"><i class="fa fa-check"></i><b>30.6.2</b> Chapter 8: Comparing Models and Testing Mediation</a></li>
<li class="chapter" data-level="30.6.3" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-8-latent-variables-as-drivers"><i class="fa fa-check"></i><b>30.6.3</b> Chapter 8: Latent Variables as Drivers</a></li>
<li class="chapter" data-level="30.6.4" data-path="what-are-structural-equation-models.html"><a href="what-are-structural-equation-models.html#chapter-10-latent-responses-and-measurement-error"><i class="fa fa-check"></i><b>30.6.4</b> Chapter 10: Latent Responses and Measurement Error</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="31" data-path="piecewise-sems.html"><a href="piecewise-sems.html"><i class="fa fa-check"></i><b>31</b> Piecewise SEMs</a>
<ul>
<li class="chapter" data-level="31.1" data-path="piecewise-sems.html"><a href="piecewise-sems.html#overview"><i class="fa fa-check"></i><b>31.1</b> Overview</a></li>
<li class="chapter" data-level="31.2" data-path="piecewise-sems.html"><a href="piecewise-sems.html#why-use-piecewise-sem-instead-of-a-covariance-sem"><i class="fa fa-check"></i><b>31.2</b> Why Use Piecewise SEM, instead of a covariance SEM?</a>
<ul>
<li class="chapter" data-level="31.2.1" data-path="piecewise-sems.html"><a href="piecewise-sems.html#comparison-of-sem-approaches"><i class="fa fa-check"></i><b>31.2.1</b> Comparison of SEM Approaches</a></li>
<li class="chapter" data-level="31.2.2" data-path="piecewise-sems.html"><a href="piecewise-sems.html#benefits-of-covariance-based-sem"><i class="fa fa-check"></i><b>31.2.2</b> Benefits of Covariance-Based SEM</a></li>
<li class="chapter" data-level="31.2.3" data-path="piecewise-sems.html"><a href="piecewise-sems.html#benefits-of-piecewise-sem"><i class="fa fa-check"></i><b>31.2.3</b> Benefits of Piecewise SEM</a></li>
<li class="chapter" data-level="31.2.4" data-path="piecewise-sems.html"><a href="piecewise-sems.html#when-to-use-each-approach"><i class="fa fa-check"></i><b>31.2.4</b> When to Use Each Approach</a></li>
<li class="chapter" data-level="31.2.5" data-path="piecewise-sems.html"><a href="piecewise-sems.html#models-differ-in-approach"><i class="fa fa-check"></i><b>31.2.5</b> Models differ in approach</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="piecewise-sems.html"><a href="piecewise-sems.html#sem-example-resilience-to-drought-in-arizona"><i class="fa fa-check"></i><b>31.3</b> SEM Example: Resilience to Drought in Arizona</a>
<ul>
<li class="chapter" data-level="31.3.1" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-12-introduction-to-piecewise-sem-in-r"><i class="fa fa-check"></i><b>31.3.1</b> Chapter 12: Introduction to Piecewise SEM in R</a></li>
</ul></li>
<li class="chapter" data-level="31.4" data-path="piecewise-sems.html"><a href="piecewise-sems.html#part-1-what-is-piecewise-sem"><i class="fa fa-check"></i><b>31.4</b> Part 1: What is Piecewise SEM?</a>
<ul>
<li class="chapter" data-level="31.4.1" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-13-nonlinearity-and-interaction-in-sem"><i class="fa fa-check"></i><b>31.4.1</b> Chapter 13: Nonlinearity and Interaction in SEM</a></li>
<li class="chapter" data-level="31.4.2" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-14-glms-with-sem-using-piecewisesem"><i class="fa fa-check"></i><b>31.4.2</b> Chapter 14: GLMs with SEM using PiecewiseSEM</a></li>
</ul></li>
<li class="chapter" data-level="31.5" data-path="piecewise-sems.html"><a href="piecewise-sems.html#overview-1"><i class="fa fa-check"></i><b>31.5</b> Overview</a>
<ul>
<li class="chapter" data-level="31.5.1" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-15-categorical-predictors-multigroup-sem"><i class="fa fa-check"></i><b>31.5.1</b> Chapter 15: Categorical Predictors &amp; Multigroup SEM</a></li>
<li class="chapter" data-level="31.5.2" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-16-multigroup-sem-in-r"><i class="fa fa-check"></i><b>31.5.2</b> Chapter 16: Multigroup SEM in R</a></li>
<li class="chapter" data-level="31.5.3" data-path="piecewise-sems.html"><a href="piecewise-sems.html#chapter-17"><i class="fa fa-check"></i><b>31.5.3</b> Chapter 17:</a></li>
</ul></li>
<li class="chapter" data-level="31.6" data-path="piecewise-sems.html"><a href="piecewise-sems.html#example-with-powerline-data"><i class="fa fa-check"></i><b>31.6</b> Example with Powerline Data</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="permuting-your-brains-out.html"><a href="permuting-your-brains-out.html"><i class="fa fa-check"></i><b>32</b> Permuting your brains out</a></li>
<li class="divider"></li>
<li><a href="https://github.com/sarasouther/DataAnalysis" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Statistics for the Natural Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="integral-population-models" class="section level1 hasAnchor" number="17">
<h1><span class="header-section-number">Chapter 17</span> Integral Population Models<a href="integral-population-models.html#integral-population-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="case-study-modeling-an-endangered-hawaiian-plant" class="section level2 hasAnchor" number="17.1">
<h2><span class="header-section-number">17.1</span> Case Study: Modeling an Endangered Hawaiian Plant<a href="integral-population-models.html#case-study-modeling-an-endangered-hawaiian-plant" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For our applied example, we’ll build a population model for <em>Silene lanceolata</em> (lanceolate catchfly), a small woody shrub endemic to the Hawaiian Islands. This species is federally listed as threatened/endangered and faces multiple conservation challenges that make it an ideal candidate for demographic modeling.</p>
<div id="why-model-s.-lanceolata-populations" class="section level3 hasAnchor" number="17.1.1">
<h3><span class="header-section-number">17.1.1</span> Why model S. lanceolata populations?<a href="integral-population-models.html#why-model-s.-lanceolata-populations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Hawaiian plant species like S. lanceolata occur in small, isolated populations that are particularly vulnerable to extinction. At Pōhakuloa Training Area (PTA) on Hawaii Island, these native plants face a perfect storm of threats:</p>
<ul>
<li>Invasive plant competition: Fountain grass (<em>Cenchrus setaceus</em>) and fireweed (<em>Senecio madagascariensis</em>) outcompete native species for water, light, and space</li>
<li>Altered fire regimes: Invasive grasses produce fine fuels that dramatically increase fire frequency—a disturbance to which Hawaiian plants have no evolutionary adaptations</li>
<li>Climate change: Increasing drought frequency threatens plants already stressed by competition and fire</li>
<li>Small population sizes: Limited numbers mean that small changes in vital rates (survival, growth, reproduction) can have large consequences for extinction risk</li>
</ul>
</div>
<div id="the-management-question" class="section level3 hasAnchor" number="17.1.2">
<h3><span class="header-section-number">17.1.2</span> The management question:<a href="integral-population-models.html#the-management-question" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Conservation managers need to decide how to allocate limited resources. Should they prioritize invasive plant control? Focus on fire suppression? Protect certain life stages? Population models allow us to project population trajectories under different management scenarios and identify which vital rates have the greatest influence on population growth.
In this example, we’ll use demographic data collected from field studies at PTA to build an Integral Projection Model (IPM) that links individual plant size to survival, growth, and reproduction. This will allow us to evaluate how management actions might influence <em>S. lanceolata</em> persistence.</p>
</div>
</div>
<div id="designing-a-demographic-census-timing-and-measurements" class="section level2 hasAnchor" number="17.2">
<h2><span class="header-section-number">17.2</span> Designing a Demographic Census: Timing and Measurements<a href="integral-population-models.html#designing-a-demographic-census-timing-and-measurements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we dive into building the population model, let’s review how demographic data are collected. The design of a census protocol involves several critical decisions that directly impact the quality and interpretability of your population projections.</p>
<div id="principle-1-census-timing-must-align-with-the-organisms-life-cycle" class="section level3 hasAnchor" number="17.2.1">
<h3><span class="header-section-number">17.2.1</span> Principle 1: Census Timing Must Align with the Organism’s Life Cycle<a href="integral-population-models.html#principle-1-census-timing-must-align-with-the-organisms-life-cycle" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For demographic models to be meaningful, censuses must occur at regular intervals that correspond to biologically relevant time steps. Ideally, you want to census:</p>
<p>At the same time each year to capture consistent population states
Before or after major demographic events (reproduction, mortality pulses, germination)
When individuals are most visible/measurable for accurate data collection</p>
<p>For <em>S. lanceolata</em> at Pōhakuloa Training Area, we faced practical constraints. While Hawaii lacks dramatic seasonal variation in temperature, the species does show phenological patterns. We conducted censuses in summer for several pragmatic reasons:</p>
<ul>
<li>Field accessibility: Summer weather allowed consistent access to remote field sites</li>
<li>Plant visibility: Woody shrubs maintain their structure year-round, but summer timing captured both vegetative and reproductive activity</li>
<li>Logistical feasibility: Research team availability and funding cycles</li>
</ul>
<p>The key is that we censused at the same time each year, allowing us to track year-to-year changes in a standardized way. Our annual time step (summer to summer) captures one full cycle of growth, reproduction, and survival.</p>
</div>
<div id="principle-2-measurements-must-link-to-vital-rates" class="section level3 hasAnchor" number="17.2.2">
<h3><span class="header-section-number">17.2.2</span> Principle 2: Measurements Must Link to Vital Rates<a href="integral-population-models.html#principle-2-measurements-must-link-to-vital-rates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Demographic models require data on survival, growth, and reproduction. The measurements we collect must allow us to estimate these vital rates. For <em>S. lanceolata</em>, we structured our census to capture:</p>
<ul>
<li><p>Size Measurements (for survival and growth): We measured multiple aspects of plant size because size often predicts both survival probability and reproductive output:</p>
<ul>
<li>Foliated length of longest branch (cm): Captures vegetative vigor and photosynthetic capacity</li>
<li>Plant height (cm): Structural size metric, indicates establishment and competitive ability</li>
<li>Plant height with reproductive stalk (cm): Total height including reproductive structures</li>
<li>Stem diameter (cm): Proxy for plant age and woody biomass accumulation</li>
<li>Number of branches (n): Architectural complexity, related to resource acquisition</li>
</ul></li>
</ul>
<p>For our Integral Projection Model (IPM), we’ll select one primary size variable that best predicts survival, growth, and fecundity. Often this is stem diameter or height, but we measured multiple metrics to explore which is most predictive.</p>
<ul>
<li><p>Reproductive Measurements (for fecundity): To estimate how many offspring each individual produces, we counted:</p></li>
<li><p>Number of inflorescences (n): Reproductive effort (number of flowering stalks)</p></li>
<li><p>Number of flowers and seed heads per stalk: Potential and realized seed production</p></li>
<li><p>Seeds per fruit: Obtained from literature since counting tiny seeds in the field is impractical</p></li>
</ul>
<p>These measurements allow us to build a size-fecundity function: larger plants typically produce more inflorescences, more flowers, and ultimately more seeds.</p>
</div>
<div id="principle-3-track-individual-fates-through-time" class="section level3 hasAnchor" number="17.2.3">
<h3><span class="header-section-number">17.2.3</span> Principle 3: Track Individual Fates Through Time<a href="integral-population-models.html#principle-3-track-individual-fates-through-time" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The power of demographic models comes from tracking individuals across census intervals:</p>
<ul>
<li>Did this individual survive from year t to year t+1?</li>
<li>If it survived, how much did it grow (change in size)?</li>
<li>How many offspring did it produce?</li>
</ul>
<p>This requires marking individual plants (tags, GPS coordinates, maps) so we can relocate them in subsequent years. For S. lanceolata, each plant received a unique identifier allowing us to build a longitudinal dataset of individual life histories.</p>
</div>
<div id="principle-4-document-context-and-threats" class="section level3 hasAnchor" number="17.2.4">
<h3><span class="header-section-number">17.2.4</span> Principle 4: Document Context and Threats<a href="integral-population-models.html#principle-4-document-context-and-threats" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Beyond demographic measurements, we recorded factors that might explain variation in vital rates:</p>
<ul>
<li>Browse damage: Evidence of herbivory (ungulates, insects)</li>
<li>Fire history: Burned vs. unburned individuals</li>
<li>Disease/stress: Chlorosis, wilting, pathogen damage</li>
<li>Proximity to invasive plants: Competition effects</li>
</ul>
<p>These covariates allow us to ask: Does fire reduce survival? Do plants near fountain grass grow more slowly? Does herbivory reduce reproduction?</p>
<p>Let’s check out data from our initial collection trip:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="integral-population-models.html#cb159-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb159-2"><a href="integral-population-models.html#cb159-2" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb159-3"><a href="integral-population-models.html#cb159-3" tabindex="-1"></a></span>
<span id="cb159-4"><a href="integral-population-models.html#cb159-4" tabindex="-1"></a><span class="co"># Create data directory if it doesn&#39;t exist</span></span>
<span id="cb159-5"><a href="integral-population-models.html#cb159-5" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;data&quot;</span>)) <span class="fu">dir.create</span>(<span class="st">&quot;data&quot;</span>)</span>
<span id="cb159-6"><a href="integral-population-models.html#cb159-6" tabindex="-1"></a></span>
<span id="cb159-7"><a href="integral-population-models.html#cb159-7" tabindex="-1"></a><span class="co"># Google Drive file ID</span></span>
<span id="cb159-8"><a href="integral-population-models.html#cb159-8" tabindex="-1"></a>file_id <span class="ot">&lt;-</span> <span class="st">&quot;1WCToCDAuSR_Wd2ScRy9yhwiDGijL47OX&quot;</span></span>
<span id="cb159-9"><a href="integral-population-models.html#cb159-9" tabindex="-1"></a></span>
<span id="cb159-10"><a href="integral-population-models.html#cb159-10" tabindex="-1"></a><span class="fu">GET</span>(</span>
<span id="cb159-11"><a href="integral-population-models.html#cb159-11" tabindex="-1"></a>  <span class="at">url =</span> <span class="fu">paste0</span>(</span>
<span id="cb159-12"><a href="integral-population-models.html#cb159-12" tabindex="-1"></a>    <span class="st">&quot;https://drive.usercontent.google.com/download?id=&quot;</span>, </span>
<span id="cb159-13"><a href="integral-population-models.html#cb159-13" tabindex="-1"></a>    file_id, <span class="st">&quot;&amp;export=download&amp;confirm=t&quot;</span></span>
<span id="cb159-14"><a href="integral-population-models.html#cb159-14" tabindex="-1"></a>  ),</span>
<span id="cb159-15"><a href="integral-population-models.html#cb159-15" tabindex="-1"></a>  <span class="fu">write_disk</span>(<span class="st">&quot;data/silene_census.csv&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb159-16"><a href="integral-population-models.html#cb159-16" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Response [https://drive.usercontent.google.com/download?id=1WCToCDAuSR_Wd2ScRy9yhwiDGijL47OX&amp;export=download&amp;confirm=t]
##   Date: 2026-01-18 02:26
##   Status: 200
##   Content-Type: application/octet-stream
##   Size: 5.03 kB
## &lt;ON DISK&gt;  /Users/sks379/Desktop/GitHubProjects/DataAnalysis/data/silene_census.csv</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="integral-population-models.html#cb161-1" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb161-2"><a href="integral-population-models.html#cb161-2" tabindex="-1"></a>silene <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/silene_census.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb161-3"><a href="integral-population-models.html#cb161-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>...<span class="dv">1</span>)  <span class="co"># Remove row number column</span></span>
<span id="cb161-4"><a href="integral-population-models.html#cb161-4" tabindex="-1"></a></span>
<span id="cb161-5"><a href="integral-population-models.html#cb161-5" tabindex="-1"></a><span class="co"># Quick summary</span></span>
<span id="cb161-6"><a href="integral-population-models.html#cb161-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dataset dimensions:&quot;</span>, <span class="fu">nrow</span>(silene), <span class="st">&quot;rows x&quot;</span>, <span class="fu">ncol</span>(silene), <span class="st">&quot;columns</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Dataset dimensions: 100 rows x 11 columns</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="integral-population-models.html#cb163-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Number of unique individuals:&quot;</span>, <span class="fu">n_distinct</span>(silene<span class="sc">$</span>UniqueID), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Number of unique individuals: 100</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="integral-population-models.html#cb165-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Weed control treatments:&quot;</span>, <span class="fu">paste</span>(<span class="fu">unique</span>(silene<span class="sc">$</span>WeedControl), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Weed control treatments: C, W</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="integral-population-models.html#cb167-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Map units:&quot;</span>, <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(silene<span class="sc">$</span>MapUnit)), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Map units: 1, 2, 3</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="integral-population-models.html#cb169-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Proportion reproduced:&quot;</span>, <span class="fu">mean</span>(silene<span class="sc">$</span>Reproduced), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Proportion reproduced: 0.44</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="integral-population-models.html#cb171-1" tabindex="-1"></a><span class="fu">glimpse</span>(silene)</span></code></pre></div>
<pre><code>## Rows: 100
## Columns: 11
## $ UniqueID                    &lt;chr&gt; &quot;Bobcat03_1&quot;, &quot;Bobcat03_2&quot;, &quot;Bobcat03_3&quot;, &quot;Bobcat03_4&quot;, &quot;Bobcat…
## $ WeedControl                 &lt;chr&gt; &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;, &quot;C&quot;…
## $ MapUnit                     &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
## $ VegHeight                   &lt;dbl&gt; 5.4, 42.6, 8.3, 2.5, 31.0, 26.8, 39.1, 18.5, 14.4, 6.8, 18.5, 1…
## $ VegReproHeight              &lt;dbl&gt; 5.4, 56.4, 8.3, 2.5, 31.0, 44.2, 53.6, 18.5, 14.4, 6.8, 18.5, 1…
## $ StemDiameter                &lt;dbl&gt; 0.18, 0.30, 0.12, 0.06, 0.22, 0.19, 0.29, 0.17, 0.24, 0.15, 0.1…
## $ StemNum                     &lt;dbl&gt; 0, 6, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ LengthLongestBranchwFoliage &lt;dbl&gt; 3.7, 1.0, 5.8, 1.5, 22.4, 18.0, 24.0, 16.4, 8.8, 4.3, 12.8, 5.1…
## $ InflorNum                   &lt;dbl&gt; 0, 6, 0, 0, 0, 4, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ Reproduced                  &lt;dbl&gt; 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
## $ TotalReproOutput            &lt;dbl&gt; 0, 21, 0, 0, 0, 26, 36, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
<div id="understanding-state-variables-in-ipms" class="section level3 hasAnchor" number="17.2.5">
<h3><span class="header-section-number">17.2.5</span> Understanding State Variables in IPMs<a href="integral-population-models.html#understanding-state-variables-in-ipms" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In an Integral Projection Model (IPM), we need to choose a state variable that describes the “state” of each individual in the population. This variable must:</p>
<ul>
<li>Predict vital rates: Larger/older individuals typically have different survival, growth, and reproduction than smaller/younger ones</li>
<li>Be continuously measured: IPMs work with continuous size distributions (unlike matrix models with discrete stages)</li>
<li>Be measurable across time: We need to track how individuals change in this variable from year to year</li>
<li>Capture biological meaningful variation: The variable should reflect real differences in demographic performance</li>
</ul>
<p>Common state variables in plant IPMs:</p>
<ul>
<li>Stem diameter</li>
<li>Plant height</li>
<li>Basal area</li>
<li>Number of stems/ramets</li>
<li>Leaf area</li>
</ul>
<p>Let’s explore our data to identify the best state variable for <em>S. lanceolata</em>.</p>
</div>
<div id="explore-potential-state-variables" class="section level3 hasAnchor" number="17.2.6">
<h3><span class="header-section-number">17.2.6</span> Explore Potential State Variables<a href="integral-population-models.html#explore-potential-state-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="integral-population-models.html#cb173-1" tabindex="-1"></a><span class="co"># Summary of candidate state variables</span></span>
<span id="cb173-2"><a href="integral-population-models.html#cb173-2" tabindex="-1"></a>state_summary <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb173-3"><a href="integral-population-models.html#cb173-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb173-4"><a href="integral-population-models.html#cb173-4" tabindex="-1"></a>    <span class="at">n_plants =</span> <span class="fu">n</span>(),</span>
<span id="cb173-5"><a href="integral-population-models.html#cb173-5" tabindex="-1"></a>    </span>
<span id="cb173-6"><a href="integral-population-models.html#cb173-6" tabindex="-1"></a>    <span class="co"># Continuous size measurements</span></span>
<span id="cb173-7"><a href="integral-population-models.html#cb173-7" tabindex="-1"></a>    <span class="at">mean_stem_diam =</span> <span class="fu">mean</span>(StemDiameter, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-8"><a href="integral-population-models.html#cb173-8" tabindex="-1"></a>    <span class="at">sd_stem_diam =</span> <span class="fu">sd</span>(StemDiameter, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-9"><a href="integral-population-models.html#cb173-9" tabindex="-1"></a>    </span>
<span id="cb173-10"><a href="integral-population-models.html#cb173-10" tabindex="-1"></a>    <span class="at">mean_height_veg =</span> <span class="fu">mean</span>(VegHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-11"><a href="integral-population-models.html#cb173-11" tabindex="-1"></a>    <span class="at">sd_height_veg =</span> <span class="fu">sd</span>(VegHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-12"><a href="integral-population-models.html#cb173-12" tabindex="-1"></a>    </span>
<span id="cb173-13"><a href="integral-population-models.html#cb173-13" tabindex="-1"></a>    <span class="at">mean_height_repro =</span> <span class="fu">mean</span>(VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-14"><a href="integral-population-models.html#cb173-14" tabindex="-1"></a>    <span class="at">sd_height_repro =</span> <span class="fu">sd</span>(VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-15"><a href="integral-population-models.html#cb173-15" tabindex="-1"></a>    </span>
<span id="cb173-16"><a href="integral-population-models.html#cb173-16" tabindex="-1"></a>    <span class="at">mean_branch_length =</span> <span class="fu">mean</span>(LengthLongestBranchwFoliage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-17"><a href="integral-population-models.html#cb173-17" tabindex="-1"></a>    <span class="at">sd_branch_length =</span> <span class="fu">sd</span>(LengthLongestBranchwFoliage, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-18"><a href="integral-population-models.html#cb173-18" tabindex="-1"></a>    </span>
<span id="cb173-19"><a href="integral-population-models.html#cb173-19" tabindex="-1"></a>    <span class="co"># Count variables</span></span>
<span id="cb173-20"><a href="integral-population-models.html#cb173-20" tabindex="-1"></a>    <span class="at">mean_stems =</span> <span class="fu">mean</span>(StemNum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-21"><a href="integral-population-models.html#cb173-21" tabindex="-1"></a>    <span class="at">sd_stems =</span> <span class="fu">sd</span>(StemNum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-22"><a href="integral-population-models.html#cb173-22" tabindex="-1"></a>    </span>
<span id="cb173-23"><a href="integral-population-models.html#cb173-23" tabindex="-1"></a>    <span class="co"># Reproduction</span></span>
<span id="cb173-24"><a href="integral-population-models.html#cb173-24" tabindex="-1"></a>    <span class="at">mean_inflor =</span> <span class="fu">mean</span>(InflorNum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-25"><a href="integral-population-models.html#cb173-25" tabindex="-1"></a>    <span class="at">sd_inflor =</span> <span class="fu">sd</span>(InflorNum, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-26"><a href="integral-population-models.html#cb173-26" tabindex="-1"></a>    <span class="at">mean_repro =</span> <span class="fu">mean</span>(TotalReproOutput, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-27"><a href="integral-population-models.html#cb173-27" tabindex="-1"></a>    <span class="at">sd_repro =</span> <span class="fu">sd</span>(TotalReproOutput, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb173-28"><a href="integral-population-models.html#cb173-28" tabindex="-1"></a>    <span class="at">prop_reproduced =</span> <span class="fu">mean</span>(Reproduced, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb173-29"><a href="integral-population-models.html#cb173-29" tabindex="-1"></a>  )</span>
<span id="cb173-30"><a href="integral-population-models.html#cb173-30" tabindex="-1"></a></span>
<span id="cb173-31"><a href="integral-population-models.html#cb173-31" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">t</span>(state_summary), <span class="at">col.names =</span> <span class="st">&quot;Value&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb173-32"><a href="integral-population-models.html#cb173-32" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Summary statistics for potential state variables&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-56">Table 17.1: </span>Summary statistics for potential state variables</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">n_plants</td>
<td align="right">100.00</td>
</tr>
<tr class="even">
<td align="left">mean_stem_diam</td>
<td align="right">0.54</td>
</tr>
<tr class="odd">
<td align="left">sd_stem_diam</td>
<td align="right">0.68</td>
</tr>
<tr class="even">
<td align="left">mean_height_veg</td>
<td align="right">49.33</td>
</tr>
<tr class="odd">
<td align="left">sd_height_veg</td>
<td align="right">43.32</td>
</tr>
<tr class="even">
<td align="left">mean_height_repro</td>
<td align="right">56.00</td>
</tr>
<tr class="odd">
<td align="left">sd_height_repro</td>
<td align="right">49.77</td>
</tr>
<tr class="even">
<td align="left">mean_branch_length</td>
<td align="right">12.03</td>
</tr>
<tr class="odd">
<td align="left">sd_branch_length</td>
<td align="right">7.14</td>
</tr>
<tr class="even">
<td align="left">mean_stems</td>
<td align="right">1.29</td>
</tr>
<tr class="odd">
<td align="left">sd_stems</td>
<td align="right">1.80</td>
</tr>
<tr class="even">
<td align="left">mean_inflor</td>
<td align="right">3.98</td>
</tr>
<tr class="odd">
<td align="left">sd_inflor</td>
<td align="right">6.67</td>
</tr>
<tr class="even">
<td align="left">mean_repro</td>
<td align="right">17.86</td>
</tr>
<tr class="odd">
<td align="left">sd_repro</td>
<td align="right">24.89</td>
</tr>
<tr class="even">
<td align="left">prop_reproduced</td>
<td align="right">0.44</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="integral-population-models.html#cb174-1" tabindex="-1"></a><span class="co"># Check for missing data</span></span>
<span id="cb174-2"><a href="integral-population-models.html#cb174-2" tabindex="-1"></a>missing_data <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb174-3"><a href="integral-population-models.html#cb174-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">|&gt;</span></span>
<span id="cb174-4"><a href="integral-population-models.html#cb174-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;Variable&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Missing&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb174-5"><a href="integral-population-models.html#cb174-5" tabindex="-1"></a>  <span class="fu">filter</span>(Missing <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb174-6"><a href="integral-population-models.html#cb174-6" tabindex="-1"></a></span>
<span id="cb174-7"><a href="integral-population-models.html#cb174-7" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(missing_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb174-8"><a href="integral-population-models.html#cb174-8" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Missing data detected:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb174-9"><a href="integral-population-models.html#cb174-9" tabindex="-1"></a>  <span class="fu">print</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(missing_data))</span>
<span id="cb174-10"><a href="integral-population-models.html#cb174-10" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb174-11"><a href="integral-population-models.html#cb174-11" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ No missing data in size measurements!</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb174-12"><a href="integral-population-models.html#cb174-12" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## 
## ✓ No missing data in size measurements!</code></pre>
</div>
<div id="visualize-distribution-of-candidate-state-variables" class="section level3 hasAnchor" number="17.2.7">
<h3><span class="header-section-number">17.2.7</span> Visualize Distribution of Candidate State Variables<a href="integral-population-models.html#visualize-distribution-of-candidate-state-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="integral-population-models.html#cb176-1" tabindex="-1"></a><span class="co"># Reshape data for plotting</span></span>
<span id="cb176-2"><a href="integral-population-models.html#cb176-2" tabindex="-1"></a>state_vars_long <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb176-3"><a href="integral-population-models.html#cb176-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb176-4"><a href="integral-population-models.html#cb176-4" tabindex="-1"></a>    UniqueID, </span>
<span id="cb176-5"><a href="integral-population-models.html#cb176-5" tabindex="-1"></a>    StemDiameter,</span>
<span id="cb176-6"><a href="integral-population-models.html#cb176-6" tabindex="-1"></a>    VegHeight,</span>
<span id="cb176-7"><a href="integral-population-models.html#cb176-7" tabindex="-1"></a>    VegReproHeight,</span>
<span id="cb176-8"><a href="integral-population-models.html#cb176-8" tabindex="-1"></a>    LengthLongestBranchwFoliage,</span>
<span id="cb176-9"><a href="integral-population-models.html#cb176-9" tabindex="-1"></a>    StemNum</span>
<span id="cb176-10"><a href="integral-population-models.html#cb176-10" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb176-11"><a href="integral-population-models.html#cb176-11" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb176-12"><a href="integral-population-models.html#cb176-12" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>UniqueID,</span>
<span id="cb176-13"><a href="integral-population-models.html#cb176-13" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb176-14"><a href="integral-population-models.html#cb176-14" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span></span>
<span id="cb176-15"><a href="integral-population-models.html#cb176-15" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb176-16"><a href="integral-population-models.html#cb176-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb176-17"><a href="integral-population-models.html#cb176-17" tabindex="-1"></a>    <span class="at">variable =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(</span>
<span id="cb176-18"><a href="integral-population-models.html#cb176-18" tabindex="-1"></a>      variable,</span>
<span id="cb176-19"><a href="integral-population-models.html#cb176-19" tabindex="-1"></a>      <span class="at">StemDiameter =</span> <span class="st">&quot;Stem Diameter (cm)&quot;</span>,</span>
<span id="cb176-20"><a href="integral-population-models.html#cb176-20" tabindex="-1"></a>      <span class="at">VegHeight =</span> <span class="st">&quot;Vegetative Height (cm)&quot;</span>,</span>
<span id="cb176-21"><a href="integral-population-models.html#cb176-21" tabindex="-1"></a>      <span class="at">VegReproHeight =</span> <span class="st">&quot;Height with Repro (cm)&quot;</span>,</span>
<span id="cb176-22"><a href="integral-population-models.html#cb176-22" tabindex="-1"></a>      <span class="at">LengthLongestBranchwFoliage =</span> <span class="st">&quot;Longest Branch w/ Foliage (cm)&quot;</span>,</span>
<span id="cb176-23"><a href="integral-population-models.html#cb176-23" tabindex="-1"></a>      <span class="at">StemNum =</span> <span class="st">&quot;Number of Stems&quot;</span></span>
<span id="cb176-24"><a href="integral-population-models.html#cb176-24" tabindex="-1"></a>    )</span>
<span id="cb176-25"><a href="integral-population-models.html#cb176-25" tabindex="-1"></a>  )</span>
<span id="cb176-26"><a href="integral-population-models.html#cb176-26" tabindex="-1"></a></span>
<span id="cb176-27"><a href="integral-population-models.html#cb176-27" tabindex="-1"></a><span class="co"># Plot distributions</span></span>
<span id="cb176-28"><a href="integral-population-models.html#cb176-28" tabindex="-1"></a><span class="fu">ggplot</span>(state_vars_long, <span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb176-29"><a href="integral-population-models.html#cb176-29" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb176-30"><a href="integral-population-models.html#cb176-30" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>variable, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb176-31"><a href="integral-population-models.html#cb176-31" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb176-32"><a href="integral-population-models.html#cb176-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Distribution of Potential State Variables&quot;</span>,</span>
<span id="cb176-33"><a href="integral-population-models.html#cb176-33" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Which variable best captures individual variation in S. lanceolata?&quot;</span>,</span>
<span id="cb176-34"><a href="integral-population-models.html#cb176-34" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Measurement value&quot;</span>,</span>
<span id="cb176-35"><a href="integral-population-models.html#cb176-35" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Number of individuals&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-1.png" width="960" style="display: block; margin: auto;" />
### Assess Correlations Between Measurements
State variables should ideally be correlated with other size metrics (indicating they capture overall plant size) but also provide unique information.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="integral-population-models.html#cb177-1" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb177-2"><a href="integral-population-models.html#cb177-2" tabindex="-1"></a></span>
<span id="cb177-3"><a href="integral-population-models.html#cb177-3" tabindex="-1"></a><span class="co"># Calculate correlation matrix</span></span>
<span id="cb177-4"><a href="integral-population-models.html#cb177-4" tabindex="-1"></a>cor_data <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb177-5"><a href="integral-population-models.html#cb177-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(StemDiameter, </span>
<span id="cb177-6"><a href="integral-population-models.html#cb177-6" tabindex="-1"></a>         VegHeight,</span>
<span id="cb177-7"><a href="integral-population-models.html#cb177-7" tabindex="-1"></a>         VegReproHeight,</span>
<span id="cb177-8"><a href="integral-population-models.html#cb177-8" tabindex="-1"></a>         LengthLongestBranchwFoliage,</span>
<span id="cb177-9"><a href="integral-population-models.html#cb177-9" tabindex="-1"></a>         StemNum,</span>
<span id="cb177-10"><a href="integral-population-models.html#cb177-10" tabindex="-1"></a>         InflorNum,</span>
<span id="cb177-11"><a href="integral-population-models.html#cb177-11" tabindex="-1"></a>         TotalReproOutput) <span class="sc">|&gt;</span></span>
<span id="cb177-12"><a href="integral-population-models.html#cb177-12" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb177-13"><a href="integral-population-models.html#cb177-13" tabindex="-1"></a>    <span class="st">`</span><span class="at">Stem Diam</span><span class="st">`</span> <span class="ot">=</span> StemDiameter,</span>
<span id="cb177-14"><a href="integral-population-models.html#cb177-14" tabindex="-1"></a>    <span class="st">`</span><span class="at">Height Veg</span><span class="st">`</span> <span class="ot">=</span> VegHeight,</span>
<span id="cb177-15"><a href="integral-population-models.html#cb177-15" tabindex="-1"></a>    <span class="st">`</span><span class="at">Height Repro</span><span class="st">`</span> <span class="ot">=</span> VegReproHeight,</span>
<span id="cb177-16"><a href="integral-population-models.html#cb177-16" tabindex="-1"></a>    <span class="st">`</span><span class="at">Branch Length</span><span class="st">`</span> <span class="ot">=</span> LengthLongestBranchwFoliage,</span>
<span id="cb177-17"><a href="integral-population-models.html#cb177-17" tabindex="-1"></a>    <span class="st">`</span><span class="at">N Stems</span><span class="st">`</span> <span class="ot">=</span> StemNum,</span>
<span id="cb177-18"><a href="integral-population-models.html#cb177-18" tabindex="-1"></a>    <span class="st">`</span><span class="at">N Inflor</span><span class="st">`</span> <span class="ot">=</span> InflorNum,</span>
<span id="cb177-19"><a href="integral-population-models.html#cb177-19" tabindex="-1"></a>    <span class="st">`</span><span class="at">Repro Output</span><span class="st">`</span> <span class="ot">=</span> TotalReproOutput</span>
<span id="cb177-20"><a href="integral-population-models.html#cb177-20" tabindex="-1"></a>  )</span>
<span id="cb177-21"><a href="integral-population-models.html#cb177-21" tabindex="-1"></a></span>
<span id="cb177-22"><a href="integral-population-models.html#cb177-22" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(cor_data, <span class="at">use =</span> <span class="st">&quot;complete.obs&quot;</span>)</span>
<span id="cb177-23"><a href="integral-population-models.html#cb177-23" tabindex="-1"></a></span>
<span id="cb177-24"><a href="integral-population-models.html#cb177-24" tabindex="-1"></a><span class="co"># Visualize correlations</span></span>
<span id="cb177-25"><a href="integral-population-models.html#cb177-25" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">&quot;color&quot;</span>, <span class="at">type =</span> <span class="st">&quot;upper&quot;</span>,</span>
<span id="cb177-26"><a href="integral-population-models.html#cb177-26" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">number.cex =</span> <span class="fl">0.7</span>,</span>
<span id="cb177-27"><a href="integral-population-models.html#cb177-27" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">tl.cex =</span> <span class="fl">0.8</span>,</span>
<span id="cb177-28"><a href="integral-population-models.html#cb177-28" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">&quot;Correlations Between Size and Reproductive Metrics&quot;</span>,</span>
<span id="cb177-29"><a href="integral-population-models.html#cb177-29" tabindex="-1"></a>         <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-58-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>In many demographic studies, time constraints limit how long we have to identify appropriate state variables, establish a census protocol, and collect sufficient data to parameterize transition matrices. Because survival and growth require observations across multiple years, early stages of a study often rely on variables that can be measured and linked to demographic processes within a single field season. For this reason, I often prioritize selecting state variables that best explain variation in reproductive rates, since reproduction can typically be measured alongside size or trait data in the same year.</p>
<p>Below, we use model selection to identify the state variable that best predicts reproductive output. In my experience, the state variable that most strongly explains reproduction often also performs well as a predictor of other vital rates, such as survival and growth, once enough data have been collected to evaluate these relationships. This approach provides a practical and biologically informed starting point for demographic modeling when data are initially limited.</p>
</div>
<div id="selecting-our-state-variable" class="section level3 hasAnchor" number="17.2.8">
<h3><span class="header-section-number">17.2.8</span> Selecting Our State Variable<a href="integral-population-models.html#selecting-our-state-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall that we are trying to identify state variables with the following characteristics:</p>
<ul>
<li>Continuously distributed: Not discrete categories, works well with IPM framework</li>
<li>Strong biological meaning: Represents accumulated woody growth and age</li>
<li>Practical: Easy to measure consistently across years</li>
<li>Predictive: Likely correlates with survival (established plants) and reproduction (larger plants)</li>
<li>Low measurement error: Less affected by seasonal variation</li>
</ul>
<p>So far, the majority of our variables meet these criteria, but let’s test predictability of vital rates! The ultimate decider!</p>
<div id="quantitative-model-comparison-with-aic" class="section level4 hasAnchor" number="17.2.8.1">
<h4><span class="header-section-number">17.2.8.1</span> Quantitative Model Comparison with AIC<a href="integral-population-models.html#quantitative-model-comparison-with-aic" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="integral-population-models.html#cb178-1" tabindex="-1"></a><span class="co"># Fit Poisson GLMs for each candidate state variable</span></span>
<span id="cb178-2"><a href="integral-population-models.html#cb178-2" tabindex="-1"></a><span class="co"># (Poisson is appropriate for count data like reproductive output)</span></span>
<span id="cb178-3"><a href="integral-population-models.html#cb178-3" tabindex="-1"></a></span>
<span id="cb178-4"><a href="integral-population-models.html#cb178-4" tabindex="-1"></a>model_diameter <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> StemDiameter, </span>
<span id="cb178-5"><a href="integral-population-models.html#cb178-5" tabindex="-1"></a>                      <span class="at">family =</span> poisson, <span class="at">data =</span> silene)</span>
<span id="cb178-6"><a href="integral-population-models.html#cb178-6" tabindex="-1"></a></span>
<span id="cb178-7"><a href="integral-population-models.html#cb178-7" tabindex="-1"></a>model_height <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> VegHeight, </span>
<span id="cb178-8"><a href="integral-population-models.html#cb178-8" tabindex="-1"></a>                    <span class="at">family =</span> poisson, <span class="at">data =</span> silene)</span>
<span id="cb178-9"><a href="integral-population-models.html#cb178-9" tabindex="-1"></a></span>
<span id="cb178-10"><a href="integral-population-models.html#cb178-10" tabindex="-1"></a>model_height_repro <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> VegReproHeight, </span>
<span id="cb178-11"><a href="integral-population-models.html#cb178-11" tabindex="-1"></a>                          <span class="at">family =</span> poisson, <span class="at">data =</span> silene)</span>
<span id="cb178-12"><a href="integral-population-models.html#cb178-12" tabindex="-1"></a></span>
<span id="cb178-13"><a href="integral-population-models.html#cb178-13" tabindex="-1"></a>model_branch <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> LengthLongestBranchwFoliage, </span>
<span id="cb178-14"><a href="integral-population-models.html#cb178-14" tabindex="-1"></a>                    <span class="at">family =</span> poisson, <span class="at">data =</span> silene)</span>
<span id="cb178-15"><a href="integral-population-models.html#cb178-15" tabindex="-1"></a></span>
<span id="cb178-16"><a href="integral-population-models.html#cb178-16" tabindex="-1"></a>model_stems <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> StemNum, </span>
<span id="cb178-17"><a href="integral-population-models.html#cb178-17" tabindex="-1"></a>                   <span class="at">family =</span> poisson, <span class="at">data =</span> silene)</span>
<span id="cb178-18"><a href="integral-population-models.html#cb178-18" tabindex="-1"></a></span>
<span id="cb178-19"><a href="integral-population-models.html#cb178-19" tabindex="-1"></a><span class="co"># Create comprehensive comparison table</span></span>
<span id="cb178-20"><a href="integral-population-models.html#cb178-20" tabindex="-1"></a>aic_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb178-21"><a href="integral-population-models.html#cb178-21" tabindex="-1"></a>  <span class="at">State_Variable =</span> <span class="fu">c</span>(<span class="st">&quot;Stem Diameter&quot;</span>, </span>
<span id="cb178-22"><a href="integral-population-models.html#cb178-22" tabindex="-1"></a>                     <span class="st">&quot;Vegetative Height&quot;</span>, </span>
<span id="cb178-23"><a href="integral-population-models.html#cb178-23" tabindex="-1"></a>                     <span class="st">&quot;Height with Repro&quot;</span>,</span>
<span id="cb178-24"><a href="integral-population-models.html#cb178-24" tabindex="-1"></a>                     <span class="st">&quot;Branch Length&quot;</span>, </span>
<span id="cb178-25"><a href="integral-population-models.html#cb178-25" tabindex="-1"></a>                     <span class="st">&quot;Number of Stems&quot;</span>),</span>
<span id="cb178-26"><a href="integral-population-models.html#cb178-26" tabindex="-1"></a>  </span>
<span id="cb178-27"><a href="integral-population-models.html#cb178-27" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(model_diameter), </span>
<span id="cb178-28"><a href="integral-population-models.html#cb178-28" tabindex="-1"></a>          <span class="fu">AIC</span>(model_height), </span>
<span id="cb178-29"><a href="integral-population-models.html#cb178-29" tabindex="-1"></a>          <span class="fu">AIC</span>(model_height_repro),</span>
<span id="cb178-30"><a href="integral-population-models.html#cb178-30" tabindex="-1"></a>          <span class="fu">AIC</span>(model_branch), </span>
<span id="cb178-31"><a href="integral-population-models.html#cb178-31" tabindex="-1"></a>          <span class="fu">AIC</span>(model_stems)),</span>
<span id="cb178-32"><a href="integral-population-models.html#cb178-32" tabindex="-1"></a>  </span>
<span id="cb178-33"><a href="integral-population-models.html#cb178-33" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)  <span class="co"># All have 2 parameters (intercept + slope)</span></span>
<span id="cb178-34"><a href="integral-population-models.html#cb178-34" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb178-35"><a href="integral-population-models.html#cb178-35" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb178-36"><a href="integral-population-models.html#cb178-36" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb178-37"><a href="integral-population-models.html#cb178-37" tabindex="-1"></a>    <span class="at">Delta_AIC =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb178-38"><a href="integral-population-models.html#cb178-38" tabindex="-1"></a>    <span class="at">Relative_Likelihood =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> Delta_AIC),</span>
<span id="cb178-39"><a href="integral-population-models.html#cb178-39" tabindex="-1"></a>    <span class="at">AIC_Weight =</span> Relative_Likelihood <span class="sc">/</span> <span class="fu">sum</span>(Relative_Likelihood),</span>
<span id="cb178-40"><a href="integral-population-models.html#cb178-40" tabindex="-1"></a>    <span class="at">Interpretation =</span> <span class="fu">case_when</span>(</span>
<span id="cb178-41"><a href="integral-population-models.html#cb178-41" tabindex="-1"></a>      Delta_AIC <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Best model&quot;</span>,</span>
<span id="cb178-42"><a href="integral-population-models.html#cb178-42" tabindex="-1"></a>      Delta_AIC <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Substantial support&quot;</span>,</span>
<span id="cb178-43"><a href="integral-population-models.html#cb178-43" tabindex="-1"></a>      Delta_AIC <span class="sc">&lt;</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">&quot;Considerably less support&quot;</span>,</span>
<span id="cb178-44"><a href="integral-population-models.html#cb178-44" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Essentially no support&quot;</span></span>
<span id="cb178-45"><a href="integral-population-models.html#cb178-45" tabindex="-1"></a>    )</span>
<span id="cb178-46"><a href="integral-population-models.html#cb178-46" tabindex="-1"></a>  )</span>
<span id="cb178-47"><a href="integral-population-models.html#cb178-47" tabindex="-1"></a></span>
<span id="cb178-48"><a href="integral-population-models.html#cb178-48" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(aic_comparison, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb178-49"><a href="integral-population-models.html#cb178-49" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;AIC comparison: Which size metric best predicts fecundity?&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-59">Table 17.2: </span>AIC comparison: Which size metric best predicts fecundity?</caption>
<colgroup>
<col width="19%" />
<col width="9%" />
<col width="3%" />
<col width="10%" />
<col width="21%" />
<col width="11%" />
<col width="24%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">State_Variable</th>
<th align="right">AIC</th>
<th align="right">df</th>
<th align="right">Delta_AIC</th>
<th align="right">Relative_Likelihood</th>
<th align="right">AIC_Weight</th>
<th align="left">Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Height with Repro</td>
<td align="right">1588.305</td>
<td align="right">2</td>
<td align="right">0.000</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Best model</td>
</tr>
<tr class="even">
<td align="left">Vegetative Height</td>
<td align="right">1876.079</td>
<td align="right">2</td>
<td align="right">287.774</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">Essentially no support</td>
</tr>
<tr class="odd">
<td align="left">Number of Stems</td>
<td align="right">2193.372</td>
<td align="right">2</td>
<td align="right">605.067</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">Essentially no support</td>
</tr>
<tr class="even">
<td align="left">Stem Diameter</td>
<td align="right">3057.851</td>
<td align="right">2</td>
<td align="right">1469.546</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">Essentially no support</td>
</tr>
<tr class="odd">
<td align="left">Branch Length</td>
<td align="right">3401.991</td>
<td align="right">2</td>
<td align="right">1813.686</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">Essentially no support</td>
</tr>
</tbody>
</table>
<p>Now, let’s visualize the top relationship!</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="integral-population-models.html#cb179-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb179-2"><a href="integral-population-models.html#cb179-2" tabindex="-1"></a></span>
<span id="cb179-3"><a href="integral-population-models.html#cb179-3" tabindex="-1"></a><span class="co"># Get predictions from the best model for smooth curve</span></span>
<span id="cb179-4"><a href="integral-population-models.html#cb179-4" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb179-5"><a href="integral-population-models.html#cb179-5" tabindex="-1"></a>  <span class="at">VegReproHeight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(silene<span class="sc">$</span>VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb179-6"><a href="integral-population-models.html#cb179-6" tabindex="-1"></a>                       <span class="fu">max</span>(silene<span class="sc">$</span>VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb179-7"><a href="integral-population-models.html#cb179-7" tabindex="-1"></a>                       <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb179-8"><a href="integral-population-models.html#cb179-8" tabindex="-1"></a>)</span>
<span id="cb179-9"><a href="integral-population-models.html#cb179-9" tabindex="-1"></a></span>
<span id="cb179-10"><a href="integral-population-models.html#cb179-10" tabindex="-1"></a>pred_data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_height_repro, </span>
<span id="cb179-11"><a href="integral-population-models.html#cb179-11" tabindex="-1"></a>                               <span class="at">newdata =</span> pred_data, </span>
<span id="cb179-12"><a href="integral-population-models.html#cb179-12" tabindex="-1"></a>                               <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb179-13"><a href="integral-population-models.html#cb179-13" tabindex="-1"></a></span>
<span id="cb179-14"><a href="integral-population-models.html#cb179-14" tabindex="-1"></a><span class="co"># Main scatter plot with model fit</span></span>
<span id="cb179-15"><a href="integral-population-models.html#cb179-15" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(silene, <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> TotalReproOutput)) <span class="sc">+</span></span>
<span id="cb179-16"><a href="integral-population-models.html#cb179-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(Reproduced)), </span>
<span id="cb179-17"><a href="integral-population-models.html#cb179-17" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb179-18"><a href="integral-population-models.html#cb179-18" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb179-19"><a href="integral-population-models.html#cb179-19" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> predicted),</span>
<span id="cb179-20"><a href="integral-population-models.html#cb179-20" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;coral&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb179-21"><a href="integral-population-models.html#cb179-21" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;gray60&quot;</span>, <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;steelblue&quot;</span>),</span>
<span id="cb179-22"><a href="integral-population-models.html#cb179-22" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No reproduction&quot;</span>, <span class="st">&quot;Reproduced&quot;</span>),</span>
<span id="cb179-23"><a href="integral-population-models.html#cb179-23" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-24"><a href="integral-population-models.html#cb179-24" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb179-25"><a href="integral-population-models.html#cb179-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Best Predictor: Height with Reproductive Structures&quot;</span>,</span>
<span id="cb179-26"><a href="integral-population-models.html#cb179-26" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;AIC = &quot;</span>, <span class="fu">round</span>(<span class="fu">AIC</span>(model_height_repro), <span class="dv">2</span>), </span>
<span id="cb179-27"><a href="integral-population-models.html#cb179-27" tabindex="-1"></a>                        <span class="st">&quot; | AIC Weight = &quot;</span>, </span>
<span id="cb179-28"><a href="integral-population-models.html#cb179-28" tabindex="-1"></a>                        <span class="fu">round</span>(aic_comparison<span class="sc">$</span>AIC_Weight[aic_comparison<span class="sc">$</span>State_Variable <span class="sc">==</span> <span class="st">&quot;Height with Repro&quot;</span>], <span class="dv">3</span>)),</span>
<span id="cb179-29"><a href="integral-population-models.html#cb179-29" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Height with reproductive structures (cm)&quot;</span>,</span>
<span id="cb179-30"><a href="integral-population-models.html#cb179-30" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Total reproductive output (flowers + seeds)&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-31"><a href="integral-population-models.html#cb179-31" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb179-32"><a href="integral-population-models.html#cb179-32" tabindex="-1"></a></span>
<span id="cb179-33"><a href="integral-population-models.html#cb179-33" tabindex="-1"></a><span class="co"># Residual plot to check model fit</span></span>
<span id="cb179-34"><a href="integral-population-models.html#cb179-34" tabindex="-1"></a>silene_resid <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb179-35"><a href="integral-population-models.html#cb179-35" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb179-36"><a href="integral-population-models.html#cb179-36" tabindex="-1"></a>    <span class="at">fitted =</span> <span class="fu">predict</span>(model_height_repro, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb179-37"><a href="integral-population-models.html#cb179-37" tabindex="-1"></a>    <span class="at">residuals =</span> TotalReproOutput <span class="sc">-</span> fitted</span>
<span id="cb179-38"><a href="integral-population-models.html#cb179-38" tabindex="-1"></a>  )</span>
<span id="cb179-39"><a href="integral-population-models.html#cb179-39" tabindex="-1"></a></span>
<span id="cb179-40"><a href="integral-population-models.html#cb179-40" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(silene_resid, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residuals)) <span class="sc">+</span></span>
<span id="cb179-41"><a href="integral-population-models.html#cb179-41" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-42"><a href="integral-population-models.html#cb179-42" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">color =</span> <span class="st">&quot;coral&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-43"><a href="integral-population-models.html#cb179-43" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;gray30&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-44"><a href="integral-population-models.html#cb179-44" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb179-45"><a href="integral-population-models.html#cb179-45" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Model Diagnostics: Residual Plot&quot;</span>,</span>
<span id="cb179-46"><a href="integral-population-models.html#cb179-46" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Fitted values&quot;</span>,</span>
<span id="cb179-47"><a href="integral-population-models.html#cb179-47" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb179-48"><a href="integral-population-models.html#cb179-48" tabindex="-1"></a></span>
<span id="cb179-49"><a href="integral-population-models.html#cb179-49" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-60-1.png" width="960" style="display: block; margin: auto;" />
<strong>Top Panel: The Size-Fecundity Relationship</strong></p>
<p>Let’s check out the figure and think about the implications:</p>
<ol style="list-style-type: decimal">
<li><strong>The Zero-Inflation Problem</strong>: Notice the large cluster of gray points at reproductive output = 0. These are plants that didn’t reproduce at all (56% of individuals!). This creates a challenge for Poisson models, which don’t naturally handle “excess zeros.”</li>
<li><strong>Clear Size Threshold</strong>: Among reproducing plants (blue), there’s a strong positive relationship - taller plants with larger reproductive structures produce more seeds. But notice that ALL small plants (&lt;~40 cm) failed to reproduce. This suggests a <strong>reproductive size threshold</strong>.</li>
<li><strong>Increasing Variance</strong>: As height increases, the spread of blue points gets wider. Small reproductive plants show relatively consistent output (~10-30 seeds), while large plants vary dramatically (20-100 seeds). This <strong>heteroscedasticity</strong> (unequal variance) can be an issue for simple linear models.</li>
<li><strong>The Perfect Fit “Problem”</strong>: The coral line fits the reproducing plants beautifully, BUT this creates a conceptual issue for IPMs: <code>VegReproHeight</code> includes the reproductive stalks themselves! This is somewhat circular - we’re using reproductive structures to predict reproduction.</li>
</ol>
<p><strong>Bottom Panel: Model Diagnostics (Critical!)</strong></p>
<p>Let’s check out the figure and think about the implications:</p>
<ol start="5" style="list-style-type: decimal">
<li><strong>Non-Random Residual Pattern</strong>: The residuals should be randomly scattered around zero (the dashed orange line). Instead, notice:
<ul>
<li><strong>Left side</strong> (fitted values 0-25): Residuals are tightly clustered near zero (all those non-reproductive plants)</li>
<li><strong>Middle</strong> (fitted values 25-50): Residuals are nicely random ✓</li>
<li><strong>Right side</strong> (fitted values &gt;75): The smooth line curves downward, indicating the model <strong>underpredicts</strong> reproductive output for the largest plants</li>
</ul></li>
<li><strong>The Outlier</strong>: See that point at the far right with residual ≈ -75? That’s a very large plant that produced MUCH less than expected. What happened? (Disease? Herbivory? Late-season measurement?)</li>
</ol>
<p><strong>What This Means for Model Selection:</strong></p>
<p>Let’s think this through:</p>
<ul>
<li><strong>Statistically</strong>: VegReproHeight has the best AIC, BUT the residual pattern suggests the Poisson model isn’t perfect.</li>
<li><strong>Biologically</strong>: This relationship makes sense - plants invest in tall reproductive stalks to display flowers and disperse seeds.</li>
</ul>
<p>A classic (and very common) way to handle “zero inflation” in plant fecundity when building IPMs is to use a two‐part (hurdle) model. In this approach, we first model whether an individual reproduces at all (i.e., produces any flowers/fruits/seeds) using a binomial model. Then, conditional on reproduction occurring, we model the amount of reproductive output (e.g., number of fruits or seeds) using a count model such as a Poisson (or often a negative binomial if counts are overdispersed). This is often more biologically realistic because it separates two distinct processes: (1) the decision/ability to reproduce and (2) how much is produced once reproduction happens.</p>
<p>A zero-inflated Poisson (ZIP) or zero-inflated negative binomial (ZINB) also addresses excess zeros, but it assumes the zeros come from two sources:</p>
<pre><code>1.  Structural zeros: individuals in a “certain zero” state (they cannot reproduce / are not eligible)
2.  Sampling zeros: individuals who are “eligible,” but still produce zero by chance under the count distribution</code></pre>
<p>Thus, in the hurdle model, all zeros are handled by the binomial part; the count model is fit to positive counts only. In the zero-inflated model, zeros can come from either the inflation process or the count process. The hurdle (binomial + conditional count) approach aligns well with plant reproductive biology because:</p>
<ul>
<li>Reproduction often reflects a threshold-like process (size/condition must be sufficient to flower/fruit).</li>
<li>Once reproducing, output typically scales with size and resources.</li>
<li>It yields two interpretable functions for the IPM:</li>
<li>probability of reproduction as a function of size</li>
<li>expected fecundity given reproduction as a function of size</li>
<li>and, bonus, it’s also often simpler to implement and communicate in an IPM context</li>
</ul>
<p>Let’s check this out:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="integral-population-models.html#cb181-1" tabindex="-1"></a><span class="co"># Fit logistic regression for each candidate state variable</span></span>
<span id="cb181-2"><a href="integral-population-models.html#cb181-2" tabindex="-1"></a><span class="co"># Response: Reproduced (0 = no, 1 = yes)</span></span>
<span id="cb181-3"><a href="integral-population-models.html#cb181-3" tabindex="-1"></a></span>
<span id="cb181-4"><a href="integral-population-models.html#cb181-4" tabindex="-1"></a>logit_diameter <span class="ot">&lt;-</span> <span class="fu">glm</span>(Reproduced <span class="sc">~</span> VegReproHeight, </span>
<span id="cb181-5"><a href="integral-population-models.html#cb181-5" tabindex="-1"></a>                      <span class="at">family =</span> binomial, <span class="at">data =</span> silene)</span>
<span id="cb181-6"><a href="integral-population-models.html#cb181-6" tabindex="-1"></a></span>
<span id="cb181-7"><a href="integral-population-models.html#cb181-7" tabindex="-1"></a>logit_height <span class="ot">&lt;-</span> <span class="fu">glm</span>(Reproduced <span class="sc">~</span> VegHeight, </span>
<span id="cb181-8"><a href="integral-population-models.html#cb181-8" tabindex="-1"></a>                    <span class="at">family =</span> binomial, <span class="at">data =</span> silene)</span>
<span id="cb181-9"><a href="integral-population-models.html#cb181-9" tabindex="-1"></a></span>
<span id="cb181-10"><a href="integral-population-models.html#cb181-10" tabindex="-1"></a>logit_height_repro <span class="ot">&lt;-</span> <span class="fu">glm</span>(Reproduced <span class="sc">~</span> VegReproHeight, </span>
<span id="cb181-11"><a href="integral-population-models.html#cb181-11" tabindex="-1"></a>                          <span class="at">family =</span> binomial, <span class="at">data =</span> silene)</span>
<span id="cb181-12"><a href="integral-population-models.html#cb181-12" tabindex="-1"></a></span>
<span id="cb181-13"><a href="integral-population-models.html#cb181-13" tabindex="-1"></a>logit_branch <span class="ot">&lt;-</span> <span class="fu">glm</span>(Reproduced <span class="sc">~</span> LengthLongestBranchwFoliage, </span>
<span id="cb181-14"><a href="integral-population-models.html#cb181-14" tabindex="-1"></a>                    <span class="at">family =</span> binomial, <span class="at">data =</span> silene)</span>
<span id="cb181-15"><a href="integral-population-models.html#cb181-15" tabindex="-1"></a></span>
<span id="cb181-16"><a href="integral-population-models.html#cb181-16" tabindex="-1"></a>logit_stems <span class="ot">&lt;-</span> <span class="fu">glm</span>(Reproduced <span class="sc">~</span> StemNum, </span>
<span id="cb181-17"><a href="integral-population-models.html#cb181-17" tabindex="-1"></a>                   <span class="at">family =</span> binomial, <span class="at">data =</span> silene)</span>
<span id="cb181-18"><a href="integral-population-models.html#cb181-18" tabindex="-1"></a></span>
<span id="cb181-19"><a href="integral-population-models.html#cb181-19" tabindex="-1"></a><span class="co"># Compare models with AIC</span></span>
<span id="cb181-20"><a href="integral-population-models.html#cb181-20" tabindex="-1"></a>aic_reproduction <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb181-21"><a href="integral-population-models.html#cb181-21" tabindex="-1"></a>  <span class="at">State_Variable =</span> <span class="fu">c</span>(<span class="st">&quot;Stem Diameter&quot;</span>, <span class="st">&quot;Vegetative Height&quot;</span>, </span>
<span id="cb181-22"><a href="integral-population-models.html#cb181-22" tabindex="-1"></a>                     <span class="st">&quot;Height with Repro&quot;</span>, <span class="st">&quot;Branch Length&quot;</span>, <span class="st">&quot;Number of Stems&quot;</span>),</span>
<span id="cb181-23"><a href="integral-population-models.html#cb181-23" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(logit_diameter), <span class="fu">AIC</span>(logit_height), </span>
<span id="cb181-24"><a href="integral-population-models.html#cb181-24" tabindex="-1"></a>          <span class="fu">AIC</span>(logit_height_repro), <span class="fu">AIC</span>(logit_branch), <span class="fu">AIC</span>(logit_stems))</span>
<span id="cb181-25"><a href="integral-population-models.html#cb181-25" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb181-26"><a href="integral-population-models.html#cb181-26" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb181-27"><a href="integral-population-models.html#cb181-27" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb181-28"><a href="integral-population-models.html#cb181-28" tabindex="-1"></a>    <span class="at">Delta_AIC =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb181-29"><a href="integral-population-models.html#cb181-29" tabindex="-1"></a>    <span class="at">AIC_Weight =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> Delta_AIC) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> Delta_AIC))</span>
<span id="cb181-30"><a href="integral-population-models.html#cb181-30" tabindex="-1"></a>  )</span>
<span id="cb181-31"><a href="integral-population-models.html#cb181-31" tabindex="-1"></a></span>
<span id="cb181-32"><a href="integral-population-models.html#cb181-32" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(aic_reproduction, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb181-33"><a href="integral-population-models.html#cb181-33" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Step 1: Which size metric best predicts probability of reproduction?&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-61">Table 17.3: </span>Step 1: Which size metric best predicts probability of reproduction?</caption>
<thead>
<tr class="header">
<th align="left">State_Variable</th>
<th align="right">AIC</th>
<th align="right">Delta_AIC</th>
<th align="right">AIC_Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Stem Diameter</td>
<td align="right">38.661</td>
<td align="right">0.000</td>
<td align="right">0.497</td>
</tr>
<tr class="even">
<td align="left">Height with Repro</td>
<td align="right">38.661</td>
<td align="right">0.000</td>
<td align="right">0.497</td>
</tr>
<tr class="odd">
<td align="left">Number of Stems</td>
<td align="right">48.159</td>
<td align="right">9.498</td>
<td align="right">0.004</td>
</tr>
<tr class="even">
<td align="left">Vegetative Height</td>
<td align="right">50.583</td>
<td align="right">11.923</td>
<td align="right">0.001</td>
</tr>
<tr class="odd">
<td align="left">Branch Length</td>
<td align="right">129.301</td>
<td align="right">90.640</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="integral-population-models.html#cb182-1" tabindex="-1"></a><span class="co"># Filter to plants that reproduced</span></span>
<span id="cb182-2"><a href="integral-population-models.html#cb182-2" tabindex="-1"></a>silene_reproductive <span class="ot">&lt;-</span> silene <span class="sc">|&gt;</span></span>
<span id="cb182-3"><a href="integral-population-models.html#cb182-3" tabindex="-1"></a>  <span class="fu">filter</span>(Reproduced <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb182-4"><a href="integral-population-models.html#cb182-4" tabindex="-1"></a></span>
<span id="cb182-5"><a href="integral-population-models.html#cb182-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Reproductive plants:&quot;</span>, <span class="fu">nrow</span>(silene_reproductive), </span>
<span id="cb182-6"><a href="integral-population-models.html#cb182-6" tabindex="-1"></a>    <span class="st">&quot;out of&quot;</span>, <span class="fu">nrow</span>(silene), </span>
<span id="cb182-7"><a href="integral-population-models.html#cb182-7" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">&quot;(&quot;</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">nrow</span>(silene_reproductive)<span class="sc">/</span><span class="fu">nrow</span>(silene), <span class="dv">1</span>), <span class="st">&quot;%)</span><span class="sc">\n</span><span class="st">&quot;</span>))</span></code></pre></div>
<pre><code>## Reproductive plants: 44 out of 100 (44%)</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="integral-population-models.html#cb184-1" tabindex="-1"></a><span class="co"># Fit Poisson regression for seed production (reproductive plants only)</span></span>
<span id="cb184-2"><a href="integral-population-models.html#cb184-2" tabindex="-1"></a>pois_diameter <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> VegReproHeight, </span>
<span id="cb184-3"><a href="integral-population-models.html#cb184-3" tabindex="-1"></a>                     <span class="at">family =</span> poisson, <span class="at">data =</span> silene_reproductive)</span>
<span id="cb184-4"><a href="integral-population-models.html#cb184-4" tabindex="-1"></a></span>
<span id="cb184-5"><a href="integral-population-models.html#cb184-5" tabindex="-1"></a>pois_height <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> VegHeight, </span>
<span id="cb184-6"><a href="integral-population-models.html#cb184-6" tabindex="-1"></a>                   <span class="at">family =</span> poisson, <span class="at">data =</span> silene_reproductive)</span>
<span id="cb184-7"><a href="integral-population-models.html#cb184-7" tabindex="-1"></a></span>
<span id="cb184-8"><a href="integral-population-models.html#cb184-8" tabindex="-1"></a>pois_height_repro <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> VegReproHeight, </span>
<span id="cb184-9"><a href="integral-population-models.html#cb184-9" tabindex="-1"></a>                         <span class="at">family =</span> poisson, <span class="at">data =</span> silene_reproductive)</span>
<span id="cb184-10"><a href="integral-population-models.html#cb184-10" tabindex="-1"></a></span>
<span id="cb184-11"><a href="integral-population-models.html#cb184-11" tabindex="-1"></a>pois_branch <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> LengthLongestBranchwFoliage, </span>
<span id="cb184-12"><a href="integral-population-models.html#cb184-12" tabindex="-1"></a>                   <span class="at">family =</span> poisson, <span class="at">data =</span> silene_reproductive)</span>
<span id="cb184-13"><a href="integral-population-models.html#cb184-13" tabindex="-1"></a></span>
<span id="cb184-14"><a href="integral-population-models.html#cb184-14" tabindex="-1"></a>pois_stems <span class="ot">&lt;-</span> <span class="fu">glm</span>(TotalReproOutput <span class="sc">~</span> StemNum, </span>
<span id="cb184-15"><a href="integral-population-models.html#cb184-15" tabindex="-1"></a>                  <span class="at">family =</span> poisson, <span class="at">data =</span> silene_reproductive)</span>
<span id="cb184-16"><a href="integral-population-models.html#cb184-16" tabindex="-1"></a></span>
<span id="cb184-17"><a href="integral-population-models.html#cb184-17" tabindex="-1"></a><span class="co"># Compare models</span></span>
<span id="cb184-18"><a href="integral-population-models.html#cb184-18" tabindex="-1"></a>aic_seed_production <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb184-19"><a href="integral-population-models.html#cb184-19" tabindex="-1"></a>  <span class="at">State_Variable =</span> <span class="fu">c</span>(<span class="st">&quot;Stem Diameter&quot;</span>, <span class="st">&quot;Vegetative Height&quot;</span>, </span>
<span id="cb184-20"><a href="integral-population-models.html#cb184-20" tabindex="-1"></a>                     <span class="st">&quot;Height with Repro&quot;</span>, <span class="st">&quot;Branch Length&quot;</span>, <span class="st">&quot;Number of Stems&quot;</span>),</span>
<span id="cb184-21"><a href="integral-population-models.html#cb184-21" tabindex="-1"></a>  <span class="at">AIC =</span> <span class="fu">c</span>(<span class="fu">AIC</span>(pois_diameter), <span class="fu">AIC</span>(pois_height), </span>
<span id="cb184-22"><a href="integral-population-models.html#cb184-22" tabindex="-1"></a>          <span class="fu">AIC</span>(pois_height_repro), <span class="fu">AIC</span>(pois_branch), <span class="fu">AIC</span>(pois_stems))</span>
<span id="cb184-23"><a href="integral-population-models.html#cb184-23" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb184-24"><a href="integral-population-models.html#cb184-24" tabindex="-1"></a>  <span class="fu">arrange</span>(AIC) <span class="sc">|&gt;</span></span>
<span id="cb184-25"><a href="integral-population-models.html#cb184-25" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb184-26"><a href="integral-population-models.html#cb184-26" tabindex="-1"></a>    <span class="at">Delta_AIC =</span> AIC <span class="sc">-</span> <span class="fu">min</span>(AIC),</span>
<span id="cb184-27"><a href="integral-population-models.html#cb184-27" tabindex="-1"></a>    <span class="at">AIC_Weight =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> Delta_AIC) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> Delta_AIC))</span>
<span id="cb184-28"><a href="integral-population-models.html#cb184-28" tabindex="-1"></a>  )</span>
<span id="cb184-29"><a href="integral-population-models.html#cb184-29" tabindex="-1"></a></span>
<span id="cb184-30"><a href="integral-population-models.html#cb184-30" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(aic_seed_production, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb184-31"><a href="integral-population-models.html#cb184-31" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Step 2: Which size metric best predicts seed count among reproducers?&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-61">Table 17.3: </span>Step 2: Which size metric best predicts seed count among reproducers?</caption>
<thead>
<tr class="header">
<th align="left">State_Variable</th>
<th align="right">AIC</th>
<th align="right">Delta_AIC</th>
<th align="right">AIC_Weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Number of Stems</td>
<td align="right">726.427</td>
<td align="right">0.000</td>
<td align="right">0.813</td>
</tr>
<tr class="even">
<td align="left">Stem Diameter</td>
<td align="right">730.757</td>
<td align="right">4.331</td>
<td align="right">0.093</td>
</tr>
<tr class="odd">
<td align="left">Height with Repro</td>
<td align="right">730.757</td>
<td align="right">4.331</td>
<td align="right">0.093</td>
</tr>
<tr class="even">
<td align="left">Vegetative Height</td>
<td align="right">747.756</td>
<td align="right">21.329</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">Branch Length</td>
<td align="right">798.683</td>
<td align="right">72.256</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="integral-population-models.html#cb185-1" tabindex="-1"></a><span class="co"># Combine the two tables</span></span>
<span id="cb185-2"><a href="integral-population-models.html#cb185-2" tabindex="-1"></a>combined_aic <span class="ot">&lt;-</span> aic_reproduction <span class="sc">|&gt;</span></span>
<span id="cb185-3"><a href="integral-population-models.html#cb185-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb185-4"><a href="integral-population-models.html#cb185-4" tabindex="-1"></a>    <span class="at">AIC_Reproduction =</span> AIC,</span>
<span id="cb185-5"><a href="integral-population-models.html#cb185-5" tabindex="-1"></a>    <span class="at">Weight_Reproduction =</span> AIC_Weight</span>
<span id="cb185-6"><a href="integral-population-models.html#cb185-6" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb185-7"><a href="integral-population-models.html#cb185-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb185-8"><a href="integral-population-models.html#cb185-8" tabindex="-1"></a>    State_Variable,</span>
<span id="cb185-9"><a href="integral-population-models.html#cb185-9" tabindex="-1"></a>    AIC_Reproduction,</span>
<span id="cb185-10"><a href="integral-population-models.html#cb185-10" tabindex="-1"></a>    Weight_Reproduction</span>
<span id="cb185-11"><a href="integral-population-models.html#cb185-11" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb185-12"><a href="integral-population-models.html#cb185-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb185-13"><a href="integral-population-models.html#cb185-13" tabindex="-1"></a>    aic_seed_production <span class="sc">|&gt;</span></span>
<span id="cb185-14"><a href="integral-population-models.html#cb185-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(</span>
<span id="cb185-15"><a href="integral-population-models.html#cb185-15" tabindex="-1"></a>        <span class="at">AIC_SeedCount =</span> AIC,</span>
<span id="cb185-16"><a href="integral-population-models.html#cb185-16" tabindex="-1"></a>        <span class="at">Weight_SeedCount =</span> AIC_Weight</span>
<span id="cb185-17"><a href="integral-population-models.html#cb185-17" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb185-18"><a href="integral-population-models.html#cb185-18" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb185-19"><a href="integral-population-models.html#cb185-19" tabindex="-1"></a>        State_Variable,</span>
<span id="cb185-20"><a href="integral-population-models.html#cb185-20" tabindex="-1"></a>        AIC_SeedCount,</span>
<span id="cb185-21"><a href="integral-population-models.html#cb185-21" tabindex="-1"></a>        Weight_SeedCount</span>
<span id="cb185-22"><a href="integral-population-models.html#cb185-22" tabindex="-1"></a>      ),</span>
<span id="cb185-23"><a href="integral-population-models.html#cb185-23" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;State_Variable&quot;</span></span>
<span id="cb185-24"><a href="integral-population-models.html#cb185-24" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb185-25"><a href="integral-population-models.html#cb185-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb185-26"><a href="integral-population-models.html#cb185-26" tabindex="-1"></a>    <span class="at">Combined_Weight =</span> Weight_Reproduction <span class="sc">*</span> Weight_SeedCount,</span>
<span id="cb185-27"><a href="integral-population-models.html#cb185-27" tabindex="-1"></a>    <span class="at">Rank_Reproduction =</span> <span class="fu">rank</span>(AIC_Reproduction),</span>
<span id="cb185-28"><a href="integral-population-models.html#cb185-28" tabindex="-1"></a>    <span class="at">Rank_SeedCount =</span> <span class="fu">rank</span>(AIC_SeedCount),</span>
<span id="cb185-29"><a href="integral-population-models.html#cb185-29" tabindex="-1"></a>    <span class="at">Average_Rank =</span> (Rank_Reproduction <span class="sc">+</span> Rank_SeedCount) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb185-30"><a href="integral-population-models.html#cb185-30" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb185-31"><a href="integral-population-models.html#cb185-31" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(Average_Rank)</span>
<span id="cb185-32"><a href="integral-population-models.html#cb185-32" tabindex="-1"></a></span>
<span id="cb185-33"><a href="integral-population-models.html#cb185-33" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(combined_aic, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb185-34"><a href="integral-population-models.html#cb185-34" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Combined performance: Which variable is best at BOTH tasks?&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-61">Table 17.3: </span>Combined performance: Which variable is best at BOTH tasks?</caption>
<colgroup>
<col width="12%" />
<col width="11%" />
<col width="13%" />
<col width="9%" />
<col width="11%" />
<col width="10%" />
<col width="12%" />
<col width="10%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">State_Variable</th>
<th align="right">AIC_Reproduction</th>
<th align="right">Weight_Reproduction</th>
<th align="right">AIC_SeedCount</th>
<th align="right">Weight_SeedCount</th>
<th align="right">Combined_Weight</th>
<th align="right">Rank_Reproduction</th>
<th align="right">Rank_SeedCount</th>
<th align="right">Average_Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Stem Diameter</td>
<td align="right">38.661</td>
<td align="right">0.497</td>
<td align="right">730.757</td>
<td align="right">0.093</td>
<td align="right">0.046</td>
<td align="right">1.5</td>
<td align="right">2.5</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Height with Repro</td>
<td align="right">38.661</td>
<td align="right">0.497</td>
<td align="right">730.757</td>
<td align="right">0.093</td>
<td align="right">0.046</td>
<td align="right">1.5</td>
<td align="right">2.5</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Number of Stems</td>
<td align="right">48.159</td>
<td align="right">0.004</td>
<td align="right">726.427</td>
<td align="right">0.813</td>
<td align="right">0.004</td>
<td align="right">3.0</td>
<td align="right">1.0</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Vegetative Height</td>
<td align="right">50.583</td>
<td align="right">0.001</td>
<td align="right">747.756</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">4.0</td>
<td align="right">4.0</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">Branch Length</td>
<td align="right">129.301</td>
<td align="right">0.000</td>
<td align="right">798.683</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">5.0</td>
<td align="right">5.0</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="integral-population-models.html#cb186-1" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb186-2"><a href="integral-population-models.html#cb186-2" tabindex="-1"></a></span>
<span id="cb186-3"><a href="integral-population-models.html#cb186-3" tabindex="-1"></a><span class="co"># Use the best model (let&#39;s assume it&#39;s stem diameter for example)</span></span>
<span id="cb186-4"><a href="integral-population-models.html#cb186-4" tabindex="-1"></a><span class="co"># Create prediction data</span></span>
<span id="cb186-5"><a href="integral-population-models.html#cb186-5" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb186-6"><a href="integral-population-models.html#cb186-6" tabindex="-1"></a>  <span class="at">VegReproHeight =</span> <span class="fu">seq</span>(<span class="fu">min</span>(silene<span class="sc">$</span>VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb186-7"><a href="integral-population-models.html#cb186-7" tabindex="-1"></a>                     <span class="fu">max</span>(silene<span class="sc">$</span>VegReproHeight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb186-8"><a href="integral-population-models.html#cb186-8" tabindex="-1"></a>                     <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb186-9"><a href="integral-population-models.html#cb186-9" tabindex="-1"></a>)</span>
<span id="cb186-10"><a href="integral-population-models.html#cb186-10" tabindex="-1"></a></span>
<span id="cb186-11"><a href="integral-population-models.html#cb186-11" tabindex="-1"></a><span class="co"># Predict probability of reproduction</span></span>
<span id="cb186-12"><a href="integral-population-models.html#cb186-12" tabindex="-1"></a>pred_data<span class="sc">$</span>prob_reproduce <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_diameter, </span>
<span id="cb186-13"><a href="integral-population-models.html#cb186-13" tabindex="-1"></a>                                    <span class="at">newdata =</span> pred_data, </span>
<span id="cb186-14"><a href="integral-population-models.html#cb186-14" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb186-15"><a href="integral-population-models.html#cb186-15" tabindex="-1"></a></span>
<span id="cb186-16"><a href="integral-population-models.html#cb186-16" tabindex="-1"></a><span class="co"># Predict seed count (on log scale, then back-transform)</span></span>
<span id="cb186-17"><a href="integral-population-models.html#cb186-17" tabindex="-1"></a>pred_data<span class="sc">$</span>expected_seeds <span class="ot">&lt;-</span> <span class="fu">predict</span>(pois_diameter, </span>
<span id="cb186-18"><a href="integral-population-models.html#cb186-18" tabindex="-1"></a>                                   <span class="at">newdata =</span> pred_data, </span>
<span id="cb186-19"><a href="integral-population-models.html#cb186-19" tabindex="-1"></a>                                   <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb186-20"><a href="integral-population-models.html#cb186-20" tabindex="-1"></a></span>
<span id="cb186-21"><a href="integral-population-models.html#cb186-21" tabindex="-1"></a><span class="co"># Combined expected output</span></span>
<span id="cb186-22"><a href="integral-population-models.html#cb186-22" tabindex="-1"></a>pred_data<span class="sc">$</span>expected_total <span class="ot">&lt;-</span> pred_data<span class="sc">$</span>prob_reproduce <span class="sc">*</span> pred_data<span class="sc">$</span>expected_seeds</span>
<span id="cb186-23"><a href="integral-population-models.html#cb186-23" tabindex="-1"></a></span>
<span id="cb186-24"><a href="integral-population-models.html#cb186-24" tabindex="-1"></a><span class="co"># Panel 1: Probability of Reproduction</span></span>
<span id="cb186-25"><a href="integral-population-models.html#cb186-25" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(silene, <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> Reproduced)) <span class="sc">+</span></span>
<span id="cb186-26"><a href="integral-population-models.html#cb186-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb186-27"><a href="integral-population-models.html#cb186-27" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.02</span>, <span class="at">width =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb186-28"><a href="integral-population-models.html#cb186-28" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb186-29"><a href="integral-population-models.html#cb186-29" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> prob_reproduce),</span>
<span id="cb186-30"><a href="integral-population-models.html#cb186-30" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;coral&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb186-31"><a href="integral-population-models.html#cb186-31" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb186-32"><a href="integral-population-models.html#cb186-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Step 1: Probability of Reproducing&quot;</span>,</span>
<span id="cb186-33"><a href="integral-population-models.html#cb186-33" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Logistic regression on all plants&quot;</span>,</span>
<span id="cb186-34"><a href="integral-population-models.html#cb186-34" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Stem diameter (cm)&quot;</span>,</span>
<span id="cb186-35"><a href="integral-population-models.html#cb186-35" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;P(Reproduction)&quot;</span>) <span class="sc">+</span></span>
<span id="cb186-36"><a href="integral-population-models.html#cb186-36" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>)</span>
<span id="cb186-37"><a href="integral-population-models.html#cb186-37" tabindex="-1"></a></span>
<span id="cb186-38"><a href="integral-population-models.html#cb186-38" tabindex="-1"></a><span class="co"># Panel 2: Seeds IF reproducing</span></span>
<span id="cb186-39"><a href="integral-population-models.html#cb186-39" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(silene_reproductive, <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> TotalReproOutput)) <span class="sc">+</span></span>
<span id="cb186-40"><a href="integral-population-models.html#cb186-40" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb186-41"><a href="integral-population-models.html#cb186-41" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb186-42"><a href="integral-population-models.html#cb186-42" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> expected_seeds),</span>
<span id="cb186-43"><a href="integral-population-models.html#cb186-43" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;coral&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb186-44"><a href="integral-population-models.html#cb186-44" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb186-45"><a href="integral-population-models.html#cb186-45" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Step 2: Seeds IF Reproducing&quot;</span>,</span>
<span id="cb186-46"><a href="integral-population-models.html#cb186-46" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Poisson regression on reproductive plants only&quot;</span>,</span>
<span id="cb186-47"><a href="integral-population-models.html#cb186-47" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Stem diameter (cm)&quot;</span>,</span>
<span id="cb186-48"><a href="integral-population-models.html#cb186-48" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Seed count (given reproduction)&quot;</span>)</span>
<span id="cb186-49"><a href="integral-population-models.html#cb186-49" tabindex="-1"></a></span>
<span id="cb186-50"><a href="integral-population-models.html#cb186-50" tabindex="-1"></a><span class="co"># Panel 3: Combined expected reproduction</span></span>
<span id="cb186-51"><a href="integral-population-models.html#cb186-51" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(silene, <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> TotalReproOutput)) <span class="sc">+</span></span>
<span id="cb186-52"><a href="integral-population-models.html#cb186-52" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(Reproduced)), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb186-53"><a href="integral-population-models.html#cb186-53" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data, </span>
<span id="cb186-54"><a href="integral-population-models.html#cb186-54" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> VegReproHeight, <span class="at">y =</span> expected_total),</span>
<span id="cb186-55"><a href="integral-population-models.html#cb186-55" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;coral&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb186-56"><a href="integral-population-models.html#cb186-56" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span> <span class="ot">=</span> <span class="st">&quot;gray60&quot;</span>, <span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="st">&quot;steelblue&quot;</span>),</span>
<span id="cb186-57"><a href="integral-population-models.html#cb186-57" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Did not reproduce&quot;</span>, <span class="st">&quot;Reproduced&quot;</span>),</span>
<span id="cb186-58"><a href="integral-population-models.html#cb186-58" tabindex="-1"></a>                     <span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb186-59"><a href="integral-population-models.html#cb186-59" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb186-60"><a href="integral-population-models.html#cb186-60" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Combined: Expected Reproduction&quot;</span>,</span>
<span id="cb186-61"><a href="integral-population-models.html#cb186-61" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;E[seeds] = P(reproduce) × E[seeds | reproduce]&quot;</span>,</span>
<span id="cb186-62"><a href="integral-population-models.html#cb186-62" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Stem diameter (cm)&quot;</span>,</span>
<span id="cb186-63"><a href="integral-population-models.html#cb186-63" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Expected reproductive output&quot;</span>) <span class="sc">+</span></span>
<span id="cb186-64"><a href="integral-population-models.html#cb186-64" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb186-65"><a href="integral-population-models.html#cb186-65" tabindex="-1"></a></span>
<span id="cb186-66"><a href="integral-population-models.html#cb186-66" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-61-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="why-use-only-one-state-variable-the-multi-dimensional-trade-off" class="section level4 hasAnchor" number="17.2.8.2">
<h4><span class="header-section-number">17.2.8.2</span> Why Use Only One State Variable? The Multi-Dimensional Trade-off<a href="integral-population-models.html#why-use-only-one-state-variable-the-multi-dimensional-trade-off" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>State variables are rarely perfect predictors of vital rates. As a result, it is tempting to assume that including additional state variables will always improve demographic models. In practice, however, adding multiple state variables introduces substantial challenges. First, it increases the amount of field data required, often extending monitoring timelines and complicating census protocols. Multi-variable models can also be less intuitive for land managers, making it harder to interpret key drivers of population dynamics or implement streamlined monitoring programs.</p>
<p>Second—and more importantly—adding state variables dramatically increases model complexity through what is known as the dimensionality problem, which we describe in the following section.</p>
</div>
</div>
<div id="the-dimensionality-problem" class="section level3 hasAnchor" number="17.2.9">
<h3><span class="header-section-number">17.2.9</span> The dimensionality problem<a href="integral-population-models.html#the-dimensionality-problem" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An Integral Projection Model (IPM) works by tracking how individuals move through a
<em>continuous distribution of sizes</em> over time. Mathematically, this involves solving
an integral equation:</p>
<p><span class="math display">\[
n(z&#39;, t+1) = \int \left[ s(z)\, g(z&#39;, z) + f(z&#39;, z) \right] n(z, t)\, dz
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(z\)</span> is the state variable (e.g., size) at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(z&#39;\)</span> is the state variable at time <span class="math inline">\(t+1\)</span></li>
<li><span class="math inline">\(n(z, t)\)</span> is the population density of individuals of size <span class="math inline">\(z\)</span> at time <span class="math inline">\(t\)</span></li>
<li><span class="math inline">\(s(z)\)</span> is the probability of survival for individuals of size <span class="math inline">\(z\)</span></li>
<li><span class="math inline">\(g(z&#39;, z)\)</span> describes growth from size <span class="math inline">\(z\)</span> to size <span class="math inline">\(z&#39;\)</span></li>
<li><span class="math inline">\(f(z&#39;, z)\)</span> describes reproductive contributions from individuals of size <span class="math inline">\(z\)</span> to size <span class="math inline">\(z&#39;\)</span></li>
</ul>
<p>The integral is evaluated over all possible values of <span class="math inline">\(z\)</span>, meaning that contributions
from individuals of every size at time <span class="math inline">\(t\)</span> are summed to determine the population
distribution at time <span class="math inline">\(t+1\)</span>.</p>
<p>With ONE state variable (e.g., stem diameter):</p>
<ul>
<li>We discretize the size range into ~100-200 cells (bins)</li>
<li>This creates a 100×100 projection matrix (manageable!)</li>
<li>Computational time: seconds</li>
</ul>
<p>With TWO state variables (e.g., diameter AND height):</p>
<ul>
<li>We need a 2-dimensional grid: diameter × height</li>
<li>With 100 bins each → 100×100 = 10,000 cells</li>
<li>Projection matrix becomes 10,000×10,000</li>
<li>Computational time: minutes to hours</li>
<li><strong>Data requirements: Need MANY more individuals to fill that grid</strong></li>
</ul>
<p>With THREE state variables (diameter, height, number of stems):</p>
<ul>
<li>100×100×100 = 1,000,000 cells</li>
<li>Matrix size: 1,000,000×1,000,000</li>
<li>Computational time: potentially days</li>
<li><strong>Data requirements: Tens of thousands of observations</strong> Most cells would be EMPTY</li>
</ul>
<p>This is called the “curse of dimensionality” - complexity grows exponentially with each added dimension. Especially since IPMs are often used to model rare plants characterized by low population sizes, the data requirements imposed by the inclusion of even a second state variable, renders this approach intractable. On rare occasions, it might be worth it to include to an additional state variable, if the two variables two variables capture different aspects of performance and they are uncorrelated and if you have HUGE datasets.</p>
<p>Onward! With total height selected as our state variable, we’re ready to build the IPM vital rate functions!</p>
</div>
</div>
<div id="packages-and-approaches-to-creating-ipms" class="section level2 hasAnchor" number="17.3">
<h2><span class="header-section-number">17.3</span> Packages and approaches to creating IPMs<a href="integral-population-models.html#packages-and-approaches-to-creating-ipms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are multiple ways to build and analyze Integral Projection Models (IPMs) in R.
All approaches are based on the same underlying demographic theory, but they differ
in how much structure is imposed, how much code must be written by the user, and
how transparent the resulting model is.</p>
<p>Here, we briefly introduce three commonly used approaches: fully automated IPM
frameworks, semi-structured IPM tools, and hand-coded IPMs. In the sections that
follow, we use these approaches to illustrate model fitting and selection using
the same biological questions.</p>
<div id="ipmr-a-modern-flexible-ipm-framework" class="section level3 hasAnchor" number="17.3.1">
<h3><span class="header-section-number">17.3.1</span> ipmr: a modern, flexible IPM framework<a href="integral-population-models.html#ipmr-a-modern-flexible-ipm-framework" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>ipmr</strong> package provides a modern, modular framework for building IPMs in R.
Rather than fitting the IPM as a single object, ipmr encourages users to specify
each vital-rate submodel (survival, growth, reproduction) explicitly and then
combine them into an IPM kernel.</p>
<p>This approach emphasizes transparency and flexibility. Model components can be
easily modified, compared, and extended, making ipmr particularly well suited for
model selection, uncertainty analysis, and advanced demographic metrics such as
sensitivities, elasticities, and transient dynamics.</p>
<p>Because ipmr requires users to think carefully about each model component, it has
a steeper learning curve than more automated approaches, but it provides the most
control and clarity for research-grade analyses.</p>
</div>
<div id="ipmpack-a-more-automated-ipm-workflow" class="section level3 hasAnchor" number="17.3.2">
<h3><span class="header-section-number">17.3.2</span> IPMpack: a more automated IPM workflow<a href="integral-population-models.html#ipmpack-a-more-automated-ipm-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <strong>IPMpack</strong> package offers a more automated approach to building IPMs, handling
many steps of kernel construction and numerical integration internally. Users
specify vital-rate models and size bounds, and the package generates the IPM and
associated outputs.</p>
<p>This approach can be efficient and relatively easy to implement for standard
one-dimensional IPMs. However, the abstraction can make it harder to see how
individual model components contribute to population dynamics, and flexibility
is more limited when extending models or exploring alternative formulations.</p>
</div>
<div id="hand-coded-ipms-maximum-transparency" class="section level3 hasAnchor" number="17.3.3">
<h3><span class="header-section-number">17.3.3</span> Hand-coded IPMs: maximum transparency<a href="integral-population-models.html#hand-coded-ipms-maximum-transparency" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A third approach is to build IPMs entirely by hand using base R code. In this
workflow, vital-rate models are fit using standard statistical tools (e.g., <code>glm</code>,
<code>lm</code>, <code>gam</code>), and the IPM kernel is constructed explicitly using numerical
integration and matrix operations.</p>
<p>Hand-coded IPMs provide complete transparency and conceptual clarity, making them
valuable for understanding how IPMs work at a fundamental level. However, they
require substantially more code, are more prone to implementation errors, and can
be difficult to maintain or extend.</p>
<p>Now let’s create the linear models that make up the IPM kernel! Through, we can work through the process using each approach!</p>
</div>
</div>
<div id="building-an-ipm-structuring-linear-models-variable-transformations-and-dealing-with-outliers" class="section level2 hasAnchor" number="17.4">
<h2><span class="header-section-number">17.4</span> Building an IPM: Structuring linear models, variable transformations, and dealing with outliers<a href="integral-population-models.html#building-an-ipm-structuring-linear-models-variable-transformations-and-dealing-with-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this section, we build the statistical models that form the core of an Integral
Projection Model (IPM). Regardless of whether an IPM is implemented using a package
such as <code>ipmr</code>, <code>IPMpack</code>, or coded by hand, the underlying structure is the same:
IPMs are constructed from a set of regression models that describe how individual
state variables influence survival, growth, and reproduction.</p>
<p>Before assembling an IPM kernel, it is therefore essential to think carefully about
(1) which vital rates will be modeled, (2) how state variables enter those models,
and (3) how issues such as zero inflation, outliers, and missing values are handled.</p>
<p>First, let’s go ahead and pull in our transition dataset. A transition dataset consists of two years of matched data, in which the fate of each individual from one year to the next is documented. Notice the structure of the dataset! This dataframe tracks the fate of all individuals in the population from time 1 to time 2. The ‘id’ column corresponds with the tag number for each plant. The ‘size’ column contains sizes (in this case heights) of individuals in time 1, while ‘sizeNext’ indicates the size at time 2. In the ‘surv’ column, the fate of the individual at time 2 is indicated by either a 0 (died) or 1 (survived). For individuals that died, we place an ‘NA’ in the sizeNext column, since that individual didn’t exist that year!</p>
<p>Reproduction is always the most complex part of demographic modeling for plant species. Often, a reproductive cycle includes cryptic stages (seeds!) that are hard to track, may include vegetative and sexual reproductive components, and may involve several processes (like flower production and seed production) that may be important to examine to understand <em>why</em> population growth rates vary!</p>
<p>For Silene lanceolata, we don’t know enough about the seed bank to include this in our models. Seed dynamics are difficult to track across multiple sites and years. For this reason, we have built the models such that seeds produced in year 1 has the potential to germinate in year 2 or perish. Luckily, ignoring the seed bank for species with high rates of seed production has negligible affects on population growth. A new seedling won’t have a size, survival or reproductive values in year 1 (NAs are added to this column), but will have a measurement in the ‘sizeNext’ column - using this pattern in the data is <em>how</em> we tell R to pull data on seedlings, so it is important to have this information correctly entered in the dataframe.</p>
<p>We’ve broken reproduction into two components, fec1 and fec2. If an individual reproduced, we mark a ‘1’ in fec1, if the individual didn’t reproduce, then we add a ‘0’ to the fec1 column. For those individuals that did reproduce, the fec2 column contains the number of seeds produced. Again notice that if an individual didn’t reproduce, we place an ‘NA’ in the fec2 column. Finally, we’ve documented other observations for each individual that we think might explain population growth rates, like whether a plant has been browsed by deer or is in competition with other vegetation.</p>
<p>IPMs are only as good as the linear models that comprise them! As a critical first step in analyses, we have to take a look at the relationship between our state variable and growth, reproduction and survival. We want to be sure to address any issues with normality and unequal variance. First, examine variance; if variation depends on the state variable, include this in the model (we’ll do this in a minute). It is fairly common in plants to see, for instance, that growth rates are more variable in larger individuals.</p>
<p>For the ipmr and handcoding, column names could essentially be anything, though it is good practice to name columns in a way that is intuitive for your analyses. The IPMpack syntax is stricter, so we will default to using those naming conventions. Let’s pull in our data and look at its structure.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="integral-population-models.html#cb187-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb187-2"><a href="integral-population-models.html#cb187-2" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb187-3"><a href="integral-population-models.html#cb187-3" tabindex="-1"></a></span>
<span id="cb187-4"><a href="integral-population-models.html#cb187-4" tabindex="-1"></a><span class="co"># Download transition data</span></span>
<span id="cb187-5"><a href="integral-population-models.html#cb187-5" tabindex="-1"></a>file_id <span class="ot">&lt;-</span> <span class="st">&quot;1V0qWq0SlA9rWzyraZaOFdWDVDKQyiu53&quot;</span></span>
<span id="cb187-6"><a href="integral-population-models.html#cb187-6" tabindex="-1"></a></span>
<span id="cb187-7"><a href="integral-population-models.html#cb187-7" tabindex="-1"></a><span class="fu">GET</span>(</span>
<span id="cb187-8"><a href="integral-population-models.html#cb187-8" tabindex="-1"></a>  <span class="at">url =</span> <span class="fu">paste0</span>(<span class="st">&quot;https://drive.usercontent.google.com/download?id=&quot;</span>, </span>
<span id="cb187-9"><a href="integral-population-models.html#cb187-9" tabindex="-1"></a>               file_id, <span class="st">&quot;&amp;export=download&amp;confirm=t&quot;</span>),</span>
<span id="cb187-10"><a href="integral-population-models.html#cb187-10" tabindex="-1"></a>  <span class="fu">write_disk</span>(<span class="st">&quot;data/silene_transitions.csv&quot;</span>, <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb187-11"><a href="integral-population-models.html#cb187-11" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Response [https://drive.usercontent.google.com/download?id=1V0qWq0SlA9rWzyraZaOFdWDVDKQyiu53&amp;export=download&amp;confirm=t]
##   Date: 2026-01-18 02:26
##   Status: 200
##   Content-Type: application/octet-stream
##   Size: 18.2 kB
## &lt;ON DISK&gt;  /Users/sks379/Desktop/GitHubProjects/DataAnalysis/data/silene_transitions.csv</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="integral-population-models.html#cb189-1" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb189-2"><a href="integral-population-models.html#cb189-2" tabindex="-1"></a>transitions <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/silene_transitions.csv&quot;</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb189-3"><a href="integral-population-models.html#cb189-3" tabindex="-1"></a></span>
<span id="cb189-4"><a href="integral-population-models.html#cb189-4" tabindex="-1"></a><span class="co"># Initial exploration</span></span>
<span id="cb189-5"><a href="integral-population-models.html#cb189-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Dataset dimensions:&quot;</span>, <span class="fu">nrow</span>(transitions), <span class="st">&quot;rows x&quot;</span>, <span class="fu">ncol</span>(transitions), <span class="st">&quot;columns</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Dataset dimensions: 392 rows x 14 columns</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="integral-population-models.html#cb191-1" tabindex="-1"></a><span class="fu">glimpse</span>(transitions)</span></code></pre></div>
<pre><code>## Rows: 392
## Columns: 14
## $ id                            &lt;dbl&gt; 7, 34, 2, 46, 31, 23, 36, 32, 1, 41, 6, 23, 35, 22, 32, 26, 4…
## $ size                          &lt;dbl&gt; 110.5, 121.6, 56.4, 97.5, 90.0, 144.5, 103.4, 90.2, 76.2, 106…
## $ surv                          &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ sizeNext                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, 26.7, NA, NA, NA, NA, NA, NA,…
## $ fec1                          &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0…
## $ fec2                          &lt;dbl&gt; 3600, 10080, 11340, 12150, 13500, 15120, 15750, 18000, 29700,…
## $ Exclude                       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Site                          &lt;chr&gt; &quot;KalawamounaE&quot;, &quot;Bobcat03&quot;, &quot;Bobcat03&quot;, &quot;KalawamounaE&quot;, &quot;Kala…
## $ `Herbivory (Y/N)_2024`        &lt;chr&gt; NA, NA, NA, &quot;N&quot;, NA, NA, NA, NA, &quot;N&quot;, &quot;N&quot;, NA, NA, NA, NA, NA…
## $ `Herbivory Agent_2024`        &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ `Disease (Y/N)_2024`          &lt;chr&gt; &quot;N&quot;, &quot;N&quot;, NA, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, &quot;N&quot;, NA, &quot;N&quot;…
## $ `Description of Disease_2024` &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
## $ NotesYear1                    &lt;chr&gt; NA, NA, NA, &quot;most leaves are gone&quot;, NA, NA, NA, NA, NA, NA, N…
## $ NotesYear2                    &lt;chr&gt; &quot;NO&quot;, &quot;NO&quot;, NA, &quot;NO&quot;, &quot;NO&quot;, &quot;NO&quot;, &quot;NO&quot;, &quot;NO&quot;, &quot;NO&quot;, &quot;NO&quot;, &quot;NO…</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="integral-population-models.html#cb193-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Column names ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Column names ===</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="integral-population-models.html#cb195-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(transitions))</span></code></pre></div>
<pre><code>##  [1] &quot;id&quot;                          &quot;size&quot;                        &quot;surv&quot;                       
##  [4] &quot;sizeNext&quot;                    &quot;fec1&quot;                        &quot;fec2&quot;                       
##  [7] &quot;Exclude&quot;                     &quot;Site&quot;                        &quot;Herbivory (Y/N)_2024&quot;       
## [10] &quot;Herbivory Agent_2024&quot;        &quot;Disease (Y/N)_2024&quot;          &quot;Description of Disease_2024&quot;
## [13] &quot;NotesYear1&quot;                  &quot;NotesYear2&quot;</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="integral-population-models.html#cb197-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Summary statistics ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Summary statistics ===</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="integral-population-models.html#cb199-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(transitions))</span></code></pre></div>
<pre><code>##        id              size             surv          sizeNext           fec1       
##  Min.   :  1.00   Min.   :  2.50   Min.   :0.000   Min.   : 0.700   Min.   :0.0000  
##  1st Qu.: 39.75   1st Qu.: 11.00   1st Qu.:0.000   1st Qu.: 3.000   1st Qu.:0.0000  
##  Median :111.50   Median : 32.30   Median :1.000   Median : 4.300   Median :0.0000  
##  Mean   :125.44   Mean   : 55.29   Mean   :0.596   Mean   : 6.167   Mean   :0.4343  
##  3rd Qu.:190.25   3rd Qu.:103.30   3rd Qu.:1.000   3rd Qu.: 6.525   3rd Qu.:1.0000  
##  Max.   :479.00   Max.   :160.20   Max.   :1.000   Max.   :44.000   Max.   :1.0000  
##                   NA&#39;s   :293      NA&#39;s   :293     NA&#39;s   :40       NA&#39;s   :293     
##       fec2            Exclude            Site           Herbivory (Y/N)_2024 Herbivory Agent_2024
##  Min.   :     90   Min.   :0.00000   Length:392         Length:392           Length:392          
##  1st Qu.:  10800   1st Qu.:0.00000   Class :character   Class :character     Class :character    
##  Median :  30240   Median :0.00000   Mode  :character   Mode  :character     Mode  :character    
##  Mean   : 130305   Mean   :0.04337                                                               
##  3rd Qu.: 127665   3rd Qu.:0.00000                                                               
##  Max.   :1086120   Max.   :1.00000                                                               
##  NA&#39;s   :349                                                                                     
##  Disease (Y/N)_2024 Description of Disease_2024  NotesYear1         NotesYear2       
##  Length:392         Mode:logical                Length:392         Length:392        
##  Class :character   NA&#39;s:392                    Class :character   Class :character  
##  Mode  :character                               Mode  :character   Mode  :character  
##                                                                                      
##                                                                                      
##                                                                                      
## </code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="integral-population-models.html#cb201-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== First few rows ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === First few rows ===</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="integral-population-models.html#cb203-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(transitions, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 14
##       id  size  surv sizeNext  fec1  fec2 Exclude Site  `Herbivory (Y/N)_2024` `Herbivory Agent_2024`
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;                  &lt;chr&gt;                 
##  1     7 110.      0     NA       1  3600       0 Kala… &lt;NA&gt;                   &lt;NA&gt;                  
##  2    34 122.      0     NA       1 10080       0 Bobc… &lt;NA&gt;                   &lt;NA&gt;                  
##  3     2  56.4     0     NA       1 11340       0 Bobc… &lt;NA&gt;                   &lt;NA&gt;                  
##  4    46  97.5     0     NA       1 12150       0 Kala… N                      &lt;NA&gt;                  
##  5    31  90       0     NA       1 13500       0 Kala… &lt;NA&gt;                   &lt;NA&gt;                  
##  6    23 144.      0     NA       1 15120       0 Kala… &lt;NA&gt;                   &lt;NA&gt;                  
##  7    36 103.      0     NA       1 15750       0 Kala… &lt;NA&gt;                   &lt;NA&gt;                  
##  8    32  90.2     0     NA       1 18000       0 Kala… &lt;NA&gt;                   &lt;NA&gt;                  
##  9     1  76.2     1     26.7     1 29700       0 Kala… N                      &lt;NA&gt;                  
## 10    41 107.      0     NA       1 31500       0 Kala… N                      &lt;NA&gt;                  
## # ℹ 4 more variables: `Disease (Y/N)_2024` &lt;chr&gt;, `Description of Disease_2024` &lt;lgl&gt;,
## #   NotesYear1 &lt;chr&gt;, NotesYear2 &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="integral-population-models.html#cb205-1" tabindex="-1"></a><span class="co"># I always include an Exclude column to allow folks entering or collecting data to identify a priori really weird stuff to exclude!</span></span>
<span id="cb205-2"><a href="integral-population-models.html#cb205-2" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> transitions <span class="sc">|&gt;</span></span>
<span id="cb205-3"><a href="integral-population-models.html#cb205-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Exclude <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Key features:</p>
<ul>
<li>survival (surv) coded as a binary, 0 = dead, 1 = alive</li>
<li>size in year one size, continuous variable</li>
<li>sizeNext, year two size, continuous variable</li>
<li>fec1 = reproduced, yes or no, coded as 0 for no, and 1 for yes</li>
<li>fec2 two number of seeds produced, estimated from floral counts, rounded to the nearest whole number</li>
<li>includes any important information that could explain what happened to the plants (where they eaten by deer? where were they located?)</li>
<li>includes an ID number</li>
<li>new seedlings indicated by not having a size year 1 (coded as NA), survival information (NA), reproduction (NA), and a sizeNext entry</li>
<li>NA indicate missing data, and 0s are true zero</li>
<li>A column labeled ‘Exclude’ used to mark observations with unusual circumstances (e.g., severe damage, measurement error, or other anomalies) that would otherwise distort model fitting. Rather than deleting these observations permanently, retaining them in the dataset and filtering them explicitly allows decisions about inclusion to remain transparent and reproducible.</li>
</ul>
<p>Using this dataset, we will build four core components of the IPM:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Survival model</strong><br />
Probability of surviving from time <span class="math inline">\(t\)</span> to <span class="math inline">\(t+1\)</span> as a function of size.</p></li>
<li><p><strong>Growth model</strong><br />
Expected size at time <span class="math inline">\(t+1\)</span> given size at time <span class="math inline">\(t\)</span>, conditional on survival.</p></li>
<li><p><strong>Probability of reproduction</strong><br />
Probability that an individual reproduces as a function of size.</p></li>
<li><p><strong>Reproductive output</strong><br />
Number of offspring produced, conditional on reproduction occurring.</p></li>
</ol>
<div id="variable-transformations-and-scale" class="section level3 hasAnchor" number="17.4.1">
<h3><span class="header-section-number">17.4.1</span> Variable transformations and scale<a href="integral-population-models.html#variable-transformations-and-scale" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Demographic rates often exhibit nonlinear relationships with size and strong
right-skew, particularly for growth and fecundity. As a result, transformations are
commonly applied to improve model fit and biological realism.</p>
<p>In this example, we will explore transformations such as:</p>
<ul>
<li>log or square-root transformations of size</li>
<li>log transformations of reproductive output</li>
<li>centering and scaling of predictors for numerical stability</li>
</ul>
<p>Rather than assuming a single transformation <em>a priori</em>, we will use model selection
to evaluate competing formulations and identify those that best explain variation
in each vital rate.</p>
</div>
<div id="dealing-with-zeros-missing-values-and-outliers" class="section level3 hasAnchor" number="17.4.2">
<h3><span class="header-section-number">17.4.2</span> Dealing with zeros, missing values, and outliers<a href="integral-population-models.html#dealing-with-zeros-missing-values-and-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This dataset illustrates several common challenges in demographic data:</p>
<ul>
<li>Survival and reproduction include many zeros</li>
<li>Growth is undefined for individuals that did not survive</li>
<li>Reproductive output spans several orders of magnitude</li>
<li>Some individuals are flagged for exclusion</li>
</ul>
<p>We address these issues explicitly by:</p>
<ul>
<li>Modeling survival and reproduction as binomial processes</li>
<li>Conditioning growth models on survival</li>
<li>Using two-stage (hurdle) models for fecundity</li>
<li>Excluding flagged individuals prior to model fitting</li>
</ul>
<p>These steps ensure that each statistical model aligns with the biological process
it represents.</p>
</div>
<div id="parallel-ipm-workflows" class="section level3 hasAnchor" number="17.4.3">
<h3><span class="header-section-number">17.4.3</span> Parallel IPM workflows<a href="integral-population-models.html#parallel-ipm-workflows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Importantly, the statistical models described above are identical across IPM
implementations. What differs among approaches is how these models are incorporated
into a population projection framework.</p>
<p>In the sections that follow, we use the same fitted vital-rate models to construct
IPMs using three approaches:</p>
<ol style="list-style-type: decimal">
<li><p><strong><code>ipmr</code></strong> — a modular, transparent framework that explicitly links each model
component to the IPM kernel.</p></li>
<li><p><strong><code>IPMpack</code></strong> — a more automated approach that streamlines kernel construction.</p></li>
<li><p><strong>Hand-coded IPMs</strong> — a fully explicit implementation that reveals the underlying
mechanics of numerical integration and matrix approximation.</p></li>
</ol>
<p>By working through each approach in parallel, we emphasize that differences among
packages reflect differences in software design, not differences in demographic
theory.</p>
<p>We begin by fitting and comparing candidate models for each vital rate, starting
with growth. At each step, we evaluate model fit, interpret parameter estimates,
and discuss how these choices influence the resulting IPM.</p>
</div>
<div id="growth-transitions" class="section level3 hasAnchor" number="17.4.4">
<h3><span class="header-section-number">17.4.4</span> Growth transitions<a href="integral-population-models.html#growth-transitions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I typically start by modeling growth. Why? Growth is typically modeled as a continuous relationship between size at time <span class="math inline">\(t\)</span> and
size at time <span class="math inline">\(t+1\)</span>. Extreme deviations from this relationship—such as implausibly large
shrinks or jumps—can strongly influence parameter estimates and propagate unrealistic
behavior throughout the IPM kernel. In contrast, extreme reproductive values often reflect genuine biological processes
and should be treated with caution rather than automatically excluded.</p>
<p>Demographic data often contain extreme values, but not all extremes should be treated
as outliers. In particular, reproductive output can exhibit large variation that is
biologically real (e.g., mast events, episodic flowering), whereas extreme values in
growth are more likely to reflect measurement error or data recording issues.</p>
<p>For this reason, we focus first on identifying and handling outliers in the <strong>growth
model</strong>, rather than applying blanket outlier removal across all vital-rate models.</p>
<p>We begin by fitting a preliminary growth model using all available, non-excluded data. Remember, that we will only work with individuals that survived (otherwise there is no growth!)</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="integral-population-models.html#cb206-1" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> final_data <span class="sc">|&gt;</span></span>
<span id="cb206-2"><a href="integral-population-models.html#cb206-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(surv <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">!</span><span class="fu">is.na</span>(sizeNext))</span>
<span id="cb206-3"><a href="integral-population-models.html#cb206-3" tabindex="-1"></a></span>
<span id="cb206-4"><a href="integral-population-models.html#cb206-4" tabindex="-1"></a>m_growth_lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(sizeNext <span class="sc">~</span> size,</span>
<span id="cb206-5"><a href="integral-population-models.html#cb206-5" tabindex="-1"></a>                   <span class="at">data =</span> growth_data)</span>
<span id="cb206-6"><a href="integral-population-models.html#cb206-6" tabindex="-1"></a></span>
<span id="cb206-7"><a href="integral-population-models.html#cb206-7" tabindex="-1"></a>m_growth_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb206-8"><a href="integral-population-models.html#cb206-8" tabindex="-1"></a>                   <span class="at">data =</span> growth_data)</span>
<span id="cb206-9"><a href="integral-population-models.html#cb206-9" tabindex="-1"></a></span>
<span id="cb206-10"><a href="integral-population-models.html#cb206-10" tabindex="-1"></a><span class="fu">AIC</span>(m_growth_lin, m_growth_log)</span></code></pre></div>
<pre><code>##              df      AIC
## m_growth_lin  3 430.8275
## m_growth_log  3 122.3578</code></pre>
<p>Great! The lower AIC value wins and we see that we need to log transform the data. Now lets look at model fit (linear vs polynomial).</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="integral-population-models.html#cb208-1" tabindex="-1"></a>m_growth_log_lin <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb208-2"><a href="integral-population-models.html#cb208-2" tabindex="-1"></a>                       <span class="at">data =</span> growth_data)</span>
<span id="cb208-3"><a href="integral-population-models.html#cb208-3" tabindex="-1"></a></span>
<span id="cb208-4"><a href="integral-population-models.html#cb208-4" tabindex="-1"></a>m_growth_log_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb208-5"><a href="integral-population-models.html#cb208-5" tabindex="-1"></a>                        <span class="at">data =</span> growth_data)</span>
<span id="cb208-6"><a href="integral-population-models.html#cb208-6" tabindex="-1"></a></span>
<span id="cb208-7"><a href="integral-population-models.html#cb208-7" tabindex="-1"></a><span class="fu">AIC</span>(m_growth_log_lin, m_growth_log_poly)</span></code></pre></div>
<pre><code>##                   df      AIC
## m_growth_log_lin   3 122.3578
## m_growth_log_poly  4 120.1388</code></pre>
<p>The polynomial model is best! But wait, before we proceed - let’s check out the fit. This is critical for two reasons. First, we want to identify and remove any outliers. Remember, these outliers are more likely to be ‘true’ outliers (mis-ided individuals, measurement error). Secondly, sometimes higher order models produce biological unrealistic fits, especially when sample size is low (i.e., odd peaks and valleys for survival). When this occurs, it is typically better to revert to the simpler model! Let’s take a look at both fits.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="integral-population-models.html#cb210-1" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb210-2"><a href="integral-population-models.html#cb210-2" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">seq</span>(<span class="fu">min</span>(growth_data<span class="sc">$</span>size),</span>
<span id="cb210-3"><a href="integral-population-models.html#cb210-3" tabindex="-1"></a>             <span class="fu">max</span>(growth_data<span class="sc">$</span>size),</span>
<span id="cb210-4"><a href="integral-population-models.html#cb210-4" tabindex="-1"></a>             <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb210-5"><a href="integral-population-models.html#cb210-5" tabindex="-1"></a>)</span>
<span id="cb210-6"><a href="integral-population-models.html#cb210-6" tabindex="-1"></a></span>
<span id="cb210-7"><a href="integral-population-models.html#cb210-7" tabindex="-1"></a>newdat<span class="sc">$</span>lin  <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">predict</span>(m_growth_log_lin,  newdat))</span>
<span id="cb210-8"><a href="integral-population-models.html#cb210-8" tabindex="-1"></a>newdat<span class="sc">$</span>poly <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">predict</span>(m_growth_log_poly, newdat))</span>
<span id="cb210-9"><a href="integral-population-models.html#cb210-9" tabindex="-1"></a></span>
<span id="cb210-10"><a href="integral-population-models.html#cb210-10" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb210-11"><a href="integral-population-models.html#cb210-11" tabindex="-1"></a></span>
<span id="cb210-12"><a href="integral-population-models.html#cb210-12" tabindex="-1"></a><span class="fu">ggplot</span>(growth_data, <span class="fu">aes</span>(size, sizeNext)) <span class="sc">+</span></span>
<span id="cb210-13"><a href="integral-population-models.html#cb210-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb210-14"><a href="integral-population-models.html#cb210-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> newdat, <span class="fu">aes</span>(size, lin,  <span class="at">color =</span> <span class="st">&quot;Linear&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb210-15"><a href="integral-population-models.html#cb210-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> newdat, <span class="fu">aes</span>(size, poly, <span class="at">color =</span> <span class="st">&quot;Quadratic&quot;</span>), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb210-16"><a href="integral-population-models.html#cb210-16" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb210-17"><a href="integral-population-models.html#cb210-17" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb210-18"><a href="integral-population-models.html#cb210-18" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb210-19"><a href="integral-population-models.html#cb210-19" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Size at time t&quot;</span>,</span>
<span id="cb210-20"><a href="integral-population-models.html#cb210-20" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Size at time t+1&quot;</span>,</span>
<span id="cb210-21"><a href="integral-population-models.html#cb210-21" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Model&quot;</span></span>
<span id="cb210-22"><a href="integral-population-models.html#cb210-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb210-23"><a href="integral-population-models.html#cb210-23" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="960" style="display: block; margin: auto;" />
Interesting! The polynomial fit indicates that growth decreases at larger sizes, and indication of aging or some biophysical limit on growth at larger sizes. This seems biologically defensible and from a modeling standpoint (lower AIC) defensible. Let’s keep the polynomial fit!</p>
<div id="outlier-removal" class="section level4 hasAnchor" number="17.4.4.1">
<h4><span class="header-section-number">17.4.4.1</span> Outlier removal<a href="integral-population-models.html#outlier-removal" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We identify growth outliers using standardized residuals from the fitted growth
model, flagging extreme deviations for biological inspection rather than automatic
removal. Only observations that are clearly inconsistent with plausible growth are
excluded, and the model is refit to ensure stable kernel behavior.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="integral-population-models.html#cb211-1" tabindex="-1"></a>m_growth_quad <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb211-2"><a href="integral-population-models.html#cb211-2" tabindex="-1"></a>  <span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb211-3"><a href="integral-population-models.html#cb211-3" tabindex="-1"></a>  <span class="at">data =</span> growth_data</span>
<span id="cb211-4"><a href="integral-population-models.html#cb211-4" tabindex="-1"></a>)</span>
<span id="cb211-5"><a href="integral-population-models.html#cb211-5" tabindex="-1"></a></span>
<span id="cb211-6"><a href="integral-population-models.html#cb211-6" tabindex="-1"></a><span class="co"># Extract residuals</span></span>
<span id="cb211-7"><a href="integral-population-models.html#cb211-7" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> growth_data <span class="sc">|&gt;</span></span>
<span id="cb211-8"><a href="integral-population-models.html#cb211-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb211-9"><a href="integral-population-models.html#cb211-9" tabindex="-1"></a>    <span class="at">fitted   =</span> <span class="fu">fitted</span>(m_growth_quad),</span>
<span id="cb211-10"><a href="integral-population-models.html#cb211-10" tabindex="-1"></a>    <span class="at">resid    =</span> <span class="fu">residuals</span>(m_growth_quad),</span>
<span id="cb211-11"><a href="integral-population-models.html#cb211-11" tabindex="-1"></a>    <span class="at">std_res  =</span> <span class="fu">rstandard</span>(m_growth_quad)</span>
<span id="cb211-12"><a href="integral-population-models.html#cb211-12" tabindex="-1"></a>  )</span>
<span id="cb211-13"><a href="integral-population-models.html#cb211-13" tabindex="-1"></a></span>
<span id="cb211-14"><a href="integral-population-models.html#cb211-14" tabindex="-1"></a><span class="co"># Visual residuals</span></span>
<span id="cb211-15"><a href="integral-population-models.html#cb211-15" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb211-16"><a href="integral-population-models.html#cb211-16" tabindex="-1"></a></span>
<span id="cb211-17"><a href="integral-population-models.html#cb211-17" tabindex="-1"></a><span class="fu">ggplot</span>(growth_data, <span class="fu">aes</span>(<span class="fu">log</span>(size), std_res)) <span class="sc">+</span></span>
<span id="cb211-18"><a href="integral-population-models.html#cb211-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb211-19"><a href="integral-population-models.html#cb211-19" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb211-20"><a href="integral-population-models.html#cb211-20" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb211-21"><a href="integral-population-models.html#cb211-21" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb211-22"><a href="integral-population-models.html#cb211-22" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb211-23"><a href="integral-population-models.html#cb211-23" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;log(size at time t)&quot;</span>,</span>
<span id="cb211-24"><a href="integral-population-models.html#cb211-24" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Standardized residual&quot;</span></span>
<span id="cb211-25"><a href="integral-population-models.html#cb211-25" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-26"><a href="integral-population-models.html#cb211-26" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="integral-population-models.html#cb212-1" tabindex="-1"></a><span class="co"># Apply ±3 is a flagging threshold, not an automatic deletion rule</span></span>
<span id="cb212-2"><a href="integral-population-models.html#cb212-2" tabindex="-1"></a>growth_data <span class="ot">&lt;-</span> growth_data <span class="sc">|&gt;</span></span>
<span id="cb212-3"><a href="integral-population-models.html#cb212-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb212-4"><a href="integral-population-models.html#cb212-4" tabindex="-1"></a>    <span class="at">flag_outlier =</span> <span class="fu">abs</span>(std_res) <span class="sc">&gt;</span> <span class="dv">3</span></span>
<span id="cb212-5"><a href="integral-population-models.html#cb212-5" tabindex="-1"></a>  )</span></code></pre></div>
<p>Here, we don’t see any significant outliers! Awesome! Let take a different look:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="integral-population-models.html#cb213-1" tabindex="-1"></a><span class="co"># Evaluating data for IPM construction using log(size)</span></span>
<span id="cb213-2"><a href="integral-population-models.html#cb213-2" tabindex="-1"></a>growth_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb213-3"><a href="integral-population-models.html#cb213-3" tabindex="-1"></a>                 <span class="at">na.action =</span> na.omit,</span>
<span id="cb213-4"><a href="integral-population-models.html#cb213-4" tabindex="-1"></a>                 <span class="at">data =</span> final_data)</span>
<span id="cb213-5"><a href="integral-population-models.html#cb213-5" tabindex="-1"></a></span>
<span id="cb213-6"><a href="integral-population-models.html#cb213-6" tabindex="-1"></a>resid_log <span class="ot">&lt;-</span> <span class="fu">residuals</span>(growth_log)</span>
<span id="cb213-7"><a href="integral-population-models.html#cb213-7" tabindex="-1"></a></span>
<span id="cb213-8"><a href="integral-population-models.html#cb213-8" tabindex="-1"></a><span class="co"># Normality test</span></span>
<span id="cb213-9"><a href="integral-population-models.html#cb213-9" tabindex="-1"></a><span class="fu">shapiro.test</span>(resid_log)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  resid_log
## W = 0.97379, p-value = 0.2316</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="integral-population-models.html#cb215-1" tabindex="-1"></a><span class="co"># Residuals vs fitted</span></span>
<span id="cb215-2"><a href="integral-population-models.html#cb215-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(growth_log), resid_log,</span>
<span id="cb215-3"><a href="integral-population-models.html#cb215-3" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Fitted values (log sizeNext)&quot;</span>,</span>
<span id="cb215-4"><a href="integral-population-models.html#cb215-4" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb215-5"><a href="integral-population-models.html#cb215-5" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Residuals vs Fitted (log–log model)&quot;</span>)</span>
<span id="cb215-6"><a href="integral-population-models.html#cb215-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="integral-population-models.html#cb216-1" tabindex="-1"></a>id.n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(final_data)</span>
<span id="cb216-2"><a href="integral-population-models.html#cb216-2" tabindex="-1"></a></span>
<span id="cb216-3"><a href="integral-population-models.html#cb216-3" tabindex="-1"></a><span class="fu">qqPlot</span>(growth_log,</span>
<span id="cb216-4"><a href="integral-population-models.html#cb216-4" tabindex="-1"></a>       <span class="at">distribution =</span> <span class="st">&quot;norm&quot;</span>,</span>
<span id="cb216-5"><a href="integral-population-models.html#cb216-5" tabindex="-1"></a>       <span class="at">id.method =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb216-6"><a href="integral-population-models.html#cb216-6" tabindex="-1"></a>       <span class="at">id.cex =</span> <span class="fl">0.6</span>,</span>
<span id="cb216-7"><a href="integral-population-models.html#cb216-7" tabindex="-1"></a>       <span class="at">id.n =</span> id.n,</span>
<span id="cb216-8"><a href="integral-population-models.html#cb216-8" tabindex="-1"></a>       <span class="at">id.col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb216-9"><a href="integral-population-models.html#cb216-9" tabindex="-1"></a>       <span class="at">id.location =</span> <span class="st">&quot;ab&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-2.png" width="960" style="display: block; margin: auto;" /></p>
<pre><code>## [1] 72 81</code></pre>
<p>This figure is showing a scatter plot of residuals on the y axis and fitted values (estimated responses) on the x axis. We use these scatterplots to detect non-linearity, unequal error variances, and outliers. The residuals should “bounce randomly” around the 0 line, indicating that the assumption that the relationship is linear is reasonable. You also show see that the residuals roughly form a “horizontal band” around the 0 line, indicating that the variances of the error terms are equal. Finally, we looking for a dataset in which no one residual “stands out” from the basic random pattern of residuals. Let’s look at these residuals another way and use label the outliers so that we can remove them if necessary!</p>
<p>A quantile-quantile plot, often abbreviated as Q-Q plot, is a graphical tool used to assess whether a dataset follows a particular theoretical distribution, such as the normal distribution. It compares the quantiles of the observed data against the quantiles of the expected theoretical distribution.</p>
<p>Here’s how to interpret a Q-Q plot: The <em>x-axis</em> of the Q-Q plot represents the theoretical quantiles from a specified distribution (e.g., the normal distribution). The <em>y-axis</em> represents the quantiles of the observed data. If the points on the Q-Q plot fall approximately along a straight line, it suggests that the data follows the theoretical distribution. Deviations from the straight line indicate departures from the assumed distribution. If points are above the line, it suggests that the observed values are higher than expected for that quantile. If points are below the line, it suggests that the observed values are lower than expected for that quantile. The ends of the Q-Q plot are often of particular interest. Deviations in the tails can indicate differences in tail behavior.</p>
<p>These data look fine! In cases where this is deviation from normality, it is good practice to try to determine whether it is legitimate to remove outliers from any statistical analysis. In demographic studies, there are so many plants and many reasonable possibilities for why we may observe a strange transition from one year to the next.</p>
<p>For example:</p>
<ul>
<li>In the first year, someone measured the plant, but it had already been browsed by a deer and so was extra short, and then appears to grow like wild in the following year</li>
<li>Someone took data on the wrong space on the datasheet</li>
<li>Someone couldn’t find a mama plant, who actually died, so accidentally measured a baby that had germinated in a nearby spot</li>
</ul>
<p>Given this, unlike with standard statistical analyses, we tend to be less stringent about when we remove outliers. Let’s take a look at residuals.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="integral-population-models.html#cb218-1" tabindex="-1"></a><span class="co"># row_index &lt;- 59</span></span>
<span id="cb218-2"><a href="integral-population-models.html#cb218-2" tabindex="-1"></a><span class="co"># value &lt;- final_data[row_index,]</span></span>
<span id="cb218-3"><a href="integral-population-models.html#cb218-3" tabindex="-1"></a><span class="co"># print(value)</span></span>
<span id="cb218-4"><a href="integral-population-models.html#cb218-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb218-5"><a href="integral-population-models.html#cb218-5" tabindex="-1"></a><span class="co"># #or you can generate the id and use that to subset (just looking at the id number from above)</span></span>
<span id="cb218-6"><a href="integral-population-models.html#cb218-6" tabindex="-1"></a><span class="co"># target_id &lt;- 17</span></span>
<span id="cb218-7"><a href="integral-population-models.html#cb218-7" tabindex="-1"></a><span class="co"># row_data_index &lt;- final_data[final_data$ID == target_id, ]</span></span>
<span id="cb218-8"><a href="integral-population-models.html#cb218-8" tabindex="-1"></a><span class="co"># print(row_data_index)</span></span>
<span id="cb218-9"><a href="integral-population-models.html#cb218-9" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb218-10"><a href="integral-population-models.html#cb218-10" tabindex="-1"></a><span class="co"># #check out the other outlier</span></span>
<span id="cb218-11"><a href="integral-population-models.html#cb218-11" tabindex="-1"></a><span class="co"># row_index &lt;- 74</span></span>
<span id="cb218-12"><a href="integral-population-models.html#cb218-12" tabindex="-1"></a><span class="co"># value &lt;- final_data[row_index,]</span></span>
<span id="cb218-13"><a href="integral-population-models.html#cb218-13" tabindex="-1"></a><span class="co"># print(value) </span></span></code></pre></div>
<p>We could decide to remove outliers! Example below:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="integral-population-models.html#cb219-1" tabindex="-1"></a><span class="co"># # Remove identified outliers</span></span>
<span id="cb219-2"><a href="integral-population-models.html#cb219-2" tabindex="-1"></a><span class="co"># final_data &lt;- final_data[-c(44, 74), ] </span></span>
<span id="cb219-3"><a href="integral-population-models.html#cb219-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-4"><a href="integral-population-models.html#cb219-4" tabindex="-1"></a><span class="co"># # Fit growth model on the log scale</span></span>
<span id="cb219-5"><a href="integral-population-models.html#cb219-5" tabindex="-1"></a><span class="co"># growth_log &lt;- lm(log(sizeNext) ~ log(size),</span></span>
<span id="cb219-6"><a href="integral-population-models.html#cb219-6" tabindex="-1"></a><span class="co">#                  na.action = na.omit,</span></span>
<span id="cb219-7"><a href="integral-population-models.html#cb219-7" tabindex="-1"></a><span class="co">#                  data = final_data)</span></span>
<span id="cb219-8"><a href="integral-population-models.html#cb219-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-9"><a href="integral-population-models.html#cb219-9" tabindex="-1"></a><span class="co"># # Extract residuals</span></span>
<span id="cb219-10"><a href="integral-population-models.html#cb219-10" tabindex="-1"></a><span class="co"># resid_log &lt;- residuals(growth_log)</span></span>
<span id="cb219-11"><a href="integral-population-models.html#cb219-11" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-12"><a href="integral-population-models.html#cb219-12" tabindex="-1"></a><span class="co"># # Test normality of residuals (on log scale)</span></span>
<span id="cb219-13"><a href="integral-population-models.html#cb219-13" tabindex="-1"></a><span class="co"># shapiro.test(resid_log)</span></span>
<span id="cb219-14"><a href="integral-population-models.html#cb219-14" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-15"><a href="integral-population-models.html#cb219-15" tabindex="-1"></a><span class="co"># # Set up plotting window</span></span>
<span id="cb219-16"><a href="integral-population-models.html#cb219-16" tabindex="-1"></a><span class="co"># par(mfrow = c(1, 2), mar = c(4, 4, 2, 1))</span></span>
<span id="cb219-17"><a href="integral-population-models.html#cb219-17" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-18"><a href="integral-population-models.html#cb219-18" tabindex="-1"></a><span class="co"># # Scatter plot of log(size) vs log(sizeNext)</span></span>
<span id="cb219-19"><a href="integral-population-models.html#cb219-19" tabindex="-1"></a><span class="co"># plot(log(sizeNext) ~ log(size),</span></span>
<span id="cb219-20"><a href="integral-population-models.html#cb219-20" tabindex="-1"></a><span class="co">#      data = final_data,</span></span>
<span id="cb219-21"><a href="integral-population-models.html#cb219-21" tabindex="-1"></a><span class="co">#      xlab = &quot;log(Size at time t)&quot;,</span></span>
<span id="cb219-22"><a href="integral-population-models.html#cb219-22" tabindex="-1"></a><span class="co">#      ylab = &quot;log(Size at time t+1)&quot;,</span></span>
<span id="cb219-23"><a href="integral-population-models.html#cb219-23" tabindex="-1"></a><span class="co">#      main = &quot;Growth relationship (log–log)&quot;)</span></span>
<span id="cb219-24"><a href="integral-population-models.html#cb219-24" tabindex="-1"></a><span class="co"># abline(growth_log, col = &quot;red&quot;, lwd = 2)</span></span>
<span id="cb219-25"><a href="integral-population-models.html#cb219-25" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb219-26"><a href="integral-population-models.html#cb219-26" tabindex="-1"></a><span class="co"># # Q-Q plot of residuals</span></span>
<span id="cb219-27"><a href="integral-population-models.html#cb219-27" tabindex="-1"></a><span class="co"># id.n &lt;- nrow(final_data)</span></span>
<span id="cb219-28"><a href="integral-population-models.html#cb219-28" tabindex="-1"></a><span class="co"># qqPlot(growth_log,</span></span>
<span id="cb219-29"><a href="integral-population-models.html#cb219-29" tabindex="-1"></a><span class="co">#        distribution = &quot;norm&quot;,</span></span>
<span id="cb219-30"><a href="integral-population-models.html#cb219-30" tabindex="-1"></a><span class="co">#        id.method = &quot;y&quot;,</span></span>
<span id="cb219-31"><a href="integral-population-models.html#cb219-31" tabindex="-1"></a><span class="co">#        id.cex = 0.6,</span></span>
<span id="cb219-32"><a href="integral-population-models.html#cb219-32" tabindex="-1"></a><span class="co">#        id.n = id.n,</span></span>
<span id="cb219-33"><a href="integral-population-models.html#cb219-33" tabindex="-1"></a><span class="co">#        id.col = &quot;blue&quot;,</span></span>
<span id="cb219-34"><a href="integral-population-models.html#cb219-34" tabindex="-1"></a><span class="co">#        id.location = &quot;ab&quot;)</span></span></code></pre></div>
<p>Remember, if you do remove outliers, you must refit the model!</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="integral-population-models.html#cb220-1" tabindex="-1"></a>growth_clean <span class="ot">&lt;-</span> growth_data <span class="sc">|&gt;</span></span>
<span id="cb220-2"><a href="integral-population-models.html#cb220-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>flag_outlier)</span>
<span id="cb220-3"><a href="integral-population-models.html#cb220-3" tabindex="-1"></a></span>
<span id="cb220-4"><a href="integral-population-models.html#cb220-4" tabindex="-1"></a><span class="co"># Refit model without outliers</span></span>
<span id="cb220-5"><a href="integral-population-models.html#cb220-5" tabindex="-1"></a>m_growth_quad_clean <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb220-6"><a href="integral-population-models.html#cb220-6" tabindex="-1"></a>  <span class="fu">log</span>(sizeNext) <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb220-7"><a href="integral-population-models.html#cb220-7" tabindex="-1"></a>  <span class="at">data =</span> growth_clean</span>
<span id="cb220-8"><a href="integral-population-models.html#cb220-8" tabindex="-1"></a>)</span>
<span id="cb220-9"><a href="integral-population-models.html#cb220-9" tabindex="-1"></a></span>
<span id="cb220-10"><a href="integral-population-models.html#cb220-10" tabindex="-1"></a><span class="co"># Compare models in order to determine whether the removal of the outlier changed fit.</span></span>
<span id="cb220-11"><a href="integral-population-models.html#cb220-11" tabindex="-1"></a><span class="fu">summary</span>(m_growth_quad)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(sizeNext) ~ poly(log(size), 2, raw = TRUE), 
##     data = growth_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.25728 -0.44403 -0.01676  0.38419  1.38985 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)                     -1.95684    1.09712  -1.784  0.07990 . 
## poly(log(size), 2, raw = TRUE)1  1.96402    0.67401   2.914  0.00512 **
## poly(log(size), 2, raw = TRUE)2 -0.19582    0.09611  -2.037  0.04634 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6424 on 56 degrees of freedom
## Multiple R-squared:  0.5209, Adjusted R-squared:  0.5038 
## F-statistic: 30.44 on 2 and 56 DF,  p-value: 1.128e-09</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="integral-population-models.html#cb222-1" tabindex="-1"></a><span class="fu">summary</span>(m_growth_quad_clean)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(sizeNext) ~ poly(log(size), 2, raw = TRUE), 
##     data = growth_clean)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.25728 -0.44403 -0.01676  0.38419  1.38985 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)                     -1.95684    1.09712  -1.784  0.07990 . 
## poly(log(size), 2, raw = TRUE)1  1.96402    0.67401   2.914  0.00512 **
## poly(log(size), 2, raw = TRUE)2 -0.19582    0.09611  -2.037  0.04634 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6424 on 56 degrees of freedom
## Multiple R-squared:  0.5209, Adjusted R-squared:  0.5038 
## F-statistic: 30.44 on 2 and 56 DF,  p-value: 1.128e-09</code></pre>
<p>Note that if you do remove outliers you must repeat the model fitting process and update the final model that can be included in the kernel!</p>
</div>
<div id="probability-of-reproduction" class="section level4 hasAnchor" number="17.4.4.2">
<h4><span class="header-section-number">17.4.4.2</span> Probability of reproduction<a href="integral-population-models.html#probability-of-reproduction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Next, we repeat this process for all individuals. I generally do not perform outlier removal for the rest of the analyses, since we want to capture true variation in vital rates. Thus, the oddballs can be important for understanding the system, but only if they are real outliers, rather than created by human error.</p>
<p>We model whether an individual reproduced (<code>fec1</code>) as a function of size:</p>
<p><span class="math display">\[
\text{logit}(p_{\text{repr}}) = \beta_0 + \beta_1 z
\]</span></p>
<p>where <span class="math inline">\(z\)</span> is the state variable (size at time <span class="math inline">\(t\)</span>).</p>
<p>First, let’s determine whether we should use a log transformation. We will apply this consistently across all models. Reproduction is often log transformed, since reproduction is expected to increase multiplicatively with size.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="integral-population-models.html#cb224-1" tabindex="-1"></a><span class="co"># Binomial model for probability of reproduction</span></span>
<span id="cb224-2"><a href="integral-population-models.html#cb224-2" tabindex="-1"></a>m_repr <span class="ot">&lt;-</span> <span class="fu">glm</span>(fec1 <span class="sc">~</span> size,</span>
<span id="cb224-3"><a href="integral-population-models.html#cb224-3" tabindex="-1"></a>              <span class="at">data =</span> final_data,</span>
<span id="cb224-4"><a href="integral-population-models.html#cb224-4" tabindex="-1"></a>              <span class="at">family =</span> binomial,</span>
<span id="cb224-5"><a href="integral-population-models.html#cb224-5" tabindex="-1"></a>              <span class="at">subset =</span> Exclude <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb224-6"><a href="integral-population-models.html#cb224-6" tabindex="-1"></a></span>
<span id="cb224-7"><a href="integral-population-models.html#cb224-7" tabindex="-1"></a>m_repr_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(fec1 <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb224-8"><a href="integral-population-models.html#cb224-8" tabindex="-1"></a>                  <span class="at">data =</span> final_data,</span>
<span id="cb224-9"><a href="integral-population-models.html#cb224-9" tabindex="-1"></a>                  <span class="at">family =</span> binomial,</span>
<span id="cb224-10"><a href="integral-population-models.html#cb224-10" tabindex="-1"></a>                  <span class="at">subset =</span> Exclude <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb224-11"><a href="integral-population-models.html#cb224-11" tabindex="-1"></a></span>
<span id="cb224-12"><a href="integral-population-models.html#cb224-12" tabindex="-1"></a><span class="fu">AIC</span>(m_repr, m_repr_log)</span></code></pre></div>
<pre><code>##            df      AIC
## m_repr      2 35.03888
## m_repr_log  2 30.57976</code></pre>
<p>And yes, the log scale has the lower AIC value, so we choose log tranformed data! Now let’s compare model fits (i.e., linear vs polynomial models).</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="integral-population-models.html#cb226-1" tabindex="-1"></a>m_repr_log_lin <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb226-2"><a href="integral-population-models.html#cb226-2" tabindex="-1"></a>  fec1 <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb226-3"><a href="integral-population-models.html#cb226-3" tabindex="-1"></a>  <span class="at">data   =</span> final_data,</span>
<span id="cb226-4"><a href="integral-population-models.html#cb226-4" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb226-5"><a href="integral-population-models.html#cb226-5" tabindex="-1"></a>)</span>
<span id="cb226-6"><a href="integral-population-models.html#cb226-6" tabindex="-1"></a></span>
<span id="cb226-7"><a href="integral-population-models.html#cb226-7" tabindex="-1"></a>m_repr_log_poly <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb226-8"><a href="integral-population-models.html#cb226-8" tabindex="-1"></a>  fec1 <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb226-9"><a href="integral-population-models.html#cb226-9" tabindex="-1"></a>  <span class="at">data   =</span> final_data,</span>
<span id="cb226-10"><a href="integral-population-models.html#cb226-10" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb226-11"><a href="integral-population-models.html#cb226-11" tabindex="-1"></a>)</span>
<span id="cb226-12"><a href="integral-population-models.html#cb226-12" tabindex="-1"></a></span>
<span id="cb226-13"><a href="integral-population-models.html#cb226-13" tabindex="-1"></a><span class="fu">AIC</span>(m_repr_log_lin, m_repr_log_poly)</span></code></pre></div>
<pre><code>##                 df      AIC
## m_repr_log_lin   2 30.57976
## m_repr_log_poly  3 31.11613</code></pre>
<p>Wonderful - the linear model wins! Next, we need to visualize the state variable-vital rate relationship.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="integral-population-models.html#cb228-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb228-2"><a href="integral-population-models.html#cb228-2" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb228-3"><a href="integral-population-models.html#cb228-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb228-4"><a href="integral-population-models.html#cb228-4" tabindex="-1"></a></span>
<span id="cb228-5"><a href="integral-population-models.html#cb228-5" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb228-6"><a href="integral-population-models.html#cb228-6" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">seq</span>(<span class="fu">min</span>(final_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb228-7"><a href="integral-population-models.html#cb228-7" tabindex="-1"></a>             <span class="fu">max</span>(final_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb228-8"><a href="integral-population-models.html#cb228-8" tabindex="-1"></a>             <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb228-9"><a href="integral-population-models.html#cb228-9" tabindex="-1"></a>)</span>
<span id="cb228-10"><a href="integral-population-models.html#cb228-10" tabindex="-1"></a></span>
<span id="cb228-11"><a href="integral-population-models.html#cb228-11" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> newdat <span class="sc">|&gt;</span></span>
<span id="cb228-12"><a href="integral-population-models.html#cb228-12" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb228-13"><a href="integral-population-models.html#cb228-13" tabindex="-1"></a>    <span class="st">`</span><span class="at">Linear (log size)</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">predict</span>(m_repr_log_lin,  newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb228-14"><a href="integral-population-models.html#cb228-14" tabindex="-1"></a>    <span class="st">`</span><span class="at">Quadratic (log size)</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">predict</span>(m_repr_log_poly, newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb228-15"><a href="integral-population-models.html#cb228-15" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb228-16"><a href="integral-population-models.html#cb228-16" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb228-17"><a href="integral-population-models.html#cb228-17" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>size,</span>
<span id="cb228-18"><a href="integral-population-models.html#cb228-18" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb228-19"><a href="integral-population-models.html#cb228-19" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Prediction&quot;</span></span>
<span id="cb228-20"><a href="integral-population-models.html#cb228-20" tabindex="-1"></a>  )</span>
<span id="cb228-21"><a href="integral-population-models.html#cb228-21" tabindex="-1"></a></span>
<span id="cb228-22"><a href="integral-population-models.html#cb228-22" tabindex="-1"></a><span class="fu">ggplot</span>(final_data, <span class="fu">aes</span>(size, fec1)) <span class="sc">+</span></span>
<span id="cb228-23"><a href="integral-population-models.html#cb228-23" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb228-24"><a href="integral-population-models.html#cb228-24" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb228-25"><a href="integral-population-models.html#cb228-25" tabindex="-1"></a>    <span class="at">data =</span> pred_df,</span>
<span id="cb228-26"><a href="integral-population-models.html#cb228-26" tabindex="-1"></a>    <span class="fu">aes</span>(size, Prediction, <span class="at">color =</span> Model),</span>
<span id="cb228-27"><a href="integral-population-models.html#cb228-27" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb228-28"><a href="integral-population-models.html#cb228-28" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb228-29"><a href="integral-population-models.html#cb228-29" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb228-30"><a href="integral-population-models.html#cb228-30" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Probability of reproduction&quot;</span>,</span>
<span id="cb228-31"><a href="integral-population-models.html#cb228-31" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Model fit&quot;</span></span>
<span id="cb228-32"><a href="integral-population-models.html#cb228-32" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb228-33"><a href="integral-population-models.html#cb228-33" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-73-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="seed-production" class="section level4 hasAnchor" number="17.4.4.3">
<h4><span class="header-section-number">17.4.4.3</span> Seed production<a href="integral-population-models.html#seed-production" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Seed production (<code>fec2</code>) is only observed for individuals that reproduced. We therefore
model fecundity conditional on reproduction (<code>fec1 == 1</code>). Because seed counts are
highly right-skewed and often overdispersed, we use a negative binomial model.</p>
<p>As above, we first evaluate whether a log transformation of size is appropriate, then
compare linear versus polynomial functional forms.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="integral-population-models.html#cb229-1" tabindex="-1"></a>fec_data <span class="ot">&lt;-</span> final_data <span class="sc">|&gt;</span></span>
<span id="cb229-2"><a href="integral-population-models.html#cb229-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(fec1 <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">!</span><span class="fu">is.na</span>(fec2))</span>
<span id="cb229-3"><a href="integral-population-models.html#cb229-3" tabindex="-1"></a></span>
<span id="cb229-4"><a href="integral-population-models.html#cb229-4" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb229-5"><a href="integral-population-models.html#cb229-5" tabindex="-1"></a></span>
<span id="cb229-6"><a href="integral-population-models.html#cb229-6" tabindex="-1"></a>m_fec_lin <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb229-7"><a href="integral-population-models.html#cb229-7" tabindex="-1"></a>  fec2 <span class="sc">~</span> size,</span>
<span id="cb229-8"><a href="integral-population-models.html#cb229-8" tabindex="-1"></a>  <span class="at">data =</span> fec_data</span>
<span id="cb229-9"><a href="integral-population-models.html#cb229-9" tabindex="-1"></a>)</span>
<span id="cb229-10"><a href="integral-population-models.html#cb229-10" tabindex="-1"></a></span>
<span id="cb229-11"><a href="integral-population-models.html#cb229-11" tabindex="-1"></a>m_fec_log <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb229-12"><a href="integral-population-models.html#cb229-12" tabindex="-1"></a>  fec2 <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb229-13"><a href="integral-population-models.html#cb229-13" tabindex="-1"></a>  <span class="at">data =</span> fec_data</span>
<span id="cb229-14"><a href="integral-population-models.html#cb229-14" tabindex="-1"></a>)</span>
<span id="cb229-15"><a href="integral-population-models.html#cb229-15" tabindex="-1"></a></span>
<span id="cb229-16"><a href="integral-population-models.html#cb229-16" tabindex="-1"></a><span class="fu">AIC</span>(m_fec_lin, m_fec_log)</span></code></pre></div>
<pre><code>##           df      AIC
## m_fec_lin  3 972.3240
## m_fec_log  3 967.9926</code></pre>
<p>Log transformation wins again! As with reproduction probability, fecundity is often expected to increase
multiplicatively with size.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="integral-population-models.html#cb231-1" tabindex="-1"></a><span class="co">#  Compare function form</span></span>
<span id="cb231-2"><a href="integral-population-models.html#cb231-2" tabindex="-1"></a>m_fec_log_lin <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb231-3"><a href="integral-population-models.html#cb231-3" tabindex="-1"></a>  fec2 <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb231-4"><a href="integral-population-models.html#cb231-4" tabindex="-1"></a>  <span class="at">data =</span> fec_data</span>
<span id="cb231-5"><a href="integral-population-models.html#cb231-5" tabindex="-1"></a>)</span>
<span id="cb231-6"><a href="integral-population-models.html#cb231-6" tabindex="-1"></a></span>
<span id="cb231-7"><a href="integral-population-models.html#cb231-7" tabindex="-1"></a>m_fec_log_poly <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(</span>
<span id="cb231-8"><a href="integral-population-models.html#cb231-8" tabindex="-1"></a>  fec2 <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb231-9"><a href="integral-population-models.html#cb231-9" tabindex="-1"></a>  <span class="at">data =</span> fec_data</span>
<span id="cb231-10"><a href="integral-population-models.html#cb231-10" tabindex="-1"></a>)</span>
<span id="cb231-11"><a href="integral-population-models.html#cb231-11" tabindex="-1"></a></span>
<span id="cb231-12"><a href="integral-population-models.html#cb231-12" tabindex="-1"></a><span class="fu">AIC</span>(m_fec_log_lin, m_fec_log_poly)</span></code></pre></div>
<pre><code>##                df      AIC
## m_fec_log_lin   3 967.9926
## m_fec_log_poly  4 963.6462</code></pre>
<p>Polynomial model wins! But note, we have a warning that the model didn’t converge! This is annoying, but not uncommon for rare plants. This typically means that we should choose the simpler model, despite AIC findings. Let’s see whether the simpler model converges.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="integral-population-models.html#cb233-1" tabindex="-1"></a><span class="fu">summary</span>(m_fec_log_lin)</span></code></pre></div>
<pre><code>## 
## Call:
## glm.nb(formula = fec2 ~ log(size), data = fec_data, init.theta = 0.4985063643, 
##     link = log)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.8531     2.9095  -1.668   0.0953 .  
## log(size)     3.5580     0.6291   5.656 1.55e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for Negative Binomial(0.4985) family taken to be 1)
## 
##     Null deviance: 60.115  on 38  degrees of freedom
## Residual deviance: 49.562  on 37  degrees of freedom
## AIC: 967.99
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  0.4985 
##           Std. Err.:  0.0932 
## 
##  2 x log-likelihood:  -961.9930</code></pre>
<p>O.K. The simple model converged! We will likely go with that model. Let’s still consider whether the preferred model is biologically feasible. Since convergence errors often occur due to low sample size, it is usually safer to go with the simpler model! Let’s visualize both models.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="integral-population-models.html#cb235-1" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb235-2"><a href="integral-population-models.html#cb235-2" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">seq</span>(<span class="fu">min</span>(fec_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb235-3"><a href="integral-population-models.html#cb235-3" tabindex="-1"></a>             <span class="fu">max</span>(fec_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb235-4"><a href="integral-population-models.html#cb235-4" tabindex="-1"></a>             <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb235-5"><a href="integral-population-models.html#cb235-5" tabindex="-1"></a>)</span>
<span id="cb235-6"><a href="integral-population-models.html#cb235-6" tabindex="-1"></a></span>
<span id="cb235-7"><a href="integral-population-models.html#cb235-7" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> newdat <span class="sc">|&gt;</span></span>
<span id="cb235-8"><a href="integral-population-models.html#cb235-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb235-9"><a href="integral-population-models.html#cb235-9" tabindex="-1"></a>    <span class="st">`</span><span class="at">Linear (log size)</span><span class="st">`</span>    <span class="ot">=</span> <span class="fu">predict</span>(m_fec_log_lin,  newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb235-10"><a href="integral-population-models.html#cb235-10" tabindex="-1"></a>    <span class="st">`</span><span class="at">Quadratic (log size)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">predict</span>(m_fec_log_poly, newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb235-11"><a href="integral-population-models.html#cb235-11" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb235-12"><a href="integral-population-models.html#cb235-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb235-13"><a href="integral-population-models.html#cb235-13" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>size,</span>
<span id="cb235-14"><a href="integral-population-models.html#cb235-14" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb235-15"><a href="integral-population-models.html#cb235-15" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Prediction&quot;</span></span>
<span id="cb235-16"><a href="integral-population-models.html#cb235-16" tabindex="-1"></a>  )</span>
<span id="cb235-17"><a href="integral-population-models.html#cb235-17" tabindex="-1"></a></span>
<span id="cb235-18"><a href="integral-population-models.html#cb235-18" tabindex="-1"></a><span class="fu">ggplot</span>(fec_data, <span class="fu">aes</span>(size, fec2)) <span class="sc">+</span></span>
<span id="cb235-19"><a href="integral-population-models.html#cb235-19" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb235-20"><a href="integral-population-models.html#cb235-20" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb235-21"><a href="integral-population-models.html#cb235-21" tabindex="-1"></a>    <span class="at">data =</span> pred_df,</span>
<span id="cb235-22"><a href="integral-population-models.html#cb235-22" tabindex="-1"></a>    <span class="fu">aes</span>(size, Prediction, <span class="at">color =</span> Model),</span>
<span id="cb235-23"><a href="integral-population-models.html#cb235-23" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb235-24"><a href="integral-population-models.html#cb235-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb235-25"><a href="integral-population-models.html#cb235-25" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb235-26"><a href="integral-population-models.html#cb235-26" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb235-27"><a href="integral-population-models.html#cb235-27" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Seed production&quot;</span>,</span>
<span id="cb235-28"><a href="integral-population-models.html#cb235-28" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Model fit&quot;</span></span>
<span id="cb235-29"><a href="integral-population-models.html#cb235-29" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb235-30"><a href="integral-population-models.html#cb235-30" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-77-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="integral-population-models.html#cb236-1" tabindex="-1"></a><span class="co"># SEED PRODUCTION MODEL (Poisson GLM) ----</span></span>
<span id="cb236-2"><a href="integral-population-models.html#cb236-2" tabindex="-1"></a><span class="co"># Check for OVERDISPERSION </span></span>
<span id="cb236-3"><a href="integral-population-models.html#cb236-3" tabindex="-1"></a><span class="co"># check_overdispersion &lt;- function(model) {</span></span>
<span id="cb236-4"><a href="integral-population-models.html#cb236-4" tabindex="-1"></a><span class="co">#   resid_dev &lt;- sum(residuals(model, type = &quot;deviance&quot;)^2)</span></span>
<span id="cb236-5"><a href="integral-population-models.html#cb236-5" tabindex="-1"></a><span class="co">#   ratio &lt;- resid_dev / model$df.residual</span></span>
<span id="cb236-6"><a href="integral-population-models.html#cb236-6" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb236-7"><a href="integral-population-models.html#cb236-7" tabindex="-1"></a><span class="co">#   cat(&quot;\n=== Overdispersion Check (Poisson Model) ===\n&quot;)</span></span>
<span id="cb236-8"><a href="integral-population-models.html#cb236-8" tabindex="-1"></a><span class="co">#   cat(&quot;Residual deviance:&quot;, round(resid_dev, 2), &quot;\n&quot;)</span></span>
<span id="cb236-9"><a href="integral-population-models.html#cb236-9" tabindex="-1"></a><span class="co">#   cat(&quot;Degrees of freedom:&quot;, model$df.residual, &quot;\n&quot;)</span></span>
<span id="cb236-10"><a href="integral-population-models.html#cb236-10" tabindex="-1"></a><span class="co">#   cat(&quot;Dispersion ratio:&quot;, round(ratio, 3), &quot;\n&quot;)</span></span>
<span id="cb236-11"><a href="integral-population-models.html#cb236-11" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb236-12"><a href="integral-population-models.html#cb236-12" tabindex="-1"></a><span class="co">#   if(ratio &gt; 2) {</span></span>
<span id="cb236-13"><a href="integral-population-models.html#cb236-13" tabindex="-1"></a><span class="co">#     cat(&quot;⚠️  OVERDISPERSED - consider using negative binomial or quasipoisson\n&quot;)</span></span>
<span id="cb236-14"><a href="integral-population-models.html#cb236-14" tabindex="-1"></a><span class="co">#   } else if(ratio &lt; 0.5) {</span></span>
<span id="cb236-15"><a href="integral-population-models.html#cb236-15" tabindex="-1"></a><span class="co">#     cat(&quot;⚠️  UNDERDISPERSED - check for zero-inflation or model structure\n&quot;)</span></span>
<span id="cb236-16"><a href="integral-population-models.html#cb236-16" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb236-17"><a href="integral-population-models.html#cb236-17" tabindex="-1"></a><span class="co">#     cat(&quot;✓ Dispersion looks reasonable for Poisson\n&quot;)</span></span>
<span id="cb236-18"><a href="integral-population-models.html#cb236-18" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb236-19"><a href="integral-population-models.html#cb236-19" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb236-20"><a href="integral-population-models.html#cb236-20" tabindex="-1"></a><span class="co">#   return(ratio)</span></span>
<span id="cb236-21"><a href="integral-population-models.html#cb236-21" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb236-22"><a href="integral-population-models.html#cb236-22" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb236-23"><a href="integral-population-models.html#cb236-23" tabindex="-1"></a><span class="co"># dispersion_ratio &lt;- check_overdispersion(seed_mod)</span></span>
<span id="cb236-24"><a href="integral-population-models.html#cb236-24" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb236-25"><a href="integral-population-models.html#cb236-25" tabindex="-1"></a><span class="co"># # If overdispersed, consider refitting:</span></span>
<span id="cb236-26"><a href="integral-population-models.html#cb236-26" tabindex="-1"></a><span class="co"># if(dispersion_ratio &gt; 2) {</span></span>
<span id="cb236-27"><a href="integral-population-models.html#cb236-27" tabindex="-1"></a><span class="co">#   cat(&quot;\n📝 Consider refitting as:\n&quot;)</span></span>
<span id="cb236-28"><a href="integral-population-models.html#cb236-28" tabindex="-1"></a><span class="co">#   cat(&quot;   library(MASS)\n&quot;)</span></span>
<span id="cb236-29"><a href="integral-population-models.html#cb236-29" tabindex="-1"></a><span class="co">#   cat(&quot;   seed_mod_nb &lt;- glm.nb(fec2 ~ size_log + I(size_log^2), data = final_data)\n&quot;)</span></span>
<span id="cb236-30"><a href="integral-population-models.html#cb236-30" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
<p>O.K. we have a judgement call, we’ve seen ‘aging’ in other metrics, so this could be reasonable, but the apparent downturn looks like it is driven by a small number of large individuals, and with the lack of model convergence, any estimate of “aging effects” would be highly uncertain. This could go either way and we could compare the difference in outcomes!</p>
</div>
<div id="survival" class="section level4 hasAnchor" number="17.4.4.4">
<h4><span class="header-section-number">17.4.4.4</span> Survival<a href="integral-population-models.html#survival" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Survival is modeled as a binary response and is therefore fit using a binomial model.
We do not perform outlier removal for survival, as extreme values (alive vs. dead)
are intrinsic to the process.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="integral-population-models.html#cb237-1" tabindex="-1"></a>m_surv_lin <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb237-2"><a href="integral-population-models.html#cb237-2" tabindex="-1"></a>  surv <span class="sc">~</span> size,</span>
<span id="cb237-3"><a href="integral-population-models.html#cb237-3" tabindex="-1"></a>  <span class="at">data =</span> final_data,</span>
<span id="cb237-4"><a href="integral-population-models.html#cb237-4" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb237-5"><a href="integral-population-models.html#cb237-5" tabindex="-1"></a>)</span>
<span id="cb237-6"><a href="integral-population-models.html#cb237-6" tabindex="-1"></a></span>
<span id="cb237-7"><a href="integral-population-models.html#cb237-7" tabindex="-1"></a>m_surv_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb237-8"><a href="integral-population-models.html#cb237-8" tabindex="-1"></a>  surv <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb237-9"><a href="integral-population-models.html#cb237-9" tabindex="-1"></a>  <span class="at">data =</span> final_data,</span>
<span id="cb237-10"><a href="integral-population-models.html#cb237-10" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb237-11"><a href="integral-population-models.html#cb237-11" tabindex="-1"></a>)</span>
<span id="cb237-12"><a href="integral-population-models.html#cb237-12" tabindex="-1"></a></span>
<span id="cb237-13"><a href="integral-population-models.html#cb237-13" tabindex="-1"></a><span class="fu">AIC</span>(m_surv_lin, m_surv_log)</span></code></pre></div>
<pre><code>##            df      AIC
## m_surv_lin  2 93.24766
## m_surv_log  2 93.78090</code></pre>
<p>These are so close! Given the other relationships, I’m just going to go with the log scale. Notably, you can include both scales for different variables in an IPM.</p>
<p>In an Integral Projection Model (IPM), all vital rates are linked to the same underlying
<strong>state variable</strong> (e.g., size), but they do <strong>not</strong> need to share the same functional
form. This means that it is perfectly acceptable for one vital rate to be modeled with
a linear relationship, while another uses a polynomial or nonlinear form.</p>
<p>Each vital rate reflects a different biological process, and these processes often
scale with size in different ways. For example, growth may decelerate at large sizes,
while survival changes more gradually, and reproduction increases multiplicatively
with size. Allowing each vital rate to adopt the functional form that best reflects its
biology improves realism and model performance.</p>
<p>Importantly, all vital-rate models must be well supported by the data and behave
sensibly when extrapolated across the full range of sizes included in the IPM. More
complex models (e.g., polynomial fits) are retained only when they converge reliably
and do not introduce implausible behavior at the boundaries of the size distribution.</p>
<p>In practice, this means that a single IPM may include:</p>
<ul>
<li>a quadratic growth model,</li>
<li>a linear (log-scale) reproduction model, and</li>
<li>a linear survival model,</li>
</ul>
<p>all operating together within the same projection kernel. The consistency of the IPM
comes from the shared state variable, not from enforcing identical mathematical forms
across vital rates.</p>
<p>All that said, I tend to find that the same transformation works across all equations and I find it more parsimonous to include the same transformation, especially when data are sparse.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="integral-population-models.html#cb239-1" tabindex="-1"></a>m_surv_log_lin <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb239-2"><a href="integral-population-models.html#cb239-2" tabindex="-1"></a>  surv <span class="sc">~</span> <span class="fu">log</span>(size),</span>
<span id="cb239-3"><a href="integral-population-models.html#cb239-3" tabindex="-1"></a>  <span class="at">data =</span> final_data,</span>
<span id="cb239-4"><a href="integral-population-models.html#cb239-4" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb239-5"><a href="integral-population-models.html#cb239-5" tabindex="-1"></a>)</span>
<span id="cb239-6"><a href="integral-population-models.html#cb239-6" tabindex="-1"></a></span>
<span id="cb239-7"><a href="integral-population-models.html#cb239-7" tabindex="-1"></a>m_surv_log_poly <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb239-8"><a href="integral-population-models.html#cb239-8" tabindex="-1"></a>  surv <span class="sc">~</span> <span class="fu">poly</span>(<span class="fu">log</span>(size), <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),</span>
<span id="cb239-9"><a href="integral-population-models.html#cb239-9" tabindex="-1"></a>  <span class="at">data =</span> final_data,</span>
<span id="cb239-10"><a href="integral-population-models.html#cb239-10" tabindex="-1"></a>  <span class="at">family =</span> binomial</span>
<span id="cb239-11"><a href="integral-population-models.html#cb239-11" tabindex="-1"></a>)</span>
<span id="cb239-12"><a href="integral-population-models.html#cb239-12" tabindex="-1"></a></span>
<span id="cb239-13"><a href="integral-population-models.html#cb239-13" tabindex="-1"></a><span class="fu">AIC</span>(m_surv_log_lin, m_surv_log_poly)</span></code></pre></div>
<pre><code>##                 df      AIC
## m_surv_log_lin   2 93.78090
## m_surv_log_poly  3 94.31272</code></pre>
<p>Let’s visualize!</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="integral-population-models.html#cb241-1" tabindex="-1"></a>newdat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb241-2"><a href="integral-population-models.html#cb241-2" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">seq</span>(<span class="fu">min</span>(final_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb241-3"><a href="integral-population-models.html#cb241-3" tabindex="-1"></a>             <span class="fu">max</span>(final_data<span class="sc">$</span>size, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb241-4"><a href="integral-population-models.html#cb241-4" tabindex="-1"></a>             <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb241-5"><a href="integral-population-models.html#cb241-5" tabindex="-1"></a>)</span>
<span id="cb241-6"><a href="integral-population-models.html#cb241-6" tabindex="-1"></a></span>
<span id="cb241-7"><a href="integral-population-models.html#cb241-7" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> newdat <span class="sc">|&gt;</span></span>
<span id="cb241-8"><a href="integral-population-models.html#cb241-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb241-9"><a href="integral-population-models.html#cb241-9" tabindex="-1"></a>    <span class="st">`</span><span class="at">Linear (log size)</span><span class="st">`</span>    <span class="ot">=</span> <span class="fu">predict</span>(m_surv_log_lin,  newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb241-10"><a href="integral-population-models.html#cb241-10" tabindex="-1"></a>    <span class="st">`</span><span class="at">Quadratic (log size)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">predict</span>(m_surv_log_poly, newdat, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb241-11"><a href="integral-population-models.html#cb241-11" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb241-12"><a href="integral-population-models.html#cb241-12" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb241-13"><a href="integral-population-models.html#cb241-13" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>size,</span>
<span id="cb241-14"><a href="integral-population-models.html#cb241-14" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Model&quot;</span>,</span>
<span id="cb241-15"><a href="integral-population-models.html#cb241-15" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Prediction&quot;</span></span>
<span id="cb241-16"><a href="integral-population-models.html#cb241-16" tabindex="-1"></a>  )</span>
<span id="cb241-17"><a href="integral-population-models.html#cb241-17" tabindex="-1"></a></span>
<span id="cb241-18"><a href="integral-population-models.html#cb241-18" tabindex="-1"></a><span class="fu">ggplot</span>(final_data, <span class="fu">aes</span>(size, surv)) <span class="sc">+</span></span>
<span id="cb241-19"><a href="integral-population-models.html#cb241-19" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="fl">0.05</span>, <span class="at">width =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb241-20"><a href="integral-population-models.html#cb241-20" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb241-21"><a href="integral-population-models.html#cb241-21" tabindex="-1"></a>    <span class="at">data =</span> pred_df,</span>
<span id="cb241-22"><a href="integral-population-models.html#cb241-22" tabindex="-1"></a>    <span class="fu">aes</span>(size, Prediction, <span class="at">color =</span> Model),</span>
<span id="cb241-23"><a href="integral-population-models.html#cb241-23" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="dv">1</span></span>
<span id="cb241-24"><a href="integral-population-models.html#cb241-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb241-25"><a href="integral-population-models.html#cb241-25" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb241-26"><a href="integral-population-models.html#cb241-26" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Survival probability&quot;</span>,</span>
<span id="cb241-27"><a href="integral-population-models.html#cb241-27" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Model fit&quot;</span></span>
<span id="cb241-28"><a href="integral-population-models.html#cb241-28" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb241-29"><a href="integral-population-models.html#cb241-29" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-80-1.png" width="960" style="display: block; margin: auto;" />
Oh yeah. Confirmed. That polynomial looks bonkers!</p>
<p>One thing to note in terms of packages. The IPMpack package has fairly slick built in equations for these initial model comparisons. For this reason, I sometimes mix-and-match packages, using the IPM pack for initial visualization and other packages or hand-coding for the actual modeling! The approach is up to you, though sometimes coding just gives you more flexibility!</p>
<p>At this point, we have assembled all of the vital-rate models needed to build a
population projection model: (1) growth, (2) survival, (3) probability of reproduction,
and (4) reproductive output. Together, these components describe how individuals move
through the population from one time step to the next.</p>
<p>In principle, additional demographic processes could be modeled if sufficient data
were available. For example, reproduction could be decomposed into multiple steps,
such as (1) the probability of flowering, (2) the probability that a flower sets seed,
and (3) reproductive output conditional on successful flowering and seed set. Each of
these processes may respond differently to environmental conditions or individual
state.</p>
<p>In practice, however, demographic data are extremely time- and labor-intensive to
collect, and most studies are limited to the transitions described above. As a result,
population models typically combine multiple biological processes into a smaller set
of composite vital rates.</p>
<p>That said, additional model complexity can be justified when driven by specific
hypotheses. For example, if a study focuses on pollination limitation or herbivore
effects on flowering, explicitly modeling intermediate reproductive steps may be
necessary and informative. The key is to match model complexity to both the available
data and the biological questions being asked.</p>
</div>
</div>
</div>
<div id="constructing-a-transition-matrix" class="section level2 hasAnchor" number="17.5">
<h2><span class="header-section-number">17.5</span> Constructing a transition matrix<a href="integral-population-models.html#constructing-a-transition-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To build a population projection model, we must translate our fitted vital-rate
models into a structure that projects the population forward in time. In matrix
population models, this structure is a <strong>transition matrix</strong>, where each element
describes the contribution of individuals in one state to another state in the next
time step.</p>
<p>In stage-structured models, the transition matrix is constructed directly from
estimated transition probabilities among discrete stages. In contrast, IPMs begin
with continuous relationships between size and vital rates. To construct a transition
matrix from these continuous functions, we discretize the size distribution into a
finite number of size classes. This discretized matrix serves as a numerical
approximation of the continuous IPM kernel.</p>
<p>Thus, even though IPMs are conceptually continuous, they are implemented computationally
as large matrices that closely approximate continuous dynamics.</p>
<p>In an IPM, population dynamics are governed by a continuous projection equation:
<span class="math display">\[
n(z&#39;, t+1) = \int K(z&#39;, z)\, n(z, t)\, dz
\]</span></p>
<p>where:
- <span class="math inline">\(z\)</span> is individual size at time <span class="math inline">\(t\)</span>,
- <span class="math inline">\(z&#39;\)</span> is size at time <span class="math inline">\(t+1\)</span>,
- <span class="math inline">\(n(z,t)\)</span> is the size distribution at time <span class="math inline">\(t\)</span>,
- <span class="math inline">\(K(z&#39;,z)\)</span> is the <strong>kernel</strong> describing transitions from size <span class="math inline">\(z\)</span> to <span class="math inline">\(z&#39;\)</span>.</p>
<p>The kernel is typically decomposed into survival–growth (<span class="math inline">\(P\)</span>) and reproduction (<span class="math inline">\(F\)</span>)
components:</p>
<p><span class="math display">\[
K(z&#39;, z) = P(z&#39;, z) + F(z&#39;, z)
\]</span>
When implemented numerically, the continuous kernel is approximated by a large matrix
<span class="math inline">\(\mathbf{K}\)</span>, where each element represents transitions between discretized size
classes.</p>
</div>
<div id="building-an-ipm-boundary-points-mesh-points-and-step-size" class="section level2 hasAnchor" number="17.6">
<h2><span class="header-section-number">17.6</span> Building an IPM: Boundary points, mesh points, and step size<a href="integral-population-models.html#building-an-ipm-boundary-points-mesh-points-and-step-size" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Constructing an IPM requires defining the size domain over which the population is
modeled and how finely that domain is discretized. This involves three key choices:
boundary points, mesh points, and step size.</p>
<p><strong>Boundary points</strong> define the minimum and maximum sizes included in the model.
These limits should encompass all biologically plausible sizes observed in the data,
often with a small buffer to avoid edge effects.</p>
<p><strong>Mesh points</strong> are the discrete size values used to approximate the continuous size
distribution. The number of mesh points determines the resolution of the IPM: more
mesh points yield a closer approximation to the continuous kernel but increase
computational cost.</p>
<p><strong>Step size</strong> is the distance between adjacent mesh points and is determined by the
boundary range divided by the number of mesh points. The step size plays a critical
role in numerical accuracy, as it scales the contribution of individuals across size
classes.</p>
<p>Together, these choices determine how well the discretized matrix approximates the
underlying continuous population dynamics. In practice, mesh sizes of 50–200 points
often provide a good balance between accuracy and computational efficiency, though
convergence should always be checked.</p>
</div>
<div id="model-evaluation-eviction" class="section level2 hasAnchor" number="17.7">
<h2><span class="header-section-number">17.7</span> Model Evaluation: Eviction<a href="integral-population-models.html#model-evaluation-eviction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One challenge in Integral Projection Models (IPMs) arises when predicted growth pushes
individuals outside the defined size boundaries of the model. For example, a growth
model may predict that some individuals shrink below the minimum size or grow beyond
the maximum size. This issue is referred to as <strong>eviction</strong>.</p>
<p>If not handled properly, eviction can lead to loss or artificial accumulation of
individuals at the boundaries, distorting population dynamics and biasing estimates
of population growth rate (<span class="math inline">\(\lambda\)</span>).</p>
<div id="why-eviction-matters" class="section level3 hasAnchor" number="17.7.1">
<h3><span class="header-section-number">17.7.1</span> Why Eviction Matters<a href="integral-population-models.html#why-eviction-matters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider a large plant with size <span class="math inline">\(z = 150 \,\text{cm}^2\)</span> and a growth model that
predicts next year’s size as:</p>
<ul>
<li>mean: <span class="math inline">\(\mu(z) = 155 \,\text{cm}^2\)</span></li>
<li>standard deviation: <span class="math inline">\(\sigma = 10 \,\text{cm}^2\)</span></li>
</ul>
<p>If the maximum size boundary is <span class="math inline">\(U = 176 \,\text{cm}^2\)</span>, some probability mass from
this individual’s growth distribution extends beyond the modeled size range. Without
correction, this probability mass is effectively lost, implicitly assuming those
individuals die. This assumption is often biologically unrealistic.</p>
</div>
<div id="eviction-correction-strategies" class="section level3 hasAnchor" number="17.7.2">
<h3><span class="header-section-number">17.7.2</span> Eviction Correction Strategies<a href="integral-population-models.html#eviction-correction-strategies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Several strategies exist to address eviction, each corresponding to different
biological assumptions.</p>
<div id="truncation-renormalization" class="section level4 hasAnchor" number="17.7.2.1">
<h4><span class="header-section-number">17.7.2.1</span> 1. Truncation (Renormalization)<a href="integral-population-models.html#truncation-renormalization" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Method:</strong></p>
<p>Redistribute probability mass that would fall outside the boundaries back into the
valid size range by renormalizing the growth distribution.</p>
<p><strong>Mathematical implementation:</strong></p>
<p><span class="math display">\[
g_{\text{truncated}}(z&#39;, z) =
\frac{g_{\text{uncorrected}}(z&#39;, z)}
{\int_L^U g_{\text{uncorrected}}(z&#39;, z)\, dz&#39;}
\]</span>
where the denominator is:</p>
<p><span class="math display">\[
\int_L^U g_{\text{uncorrected}}(z&#39;, z)\, dz&#39;
=
\Phi\left(\frac{U - \mu(z)}{\sigma}\right)
-
\Phi\left(\frac{L - \mu(z)}{\sigma}\right)
\]</span>
and <span class="math inline">\(\Phi(\cdot)\)</span> is the cumulative distribution function of the normal distribution.</p>
<p>Note two different kinds of truncation:</p>
<p><strong>Simple truncation</strong> divides by (p_upper - p_lower) for EVERY transition:</p>
<ul>
<li>Pro: Conceptually simpler</li>
<li>Con: Applies unnecessary operations when eviction risk is ~0%</li>
<li>Con: Can introduce small numerical artifacts across the entire matrix</li>
</ul>
<p><strong>Conditional truncation</strong> only corrects when eviction is meaningful (&gt;1e-10 probability):</p>
<ul>
<li>Pro: More numerically stable</li>
<li>Pro: Matches industry-standard implementations (ipmr)</li>
<li>Pro: Computationally more accurate</li>
<li>Pro: Only modifies transitions that actually need correction</li>
</ul>
<p><strong>Biological interpretation:</strong></p>
<p>Individuals do not actually leave the population; instead, extreme sizes are “folded
back” into the observable range. This approach assumes that the boundaries reflect
measurement or detection limits rather than true biological limits.</p>
<p><strong>When appropriate:</strong></p>
<ul>
<li>Size represents natural constraints<br />
</li>
<li>Boundaries are conservative relative to the true biological range<br />
</li>
<li>Extreme sizes are rare in the data</li>
</ul>
<p>For plants demography, I typically use truncation!</p>
</div>
<div id="reflection" class="section level4 hasAnchor" number="17.7.2.2">
<h4><span class="header-section-number">17.7.2.2</span> 2. Reflection<a href="integral-population-models.html#reflection" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Method:</strong></p>
<p>Reflect probability mass back into the domain, creating symmetric probability density
at the boundaries.</p>
<p><strong>Mathematical implementation:</strong></p>
<p><span class="math display">\[
g_{\text{reflected}}(z&#39;, z) =
g(z&#39;, z) +
g(2L - z&#39;, z) +
g(2U - z&#39;, z)
\]</span></p>
<p><strong>Biological interpretation:</strong></p>
<p>Minimum and maximum sizes act as hard biological barriers, such as physical or
architectural constraints.</p>
<p><strong>When appropriate:</strong></p>
<ul>
<li>Clear biological maxima exist (e.g., determinate growth)<br />
</li>
<li>Minimum size represents a functional threshold</li>
</ul>
</div>
<div id="redistribution-to-boundary-classes" class="section level4 hasAnchor" number="17.7.2.3">
<h4><span class="header-section-number">17.7.2.3</span> 3. Redistribution to Boundary Classes<a href="integral-population-models.html#redistribution-to-boundary-classes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Method:</strong></p>
<p>Accumulate all evicted probability mass into the boundary size classes.</p>
<p><strong>Biological interpretation:</strong></p>
<p>Individuals reach a size asymptote and remain at that size indefinitely.</p>
<p><strong>When appropriate:</strong></p>
<ul>
<li>Species with determinate growth<br />
</li>
<li>Maximum size represents a stable life stage</li>
</ul>
</div>
<div id="no-correction-accept-loss" class="section level4 hasAnchor" number="17.7.2.4">
<h4><span class="header-section-number">17.7.2.4</span> 4. No Correction (Accept Loss)<a href="integral-population-models.html#no-correction-accept-loss" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>Method:</strong></p>
<p>Allow probability mass to escape the modeled domain, treating eviction as mortality.</p>
<p><strong>Biological interpretation:</strong></p>
<p>Individuals that grow beyond <span class="math inline">\(U\)</span> or shrink below <span class="math inline">\(L\)</span> are assumed to die.</p>
<p><strong>When appropriate:</strong></p>
<ul>
<li>Rarely appropriate in practice<br />
</li>
<li>May be acceptable if eviction is negligible (e.g., &lt;1% of total probability mass)</li>
</ul>
</div>
</div>
<div id="summary" class="section level3 hasAnchor" number="17.7.3">
<h3><span class="header-section-number">17.7.3</span> Summary<a href="integral-population-models.html#summary" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Evaluating and correcting for eviction is a critical step in IPM construction.
Excessive eviction often signals issues with boundary selection, growth model
specification, or extrapolation beyond the data. The chosen correction method should
align with both the biology of the species and the interpretation of the size variable.</p>
</div>
</div>
<div id="estimating-population-dynamics-parameters" class="section level2 hasAnchor" number="17.8">
<h2><span class="header-section-number">17.8</span> Estimating population dynamics parameters<a href="integral-population-models.html#estimating-population-dynamics-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once the transition matrix has been constructed, we can calculate key population
dynamics parameters. The most important of these is the long-term population growth
rate, <span class="math inline">\(\lambda\)</span>, which describes whether the population is expected to grow, decline,
or remain stable over time.</p>
<p>Additional quantities of interest include the stable size distribution, which
describes the relative frequency of individuals across sizes at equilibrium, and the
reproductive value, which measures the relative contribution of individuals of
different sizes to future population growth.</p>
<p>Beyond asymptotic behavior, IPMs also allow us to quantify short-term or <strong>transient
dynamics</strong>, such as population amplification, attenuation, and inertia. These metrics
describe how populations respond to disturbances before reaching long-term equilibrium
and are often particularly relevant for conservation and management.</p>
</div>
<div id="calculating-confidence-intervals" class="section level2 hasAnchor" number="17.9">
<h2><span class="header-section-number">17.9</span> Calculating confidence intervals<a href="integral-population-models.html#calculating-confidence-intervals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Demographic models are built from estimated vital-rate relationships, each of which
contains uncertainty. To understand how this uncertainty propagates into population
dynamics, we must quantify uncertainty around derived parameters such as <span class="math inline">\(\lambda\)</span>.</p>
<p>A common approach is to use resampling methods, such as bootstrapping, in which vital
rate models are repeatedly refit to resampled data. Each refitted model is used to
reconstruct the IPM and calculate population metrics, generating empirical
distributions for parameters of interest.</p>
<p>Confidence intervals derived from these distributions provide insight into the
robustness of model predictions and help distinguish meaningful biological patterns
from sampling variability. Incorporating uncertainty is particularly important when
IPMs are used to inform conservation decisions or compare population viability across
sites or treatments.</p>
</div>
<div id="putting-this-all-together-in-code-form" class="section level2 hasAnchor" number="17.10">
<h2><span class="header-section-number">17.10</span> Putting this all together in code form!<a href="integral-population-models.html#putting-this-all-together-in-code-form" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For simplicity, let’s go ahead and code this using the ipmr program! Note: From this point forward, the IPM is constructed using log(size) as the state variable. All kernels, mesh points, eviction correction, and demographic metrics are defined on the log scale unless explicitly stated otherwise. Raw units (cm) are used only for interpretation and visualization.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="integral-population-models.html#cb242-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb242-2"><a href="integral-population-models.html#cb242-2" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb242-3"><a href="integral-population-models.html#cb242-3" tabindex="-1"></a><span class="fu">library</span>(ipmr)</span>
<span id="cb242-4"><a href="integral-population-models.html#cb242-4" tabindex="-1"></a></span>
<span id="cb242-5"><a href="integral-population-models.html#cb242-5" tabindex="-1"></a>species_name <span class="ot">&lt;-</span> <span class="st">&quot;SILLAN&quot;</span></span>
<span id="cb242-6"><a href="integral-population-models.html#cb242-6" tabindex="-1"></a>trans_years  <span class="ot">&lt;-</span> <span class="st">&quot;20232024&quot;</span></span>
<span id="cb242-7"><a href="integral-population-models.html#cb242-7" tabindex="-1"></a></span>
<span id="cb242-8"><a href="integral-population-models.html#cb242-8" tabindex="-1"></a><span class="co">#==============================================</span></span>
<span id="cb242-9"><a href="integral-population-models.html#cb242-9" tabindex="-1"></a><span class="co"># Transform data</span></span>
<span id="cb242-10"><a href="integral-population-models.html#cb242-10" tabindex="-1"></a><span class="co">#==============================================</span></span>
<span id="cb242-11"><a href="integral-population-models.html#cb242-11" tabindex="-1"></a></span>
<span id="cb242-12"><a href="integral-population-models.html#cb242-12" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb242-13"><a href="integral-population-models.html#cb242-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-14"><a href="integral-population-models.html#cb242-14" tabindex="-1"></a>    <span class="at">size_raw     =</span> size,</span>
<span id="cb242-15"><a href="integral-population-models.html#cb242-15" tabindex="-1"></a>    <span class="at">sizeNext_raw =</span> sizeNext,</span>
<span id="cb242-16"><a href="integral-population-models.html#cb242-16" tabindex="-1"></a>    <span class="at">size_log     =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(size) <span class="sc">&amp;</span> size <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">log</span>(size), <span class="cn">NA_real_</span>),</span>
<span id="cb242-17"><a href="integral-population-models.html#cb242-17" tabindex="-1"></a>    <span class="at">sizeNext_log =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(sizeNext) <span class="sc">&amp;</span> sizeNext <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">log</span>(sizeNext), <span class="cn">NA_real_</span>)</span>
<span id="cb242-18"><a href="integral-population-models.html#cb242-18" tabindex="-1"></a>  )</span>
<span id="cb242-19"><a href="integral-population-models.html#cb242-19" tabindex="-1"></a></span>
<span id="cb242-20"><a href="integral-population-models.html#cb242-20" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb242-21"><a href="integral-population-models.html#cb242-21" tabindex="-1"></a><span class="co"># Final models (LOG-SCALE STATE VARIABLE)</span></span>
<span id="cb242-22"><a href="integral-population-models.html#cb242-22" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb242-23"><a href="integral-population-models.html#cb242-23" tabindex="-1"></a></span>
<span id="cb242-24"><a href="integral-population-models.html#cb242-24" tabindex="-1"></a>grow_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb242-25"><a href="integral-population-models.html#cb242-25" tabindex="-1"></a>  sizeNext_log <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb242-26"><a href="integral-population-models.html#cb242-26" tabindex="-1"></a>  <span class="at">data =</span> final_data</span>
<span id="cb242-27"><a href="integral-population-models.html#cb242-27" tabindex="-1"></a>)</span>
<span id="cb242-28"><a href="integral-population-models.html#cb242-28" tabindex="-1"></a></span>
<span id="cb242-29"><a href="integral-population-models.html#cb242-29" tabindex="-1"></a>grow_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">resid</span>(grow_mod), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb242-30"><a href="integral-population-models.html#cb242-30" tabindex="-1"></a></span>
<span id="cb242-31"><a href="integral-population-models.html#cb242-31" tabindex="-1"></a>surv_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb242-32"><a href="integral-population-models.html#cb242-32" tabindex="-1"></a>  surv <span class="sc">~</span> size_log,</span>
<span id="cb242-33"><a href="integral-population-models.html#cb242-33" tabindex="-1"></a>  <span class="at">data   =</span> final_data,</span>
<span id="cb242-34"><a href="integral-population-models.html#cb242-34" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb242-35"><a href="integral-population-models.html#cb242-35" tabindex="-1"></a>)</span>
<span id="cb242-36"><a href="integral-population-models.html#cb242-36" tabindex="-1"></a></span>
<span id="cb242-37"><a href="integral-population-models.html#cb242-37" tabindex="-1"></a>repr_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb242-38"><a href="integral-population-models.html#cb242-38" tabindex="-1"></a>  fec1 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb242-39"><a href="integral-population-models.html#cb242-39" tabindex="-1"></a>  <span class="at">data   =</span> final_data,</span>
<span id="cb242-40"><a href="integral-population-models.html#cb242-40" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>()</span>
<span id="cb242-41"><a href="integral-population-models.html#cb242-41" tabindex="-1"></a>)</span>
<span id="cb242-42"><a href="integral-population-models.html#cb242-42" tabindex="-1"></a></span>
<span id="cb242-43"><a href="integral-population-models.html#cb242-43" tabindex="-1"></a><span class="co"># Pick best form</span></span>
<span id="cb242-44"><a href="integral-population-models.html#cb242-44" tabindex="-1"></a></span>
<span id="cb242-45"><a href="integral-population-models.html#cb242-45" tabindex="-1"></a>seed_mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb242-46"><a href="integral-population-models.html#cb242-46" tabindex="-1"></a>  fec2 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb242-47"><a href="integral-population-models.html#cb242-47" tabindex="-1"></a>  <span class="at">data   =</span> final_data,</span>
<span id="cb242-48"><a href="integral-population-models.html#cb242-48" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb242-49"><a href="integral-population-models.html#cb242-49" tabindex="-1"></a></span>
<span id="cb242-50"><a href="integral-population-models.html#cb242-50" tabindex="-1"></a><span class="co"># seed_mod &lt;- glm.nb(</span></span>
<span id="cb242-51"><a href="integral-population-models.html#cb242-51" tabindex="-1"></a><span class="co">#   fec2 ~ size_log + I(size_log^2),</span></span>
<span id="cb242-52"><a href="integral-population-models.html#cb242-52" tabindex="-1"></a><span class="co">#   data = final_data</span></span>
<span id="cb242-53"><a href="integral-population-models.html#cb242-53" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb242-54"><a href="integral-population-models.html#cb242-54" tabindex="-1"></a></span>
<span id="cb242-55"><a href="integral-population-models.html#cb242-55" tabindex="-1"></a></span>
<span id="cb242-56"><a href="integral-population-models.html#cb242-56" tabindex="-1"></a><span class="co"># #===============================================</span></span>
<span id="cb242-57"><a href="integral-population-models.html#cb242-57" tabindex="-1"></a><span class="co"># # Model diagnostics</span></span>
<span id="cb242-58"><a href="integral-population-models.html#cb242-58" tabindex="-1"></a><span class="co"># #===============================================</span></span>
<span id="cb242-59"><a href="integral-population-models.html#cb242-59" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-60"><a href="integral-population-models.html#cb242-60" tabindex="-1"></a><span class="co"># cat(&quot;\n=== Sample Size for Vital Rates ===\n&quot;)</span></span>
<span id="cb242-61"><a href="integral-population-models.html#cb242-61" tabindex="-1"></a><span class="co"># n_for_models &lt;- sum(!is.na(final_data$size_log) &amp; !is.na(final_data$sizeNext_log))</span></span>
<span id="cb242-62"><a href="integral-population-models.html#cb242-62" tabindex="-1"></a><span class="co"># cat(&quot;Growth/survival sample size:&quot;, n_for_models, &quot;\n&quot;)</span></span>
<span id="cb242-63"><a href="integral-population-models.html#cb242-63" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-64"><a href="integral-population-models.html#cb242-64" tabindex="-1"></a><span class="co"># if(n_for_models &lt; 100) {</span></span>
<span id="cb242-65"><a href="integral-population-models.html#cb242-65" tabindex="-1"></a><span class="co">#   cat(&quot;⚠️  </span><span class="al">WARNING</span><span class="co">: Small sample (&lt;100) may yield unreliable estimates\n&quot;)</span></span>
<span id="cb242-66"><a href="integral-population-models.html#cb242-66" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb242-67"><a href="integral-population-models.html#cb242-67" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb242-68"><a href="integral-population-models.html#cb242-68" tabindex="-1"></a><span class="co"># # Check seed model overdispersion</span></span>
<span id="cb242-69"><a href="integral-population-models.html#cb242-69" tabindex="-1"></a><span class="co"># dispersion_ratio &lt;- sum(residuals(seed_mod, type = &quot;deviance&quot;)^2) / seed_mod$df.residual</span></span>
<span id="cb242-70"><a href="integral-population-models.html#cb242-70" tabindex="-1"></a><span class="co"># cat(&quot;\n=== Seed Model Overdispersion ===\n&quot;)</span></span>
<span id="cb242-71"><a href="integral-population-models.html#cb242-71" tabindex="-1"></a><span class="co"># cat(&quot;Dispersion ratio:&quot;, round(dispersion_ratio, 3), &quot;\n&quot;)</span></span>
<span id="cb242-72"><a href="integral-population-models.html#cb242-72" tabindex="-1"></a><span class="co"># if(dispersion_ratio &gt; 2) {</span></span>
<span id="cb242-73"><a href="integral-population-models.html#cb242-73" tabindex="-1"></a><span class="co">#   cat(&quot;⚠️  OVERDISPERSED (ratio &gt; 2) - consider negative binomial\n&quot;)</span></span>
<span id="cb242-74"><a href="integral-population-models.html#cb242-74" tabindex="-1"></a><span class="co"># } else {</span></span>
<span id="cb242-75"><a href="integral-population-models.html#cb242-75" tabindex="-1"></a><span class="co">#   cat(&quot;✓ Poisson assumption reasonable\n&quot;)</span></span>
<span id="cb242-76"><a href="integral-population-models.html#cb242-76" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb242-77"><a href="integral-population-models.html#cb242-77" tabindex="-1"></a></span>
<span id="cb242-78"><a href="integral-population-models.html#cb242-78" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb242-79"><a href="integral-population-models.html#cb242-79" tabindex="-1"></a><span class="co"># Recruitment information (LOG SCALE) - ROBUST</span></span>
<span id="cb242-80"><a href="integral-population-models.html#cb242-80" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb242-81"><a href="integral-population-models.html#cb242-81" tabindex="-1"></a></span>
<span id="cb242-82"><a href="integral-population-models.html#cb242-82" tabindex="-1"></a><span class="co"># Strict recruit definition</span></span>
<span id="cb242-83"><a href="integral-population-models.html#cb242-83" tabindex="-1"></a>robust_recruit_logical <span class="ot">&lt;-</span> <span class="fu">is.na</span>(final_data<span class="sc">$</span>size_log) <span class="sc">&amp;</span> </span>
<span id="cb242-84"><a href="integral-population-models.html#cb242-84" tabindex="-1"></a>  <span class="fu">is.na</span>(final_data<span class="sc">$</span>surv) <span class="sc">&amp;</span> </span>
<span id="cb242-85"><a href="integral-population-models.html#cb242-85" tabindex="-1"></a>  <span class="fu">is.na</span>(final_data<span class="sc">$</span>fec1) <span class="sc">&amp;</span> </span>
<span id="cb242-86"><a href="integral-population-models.html#cb242-86" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(final_data<span class="sc">$</span>sizeNext_log)</span>
<span id="cb242-87"><a href="integral-population-models.html#cb242-87" tabindex="-1"></a></span>
<span id="cb242-88"><a href="integral-population-models.html#cb242-88" tabindex="-1"></a>recr_data <span class="ot">&lt;-</span> final_data[robust_recruit_logical, ]</span>
<span id="cb242-89"><a href="integral-population-models.html#cb242-89" tabindex="-1"></a></span>
<span id="cb242-90"><a href="integral-population-models.html#cb242-90" tabindex="-1"></a>recr_mu <span class="ot">&lt;-</span> <span class="fu">mean</span>(recr_data<span class="sc">$</span>sizeNext_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb242-91"><a href="integral-population-models.html#cb242-91" tabindex="-1"></a>recr_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(recr_data<span class="sc">$</span>sizeNext_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb242-92"><a href="integral-population-models.html#cb242-92" tabindex="-1"></a>recr_n  <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.finite</span>(recr_data<span class="sc">$</span>sizeNext_log))</span>
<span id="cb242-93"><a href="integral-population-models.html#cb242-93" tabindex="-1"></a>seed_n  <span class="ot">&lt;-</span> <span class="fu">sum</span>(final_data<span class="sc">$</span>fec2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb242-94"><a href="integral-population-models.html#cb242-94" tabindex="-1"></a></span>
<span id="cb242-95"><a href="integral-population-models.html#cb242-95" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(seed_n) <span class="sc">||</span> seed_n <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">&quot;seed_n is 0 or non-finite; cannot build fecundity kernel&quot;</span>)</span>
<span id="cb242-96"><a href="integral-population-models.html#cb242-96" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(recr_n) <span class="sc">||</span> recr_n <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">&quot;recr_n is 0 or non-finite; cannot build recruitment kernel&quot;</span>)</span>
<span id="cb242-97"><a href="integral-population-models.html#cb242-97" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(recr_mu) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(recr_sd) <span class="sc">||</span> recr_sd <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">&quot;Recruit size distribution invalid (mu/sd)&quot;</span>)</span>
<span id="cb242-98"><a href="integral-population-models.html#cb242-98" tabindex="-1"></a></span>
<span id="cb242-99"><a href="integral-population-models.html#cb242-99" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Recruitment Validation ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Recruitment Validation ===</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="integral-population-models.html#cb244-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Recruits:&quot;</span>, recr_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Recruits: 293</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="integral-population-models.html#cb246-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Total seeds produced:&quot;</span>, seed_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Total seeds produced: 5317830</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="integral-population-models.html#cb248-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Establishment probability:&quot;</span>, <span class="fu">round</span>(recr_n <span class="sc">/</span> seed_n, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Establishment probability: 1e-04</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="integral-population-models.html#cb250-1" tabindex="-1"></a><span class="co"># Define minimum size to flower (LOG SCALE)</span></span>
<span id="cb250-2"><a href="integral-population-models.html#cb250-2" tabindex="-1"></a>min_repro_size_log <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">min</span>(final_data<span class="sc">$</span>size_log[final_data<span class="sc">$</span>fec1 <span class="sc">==</span> <span class="dv">1</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb250-3"><a href="integral-population-models.html#cb250-3" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(min_repro_size_log)) {</span>
<span id="cb250-4"><a href="integral-population-models.html#cb250-4" tabindex="-1"></a>  min_repro_size_log <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb250-5"><a href="integral-population-models.html#cb250-5" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;⚠️ No reproductive individuals (fec1==1). Setting min_repro_size_log = Inf (F kernel will be ~0).&quot;</span>)</span>
<span id="cb250-6"><a href="integral-population-models.html#cb250-6" tabindex="-1"></a>}</span>
<span id="cb250-7"><a href="integral-population-models.html#cb250-7" tabindex="-1"></a></span>
<span id="cb250-8"><a href="integral-population-models.html#cb250-8" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb250-9"><a href="integral-population-models.html#cb250-9" tabindex="-1"></a><span class="co"># State variable domain (LOG SCALE) - DATA-DRIVEN</span></span>
<span id="cb250-10"><a href="integral-population-models.html#cb250-10" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb250-11"><a href="integral-population-models.html#cb250-11" tabindex="-1"></a>all_sizes_log <span class="ot">&lt;-</span> <span class="fu">c</span>(final_data<span class="sc">$</span>size_log, final_data<span class="sc">$</span>sizeNext_log)</span>
<span id="cb250-12"><a href="integral-population-models.html#cb250-12" tabindex="-1"></a>size_quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_sizes_log, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb250-13"><a href="integral-population-models.html#cb250-13" tabindex="-1"></a></span>
<span id="cb250-14"><a href="integral-population-models.html#cb250-14" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(size_quantiles[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb250-15"><a href="integral-population-models.html#cb250-15" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(size_quantiles[<span class="dv">2</span>]) <span class="sc">*</span> <span class="fl">1.1</span></span>
<span id="cb250-16"><a href="integral-population-models.html#cb250-16" tabindex="-1"></a></span>
<span id="cb250-17"><a href="integral-population-models.html#cb250-17" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(L) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(U) <span class="sc">||</span> L <span class="sc">&gt;=</span> U) <span class="fu">stop</span>(<span class="st">&quot;Invalid domain bounds: check sizes and quantiles&quot;</span>)</span>
<span id="cb250-18"><a href="integral-population-models.html#cb250-18" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb250-19"><a href="integral-population-models.html#cb250-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Recruitment Validation ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Recruitment Validation ===</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="integral-population-models.html#cb252-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Recruits (strict definition):&quot;</span>, recr_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Recruits (strict definition): 293</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="integral-population-models.html#cb254-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Total seeds produced:&quot;</span>, seed_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Total seeds produced: 5317830</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="integral-population-models.html#cb256-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Establishment probability:&quot;</span>, <span class="fu">round</span>(recr_n <span class="sc">/</span> seed_n, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Establishment probability: 1e-04</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="integral-population-models.html#cb258-1" tabindex="-1"></a>n_adults <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(final_data<span class="sc">$</span>size_log))</span>
<span id="cb258-2"><a href="integral-population-models.html#cb258-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Demographic structure:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Demographic structure:</code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="integral-population-models.html#cb260-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Adults at time t:&quot;</span>, n_adults, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Adults at time t: 82</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="integral-population-models.html#cb262-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Recruits at time t+1:&quot;</span>, recr_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Recruits at time t+1: 293</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="integral-population-models.html#cb264-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Recruit:Adult ratio:&quot;</span>, <span class="fu">round</span>(recr_n <span class="sc">/</span> n_adults, <span class="dv">2</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Recruit:Adult ratio: 3.57</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="integral-population-models.html#cb266-1" tabindex="-1"></a><span class="cf">if</span>(recr_n <span class="sc">&gt;</span> n_adults <span class="sc">*</span> <span class="dv">2</span>) {</span>
<span id="cb266-2"><a href="integral-population-models.html#cb266-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;⚠️  High recruitment! Lambda will be recruitment-driven</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb266-3"><a href="integral-population-models.html#cb266-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## ⚠️  High recruitment! Lambda will be recruitment-driven</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="integral-population-models.html#cb268-1" tabindex="-1"></a><span class="co"># Visualize recruit distribution</span></span>
<span id="cb268-2"><a href="integral-population-models.html#cb268-2" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(</span>
<span id="cb268-3"><a href="integral-population-models.html#cb268-3" tabindex="-1"></a>  <span class="fu">min</span>(recr_data<span class="sc">$</span>sizeNext_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-4"><a href="integral-population-models.html#cb268-4" tabindex="-1"></a>  <span class="fu">max</span>(recr_data<span class="sc">$</span>sizeNext_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb268-5"><a href="integral-population-models.html#cb268-5" tabindex="-1"></a>  <span class="at">length.out =</span> <span class="dv">200</span></span>
<span id="cb268-6"><a href="integral-population-models.html#cb268-6" tabindex="-1"></a>)</span>
<span id="cb268-7"><a href="integral-population-models.html#cb268-7" tabindex="-1"></a></span>
<span id="cb268-8"><a href="integral-population-models.html#cb268-8" tabindex="-1"></a>recr_fit <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb268-9"><a href="integral-population-models.html#cb268-9" tabindex="-1"></a>  <span class="at">x =</span> x_seq,</span>
<span id="cb268-10"><a href="integral-population-models.html#cb268-10" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">dnorm</span>(x_seq, <span class="at">mean =</span> recr_mu, <span class="at">sd =</span> recr_sd)</span>
<span id="cb268-11"><a href="integral-population-models.html#cb268-11" tabindex="-1"></a>)</span>
<span id="cb268-12"><a href="integral-population-models.html#cb268-12" tabindex="-1"></a></span>
<span id="cb268-13"><a href="integral-population-models.html#cb268-13" tabindex="-1"></a>shapiro_result <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(recr_data<span class="sc">$</span>sizeNext_log)</span>
<span id="cb268-14"><a href="integral-population-models.html#cb268-14" tabindex="-1"></a></span>
<span id="cb268-15"><a href="integral-population-models.html#cb268-15" tabindex="-1"></a>recruit_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(recr_data, <span class="fu">aes</span>(<span class="at">x =</span> sizeNext_log)) <span class="sc">+</span></span>
<span id="cb268-16"><a href="integral-population-models.html#cb268-16" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(density)),</span>
<span id="cb268-17"><a href="integral-population-models.html#cb268-17" tabindex="-1"></a>                 <span class="at">bins =</span> <span class="dv">30</span>,</span>
<span id="cb268-18"><a href="integral-population-models.html#cb268-18" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>,</span>
<span id="cb268-19"><a href="integral-population-models.html#cb268-19" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb268-20"><a href="integral-population-models.html#cb268-20" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb268-21"><a href="integral-population-models.html#cb268-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> recr_fit,</span>
<span id="cb268-22"><a href="integral-population-models.html#cb268-22" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb268-23"><a href="integral-population-models.html#cb268-23" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb268-24"><a href="integral-population-models.html#cb268-24" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb268-25"><a href="integral-population-models.html#cb268-25" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb268-26"><a href="integral-population-models.html#cb268-26" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Recruit size at time t+1 (log scale)&quot;</span>,</span>
<span id="cb268-27"><a href="integral-population-models.html#cb268-27" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb268-28"><a href="integral-population-models.html#cb268-28" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Recruit size distribution and IPM recruitment kernel&quot;</span>,</span>
<span id="cb268-29"><a href="integral-population-models.html#cb268-29" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Blue line = normal distribution used in F kernel</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb268-30"><a href="integral-population-models.html#cb268-30" tabindex="-1"></a>                      <span class="st">&quot;Shapiro-Wilk p = &quot;</span>, <span class="fu">round</span>(shapiro_result<span class="sc">$</span>p.value, <span class="dv">3</span>))</span>
<span id="cb268-31"><a href="integral-population-models.html#cb268-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb268-32"><a href="integral-population-models.html#cb268-32" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">15</span>)</span>
<span id="cb268-33"><a href="integral-population-models.html#cb268-33" tabindex="-1"></a></span>
<span id="cb268-34"><a href="integral-population-models.html#cb268-34" tabindex="-1"></a><span class="fu">print</span>(recruit_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-81-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="integral-population-models.html#cb269-1" tabindex="-1"></a><span class="co"># Define minimum size to flower (LOG SCALE)</span></span>
<span id="cb269-2"><a href="integral-population-models.html#cb269-2" tabindex="-1"></a>min_repro_size_log <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb269-3"><a href="integral-population-models.html#cb269-3" tabindex="-1"></a>  final_data<span class="sc">$</span>size_log[final_data<span class="sc">$</span>fec1 <span class="sc">==</span> <span class="dv">1</span>],</span>
<span id="cb269-4"><a href="integral-population-models.html#cb269-4" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb269-5"><a href="integral-population-models.html#cb269-5" tabindex="-1"></a>)</span>
<span id="cb269-6"><a href="integral-population-models.html#cb269-6" tabindex="-1"></a></span>
<span id="cb269-7"><a href="integral-population-models.html#cb269-7" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Minimum reproductive size (log):&quot;</span>, <span class="fu">round</span>(min_repro_size_log, <span class="dv">3</span>), </span>
<span id="cb269-8"><a href="integral-population-models.html#cb269-8" tabindex="-1"></a>    <span class="st">&quot; → raw:&quot;</span>, <span class="fu">round</span>(<span class="fu">exp</span>(min_repro_size_log), <span class="dv">2</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Minimum reproductive size (log): 3.544  → raw: 34.6 cm</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="integral-population-models.html#cb271-1" tabindex="-1"></a><span class="co"># Build params list</span></span>
<span id="cb271-2"><a href="integral-population-models.html#cb271-2" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb271-3"><a href="integral-population-models.html#cb271-3" tabindex="-1"></a>  <span class="at">recr_mu            =</span> recr_mu,</span>
<span id="cb271-4"><a href="integral-population-models.html#cb271-4" tabindex="-1"></a>  <span class="at">recr_sd            =</span> recr_sd,</span>
<span id="cb271-5"><a href="integral-population-models.html#cb271-5" tabindex="-1"></a>  <span class="at">grow_sd            =</span> grow_sd,</span>
<span id="cb271-6"><a href="integral-population-models.html#cb271-6" tabindex="-1"></a>  <span class="at">surv_mod           =</span> surv_mod,</span>
<span id="cb271-7"><a href="integral-population-models.html#cb271-7" tabindex="-1"></a>  <span class="at">grow_mod           =</span> grow_mod,</span>
<span id="cb271-8"><a href="integral-population-models.html#cb271-8" tabindex="-1"></a>  <span class="at">repr_mod           =</span> repr_mod,</span>
<span id="cb271-9"><a href="integral-population-models.html#cb271-9" tabindex="-1"></a>  <span class="at">seed_mod           =</span> seed_mod,</span>
<span id="cb271-10"><a href="integral-population-models.html#cb271-10" tabindex="-1"></a>  <span class="at">recr_n             =</span> recr_n,</span>
<span id="cb271-11"><a href="integral-population-models.html#cb271-11" tabindex="-1"></a>  <span class="at">seed_n             =</span> seed_n,</span>
<span id="cb271-12"><a href="integral-population-models.html#cb271-12" tabindex="-1"></a>  <span class="at">min_repro_size_log =</span> min_repro_size_log   </span>
<span id="cb271-13"><a href="integral-population-models.html#cb271-13" tabindex="-1"></a>)</span>
<span id="cb271-14"><a href="integral-population-models.html#cb271-14" tabindex="-1"></a></span>
<span id="cb271-15"><a href="integral-population-models.html#cb271-15" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb271-16"><a href="integral-population-models.html#cb271-16" tabindex="-1"></a><span class="co"># State variable domain (LOG SCALE) - DATA-DRIVEN</span></span>
<span id="cb271-17"><a href="integral-population-models.html#cb271-17" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb271-18"><a href="integral-population-models.html#cb271-18" tabindex="-1"></a></span>
<span id="cb271-19"><a href="integral-population-models.html#cb271-19" tabindex="-1"></a>percentile_lower <span class="ot">&lt;-</span> <span class="fl">0.01</span>  </span>
<span id="cb271-20"><a href="integral-population-models.html#cb271-20" tabindex="-1"></a>percentile_upper <span class="ot">&lt;-</span> <span class="fl">0.99</span>  </span>
<span id="cb271-21"><a href="integral-population-models.html#cb271-21" tabindex="-1"></a></span>
<span id="cb271-22"><a href="integral-population-models.html#cb271-22" tabindex="-1"></a>all_sizes_log <span class="ot">&lt;-</span> <span class="fu">c</span>(final_data<span class="sc">$</span>size_log, final_data<span class="sc">$</span>sizeNext_log)</span>
<span id="cb271-23"><a href="integral-population-models.html#cb271-23" tabindex="-1"></a>size_quantiles <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_sizes_log, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.99</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb271-24"><a href="integral-population-models.html#cb271-24" tabindex="-1"></a></span>
<span id="cb271-25"><a href="integral-population-models.html#cb271-25" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(size_quantiles[<span class="dv">1</span>]) <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb271-26"><a href="integral-population-models.html#cb271-26" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(size_quantiles[<span class="dv">2</span>]) <span class="sc">*</span> <span class="fl">1.1</span></span>
<span id="cb271-27"><a href="integral-population-models.html#cb271-27" tabindex="-1"></a></span>
<span id="cb271-28"><a href="integral-population-models.html#cb271-28" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(L) <span class="sc">||</span> <span class="sc">!</span><span class="fu">is.finite</span>(U) <span class="sc">||</span> L <span class="sc">&gt;=</span> U) <span class="fu">stop</span>(<span class="st">&quot;Invalid domain bounds: check sizes and quantiles&quot;</span>)</span>
<span id="cb271-29"><a href="integral-population-models.html#cb271-29" tabindex="-1"></a></span>
<span id="cb271-30"><a href="integral-population-models.html#cb271-30" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Domain Boundaries (DATA-DRIVEN) ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Domain Boundaries (DATA-DRIVEN) ===</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="integral-population-models.html#cb273-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Method: Exclude bottom/top&quot;</span>, percentile_lower <span class="sc">*</span> <span class="dv">100</span>, <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Method: Exclude bottom/top 1 %</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="integral-population-models.html#cb275-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Log scale: [&quot;</span>, <span class="fu">round</span>(L, <span class="dv">3</span>), <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(U, <span class="dv">3</span>), <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Log scale: [ 0 , 5.452 ]</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="integral-population-models.html#cb277-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Raw scale: [&quot;</span>, <span class="fu">round</span>(<span class="fu">exp</span>(L), <span class="dv">3</span>), <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(<span class="fu">exp</span>(U), <span class="dv">3</span>), <span class="st">&quot;] cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Raw scale: [ 1 , 233.144 ] cm</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="integral-population-models.html#cb279-1" tabindex="-1"></a>excluded_n <span class="ot">&lt;-</span> <span class="fu">sum</span>(all_sizes_log <span class="sc">&lt;</span> size_quantiles[<span class="dv">1</span>] <span class="sc">|</span> </span>
<span id="cb279-2"><a href="integral-population-models.html#cb279-2" tabindex="-1"></a>                    all_sizes_log <span class="sc">&gt;</span> size_quantiles[<span class="dv">2</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb279-3"><a href="integral-population-models.html#cb279-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Excluded outliers:&quot;</span>, excluded_n, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Excluded outliers: 7</code></pre>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="integral-population-models.html#cb281-1" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb281-2"><a href="integral-population-models.html#cb281-2" tabindex="-1"></a><span class="co"># BUILD IPM WITH ipmr</span></span>
<span id="cb281-3"><a href="integral-population-models.html#cb281-3" tabindex="-1"></a><span class="co"># ==============================================================================</span></span>
<span id="cb281-4"><a href="integral-population-models.html#cb281-4" tabindex="-1"></a></span>
<span id="cb281-5"><a href="integral-population-models.html#cb281-5" tabindex="-1"></a>obs_ipm <span class="ot">&lt;-</span> <span class="fu">init_ipm</span>(</span>
<span id="cb281-6"><a href="integral-population-models.html#cb281-6" tabindex="-1"></a>  <span class="at">sim_gen   =</span> <span class="st">&quot;simple&quot;</span>,</span>
<span id="cb281-7"><a href="integral-population-models.html#cb281-7" tabindex="-1"></a>  <span class="at">di_dd     =</span> <span class="st">&quot;di&quot;</span>,</span>
<span id="cb281-8"><a href="integral-population-models.html#cb281-8" tabindex="-1"></a>  <span class="at">det_stoch =</span> <span class="st">&quot;det&quot;</span></span>
<span id="cb281-9"><a href="integral-population-models.html#cb281-9" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb281-10"><a href="integral-population-models.html#cb281-10" tabindex="-1"></a>  </span>
<span id="cb281-11"><a href="integral-population-models.html#cb281-11" tabindex="-1"></a>  <span class="co">#-------------------------</span></span>
<span id="cb281-12"><a href="integral-population-models.html#cb281-12" tabindex="-1"></a><span class="co"># P kernel (survival + growth)</span></span>
<span id="cb281-13"><a href="integral-population-models.html#cb281-13" tabindex="-1"></a><span class="co">#-------------------------</span></span>
<span id="cb281-14"><a href="integral-population-models.html#cb281-14" tabindex="-1"></a><span class="fu">define_kernel</span>(</span>
<span id="cb281-15"><a href="integral-population-models.html#cb281-15" tabindex="-1"></a>  <span class="at">name    =</span> <span class="st">&quot;P&quot;</span>,</span>
<span id="cb281-16"><a href="integral-population-models.html#cb281-16" tabindex="-1"></a>  <span class="at">family  =</span> <span class="st">&quot;CC&quot;</span>,</span>
<span id="cb281-17"><a href="integral-population-models.html#cb281-17" tabindex="-1"></a>  <span class="at">formula =</span> s <span class="sc">*</span> g,</span>
<span id="cb281-18"><a href="integral-population-models.html#cb281-18" tabindex="-1"></a>  </span>
<span id="cb281-19"><a href="integral-population-models.html#cb281-19" tabindex="-1"></a>  <span class="co"># Survival</span></span>
<span id="cb281-20"><a href="integral-population-models.html#cb281-20" tabindex="-1"></a>  <span class="at">s =</span> <span class="fu">predict</span>(</span>
<span id="cb281-21"><a href="integral-population-models.html#cb281-21" tabindex="-1"></a>    surv_mod,</span>
<span id="cb281-22"><a href="integral-population-models.html#cb281-22" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> sa_1),</span>
<span id="cb281-23"><a href="integral-population-models.html#cb281-23" tabindex="-1"></a>    <span class="at">type    =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb281-24"><a href="integral-population-models.html#cb281-24" tabindex="-1"></a>  ),</span>
<span id="cb281-25"><a href="integral-population-models.html#cb281-25" tabindex="-1"></a>  </span>
<span id="cb281-26"><a href="integral-population-models.html#cb281-26" tabindex="-1"></a>  <span class="co"># Growth mean (log size at t+1)</span></span>
<span id="cb281-27"><a href="integral-population-models.html#cb281-27" tabindex="-1"></a>  <span class="at">g_mu =</span> <span class="fu">predict</span>(</span>
<span id="cb281-28"><a href="integral-population-models.html#cb281-28" tabindex="-1"></a>    grow_mod,</span>
<span id="cb281-29"><a href="integral-population-models.html#cb281-29" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> sa_1),</span>
<span id="cb281-30"><a href="integral-population-models.html#cb281-30" tabindex="-1"></a>    <span class="at">type    =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb281-31"><a href="integral-population-models.html#cb281-31" tabindex="-1"></a>  ),</span>
<span id="cb281-32"><a href="integral-population-models.html#cb281-32" tabindex="-1"></a>  </span>
<span id="cb281-33"><a href="integral-population-models.html#cb281-33" tabindex="-1"></a>  <span class="co"># Growth distribution</span></span>
<span id="cb281-34"><a href="integral-population-models.html#cb281-34" tabindex="-1"></a>  <span class="at">g =</span> <span class="fu">dnorm</span>(sa_2, g_mu, grow_sd),</span>
<span id="cb281-35"><a href="integral-population-models.html#cb281-35" tabindex="-1"></a>  </span>
<span id="cb281-36"><a href="integral-population-models.html#cb281-36" tabindex="-1"></a>  <span class="at">states        =</span> <span class="fu">list</span>(<span class="st">&quot;sa&quot;</span>),</span>
<span id="cb281-37"><a href="integral-population-models.html#cb281-37" tabindex="-1"></a>  <span class="at">data_list     =</span> params,</span>
<span id="cb281-38"><a href="integral-population-models.html#cb281-38" tabindex="-1"></a>  <span class="at">uses_par_sets =</span> <span class="cn">FALSE</span>,</span>
<span id="cb281-39"><a href="integral-population-models.html#cb281-39" tabindex="-1"></a>  </span>
<span id="cb281-40"><a href="integral-population-models.html#cb281-40" tabindex="-1"></a>  <span class="at">evict_cor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-41"><a href="integral-population-models.html#cb281-41" tabindex="-1"></a>  <span class="at">evict_fun =</span> <span class="fu">truncated_distributions</span>(</span>
<span id="cb281-42"><a href="integral-population-models.html#cb281-42" tabindex="-1"></a>    <span class="at">fun    =</span> <span class="st">&quot;norm&quot;</span>,</span>
<span id="cb281-43"><a href="integral-population-models.html#cb281-43" tabindex="-1"></a>    <span class="at">target =</span> <span class="st">&quot;g&quot;</span></span>
<span id="cb281-44"><a href="integral-population-models.html#cb281-44" tabindex="-1"></a>  )</span>
<span id="cb281-45"><a href="integral-population-models.html#cb281-45" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb281-46"><a href="integral-population-models.html#cb281-46" tabindex="-1"></a>  </span>
<span id="cb281-47"><a href="integral-population-models.html#cb281-47" tabindex="-1"></a>  <span class="co">#-------------------------</span></span>
<span id="cb281-48"><a href="integral-population-models.html#cb281-48" tabindex="-1"></a><span class="co"># F kernel (fecundity)</span></span>
<span id="cb281-49"><a href="integral-population-models.html#cb281-49" tabindex="-1"></a><span class="co">#-------------------------</span></span>
<span id="cb281-50"><a href="integral-population-models.html#cb281-50" tabindex="-1"></a><span class="fu">define_kernel</span>(</span>
<span id="cb281-51"><a href="integral-population-models.html#cb281-51" tabindex="-1"></a>  <span class="at">name    =</span> <span class="st">&quot;F&quot;</span>,</span>
<span id="cb281-52"><a href="integral-population-models.html#cb281-52" tabindex="-1"></a>  <span class="at">family  =</span> <span class="st">&quot;CC&quot;</span>,</span>
<span id="cb281-53"><a href="integral-population-models.html#cb281-53" tabindex="-1"></a>  <span class="at">formula =</span> r_p <span class="sc">*</span> r_s <span class="sc">*</span> r_d <span class="sc">*</span> r_r,</span>
<span id="cb281-54"><a href="integral-population-models.html#cb281-54" tabindex="-1"></a>  </span>
<span id="cb281-55"><a href="integral-population-models.html#cb281-55" tabindex="-1"></a>  <span class="at">r_p =</span> <span class="fu">ifelse</span>(</span>
<span id="cb281-56"><a href="integral-population-models.html#cb281-56" tabindex="-1"></a>    sa_1 <span class="sc">&lt;</span> min_repro_size_log,</span>
<span id="cb281-57"><a href="integral-population-models.html#cb281-57" tabindex="-1"></a>    <span class="dv">0</span>,</span>
<span id="cb281-58"><a href="integral-population-models.html#cb281-58" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb281-59"><a href="integral-population-models.html#cb281-59" tabindex="-1"></a>      repr_mod,</span>
<span id="cb281-60"><a href="integral-population-models.html#cb281-60" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> sa_1),</span>
<span id="cb281-61"><a href="integral-population-models.html#cb281-61" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb281-62"><a href="integral-population-models.html#cb281-62" tabindex="-1"></a>    )</span>
<span id="cb281-63"><a href="integral-population-models.html#cb281-63" tabindex="-1"></a>  ),</span>
<span id="cb281-64"><a href="integral-population-models.html#cb281-64" tabindex="-1"></a>  </span>
<span id="cb281-65"><a href="integral-population-models.html#cb281-65" tabindex="-1"></a>  <span class="at">r_s =</span> <span class="fu">predict</span>(</span>
<span id="cb281-66"><a href="integral-population-models.html#cb281-66" tabindex="-1"></a>    seed_mod,</span>
<span id="cb281-67"><a href="integral-population-models.html#cb281-67" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> sa_1),</span>
<span id="cb281-68"><a href="integral-population-models.html#cb281-68" tabindex="-1"></a>    <span class="at">type    =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb281-69"><a href="integral-population-models.html#cb281-69" tabindex="-1"></a>  ),</span>
<span id="cb281-70"><a href="integral-population-models.html#cb281-70" tabindex="-1"></a>  </span>
<span id="cb281-71"><a href="integral-population-models.html#cb281-71" tabindex="-1"></a>  <span class="at">r_r =</span> recr_n <span class="sc">/</span> seed_n,</span>
<span id="cb281-72"><a href="integral-population-models.html#cb281-72" tabindex="-1"></a>  </span>
<span id="cb281-73"><a href="integral-population-models.html#cb281-73" tabindex="-1"></a>  <span class="at">r_d =</span> <span class="fu">dnorm</span>(sa_2, recr_mu, recr_sd),</span>
<span id="cb281-74"><a href="integral-population-models.html#cb281-74" tabindex="-1"></a>  </span>
<span id="cb281-75"><a href="integral-population-models.html#cb281-75" tabindex="-1"></a>  <span class="at">states        =</span> <span class="fu">list</span>(<span class="st">&quot;sa&quot;</span>),</span>
<span id="cb281-76"><a href="integral-population-models.html#cb281-76" tabindex="-1"></a>  <span class="at">data_list     =</span> params,</span>
<span id="cb281-77"><a href="integral-population-models.html#cb281-77" tabindex="-1"></a>  <span class="at">uses_par_sets =</span> <span class="cn">FALSE</span>,</span>
<span id="cb281-78"><a href="integral-population-models.html#cb281-78" tabindex="-1"></a>  </span>
<span id="cb281-79"><a href="integral-population-models.html#cb281-79" tabindex="-1"></a>  <span class="at">evict_cor =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-80"><a href="integral-population-models.html#cb281-80" tabindex="-1"></a>  <span class="at">evict_fun =</span> <span class="fu">truncated_distributions</span>(</span>
<span id="cb281-81"><a href="integral-population-models.html#cb281-81" tabindex="-1"></a>    <span class="at">fun    =</span> <span class="st">&quot;norm&quot;</span>,</span>
<span id="cb281-82"><a href="integral-population-models.html#cb281-82" tabindex="-1"></a>    <span class="at">target =</span> <span class="st">&quot;r_d&quot;</span></span>
<span id="cb281-83"><a href="integral-population-models.html#cb281-83" tabindex="-1"></a>  )</span>
<span id="cb281-84"><a href="integral-population-models.html#cb281-84" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb281-85"><a href="integral-population-models.html#cb281-85" tabindex="-1"></a>  </span>
<span id="cb281-86"><a href="integral-population-models.html#cb281-86" tabindex="-1"></a>  <span class="co">#-------------------------</span></span>
<span id="cb281-87"><a href="integral-population-models.html#cb281-87" tabindex="-1"></a><span class="co"># Implementation + domain</span></span>
<span id="cb281-88"><a href="integral-population-models.html#cb281-88" tabindex="-1"></a><span class="co">#-------------------------</span></span>
<span id="cb281-89"><a href="integral-population-models.html#cb281-89" tabindex="-1"></a><span class="fu">define_impl</span>(</span>
<span id="cb281-90"><a href="integral-population-models.html#cb281-90" tabindex="-1"></a>  <span class="fu">make_impl_args_list</span>(</span>
<span id="cb281-91"><a href="integral-population-models.html#cb281-91" tabindex="-1"></a>    <span class="at">kernel_names =</span> <span class="fu">c</span>(<span class="st">&quot;P&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb281-92"><a href="integral-population-models.html#cb281-92" tabindex="-1"></a>    <span class="at">int_rule     =</span> <span class="fu">rep</span>(<span class="st">&quot;midpoint&quot;</span>, <span class="dv">2</span>),</span>
<span id="cb281-93"><a href="integral-population-models.html#cb281-93" tabindex="-1"></a>    <span class="at">state_start  =</span> <span class="fu">rep</span>(<span class="st">&quot;sa&quot;</span>, <span class="dv">2</span>),</span>
<span id="cb281-94"><a href="integral-population-models.html#cb281-94" tabindex="-1"></a>    <span class="at">state_end    =</span> <span class="fu">rep</span>(<span class="st">&quot;sa&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb281-95"><a href="integral-population-models.html#cb281-95" tabindex="-1"></a>  )</span>
<span id="cb281-96"><a href="integral-population-models.html#cb281-96" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb281-97"><a href="integral-population-models.html#cb281-97" tabindex="-1"></a>  </span>
<span id="cb281-98"><a href="integral-population-models.html#cb281-98" tabindex="-1"></a>  <span class="fu">define_domains</span>(</span>
<span id="cb281-99"><a href="integral-population-models.html#cb281-99" tabindex="-1"></a>    <span class="at">sa =</span> <span class="fu">c</span>(L, U, <span class="dv">100</span>)</span>
<span id="cb281-100"><a href="integral-population-models.html#cb281-100" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb281-101"><a href="integral-population-models.html#cb281-101" tabindex="-1"></a>  </span>
<span id="cb281-102"><a href="integral-population-models.html#cb281-102" tabindex="-1"></a>  <span class="fu">define_pop_state</span>(</span>
<span id="cb281-103"><a href="integral-population-models.html#cb281-103" tabindex="-1"></a>    <span class="at">n_sa =</span> <span class="fu">runif</span>(<span class="dv">100</span>)</span>
<span id="cb281-104"><a href="integral-population-models.html#cb281-104" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb281-105"><a href="integral-population-models.html#cb281-105" tabindex="-1"></a>  </span>
<span id="cb281-106"><a href="integral-population-models.html#cb281-106" tabindex="-1"></a>  <span class="fu">make_ipm</span>(</span>
<span id="cb281-107"><a href="integral-population-models.html#cb281-107" tabindex="-1"></a>    <span class="at">iterate    =</span> <span class="cn">TRUE</span>,</span>
<span id="cb281-108"><a href="integral-population-models.html#cb281-108" tabindex="-1"></a>    <span class="at">iterations =</span> <span class="dv">100</span></span>
<span id="cb281-109"><a href="integral-population-models.html#cb281-109" tabindex="-1"></a>  )</span>
<span id="cb281-110"><a href="integral-population-models.html#cb281-110" tabindex="-1"></a></span>
<span id="cb281-111"><a href="integral-population-models.html#cb281-111" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb281-112"><a href="integral-population-models.html#cb281-112" tabindex="-1"></a><span class="co"># Extract kernels and λ</span></span>
<span id="cb281-113"><a href="integral-population-models.html#cb281-113" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb281-114"><a href="integral-population-models.html#cb281-114" tabindex="-1"></a></span>
<span id="cb281-115"><a href="integral-population-models.html#cb281-115" tabindex="-1"></a>P <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>P</span>
<span id="cb281-116"><a href="integral-population-models.html#cb281-116" tabindex="-1"></a>F <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>F</span>
<span id="cb281-117"><a href="integral-population-models.html#cb281-117" tabindex="-1"></a>K_matrix <span class="ot">&lt;-</span> P <span class="sc">+</span> F</span>
<span id="cb281-118"><a href="integral-population-models.html#cb281-118" tabindex="-1"></a></span>
<span id="cb281-119"><a href="integral-population-models.html#cb281-119" tabindex="-1"></a>eigs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(K_matrix)</span>
<span id="cb281-120"><a href="integral-population-models.html#cb281-120" tabindex="-1"></a>lambda_raw <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">Re</span>(eigs<span class="sc">$</span>values))</span>
<span id="cb281-121"><a href="integral-population-models.html#cb281-121" tabindex="-1"></a></span>
<span id="cb281-122"><a href="integral-population-models.html#cb281-122" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== IPM Results ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === IPM Results ===</code></pre>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="integral-population-models.html#cb283-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Population growth rate (λ):&quot;</span>, <span class="fu">round</span>(lambda_raw, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Population growth rate (λ): 0.9647</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="integral-population-models.html#cb285-1" tabindex="-1"></a><span class="cf">if</span> (lambda_raw <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb285-2"><a href="integral-population-models.html#cb285-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;→ Population GROWING at&quot;</span>, <span class="fu">round</span>((lambda_raw <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&quot;% per year</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb285-3"><a href="integral-population-models.html#cb285-3" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (lambda_raw <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb285-4"><a href="integral-population-models.html#cb285-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;→ Population DECLINING at&quot;</span>, <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> lambda_raw) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&quot;% per year</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb285-5"><a href="integral-population-models.html#cb285-5" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb285-6"><a href="integral-population-models.html#cb285-6" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;→ Population STABLE</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb285-7"><a href="integral-population-models.html#cb285-7" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## → Population DECLINING at 3.53 % per year</code></pre>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="integral-population-models.html#cb287-1" tabindex="-1"></a>stable_dist_raw <span class="ot">&lt;-</span> <span class="fu">Re</span>(eigs<span class="sc">$</span>vectors[, <span class="fu">which.max</span>(<span class="fu">Re</span>(eigs<span class="sc">$</span>values))])</span>
<span id="cb287-2"><a href="integral-population-models.html#cb287-2" tabindex="-1"></a>stable_dist_raw <span class="ot">&lt;-</span> stable_dist_raw <span class="sc">/</span> <span class="fu">sum</span>(stable_dist_raw)</span>
<span id="cb287-3"><a href="integral-population-models.html#cb287-3" tabindex="-1"></a></span>
<span id="cb287-4"><a href="integral-population-models.html#cb287-4" tabindex="-1"></a><span class="co"># ==============================</span></span>
<span id="cb287-5"><a href="integral-population-models.html#cb287-5" tabindex="-1"></a><span class="co"># SAVE FULL IPM OBJECT (RDS)</span></span>
<span id="cb287-6"><a href="integral-population-models.html#cb287-6" tabindex="-1"></a><span class="co"># ==============================</span></span>
<span id="cb287-7"><a href="integral-population-models.html#cb287-7" tabindex="-1"></a></span>
<span id="cb287-8"><a href="integral-population-models.html#cb287-8" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;IPM_outputs&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb287-9"><a href="integral-population-models.html#cb287-9" tabindex="-1"></a>species_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;IPM_outputs&quot;</span>, <span class="fu">paste0</span>(species_name, <span class="st">&quot;_&quot;</span>, trans_years))</span>
<span id="cb287-10"><a href="integral-population-models.html#cb287-10" tabindex="-1"></a><span class="fu">dir.create</span>(species_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb287-11"><a href="integral-population-models.html#cb287-11" tabindex="-1"></a></span>
<span id="cb287-12"><a href="integral-population-models.html#cb287-12" tabindex="-1"></a>mesh_points <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>domains<span class="sc">$</span>sa</span>
<span id="cb287-13"><a href="integral-population-models.html#cb287-13" tabindex="-1"></a>mesh_width  <span class="ot">&lt;-</span> <span class="fu">diff</span>(mesh_points)[<span class="dv">1</span>]</span>
<span id="cb287-14"><a href="integral-population-models.html#cb287-14" tabindex="-1"></a></span>
<span id="cb287-15"><a href="integral-population-models.html#cb287-15" tabindex="-1"></a>ipm_rds <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb287-16"><a href="integral-population-models.html#cb287-16" tabindex="-1"></a>  </span>
<span id="cb287-17"><a href="integral-population-models.html#cb287-17" tabindex="-1"></a>  <span class="at">metadata =</span> <span class="fu">list</span>(</span>
<span id="cb287-18"><a href="integral-population-models.html#cb287-18" tabindex="-1"></a>    <span class="at">species        =</span> species_name,</span>
<span id="cb287-19"><a href="integral-population-models.html#cb287-19" tabindex="-1"></a>    <span class="at">transition     =</span> trans_years,</span>
<span id="cb287-20"><a href="integral-population-models.html#cb287-20" tabindex="-1"></a>    <span class="at">date_created   =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb287-21"><a href="integral-population-models.html#cb287-21" tabindex="-1"></a>    <span class="at">state_variable =</span> <span class="st">&quot;size_log&quot;</span>,</span>
<span id="cb287-22"><a href="integral-population-models.html#cb287-22" tabindex="-1"></a>    <span class="at">state_scale    =</span> <span class="st">&quot;log&quot;</span>,</span>
<span id="cb287-23"><a href="integral-population-models.html#cb287-23" tabindex="-1"></a>    <span class="at">raw_units      =</span> <span class="st">&quot;original size units&quot;</span>,</span>
<span id="cb287-24"><a href="integral-population-models.html#cb287-24" tabindex="-1"></a>    <span class="at">mesh_points_n  =</span> <span class="fu">length</span>(mesh_points),</span>
<span id="cb287-25"><a href="integral-population-models.html#cb287-25" tabindex="-1"></a>    <span class="at">mesh_bounds    =</span> <span class="fu">c</span>(<span class="at">L =</span> L, <span class="at">U =</span> U),</span>
<span id="cb287-26"><a href="integral-population-models.html#cb287-26" tabindex="-1"></a>    <span class="at">mesh_width     =</span> mesh_width</span>
<span id="cb287-27"><a href="integral-population-models.html#cb287-27" tabindex="-1"></a>  ),</span>
<span id="cb287-28"><a href="integral-population-models.html#cb287-28" tabindex="-1"></a>  </span>
<span id="cb287-29"><a href="integral-population-models.html#cb287-29" tabindex="-1"></a>  <span class="at">kernels =</span> <span class="fu">list</span>(</span>
<span id="cb287-30"><a href="integral-population-models.html#cb287-30" tabindex="-1"></a>    <span class="at">K =</span> K_matrix,</span>
<span id="cb287-31"><a href="integral-population-models.html#cb287-31" tabindex="-1"></a>    <span class="at">P =</span> P,</span>
<span id="cb287-32"><a href="integral-population-models.html#cb287-32" tabindex="-1"></a>    <span class="at">F =</span> F</span>
<span id="cb287-33"><a href="integral-population-models.html#cb287-33" tabindex="-1"></a>  ),</span>
<span id="cb287-34"><a href="integral-population-models.html#cb287-34" tabindex="-1"></a>  </span>
<span id="cb287-35"><a href="integral-population-models.html#cb287-35" tabindex="-1"></a>  <span class="at">size =</span> <span class="fu">list</span>(</span>
<span id="cb287-36"><a href="integral-population-models.html#cb287-36" tabindex="-1"></a>    <span class="at">mesh_points_log =</span> mesh_points,</span>
<span id="cb287-37"><a href="integral-population-models.html#cb287-37" tabindex="-1"></a>    <span class="at">stable_dist     =</span> stable_dist_raw</span>
<span id="cb287-38"><a href="integral-population-models.html#cb287-38" tabindex="-1"></a>  ),</span>
<span id="cb287-39"><a href="integral-population-models.html#cb287-39" tabindex="-1"></a>  </span>
<span id="cb287-40"><a href="integral-population-models.html#cb287-40" tabindex="-1"></a>  <span class="at">population_metrics =</span> <span class="fu">list</span>(</span>
<span id="cb287-41"><a href="integral-population-models.html#cb287-41" tabindex="-1"></a>    <span class="at">lambda =</span> lambda_raw</span>
<span id="cb287-42"><a href="integral-population-models.html#cb287-42" tabindex="-1"></a>  ),</span>
<span id="cb287-43"><a href="integral-population-models.html#cb287-43" tabindex="-1"></a>  </span>
<span id="cb287-44"><a href="integral-population-models.html#cb287-44" tabindex="-1"></a>  <span class="at">models =</span> <span class="fu">list</span>(</span>
<span id="cb287-45"><a href="integral-population-models.html#cb287-45" tabindex="-1"></a>    <span class="at">growth       =</span> grow_mod,</span>
<span id="cb287-46"><a href="integral-population-models.html#cb287-46" tabindex="-1"></a>    <span class="at">survival     =</span> surv_mod,</span>
<span id="cb287-47"><a href="integral-population-models.html#cb287-47" tabindex="-1"></a>    <span class="at">reproduction =</span> repr_mod,</span>
<span id="cb287-48"><a href="integral-population-models.html#cb287-48" tabindex="-1"></a>    <span class="at">fecundity    =</span> seed_mod</span>
<span id="cb287-49"><a href="integral-population-models.html#cb287-49" tabindex="-1"></a>  ),</span>
<span id="cb287-50"><a href="integral-population-models.html#cb287-50" tabindex="-1"></a>  </span>
<span id="cb287-51"><a href="integral-population-models.html#cb287-51" tabindex="-1"></a>  <span class="at">recruitment =</span> <span class="fu">list</span>(</span>
<span id="cb287-52"><a href="integral-population-models.html#cb287-52" tabindex="-1"></a>    <span class="at">recr_mu_log        =</span> recr_mu,</span>
<span id="cb287-53"><a href="integral-population-models.html#cb287-53" tabindex="-1"></a>    <span class="at">recr_sd_log        =</span> recr_sd,</span>
<span id="cb287-54"><a href="integral-population-models.html#cb287-54" tabindex="-1"></a>    <span class="at">recr_n             =</span> recr_n,</span>
<span id="cb287-55"><a href="integral-population-models.html#cb287-55" tabindex="-1"></a>    <span class="at">seed_n             =</span> seed_n,</span>
<span id="cb287-56"><a href="integral-population-models.html#cb287-56" tabindex="-1"></a>    <span class="at">establishment_prob =</span> recr_n <span class="sc">/</span> seed_n</span>
<span id="cb287-57"><a href="integral-population-models.html#cb287-57" tabindex="-1"></a>  ),</span>
<span id="cb287-58"><a href="integral-population-models.html#cb287-58" tabindex="-1"></a>  </span>
<span id="cb287-59"><a href="integral-population-models.html#cb287-59" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb287-60"><a href="integral-population-models.html#cb287-60" tabindex="-1"></a>  <span class="at">data   =</span> final_data</span>
<span id="cb287-61"><a href="integral-population-models.html#cb287-61" tabindex="-1"></a>)</span>
<span id="cb287-62"><a href="integral-population-models.html#cb287-62" tabindex="-1"></a></span>
<span id="cb287-63"><a href="integral-population-models.html#cb287-63" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb287-64"><a href="integral-population-models.html#cb287-64" tabindex="-1"></a>  ipm_rds,</span>
<span id="cb287-65"><a href="integral-population-models.html#cb287-65" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">file.path</span>(species_dir, <span class="st">&quot;IPM_full_object.rds&quot;</span>)</span>
<span id="cb287-66"><a href="integral-population-models.html#cb287-66" tabindex="-1"></a>)</span>
<span id="cb287-67"><a href="integral-population-models.html#cb287-67" tabindex="-1"></a></span>
<span id="cb287-68"><a href="integral-population-models.html#cb287-68" tabindex="-1"></a><span class="fu">cat</span>(</span>
<span id="cb287-69"><a href="integral-population-models.html#cb287-69" tabindex="-1"></a>  <span class="st">&quot;✓ Saved full IPM object (log-scale) to:&quot;</span>,</span>
<span id="cb287-70"><a href="integral-population-models.html#cb287-70" tabindex="-1"></a>  <span class="fu">file.path</span>(species_dir, <span class="st">&quot;IPM_full_object.rds&quot;</span>),</span>
<span id="cb287-71"><a href="integral-population-models.html#cb287-71" tabindex="-1"></a>  <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span></span>
<span id="cb287-72"><a href="integral-population-models.html#cb287-72" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## ✓ Saved full IPM object (log-scale) to: IPM_outputs/SILLAN_20232024/IPM_full_object.rds</code></pre>
<p>Now, let’s bootstrap for confidence intervals!</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="integral-population-models.html#cb289-1" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb289-2"><a href="integral-population-models.html#cb289-2" tabindex="-1"></a><span class="co"># BOOTSTRAP ANALYSIS - UNCERTAINTY IN LAMBDA</span></span>
<span id="cb289-3"><a href="integral-population-models.html#cb289-3" tabindex="-1"></a><span class="co">#===============================================</span></span>
<span id="cb289-4"><a href="integral-population-models.html#cb289-4" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb289-5"><a href="integral-population-models.html#cb289-5" tabindex="-1"></a></span>
<span id="cb289-6"><a href="integral-population-models.html#cb289-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Starting Bootstrap Analysis ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Starting Bootstrap Analysis ===</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="integral-population-models.html#cb291-1" tabindex="-1"></a><span class="co"># Define helper function for safe GLM fitting</span></span>
<span id="cb291-2"><a href="integral-population-models.html#cb291-2" tabindex="-1"></a>safe_glm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, family) {</span>
<span id="cb291-3"><a href="integral-population-models.html#cb291-3" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb291-4"><a href="integral-population-models.html#cb291-4" tabindex="-1"></a>    <span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> family),</span>
<span id="cb291-5"><a href="integral-population-models.html#cb291-5" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>,</span>
<span id="cb291-6"><a href="integral-population-models.html#cb291-6" tabindex="-1"></a>    <span class="at">warning =</span> <span class="cf">function</span>(w) <span class="cn">NULL</span></span>
<span id="cb291-7"><a href="integral-population-models.html#cb291-7" tabindex="-1"></a>  )</span>
<span id="cb291-8"><a href="integral-population-models.html#cb291-8" tabindex="-1"></a>}</span>
<span id="cb291-9"><a href="integral-population-models.html#cb291-9" tabindex="-1"></a></span>
<span id="cb291-10"><a href="integral-population-models.html#cb291-10" tabindex="-1"></a><span class="co"># Helper to extract state variable name from model</span></span>
<span id="cb291-11"><a href="integral-population-models.html#cb291-11" tabindex="-1"></a>get_state_name <span class="ot">&lt;-</span> <span class="cf">function</span>(mod) {</span>
<span id="cb291-12"><a href="integral-population-models.html#cb291-12" tabindex="-1"></a>  <span class="fu">all.vars</span>(<span class="fu">formula</span>(mod))[<span class="dv">2</span>]</span>
<span id="cb291-13"><a href="integral-population-models.html#cb291-13" tabindex="-1"></a>}</span>
<span id="cb291-14"><a href="integral-population-models.html#cb291-14" tabindex="-1"></a></span>
<span id="cb291-15"><a href="integral-population-models.html#cb291-15" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb291-16"><a href="integral-population-models.html#cb291-16" tabindex="-1"></a><span class="co"># Prepare data splits (ROBUST DEFINITION)</span></span>
<span id="cb291-17"><a href="integral-population-models.html#cb291-17" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb291-18"><a href="integral-population-models.html#cb291-18" tabindex="-1"></a></span>
<span id="cb291-19"><a href="integral-population-models.html#cb291-19" tabindex="-1"></a><span class="co"># Adults: individuals present at time t (with size_log)</span></span>
<span id="cb291-20"><a href="integral-population-models.html#cb291-20" tabindex="-1"></a>adults <span class="ot">&lt;-</span> final_data[<span class="sc">!</span><span class="fu">is.na</span>(final_data<span class="sc">$</span>size_log), ]</span>
<span id="cb291-21"><a href="integral-population-models.html#cb291-21" tabindex="-1"></a></span>
<span id="cb291-22"><a href="integral-population-models.html#cb291-22" tabindex="-1"></a><span class="co"># Recruits: STRICT definition matching Section 1</span></span>
<span id="cb291-23"><a href="integral-population-models.html#cb291-23" tabindex="-1"></a>robust_recruit_logical <span class="ot">&lt;-</span> <span class="fu">is.na</span>(final_data<span class="sc">$</span>size_log) <span class="sc">&amp;</span> </span>
<span id="cb291-24"><a href="integral-population-models.html#cb291-24" tabindex="-1"></a>  <span class="fu">is.na</span>(final_data<span class="sc">$</span>surv) <span class="sc">&amp;</span> </span>
<span id="cb291-25"><a href="integral-population-models.html#cb291-25" tabindex="-1"></a>  <span class="fu">is.na</span>(final_data<span class="sc">$</span>fec1) <span class="sc">&amp;</span> </span>
<span id="cb291-26"><a href="integral-population-models.html#cb291-26" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(final_data<span class="sc">$</span>sizeNext_log)</span>
<span id="cb291-27"><a href="integral-population-models.html#cb291-27" tabindex="-1"></a></span>
<span id="cb291-28"><a href="integral-population-models.html#cb291-28" tabindex="-1"></a>recr_data <span class="ot">&lt;-</span> final_data[robust_recruit_logical, ]</span>
<span id="cb291-29"><a href="integral-population-models.html#cb291-29" tabindex="-1"></a></span>
<span id="cb291-30"><a href="integral-population-models.html#cb291-30" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Adults (will be bootstrapped):&quot;</span>, <span class="fu">nrow</span>(adults), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Adults (will be bootstrapped): 82</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="integral-population-models.html#cb293-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Recruits (held constant):&quot;</span>, <span class="fu">nrow</span>(recr_data), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Recruits (held constant): 293</code></pre>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="integral-population-models.html#cb295-1" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb295-2"><a href="integral-population-models.html#cb295-2" tabindex="-1"></a><span class="co"># Freeze fixed components</span></span>
<span id="cb295-3"><a href="integral-population-models.html#cb295-3" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb295-4"><a href="integral-population-models.html#cb295-4" tabindex="-1"></a></span>
<span id="cb295-5"><a href="integral-population-models.html#cb295-5" tabindex="-1"></a><span class="co"># Use the mesh from your main IPM</span></span>
<span id="cb295-6"><a href="integral-population-models.html#cb295-6" tabindex="-1"></a>fixed_mesh <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>domains<span class="sc">$</span>sa</span>
<span id="cb295-7"><a href="integral-population-models.html#cb295-7" tabindex="-1"></a></span>
<span id="cb295-8"><a href="integral-population-models.html#cb295-8" tabindex="-1"></a><span class="co"># Store full-data models as fallbacks</span></span>
<span id="cb295-9"><a href="integral-population-models.html#cb295-9" tabindex="-1"></a>surv_mod_full <span class="ot">&lt;-</span> surv_mod</span>
<span id="cb295-10"><a href="integral-population-models.html#cb295-10" tabindex="-1"></a>repr_mod_full <span class="ot">&lt;-</span> repr_mod</span>
<span id="cb295-11"><a href="integral-population-models.html#cb295-11" tabindex="-1"></a>seed_mod_full <span class="ot">&lt;-</span> seed_mod</span>
<span id="cb295-12"><a href="integral-population-models.html#cb295-12" tabindex="-1"></a></span>
<span id="cb295-13"><a href="integral-population-models.html#cb295-13" tabindex="-1"></a><span class="co"># Store full-data recruitment parameters (NOT bootstrapped)</span></span>
<span id="cb295-14"><a href="integral-population-models.html#cb295-14" tabindex="-1"></a>recr_mu_full  <span class="ot">&lt;-</span> recr_mu</span>
<span id="cb295-15"><a href="integral-population-models.html#cb295-15" tabindex="-1"></a>recr_sd_full  <span class="ot">&lt;-</span> recr_sd</span>
<span id="cb295-16"><a href="integral-population-models.html#cb295-16" tabindex="-1"></a>recr_n_full   <span class="ot">&lt;-</span> recr_n</span>
<span id="cb295-17"><a href="integral-population-models.html#cb295-17" tabindex="-1"></a>min_repro_full <span class="ot">&lt;-</span> min_repro_size_log</span>
<span id="cb295-18"><a href="integral-population-models.html#cb295-18" tabindex="-1"></a></span>
<span id="cb295-19"><a href="integral-population-models.html#cb295-19" tabindex="-1"></a><span class="co"># Store proto_ipm for reuse</span></span>
<span id="cb295-20"><a href="integral-population-models.html#cb295-20" tabindex="-1"></a>use_proto <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>proto_ipm</span>
<span id="cb295-21"><a href="integral-population-models.html#cb295-21" tabindex="-1"></a></span>
<span id="cb295-22"><a href="integral-population-models.html#cb295-22" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ Fixed mesh points:&quot;</span>, <span class="fu">length</span>(fixed_mesh), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ✓ Fixed mesh points: 0</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="integral-population-models.html#cb297-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Domain bounds (log): [&quot;</span>, <span class="fu">round</span>(L, <span class="dv">3</span>), <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(U, <span class="dv">3</span>), <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Domain bounds (log): [ 0 , 5.452 ]</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="integral-population-models.html#cb299-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Recruitment held constant: μ =&quot;</span>, <span class="fu">round</span>(recr_mu_full, <span class="dv">3</span>), </span>
<span id="cb299-2"><a href="integral-population-models.html#cb299-2" tabindex="-1"></a>    <span class="st">&quot;, σ =&quot;</span>, <span class="fu">round</span>(recr_sd_full, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Recruitment held constant: μ = 1.352 , σ = 0.611</code></pre>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="integral-population-models.html#cb301-1" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb301-2"><a href="integral-population-models.html#cb301-2" tabindex="-1"></a><span class="co"># Bootstrap setup</span></span>
<span id="cb301-3"><a href="integral-population-models.html#cb301-3" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb301-4"><a href="integral-population-models.html#cb301-4" tabindex="-1"></a></span>
<span id="cb301-5"><a href="integral-population-models.html#cb301-5" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">50</span><span class="dt">L</span></span>
<span id="cb301-6"><a href="integral-population-models.html#cb301-6" tabindex="-1"></a>max_tries <span class="ot">&lt;-</span> n_boot <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb301-7"><a href="integral-population-models.html#cb301-7" tabindex="-1"></a></span>
<span id="cb301-8"><a href="integral-population-models.html#cb301-8" tabindex="-1"></a><span class="co"># Storage vectors</span></span>
<span id="cb301-9"><a href="integral-population-models.html#cb301-9" tabindex="-1"></a>all_lambdas            <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, n_boot)</span>
<span id="cb301-10"><a href="integral-population-models.html#cb301-10" tabindex="-1"></a>mean_size_rep          <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, n_boot)</span>
<span id="cb301-11"><a href="integral-population-models.html#cb301-11" tabindex="-1"></a>var_size_rep           <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, n_boot)</span>
<span id="cb301-12"><a href="integral-population-models.html#cb301-12" tabindex="-1"></a>prop_stable_repro_vals <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, n_boot)</span>
<span id="cb301-13"><a href="integral-population-models.html#cb301-13" tabindex="-1"></a></span>
<span id="cb301-14"><a href="integral-population-models.html#cb301-14" tabindex="-1"></a>valid_iter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb301-15"><a href="integral-population-models.html#cb301-15" tabindex="-1"></a>attempts   <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb301-16"><a href="integral-population-models.html#cb301-16" tabindex="-1"></a></span>
<span id="cb301-17"><a href="integral-population-models.html#cb301-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Bootstrap Loop ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Bootstrap Loop ===</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="integral-population-models.html#cb303-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Target iterations:&quot;</span>, n_boot, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Target iterations: 50</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="integral-population-models.html#cb305-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Maximum attempts:&quot;</span>, max_tries, <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Maximum attempts: 250</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="integral-population-models.html#cb307-1" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb307-2"><a href="integral-population-models.html#cb307-2" tabindex="-1"></a><span class="co"># BOOTSTRAP LOOP</span></span>
<span id="cb307-3"><a href="integral-population-models.html#cb307-3" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb307-4"><a href="integral-population-models.html#cb307-4" tabindex="-1"></a></span>
<span id="cb307-5"><a href="integral-population-models.html#cb307-5" tabindex="-1"></a><span class="cf">while</span> (valid_iter <span class="sc">&lt;</span> n_boot <span class="sc">&amp;&amp;</span> attempts <span class="sc">&lt;</span> max_tries) {</span>
<span id="cb307-6"><a href="integral-population-models.html#cb307-6" tabindex="-1"></a>  </span>
<span id="cb307-7"><a href="integral-population-models.html#cb307-7" tabindex="-1"></a>  attempts <span class="ot">&lt;-</span> attempts <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb307-8"><a href="integral-population-models.html#cb307-8" tabindex="-1"></a>  </span>
<span id="cb307-9"><a href="integral-population-models.html#cb307-9" tabindex="-1"></a>  <span class="co"># Progress indicator every 10 attempts</span></span>
<span id="cb307-10"><a href="integral-population-models.html#cb307-10" tabindex="-1"></a>  <span class="cf">if</span> (attempts <span class="sc">%%</span> <span class="dv">10</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb307-11"><a href="integral-population-models.html#cb307-11" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Attempt&quot;</span>, attempts, <span class="st">&quot;| Valid:&quot;</span>, valid_iter, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb307-12"><a href="integral-population-models.html#cb307-12" tabindex="-1"></a>  }</span>
<span id="cb307-13"><a href="integral-population-models.html#cb307-13" tabindex="-1"></a>  </span>
<span id="cb307-14"><a href="integral-population-models.html#cb307-14" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-15"><a href="integral-population-models.html#cb307-15" tabindex="-1"></a>  <span class="co"># Resample adults only (NOT recruits)</span></span>
<span id="cb307-16"><a href="integral-population-models.html#cb307-16" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-17"><a href="integral-population-models.html#cb307-17" tabindex="-1"></a>  boot_ind  <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(adults)), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb307-18"><a href="integral-population-models.html#cb307-18" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(adults[boot_ind, ], recr_data)  <span class="co"># Append FULL recruit dataset</span></span>
<span id="cb307-19"><a href="integral-population-models.html#cb307-19" tabindex="-1"></a>  </span>
<span id="cb307-20"><a href="integral-population-models.html#cb307-20" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-21"><a href="integral-population-models.html#cb307-21" tabindex="-1"></a>  <span class="co"># Refit vital rate models</span></span>
<span id="cb307-22"><a href="integral-population-models.html#cb307-22" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-23"><a href="integral-population-models.html#cb307-23" tabindex="-1"></a>  </span>
<span id="cb307-24"><a href="integral-population-models.html#cb307-24" tabindex="-1"></a>  <span class="co"># Growth model (MUST succeed)</span></span>
<span id="cb307-25"><a href="integral-population-models.html#cb307-25" tabindex="-1"></a>  grow_mod_boot <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb307-26"><a href="integral-population-models.html#cb307-26" tabindex="-1"></a>    <span class="fu">lm</span>(sizeNext_log <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> boot_data),</span>
<span id="cb307-27"><a href="integral-population-models.html#cb307-27" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span></span>
<span id="cb307-28"><a href="integral-population-models.html#cb307-28" tabindex="-1"></a>  )</span>
<span id="cb307-29"><a href="integral-population-models.html#cb307-29" tabindex="-1"></a>  </span>
<span id="cb307-30"><a href="integral-population-models.html#cb307-30" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(grow_mod_boot)) <span class="cf">next</span></span>
<span id="cb307-31"><a href="integral-population-models.html#cb307-31" tabindex="-1"></a>  </span>
<span id="cb307-32"><a href="integral-population-models.html#cb307-32" tabindex="-1"></a>  grow_sd_boot <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">resid</span>(grow_mod_boot), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb307-33"><a href="integral-population-models.html#cb307-33" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(grow_sd_boot) <span class="sc">||</span> grow_sd_boot <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb307-34"><a href="integral-population-models.html#cb307-34" tabindex="-1"></a>  </span>
<span id="cb307-35"><a href="integral-population-models.html#cb307-35" tabindex="-1"></a>  <span class="co"># Survival model (fall back to full model if fails)</span></span>
<span id="cb307-36"><a href="integral-population-models.html#cb307-36" tabindex="-1"></a>  surv_mod_boot <span class="ot">&lt;-</span> <span class="fu">safe_glm</span>(surv <span class="sc">~</span> size_log, boot_data, <span class="fu">binomial</span>())</span>
<span id="cb307-37"><a href="integral-population-models.html#cb307-37" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(surv_mod_boot)) {</span>
<span id="cb307-38"><a href="integral-population-models.html#cb307-38" tabindex="-1"></a>    surv_mod_boot <span class="ot">&lt;-</span> surv_mod_full</span>
<span id="cb307-39"><a href="integral-population-models.html#cb307-39" tabindex="-1"></a>  }</span>
<span id="cb307-40"><a href="integral-population-models.html#cb307-40" tabindex="-1"></a>  </span>
<span id="cb307-41"><a href="integral-population-models.html#cb307-41" tabindex="-1"></a>  <span class="co"># Reproduction probability (fall back if fails)</span></span>
<span id="cb307-42"><a href="integral-population-models.html#cb307-42" tabindex="-1"></a>  repr_mod_boot <span class="ot">&lt;-</span> <span class="fu">safe_glm</span>(fec1 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>), boot_data, <span class="fu">binomial</span>())</span>
<span id="cb307-43"><a href="integral-population-models.html#cb307-43" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(repr_mod_boot)) {</span>
<span id="cb307-44"><a href="integral-population-models.html#cb307-44" tabindex="-1"></a>    repr_mod_boot <span class="ot">&lt;-</span> repr_mod_full</span>
<span id="cb307-45"><a href="integral-population-models.html#cb307-45" tabindex="-1"></a>  }</span>
<span id="cb307-46"><a href="integral-population-models.html#cb307-46" tabindex="-1"></a>  </span>
<span id="cb307-47"><a href="integral-population-models.html#cb307-47" tabindex="-1"></a>  <span class="co"># Seed production (fall back if fails)</span></span>
<span id="cb307-48"><a href="integral-population-models.html#cb307-48" tabindex="-1"></a>  seed_mod_boot <span class="ot">&lt;-</span> <span class="fu">safe_glm</span>(fec2 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>), boot_data, <span class="fu">poisson</span>())</span>
<span id="cb307-49"><a href="integral-population-models.html#cb307-49" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(seed_mod_boot)) {</span>
<span id="cb307-50"><a href="integral-population-models.html#cb307-50" tabindex="-1"></a>    seed_mod_boot <span class="ot">&lt;-</span> seed_mod_full</span>
<span id="cb307-51"><a href="integral-population-models.html#cb307-51" tabindex="-1"></a>  }</span>
<span id="cb307-52"><a href="integral-population-models.html#cb307-52" tabindex="-1"></a>  </span>
<span id="cb307-53"><a href="integral-population-models.html#cb307-53" tabindex="-1"></a>  <span class="co"># Calculate seed_n from bootstrap sample</span></span>
<span id="cb307-54"><a href="integral-population-models.html#cb307-54" tabindex="-1"></a>  seed_n_boot <span class="ot">&lt;-</span> <span class="fu">sum</span>(boot_data<span class="sc">$</span>fec2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb307-55"><a href="integral-population-models.html#cb307-55" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(seed_n_boot) <span class="sc">||</span> seed_n_boot <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb307-56"><a href="integral-population-models.html#cb307-56" tabindex="-1"></a>  </span>
<span id="cb307-57"><a href="integral-population-models.html#cb307-57" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-58"><a href="integral-population-models.html#cb307-58" tabindex="-1"></a>  <span class="co"># Update parameters in proto_ipm</span></span>
<span id="cb307-59"><a href="integral-population-models.html#cb307-59" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-60"><a href="integral-population-models.html#cb307-60" tabindex="-1"></a>  </span>
<span id="cb307-61"><a href="integral-population-models.html#cb307-61" tabindex="-1"></a>  params_boot <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb307-62"><a href="integral-population-models.html#cb307-62" tabindex="-1"></a>    <span class="at">recr_mu            =</span> recr_mu_full,      <span class="co"># FIXED - not bootstrapped</span></span>
<span id="cb307-63"><a href="integral-population-models.html#cb307-63" tabindex="-1"></a>    <span class="at">recr_sd            =</span> recr_sd_full,      <span class="co"># FIXED - not bootstrapped</span></span>
<span id="cb307-64"><a href="integral-population-models.html#cb307-64" tabindex="-1"></a>    <span class="at">grow_sd            =</span> grow_sd_boot,      <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-65"><a href="integral-population-models.html#cb307-65" tabindex="-1"></a>    <span class="at">surv_mod           =</span> surv_mod_boot,     <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-66"><a href="integral-population-models.html#cb307-66" tabindex="-1"></a>    <span class="at">grow_mod           =</span> grow_mod_boot,     <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-67"><a href="integral-population-models.html#cb307-67" tabindex="-1"></a>    <span class="at">repr_mod           =</span> repr_mod_boot,     <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-68"><a href="integral-population-models.html#cb307-68" tabindex="-1"></a>    <span class="at">seed_mod           =</span> seed_mod_boot,     <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-69"><a href="integral-population-models.html#cb307-69" tabindex="-1"></a>    <span class="at">recr_n             =</span> recr_n_full,       <span class="co"># FIXED - not bootstrapped</span></span>
<span id="cb307-70"><a href="integral-population-models.html#cb307-70" tabindex="-1"></a>    <span class="at">seed_n             =</span> seed_n_boot,       <span class="co"># BOOTSTRAPPED</span></span>
<span id="cb307-71"><a href="integral-population-models.html#cb307-71" tabindex="-1"></a>    <span class="at">min_repro_size_log =</span> min_repro_full     <span class="co"># FIXED - not bootstrapped</span></span>
<span id="cb307-72"><a href="integral-population-models.html#cb307-72" tabindex="-1"></a>  )</span>
<span id="cb307-73"><a href="integral-population-models.html#cb307-73" tabindex="-1"></a>  </span>
<span id="cb307-74"><a href="integral-population-models.html#cb307-74" tabindex="-1"></a>  <span class="co"># Clone proto_ipm and insert new parameters</span></span>
<span id="cb307-75"><a href="integral-population-models.html#cb307-75" tabindex="-1"></a>  proto_boot <span class="ot">&lt;-</span> use_proto</span>
<span id="cb307-76"><a href="integral-population-models.html#cb307-76" tabindex="-1"></a>  <span class="fu">parameters</span>(proto_boot) <span class="ot">&lt;-</span> params_boot</span>
<span id="cb307-77"><a href="integral-population-models.html#cb307-77" tabindex="-1"></a>  </span>
<span id="cb307-78"><a href="integral-population-models.html#cb307-78" tabindex="-1"></a>  <span class="co"># Build bootstrapped IPM</span></span>
<span id="cb307-79"><a href="integral-population-models.html#cb307-79" tabindex="-1"></a>  boot_ipm <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb307-80"><a href="integral-population-models.html#cb307-80" tabindex="-1"></a>    <span class="fu">make_ipm</span>(proto_boot, <span class="at">iterate =</span> <span class="cn">TRUE</span>, <span class="at">iterations =</span> <span class="dv">100</span>),</span>
<span id="cb307-81"><a href="integral-population-models.html#cb307-81" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span></span>
<span id="cb307-82"><a href="integral-population-models.html#cb307-82" tabindex="-1"></a>  )</span>
<span id="cb307-83"><a href="integral-population-models.html#cb307-83" tabindex="-1"></a>  </span>
<span id="cb307-84"><a href="integral-population-models.html#cb307-84" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(boot_ipm)) <span class="cf">next</span></span>
<span id="cb307-85"><a href="integral-population-models.html#cb307-85" tabindex="-1"></a>  </span>
<span id="cb307-86"><a href="integral-population-models.html#cb307-86" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-87"><a href="integral-population-models.html#cb307-87" tabindex="-1"></a>  <span class="co"># Extract lambda</span></span>
<span id="cb307-88"><a href="integral-population-models.html#cb307-88" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-89"><a href="integral-population-models.html#cb307-89" tabindex="-1"></a>  </span>
<span id="cb307-90"><a href="integral-population-models.html#cb307-90" tabindex="-1"></a>  lam <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb307-91"><a href="integral-population-models.html#cb307-91" tabindex="-1"></a>    ipmr<span class="sc">::</span><span class="fu">lambda</span>(boot_ipm), </span>
<span id="cb307-92"><a href="integral-population-models.html#cb307-92" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA_real_</span></span>
<span id="cb307-93"><a href="integral-population-models.html#cb307-93" tabindex="-1"></a>  )</span>
<span id="cb307-94"><a href="integral-population-models.html#cb307-94" tabindex="-1"></a>  </span>
<span id="cb307-95"><a href="integral-population-models.html#cb307-95" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.finite</span>(lam)) <span class="cf">next</span></span>
<span id="cb307-96"><a href="integral-population-models.html#cb307-96" tabindex="-1"></a>  </span>
<span id="cb307-97"><a href="integral-population-models.html#cb307-97" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-98"><a href="integral-population-models.html#cb307-98" tabindex="-1"></a>  <span class="co"># Extract stable distribution</span></span>
<span id="cb307-99"><a href="integral-population-models.html#cb307-99" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-100"><a href="integral-population-models.html#cb307-100" tabindex="-1"></a>  </span>
<span id="cb307-101"><a href="integral-population-models.html#cb307-101" tabindex="-1"></a>  stable_vec <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb307-102"><a href="integral-population-models.html#cb307-102" tabindex="-1"></a>    sv <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ipmr<span class="sc">::</span><span class="fu">right_ev</span>(boot_ipm)<span class="sc">$</span>sa)</span>
<span id="cb307-103"><a href="integral-population-models.html#cb307-103" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.finite</span>(sv)) <span class="sc">||</span> <span class="fu">sum</span>(sv) <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb307-104"><a href="integral-population-models.html#cb307-104" tabindex="-1"></a>      <span class="cn">NULL</span></span>
<span id="cb307-105"><a href="integral-population-models.html#cb307-105" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb307-106"><a href="integral-population-models.html#cb307-106" tabindex="-1"></a>      sv <span class="sc">/</span> <span class="fu">sum</span>(sv)</span>
<span id="cb307-107"><a href="integral-population-models.html#cb307-107" tabindex="-1"></a>    }</span>
<span id="cb307-108"><a href="integral-population-models.html#cb307-108" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb307-109"><a href="integral-population-models.html#cb307-109" tabindex="-1"></a>  </span>
<span id="cb307-110"><a href="integral-population-models.html#cb307-110" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(stable_vec)) <span class="cf">next</span></span>
<span id="cb307-111"><a href="integral-population-models.html#cb307-111" tabindex="-1"></a>  </span>
<span id="cb307-112"><a href="integral-population-models.html#cb307-112" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-113"><a href="integral-population-models.html#cb307-113" tabindex="-1"></a>  <span class="co"># Calculate reproductive metrics (ROBUST + SAFE)</span></span>
<span id="cb307-114"><a href="integral-population-models.html#cb307-114" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-115"><a href="integral-population-models.html#cb307-115" tabindex="-1"></a>  </span>
<span id="cb307-116"><a href="integral-population-models.html#cb307-116" tabindex="-1"></a>  size_classes <span class="ot">&lt;-</span> fixed_mesh</span>
<span id="cb307-117"><a href="integral-population-models.html#cb307-117" tabindex="-1"></a>  </span>
<span id="cb307-118"><a href="integral-population-models.html#cb307-118" tabindex="-1"></a>  <span class="co"># Get predictor names from models</span></span>
<span id="cb307-119"><a href="integral-population-models.html#cb307-119" tabindex="-1"></a>  repr_state <span class="ot">&lt;-</span> <span class="fu">get_state_name</span>(repr_mod_boot)</span>
<span id="cb307-120"><a href="integral-population-models.html#cb307-120" tabindex="-1"></a>  seed_state <span class="ot">&lt;-</span> <span class="fu">get_state_name</span>(seed_mod_boot)</span>
<span id="cb307-121"><a href="integral-population-models.html#cb307-121" tabindex="-1"></a>  </span>
<span id="cb307-122"><a href="integral-population-models.html#cb307-122" tabindex="-1"></a>  <span class="co"># Predict reproduction probability</span></span>
<span id="cb307-123"><a href="integral-population-models.html#cb307-123" tabindex="-1"></a>  rp_raw <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb307-124"><a href="integral-population-models.html#cb307-124" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb307-125"><a href="integral-population-models.html#cb307-125" tabindex="-1"></a>      repr_mod_boot,</span>
<span id="cb307-126"><a href="integral-population-models.html#cb307-126" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">setNames</span>(<span class="fu">data.frame</span>(size_classes), repr_state),</span>
<span id="cb307-127"><a href="integral-population-models.html#cb307-127" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb307-128"><a href="integral-population-models.html#cb307-128" tabindex="-1"></a>    ),</span>
<span id="cb307-129"><a href="integral-population-models.html#cb307-129" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(size_classes))</span>
<span id="cb307-130"><a href="integral-population-models.html#cb307-130" tabindex="-1"></a>  )</span>
<span id="cb307-131"><a href="integral-population-models.html#cb307-131" tabindex="-1"></a>  </span>
<span id="cb307-132"><a href="integral-population-models.html#cb307-132" tabindex="-1"></a>  <span class="co"># Enforce minimum reproductive size threshold</span></span>
<span id="cb307-133"><a href="integral-population-models.html#cb307-133" tabindex="-1"></a>  rp_vals <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(size_classes <span class="sc">&lt;</span> min_repro_full, <span class="dv">0</span>, rp_raw)</span>
<span id="cb307-134"><a href="integral-population-models.html#cb307-134" tabindex="-1"></a>  rp_vals[<span class="sc">!</span><span class="fu">is.finite</span>(rp_vals)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb307-135"><a href="integral-population-models.html#cb307-135" tabindex="-1"></a>  </span>
<span id="cb307-136"><a href="integral-population-models.html#cb307-136" tabindex="-1"></a>  <span class="co"># Predict seed production</span></span>
<span id="cb307-137"><a href="integral-population-models.html#cb307-137" tabindex="-1"></a>  rs_vals <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(</span>
<span id="cb307-138"><a href="integral-population-models.html#cb307-138" tabindex="-1"></a>    <span class="fu">predict</span>(</span>
<span id="cb307-139"><a href="integral-population-models.html#cb307-139" tabindex="-1"></a>      seed_mod_boot,</span>
<span id="cb307-140"><a href="integral-population-models.html#cb307-140" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">setNames</span>(<span class="fu">data.frame</span>(size_classes), seed_state),</span>
<span id="cb307-141"><a href="integral-population-models.html#cb307-141" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb307-142"><a href="integral-population-models.html#cb307-142" tabindex="-1"></a>    ),</span>
<span id="cb307-143"><a href="integral-population-models.html#cb307-143" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(size_classes))</span>
<span id="cb307-144"><a href="integral-population-models.html#cb307-144" tabindex="-1"></a>  )</span>
<span id="cb307-145"><a href="integral-population-models.html#cb307-145" tabindex="-1"></a>  </span>
<span id="cb307-146"><a href="integral-population-models.html#cb307-146" tabindex="-1"></a>  rs_vals[<span class="sc">!</span><span class="fu">is.finite</span>(rs_vals)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb307-147"><a href="integral-population-models.html#cb307-147" tabindex="-1"></a>  </span>
<span id="cb307-148"><a href="integral-population-models.html#cb307-148" tabindex="-1"></a>  <span class="co"># Combined reproductive intensity</span></span>
<span id="cb307-149"><a href="integral-population-models.html#cb307-149" tabindex="-1"></a>  repro_intensity <span class="ot">&lt;-</span> rp_vals <span class="sc">*</span> rs_vals</span>
<span id="cb307-150"><a href="integral-population-models.html#cb307-150" tabindex="-1"></a>  </span>
<span id="cb307-151"><a href="integral-population-models.html#cb307-151" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(repro_intensity) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb307-152"><a href="integral-population-models.html#cb307-152" tabindex="-1"></a>    w_parent  <span class="ot">&lt;-</span> repro_intensity <span class="sc">/</span> <span class="fu">sum</span>(repro_intensity)</span>
<span id="cb307-153"><a href="integral-population-models.html#cb307-153" tabindex="-1"></a>    mean_rep  <span class="ot">&lt;-</span> <span class="fu">sum</span>(size_classes <span class="sc">*</span> w_parent)</span>
<span id="cb307-154"><a href="integral-population-models.html#cb307-154" tabindex="-1"></a>    var_rep   <span class="ot">&lt;-</span> <span class="fu">sum</span>((size_classes <span class="sc">-</span> mean_rep)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> w_parent)</span>
<span id="cb307-155"><a href="integral-population-models.html#cb307-155" tabindex="-1"></a>    prop_rep  <span class="ot">&lt;-</span> <span class="fu">sum</span>(stable_vec[repro_intensity <span class="sc">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb307-156"><a href="integral-population-models.html#cb307-156" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb307-157"><a href="integral-population-models.html#cb307-157" tabindex="-1"></a>    mean_rep <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb307-158"><a href="integral-population-models.html#cb307-158" tabindex="-1"></a>    var_rep  <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb307-159"><a href="integral-population-models.html#cb307-159" tabindex="-1"></a>    prop_rep <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb307-160"><a href="integral-population-models.html#cb307-160" tabindex="-1"></a>  }</span>
<span id="cb307-161"><a href="integral-population-models.html#cb307-161" tabindex="-1"></a>  </span>
<span id="cb307-162"><a href="integral-population-models.html#cb307-162" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-163"><a href="integral-population-models.html#cb307-163" tabindex="-1"></a>  <span class="co"># SAVE RESULTS</span></span>
<span id="cb307-164"><a href="integral-population-models.html#cb307-164" tabindex="-1"></a>  <span class="co">#--------------------------------</span></span>
<span id="cb307-165"><a href="integral-population-models.html#cb307-165" tabindex="-1"></a>  </span>
<span id="cb307-166"><a href="integral-population-models.html#cb307-166" tabindex="-1"></a>  valid_iter <span class="ot">&lt;-</span> valid_iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb307-167"><a href="integral-population-models.html#cb307-167" tabindex="-1"></a>  </span>
<span id="cb307-168"><a href="integral-population-models.html#cb307-168" tabindex="-1"></a>  all_lambdas[valid_iter]            <span class="ot">&lt;-</span> lam</span>
<span id="cb307-169"><a href="integral-population-models.html#cb307-169" tabindex="-1"></a>  mean_size_rep[valid_iter]          <span class="ot">&lt;-</span> mean_rep</span>
<span id="cb307-170"><a href="integral-population-models.html#cb307-170" tabindex="-1"></a>  var_size_rep[valid_iter]           <span class="ot">&lt;-</span> var_rep</span>
<span id="cb307-171"><a href="integral-population-models.html#cb307-171" tabindex="-1"></a>  prop_stable_repro_vals[valid_iter] <span class="ot">&lt;-</span> prop_rep</span>
<span id="cb307-172"><a href="integral-population-models.html#cb307-172" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Attempt 10 | Valid: 9 
## Attempt 20 | Valid: 18 
## Attempt 30 | Valid: 28 
## Attempt 40 | Valid: 38 
## Attempt 50 | Valid: 47</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="integral-population-models.html#cb309-1" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb309-2"><a href="integral-population-models.html#cb309-2" tabindex="-1"></a><span class="co"># BOOTSTRAP SUMMARY</span></span>
<span id="cb309-3"><a href="integral-population-models.html#cb309-3" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb309-4"><a href="integral-population-models.html#cb309-4" tabindex="-1"></a></span>
<span id="cb309-5"><a href="integral-population-models.html#cb309-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Bootstrap Complete ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Bootstrap Complete ===</code></pre>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="integral-population-models.html#cb311-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Valid iterations:&quot;</span>, valid_iter, <span class="st">&quot;/&quot;</span>, n_boot, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Valid iterations: 50 / 50</code></pre>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="integral-population-models.html#cb313-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Total attempts:&quot;</span>, attempts, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Total attempts: 52</code></pre>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="integral-population-models.html#cb315-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Success rate:&quot;</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> valid_iter <span class="sc">/</span> attempts, <span class="dv">1</span>), <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Success rate: 96.2 %</code></pre>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="integral-population-models.html#cb317-1" tabindex="-1"></a><span class="cf">if</span> (valid_iter <span class="sc">&lt;</span> n_boot) {</span>
<span id="cb317-2"><a href="integral-population-models.html#cb317-2" tabindex="-1"></a>  <span class="fu">warning</span>(<span class="st">&quot;Only &quot;</span>, valid_iter, <span class="st">&quot; successful bootstrap iterations (target was &quot;</span>, n_boot, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb317-3"><a href="integral-population-models.html#cb317-3" tabindex="-1"></a>}</span>
<span id="cb317-4"><a href="integral-population-models.html#cb317-4" tabindex="-1"></a></span>
<span id="cb317-5"><a href="integral-population-models.html#cb317-5" tabindex="-1"></a><span class="co"># Remove NA values (unfilled slots if valid_iter &lt; n_boot)</span></span>
<span id="cb317-6"><a href="integral-population-models.html#cb317-6" tabindex="-1"></a>all_lambdas            <span class="ot">&lt;-</span> all_lambdas[<span class="dv">1</span><span class="sc">:</span>valid_iter]</span>
<span id="cb317-7"><a href="integral-population-models.html#cb317-7" tabindex="-1"></a>mean_size_rep          <span class="ot">&lt;-</span> mean_size_rep[<span class="dv">1</span><span class="sc">:</span>valid_iter]</span>
<span id="cb317-8"><a href="integral-population-models.html#cb317-8" tabindex="-1"></a>var_size_rep           <span class="ot">&lt;-</span> var_size_rep[<span class="dv">1</span><span class="sc">:</span>valid_iter]</span>
<span id="cb317-9"><a href="integral-population-models.html#cb317-9" tabindex="-1"></a>prop_stable_repro_vals <span class="ot">&lt;-</span> prop_stable_repro_vals[<span class="dv">1</span><span class="sc">:</span>valid_iter]</span>
<span id="cb317-10"><a href="integral-population-models.html#cb317-10" tabindex="-1"></a></span>
<span id="cb317-11"><a href="integral-population-models.html#cb317-11" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb317-12"><a href="integral-population-models.html#cb317-12" tabindex="-1"></a><span class="co"># CALCULATE CONFIDENCE INTERVALS</span></span>
<span id="cb317-13"><a href="integral-population-models.html#cb317-13" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb317-14"><a href="integral-population-models.html#cb317-14" tabindex="-1"></a></span>
<span id="cb317-15"><a href="integral-population-models.html#cb317-15" tabindex="-1"></a>lambda_ci <span class="ot">&lt;-</span> <span class="fu">quantile</span>(all_lambdas, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb317-16"><a href="integral-population-models.html#cb317-16" tabindex="-1"></a>lambda_obs <span class="ot">&lt;-</span> ipmr<span class="sc">::</span><span class="fu">lambda</span>(obs_ipm)</span>
<span id="cb317-17"><a href="integral-population-models.html#cb317-17" tabindex="-1"></a></span>
<span id="cb317-18"><a href="integral-population-models.html#cb317-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Lambda Estimates ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Lambda Estimates ===</code></pre>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="integral-population-models.html#cb319-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Observed λ:&quot;</span>, <span class="fu">round</span>(lambda_obs, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Observed λ: 0.9647</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="integral-population-models.html#cb321-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Bootstrap mean λ:&quot;</span>, <span class="fu">round</span>(<span class="fu">mean</span>(all_lambdas, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Bootstrap mean λ: 0.9392</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="integral-population-models.html#cb323-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;95% CI: [&quot;</span>, <span class="fu">round</span>(lambda_ci[<span class="dv">1</span>], <span class="dv">4</span>), <span class="st">&quot;,&quot;</span>, <span class="fu">round</span>(lambda_ci[<span class="dv">2</span>], <span class="dv">4</span>), <span class="st">&quot;]</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 95% CI: [ 0.813 , 0.9923 ]</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="integral-population-models.html#cb325-1" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb325-2"><a href="integral-population-models.html#cb325-2" tabindex="-1"></a><span class="co"># VISUALIZE RESULTS</span></span>
<span id="cb325-3"><a href="integral-population-models.html#cb325-3" tabindex="-1"></a><span class="co">#--------------------------------</span></span>
<span id="cb325-4"><a href="integral-population-models.html#cb325-4" tabindex="-1"></a></span>
<span id="cb325-5"><a href="integral-population-models.html#cb325-5" tabindex="-1"></a><span class="co"># Lambda distribution</span></span>
<span id="cb325-6"><a href="integral-population-models.html#cb325-6" tabindex="-1"></a>lambda_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">lambda =</span> all_lambdas), <span class="fu">aes</span>(<span class="at">x =</span> lambda)) <span class="sc">+</span></span>
<span id="cb325-7"><a href="integral-population-models.html#cb325-7" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb325-8"><a href="integral-population-models.html#cb325-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lambda_obs, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-9"><a href="integral-population-models.html#cb325-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lambda_ci[<span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-10"><a href="integral-population-models.html#cb325-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lambda_ci[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-11"><a href="integral-population-models.html#cb325-11" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb325-12"><a href="integral-population-models.html#cb325-12" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Bootstrap Distribution of λ&quot;</span>,</span>
<span id="cb325-13"><a href="integral-population-models.html#cb325-13" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;n = &quot;</span>, valid_iter, <span class="st">&quot; iterations&quot;</span>),</span>
<span id="cb325-14"><a href="integral-population-models.html#cb325-14" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Population growth rate (λ)&quot;</span>,</span>
<span id="cb325-15"><a href="integral-population-models.html#cb325-15" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Frequency&quot;</span></span>
<span id="cb325-16"><a href="integral-population-models.html#cb325-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb325-17"><a href="integral-population-models.html#cb325-17" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> lambda_obs, <span class="at">y =</span> <span class="cn">Inf</span>, </span>
<span id="cb325-18"><a href="integral-population-models.html#cb325-18" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&quot;Observed: &quot;</span>, <span class="fu">round</span>(lambda_obs, <span class="dv">3</span>)),</span>
<span id="cb325-19"><a href="integral-population-models.html#cb325-19" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">fontface =</span> <span class="st">&quot;bold&quot;</span>) <span class="sc">+</span></span>
<span id="cb325-20"><a href="integral-population-models.html#cb325-20" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb325-21"><a href="integral-population-models.html#cb325-21" tabindex="-1"></a></span>
<span id="cb325-22"><a href="integral-population-models.html#cb325-22" tabindex="-1"></a><span class="fu">print</span>(lambda_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-82-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="integral-population-models.html#cb326-1" tabindex="-1"></a><span class="co"># Save plot</span></span>
<span id="cb326-2"><a href="integral-population-models.html#cb326-2" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb326-3"><a href="integral-population-models.html#cb326-3" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_lambda_bootstrap.png&quot;</span>),</span>
<span id="cb326-4"><a href="integral-population-models.html#cb326-4" tabindex="-1"></a>  lambda_plot,</span>
<span id="cb326-5"><a href="integral-population-models.html#cb326-5" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb326-6"><a href="integral-population-models.html#cb326-6" tabindex="-1"></a>)</span>
<span id="cb326-7"><a href="integral-population-models.html#cb326-7" tabindex="-1"></a></span>
<span id="cb326-8"><a href="integral-population-models.html#cb326-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ Bootstrap complete! Lambda plot saved.</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ✓ Bootstrap complete! Lambda plot saved.</code></pre>
<p>Now, let’s look at these results! To better understand the life history strategy underlying the observed population growth rate, we calculated several additional demographic metrics. These included net reproductive rate (R₀; the expected lifetime offspring per individual), generation time (the average interval between generations), and size-specific patterns in reproduction and survival. Together, these metrics paint a fuller picture of how individuals progress through their life cycle and contribute to population dynamics.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="integral-population-models.html#cb328-1" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb328-2"><a href="integral-population-models.html#cb328-2" tabindex="-1"></a><span class="co"># LIFE-HISTORY METRICS FROM A SIZE-STRUCTURED IPM</span></span>
<span id="cb328-3"><a href="integral-population-models.html#cb328-3" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb328-4"><a href="integral-population-models.html#cb328-4" tabindex="-1"></a><span class="fu">library</span>(ipmr)</span>
<span id="cb328-5"><a href="integral-population-models.html#cb328-5" tabindex="-1"></a></span>
<span id="cb328-6"><a href="integral-population-models.html#cb328-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Computing Life-History Metrics ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Computing Life-History Metrics ===</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="integral-population-models.html#cb330-1" tabindex="-1"></a>state_var <span class="ot">&lt;-</span> <span class="st">&quot;sa&quot;</span></span>
<span id="cb330-2"><a href="integral-population-models.html#cb330-2" tabindex="-1"></a></span>
<span id="cb330-3"><a href="integral-population-models.html#cb330-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb330-4"><a href="integral-population-models.html#cb330-4" tabindex="-1"></a><span class="co"># 1. Extract discretized kernels</span></span>
<span id="cb330-5"><a href="integral-population-models.html#cb330-5" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb330-6"><a href="integral-population-models.html#cb330-6" tabindex="-1"></a>Pm <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>P</span>
<span id="cb330-7"><a href="integral-population-models.html#cb330-7" tabindex="-1"></a>Fm <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>F</span>
<span id="cb330-8"><a href="integral-population-models.html#cb330-8" tabindex="-1"></a>K  <span class="ot">&lt;-</span> Pm <span class="sc">+</span> Fm</span>
<span id="cb330-9"><a href="integral-population-models.html#cb330-9" tabindex="-1"></a></span>
<span id="cb330-10"><a href="integral-population-models.html#cb330-10" tabindex="-1"></a>n_mesh <span class="ot">&lt;-</span> <span class="fu">nrow</span>(Pm)</span>
<span id="cb330-11"><a href="integral-population-models.html#cb330-11" tabindex="-1"></a></span>
<span id="cb330-12"><a href="integral-population-models.html#cb330-12" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb330-13"><a href="integral-population-models.html#cb330-13" tabindex="-1"></a><span class="co"># 2. Extract mesh (CORRECTED - get unique values)</span></span>
<span id="cb330-14"><a href="integral-population-models.html#cb330-14" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb330-15"><a href="integral-population-models.html#cb330-15" tabindex="-1"></a></span>
<span id="cb330-16"><a href="integral-population-models.html#cb330-16" tabindex="-1"></a><span class="co"># sa_1 in main_env is the expanded grid (n_mesh × n_mesh values)</span></span>
<span id="cb330-17"><a href="integral-population-models.html#cb330-17" tabindex="-1"></a><span class="co"># We need the unique mesh points</span></span>
<span id="cb330-18"><a href="integral-population-models.html#cb330-18" tabindex="-1"></a>sa_1_full <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;sa_1&quot;</span>, <span class="at">envir =</span> obs_ipm<span class="sc">$</span>env_list<span class="sc">$</span>main_env)</span>
<span id="cb330-19"><a href="integral-population-models.html#cb330-19" tabindex="-1"></a>size_classes <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(sa_1_full)))</span>
<span id="cb330-20"><a href="integral-population-models.html#cb330-20" tabindex="-1"></a></span>
<span id="cb330-21"><a href="integral-population-models.html#cb330-21" tabindex="-1"></a><span class="co"># Verify length</span></span>
<span id="cb330-22"><a href="integral-population-models.html#cb330-22" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(size_classes) <span class="sc">!=</span> n_mesh) {</span>
<span id="cb330-23"><a href="integral-population-models.html#cb330-23" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Mesh length (&quot;</span>, <span class="fu">length</span>(size_classes), <span class="st">&quot;) != kernel dim (&quot;</span>, n_mesh, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb330-24"><a href="integral-population-models.html#cb330-24" tabindex="-1"></a>}</span>
<span id="cb330-25"><a href="integral-population-models.html#cb330-25" tabindex="-1"></a></span>
<span id="cb330-26"><a href="integral-population-models.html#cb330-26" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Extracted mesh from main_env (unique values from sa_1)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Extracted mesh from main_env (unique values from sa_1)</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="integral-population-models.html#cb332-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Original sa_1 length:&quot;</span>, <span class="fu">length</span>(sa_1_full), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Original sa_1 length: 10000</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="integral-population-models.html#cb334-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Unique mesh points:&quot;</span>, n_mesh, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Unique mesh points: 100</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="integral-population-models.html#cb336-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Domain (log):&quot;</span>, <span class="fu">round</span>(<span class="fu">range</span>(size_classes), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Domain (log): 0.027 5.424</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="integral-population-models.html#cb338-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Domain (raw):&quot;</span>, <span class="fu">round</span>(<span class="fu">exp</span>(<span class="fu">range</span>(size_classes)), <span class="dv">2</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Domain (raw): 1.03 226.87 cm</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="integral-population-models.html#cb340-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb340-2"><a href="integral-population-models.html#cb340-2" tabindex="-1"></a><span class="co"># 3. Population growth rate (λ)</span></span>
<span id="cb340-3"><a href="integral-population-models.html#cb340-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb340-4"><a href="integral-population-models.html#cb340-4" tabindex="-1"></a>lambda_obs <span class="ot">&lt;-</span> ipmr<span class="sc">::</span><span class="fu">lambda</span>(obs_ipm)</span>
<span id="cb340-5"><a href="integral-population-models.html#cb340-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ Lambda:&quot;</span>, <span class="fu">round</span>(lambda_obs, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ✓ Lambda: 0.9647</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="integral-population-models.html#cb342-1" tabindex="-1"></a><span class="cf">if</span>(lambda_obs <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb342-2"><a href="integral-population-models.html#cb342-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  → Population GROWING at&quot;</span>, <span class="fu">round</span>((lambda_obs <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&quot;% per year</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb342-3"><a href="integral-population-models.html#cb342-3" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(lambda_obs <span class="sc">&lt;</span> <span class="dv">1</span>) {</span>
<span id="cb342-4"><a href="integral-population-models.html#cb342-4" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  → Population DECLINING at&quot;</span>, <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> lambda_obs) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&quot;% per year</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb342-5"><a href="integral-population-models.html#cb342-5" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb342-6"><a href="integral-population-models.html#cb342-6" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;  → Population STABLE</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb342-7"><a href="integral-population-models.html#cb342-7" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>##   → Population DECLINING at 3.53 % per year</code></pre>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="integral-population-models.html#cb344-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb344-2"><a href="integral-population-models.html#cb344-2" tabindex="-1"></a><span class="co"># 4. Stable size distribution</span></span>
<span id="cb344-3"><a href="integral-population-models.html#cb344-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb344-4"><a href="integral-population-models.html#cb344-4" tabindex="-1"></a>stable_output <span class="ot">&lt;-</span> ipmr<span class="sc">::</span><span class="fu">right_ev</span>(obs_ipm)</span>
<span id="cb344-5"><a href="integral-population-models.html#cb344-5" tabindex="-1"></a></span>
<span id="cb344-6"><a href="integral-population-models.html#cb344-6" tabindex="-1"></a>stable_vec <span class="ot">&lt;-</span> stable_output[[<span class="fu">paste0</span>(state_var, <span class="st">&quot;_w&quot;</span>)]]</span>
<span id="cb344-7"><a href="integral-population-models.html#cb344-7" tabindex="-1"></a>stable_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(stable_vec)</span>
<span id="cb344-8"><a href="integral-population-models.html#cb344-8" tabindex="-1"></a></span>
<span id="cb344-9"><a href="integral-population-models.html#cb344-9" tabindex="-1"></a><span class="co"># Verify length</span></span>
<span id="cb344-10"><a href="integral-population-models.html#cb344-10" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(stable_vec) <span class="sc">!=</span> n_mesh) {</span>
<span id="cb344-11"><a href="integral-population-models.html#cb344-11" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;Stable vector length (&quot;</span>, <span class="fu">length</span>(stable_vec), <span class="st">&quot;) != kernel dim (&quot;</span>, n_mesh, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb344-12"><a href="integral-population-models.html#cb344-12" tabindex="-1"></a>}</span>
<span id="cb344-13"><a href="integral-population-models.html#cb344-13" tabindex="-1"></a></span>
<span id="cb344-14"><a href="integral-population-models.html#cb344-14" tabindex="-1"></a><span class="co"># Normalize (should already be 1)</span></span>
<span id="cb344-15"><a href="integral-population-models.html#cb344-15" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">isTRUE</span>(<span class="fu">all.equal</span>(<span class="fu">sum</span>(stable_vec), <span class="dv">1</span>))) {</span>
<span id="cb344-16"><a href="integral-population-models.html#cb344-16" tabindex="-1"></a>  stable_vec <span class="ot">&lt;-</span> stable_vec <span class="sc">/</span> <span class="fu">sum</span>(stable_vec)</span>
<span id="cb344-17"><a href="integral-population-models.html#cb344-17" tabindex="-1"></a>}</span>
<span id="cb344-18"><a href="integral-population-models.html#cb344-18" tabindex="-1"></a></span>
<span id="cb344-19"><a href="integral-population-models.html#cb344-19" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Stable distribution extracted (sum =&quot;</span>, <span class="fu">round</span>(<span class="fu">sum</span>(stable_vec), <span class="dv">6</span>), <span class="st">&quot;)</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Stable distribution extracted (sum = 1 )</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="integral-population-models.html#cb346-1" tabindex="-1"></a><span class="co"># Mean size under stable distribution</span></span>
<span id="cb346-2"><a href="integral-population-models.html#cb346-2" tabindex="-1"></a>mean_size_stable_log <span class="ot">&lt;-</span> <span class="fu">sum</span>(size_classes <span class="sc">*</span> stable_vec)</span>
<span id="cb346-3"><a href="integral-population-models.html#cb346-3" tabindex="-1"></a>mean_size_stable_raw <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean_size_stable_log)</span>
<span id="cb346-4"><a href="integral-population-models.html#cb346-4" tabindex="-1"></a></span>
<span id="cb346-5"><a href="integral-population-models.html#cb346-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean size (log):&quot;</span>, <span class="fu">round</span>(mean_size_stable_log, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean size (log): 0.213</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="integral-population-models.html#cb348-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean size (raw):&quot;</span>, <span class="fu">round</span>(mean_size_stable_raw, <span class="dv">2</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean size (raw): 1.24 cm</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="integral-population-models.html#cb350-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb350-2"><a href="integral-population-models.html#cb350-2" tabindex="-1"></a><span class="co"># 5. Reproductive value</span></span>
<span id="cb350-3"><a href="integral-population-models.html#cb350-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb350-4"><a href="integral-population-models.html#cb350-4" tabindex="-1"></a>rv_output <span class="ot">&lt;-</span> ipmr<span class="sc">::</span><span class="fu">left_ev</span>(obs_ipm)</span>
<span id="cb350-5"><a href="integral-population-models.html#cb350-5" tabindex="-1"></a></span>
<span id="cb350-6"><a href="integral-population-models.html#cb350-6" tabindex="-1"></a><span class="co"># Try with suffix first, fallback to first element</span></span>
<span id="cb350-7"><a href="integral-population-models.html#cb350-7" tabindex="-1"></a>rv_vec <span class="ot">&lt;-</span> rv_output[[<span class="fu">paste0</span>(state_var, <span class="st">&quot;_w&quot;</span>)]]</span>
<span id="cb350-8"><a href="integral-population-models.html#cb350-8" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(rv_vec)) rv_vec <span class="ot">&lt;-</span> rv_output[[<span class="dv">1</span>]]</span>
<span id="cb350-9"><a href="integral-population-models.html#cb350-9" tabindex="-1"></a></span>
<span id="cb350-10"><a href="integral-population-models.html#cb350-10" tabindex="-1"></a>rv_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rv_vec)</span>
<span id="cb350-11"><a href="integral-population-models.html#cb350-11" tabindex="-1"></a></span>
<span id="cb350-12"><a href="integral-population-models.html#cb350-12" tabindex="-1"></a><span class="co"># Verify length</span></span>
<span id="cb350-13"><a href="integral-population-models.html#cb350-13" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(rv_vec) <span class="sc">!=</span> n_mesh) {</span>
<span id="cb350-14"><a href="integral-population-models.html#cb350-14" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">&quot;RV vector length (&quot;</span>, <span class="fu">length</span>(rv_vec), <span class="st">&quot;) != kernel dim (&quot;</span>, n_mesh, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb350-15"><a href="integral-population-models.html#cb350-15" tabindex="-1"></a>}</span>
<span id="cb350-16"><a href="integral-population-models.html#cb350-16" tabindex="-1"></a></span>
<span id="cb350-17"><a href="integral-population-models.html#cb350-17" tabindex="-1"></a><span class="co"># Scale to max = 1</span></span>
<span id="cb350-18"><a href="integral-population-models.html#cb350-18" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">max</span>(rv_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb350-19"><a href="integral-population-models.html#cb350-19" tabindex="-1"></a>  rv_vec <span class="ot">&lt;-</span> rv_vec <span class="sc">/</span> <span class="fu">max</span>(rv_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb350-20"><a href="integral-population-models.html#cb350-20" tabindex="-1"></a>}</span>
<span id="cb350-21"><a href="integral-population-models.html#cb350-21" tabindex="-1"></a></span>
<span id="cb350-22"><a href="integral-population-models.html#cb350-22" tabindex="-1"></a>max_rv <span class="ot">&lt;-</span> <span class="fu">max</span>(rv_vec, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb350-23"><a href="integral-population-models.html#cb350-23" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Max reproductive value:&quot;</span>, <span class="fu">round</span>(max_rv, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Max reproductive value: 1</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="integral-population-models.html#cb352-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb352-2"><a href="integral-population-models.html#cb352-2" tabindex="-1"></a><span class="co"># 6. Size-specific reproduction</span></span>
<span id="cb352-3"><a href="integral-population-models.html#cb352-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb352-4"><a href="integral-population-models.html#cb352-4" tabindex="-1"></a>size_specific_repro <span class="ot">&lt;-</span> <span class="fu">colSums</span>(Fm)</span>
<span id="cb352-5"><a href="integral-population-models.html#cb352-5" tabindex="-1"></a></span>
<span id="cb352-6"><a href="integral-population-models.html#cb352-6" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">sum</span>(size_specific_repro) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb352-7"><a href="integral-population-models.html#cb352-7" tabindex="-1"></a>  mean_rep_obs_log <span class="ot">&lt;-</span> <span class="fu">sum</span>(size_classes <span class="sc">*</span> size_specific_repro) <span class="sc">/</span> <span class="fu">sum</span>(size_specific_repro)</span>
<span id="cb352-8"><a href="integral-population-models.html#cb352-8" tabindex="-1"></a>  mean_rep_obs_raw <span class="ot">&lt;-</span> <span class="fu">exp</span>(mean_rep_obs_log)</span>
<span id="cb352-9"><a href="integral-population-models.html#cb352-9" tabindex="-1"></a>  var_rep_obs_log  <span class="ot">&lt;-</span> <span class="fu">sum</span>((size_classes <span class="sc">-</span> mean_rep_obs_log)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> size_specific_repro) <span class="sc">/</span> </span>
<span id="cb352-10"><a href="integral-population-models.html#cb352-10" tabindex="-1"></a>                      <span class="fu">sum</span>(size_specific_repro)</span>
<span id="cb352-11"><a href="integral-population-models.html#cb352-11" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb352-12"><a href="integral-population-models.html#cb352-12" tabindex="-1"></a>  mean_rep_obs_log <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb352-13"><a href="integral-population-models.html#cb352-13" tabindex="-1"></a>  mean_rep_obs_raw <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb352-14"><a href="integral-population-models.html#cb352-14" tabindex="-1"></a>  var_rep_obs_log  <span class="ot">&lt;-</span> <span class="cn">NA_real_</span></span>
<span id="cb352-15"><a href="integral-population-models.html#cb352-15" tabindex="-1"></a>}</span>
<span id="cb352-16"><a href="integral-population-models.html#cb352-16" tabindex="-1"></a></span>
<span id="cb352-17"><a href="integral-population-models.html#cb352-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Mean reproductive size (log):&quot;</span>, <span class="fu">round</span>(mean_rep_obs_log, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Mean reproductive size (log): 4.783</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="integral-population-models.html#cb354-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Mean reproductive size (raw):&quot;</span>, <span class="fu">round</span>(mean_rep_obs_raw, <span class="dv">2</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Mean reproductive size (raw): 119.47 cm</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="integral-population-models.html#cb356-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb356-2"><a href="integral-population-models.html#cb356-2" tabindex="-1"></a><span class="co"># 7. Expected remaining lifetime by size</span></span>
<span id="cb356-3"><a href="integral-population-models.html#cb356-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb356-4"><a href="integral-population-models.html#cb356-4" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== Computing Expected Remaining Lifetime ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === Computing Expected Remaining Lifetime ===</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="integral-population-models.html#cb358-1" tabindex="-1"></a><span class="co"># Check P eigenvalue</span></span>
<span id="cb358-2"><a href="integral-population-models.html#cb358-2" tabindex="-1"></a>P_eigs <span class="ot">&lt;-</span> <span class="fu">eigen</span>(Pm)<span class="sc">$</span>values</span>
<span id="cb358-3"><a href="integral-population-models.html#cb358-3" tabindex="-1"></a>P_lambda <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">Re</span>(P_eigs))</span>
<span id="cb358-4"><a href="integral-population-models.html#cb358-4" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;P kernel eigenvalue:&quot;</span>, <span class="fu">round</span>(P_lambda, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## P kernel eigenvalue: 0.9647</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="integral-population-models.html#cb360-1" tabindex="-1"></a><span class="cf">if</span>(P_lambda <span class="sc">&gt;=</span> <span class="fl">0.99</span>) {</span>
<span id="cb360-2"><a href="integral-population-models.html#cb360-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;⚠️  High P eigenvalue (&gt;0.99) - expected lifetimes may be very long</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb360-3"><a href="integral-population-models.html#cb360-3" tabindex="-1"></a>}</span>
<span id="cb360-4"><a href="integral-population-models.html#cb360-4" tabindex="-1"></a></span>
<span id="cb360-5"><a href="integral-population-models.html#cb360-5" tabindex="-1"></a>expected_remaining_life <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_mesh)</span>
<span id="cb360-6"><a href="integral-population-models.html#cb360-6" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, n_mesh)</span>
<span id="cb360-7"><a href="integral-population-models.html#cb360-7" tabindex="-1"></a></span>
<span id="cb360-8"><a href="integral-population-models.html#cb360-8" tabindex="-1"></a>tol <span class="ot">&lt;-</span> <span class="fl">1e-8</span></span>
<span id="cb360-9"><a href="integral-population-models.html#cb360-9" tabindex="-1"></a>max_iter <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb360-10"><a href="integral-population-models.html#cb360-10" tabindex="-1"></a>converged <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb360-11"><a href="integral-population-models.html#cb360-11" tabindex="-1"></a></span>
<span id="cb360-12"><a href="integral-population-models.html#cb360-12" tabindex="-1"></a><span class="cf">for</span>(iter <span class="cf">in</span> <span class="fu">seq_len</span>(max_iter)) {</span>
<span id="cb360-13"><a href="integral-population-models.html#cb360-13" tabindex="-1"></a>  expected_remaining_life <span class="ot">&lt;-</span> expected_remaining_life <span class="sc">+</span> v</span>
<span id="cb360-14"><a href="integral-population-models.html#cb360-14" tabindex="-1"></a>  v_new <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Pm <span class="sc">%*%</span> v)</span>
<span id="cb360-15"><a href="integral-population-models.html#cb360-15" tabindex="-1"></a></span>
<span id="cb360-16"><a href="integral-population-models.html#cb360-16" tabindex="-1"></a>  diff <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">abs</span>(v_new <span class="sc">-</span> v), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb360-17"><a href="integral-population-models.html#cb360-17" tabindex="-1"></a>  </span>
<span id="cb360-18"><a href="integral-population-models.html#cb360-18" tabindex="-1"></a>  <span class="cf">if</span>(diff <span class="sc">&lt;</span> tol) {</span>
<span id="cb360-19"><a href="integral-population-models.html#cb360-19" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;✓ Converged after&quot;</span>, iter, <span class="st">&quot;iterations</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb360-20"><a href="integral-population-models.html#cb360-20" tabindex="-1"></a>    converged <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb360-21"><a href="integral-population-models.html#cb360-21" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb360-22"><a href="integral-population-models.html#cb360-22" tabindex="-1"></a>  }</span>
<span id="cb360-23"><a href="integral-population-models.html#cb360-23" tabindex="-1"></a></span>
<span id="cb360-24"><a href="integral-population-models.html#cb360-24" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.finite</span>(v_new)) <span class="sc">||</span> <span class="fu">max</span>(v_new) <span class="sc">&gt;</span> <span class="fl">1e6</span>) {</span>
<span id="cb360-25"><a href="integral-population-models.html#cb360-25" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">&quot;⚠️  Lifetime calculation diverging at iteration &quot;</span>, iter)</span>
<span id="cb360-26"><a href="integral-population-models.html#cb360-26" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb360-27"><a href="integral-population-models.html#cb360-27" tabindex="-1"></a>  }</span>
<span id="cb360-28"><a href="integral-population-models.html#cb360-28" tabindex="-1"></a></span>
<span id="cb360-29"><a href="integral-population-models.html#cb360-29" tabindex="-1"></a>  v <span class="ot">&lt;-</span> v_new</span>
<span id="cb360-30"><a href="integral-population-models.html#cb360-30" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## ✓ Converged after 498 iterations</code></pre>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="integral-population-models.html#cb362-1" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>converged) {</span>
<span id="cb362-2"><a href="integral-population-models.html#cb362-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;⚠️  Did not fully converge after&quot;</span>, max_iter, <span class="st">&quot;iterations</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb362-3"><a href="integral-population-models.html#cb362-3" tabindex="-1"></a>}</span>
<span id="cb362-4"><a href="integral-population-models.html#cb362-4" tabindex="-1"></a></span>
<span id="cb362-5"><a href="integral-population-models.html#cb362-5" tabindex="-1"></a>max_life <span class="ot">&lt;-</span> <span class="fu">max</span>(expected_remaining_life)</span>
<span id="cb362-6"><a href="integral-population-models.html#cb362-6" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Max expected lifetime:&quot;</span>, <span class="fu">round</span>(max_life, <span class="dv">2</span>), <span class="st">&quot;time steps</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Max expected lifetime: 402.78 time steps</code></pre>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="integral-population-models.html#cb364-1" tabindex="-1"></a><span class="cf">if</span>(max_life <span class="sc">&gt;</span> <span class="dv">100</span>) {</span>
<span id="cb364-2"><a href="integral-population-models.html#cb364-2" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;⚠️  Very high lifetime (&gt;100 years) - survival model may be overfitting</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb364-3"><a href="integral-population-models.html#cb364-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## ⚠️  Very high lifetime (&gt;100 years) - survival model may be overfitting</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="integral-population-models.html#cb366-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb366-2"><a href="integral-population-models.html#cb366-2" tabindex="-1"></a><span class="co"># 8. Median size (weighted by stable distribution)</span></span>
<span id="cb366-3"><a href="integral-population-models.html#cb366-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb366-4"><a href="integral-population-models.html#cb366-4" tabindex="-1"></a>cumulative_dist <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(stable_vec)</span>
<span id="cb366-5"><a href="integral-population-models.html#cb366-5" tabindex="-1"></a>median_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cumulative_dist <span class="sc">&gt;=</span> <span class="fl">0.5</span>)[<span class="dv">1</span>]</span>
<span id="cb366-6"><a href="integral-population-models.html#cb366-6" tabindex="-1"></a></span>
<span id="cb366-7"><a href="integral-population-models.html#cb366-7" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.na</span>(median_index)) {</span>
<span id="cb366-8"><a href="integral-population-models.html#cb366-8" tabindex="-1"></a>  median_index <span class="ot">&lt;-</span> <span class="fu">floor</span>(n_mesh <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb366-9"><a href="integral-population-models.html#cb366-9" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;⚠️  Could not find weighted median, using middle bin</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb366-10"><a href="integral-population-models.html#cb366-10" tabindex="-1"></a>}</span>
<span id="cb366-11"><a href="integral-population-models.html#cb366-11" tabindex="-1"></a></span>
<span id="cb366-12"><a href="integral-population-models.html#cb366-12" tabindex="-1"></a>median_size_log <span class="ot">&lt;-</span> size_classes[median_index]</span>
<span id="cb366-13"><a href="integral-population-models.html#cb366-13" tabindex="-1"></a>median_size_raw <span class="ot">&lt;-</span> <span class="fu">exp</span>(median_size_log)</span>
<span id="cb366-14"><a href="integral-population-models.html#cb366-14" tabindex="-1"></a>life_exp_median_obs <span class="ot">&lt;-</span> expected_remaining_life[median_index]</span>
<span id="cb366-15"><a href="integral-population-models.html#cb366-15" tabindex="-1"></a></span>
<span id="cb366-16"><a href="integral-population-models.html#cb366-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ Median size (log):&quot;</span>, <span class="fu">round</span>(median_size_log, <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ Median size (log): 0.136</code></pre>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="integral-population-models.html#cb368-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Median size (raw):&quot;</span>, <span class="fu">round</span>(median_size_raw, <span class="dv">2</span>), <span class="st">&quot;cm</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Median size (raw): 1.15 cm</code></pre>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="integral-population-models.html#cb370-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Expected lifetime at median:&quot;</span>, <span class="fu">round</span>(life_exp_median_obs, <span class="dv">2</span>), <span class="st">&quot;time steps</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Expected lifetime at median: 256.59 time steps</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="integral-population-models.html#cb372-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb372-2"><a href="integral-population-models.html#cb372-2" tabindex="-1"></a><span class="co"># 9. Summary table</span></span>
<span id="cb372-3"><a href="integral-population-models.html#cb372-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb372-4"><a href="integral-population-models.html#cb372-4" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb372-5"><a href="integral-population-models.html#cb372-5" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb372-6"><a href="integral-population-models.html#cb372-6" tabindex="-1"></a>    <span class="st">&quot;Population growth rate (λ)&quot;</span>,</span>
<span id="cb372-7"><a href="integral-population-models.html#cb372-7" tabindex="-1"></a>    <span class="st">&quot;Mean size (stable, log)&quot;</span>,</span>
<span id="cb372-8"><a href="integral-population-models.html#cb372-8" tabindex="-1"></a>    <span class="st">&quot;Mean size (stable, cm)&quot;</span>,</span>
<span id="cb372-9"><a href="integral-population-models.html#cb372-9" tabindex="-1"></a>    <span class="st">&quot;Median size (stable, log)&quot;</span>,</span>
<span id="cb372-10"><a href="integral-population-models.html#cb372-10" tabindex="-1"></a>    <span class="st">&quot;Median size (stable, cm)&quot;</span>,</span>
<span id="cb372-11"><a href="integral-population-models.html#cb372-11" tabindex="-1"></a>    <span class="st">&quot;Mean reproductive size (log)&quot;</span>,</span>
<span id="cb372-12"><a href="integral-population-models.html#cb372-12" tabindex="-1"></a>    <span class="st">&quot;Mean reproductive size (cm)&quot;</span>,</span>
<span id="cb372-13"><a href="integral-population-models.html#cb372-13" tabindex="-1"></a>    <span class="st">&quot;Variance reproductive size (log)&quot;</span>,</span>
<span id="cb372-14"><a href="integral-population-models.html#cb372-14" tabindex="-1"></a>    <span class="st">&quot;Expected lifetime at median&quot;</span>,</span>
<span id="cb372-15"><a href="integral-population-models.html#cb372-15" tabindex="-1"></a>    <span class="st">&quot;Max reproductive value&quot;</span></span>
<span id="cb372-16"><a href="integral-population-models.html#cb372-16" tabindex="-1"></a>  ),</span>
<span id="cb372-17"><a href="integral-population-models.html#cb372-17" tabindex="-1"></a>  <span class="at">Estimate =</span> <span class="fu">round</span>(<span class="fu">c</span>(</span>
<span id="cb372-18"><a href="integral-population-models.html#cb372-18" tabindex="-1"></a>    lambda_obs,</span>
<span id="cb372-19"><a href="integral-population-models.html#cb372-19" tabindex="-1"></a>    mean_size_stable_log,</span>
<span id="cb372-20"><a href="integral-population-models.html#cb372-20" tabindex="-1"></a>    mean_size_stable_raw,</span>
<span id="cb372-21"><a href="integral-population-models.html#cb372-21" tabindex="-1"></a>    median_size_log,</span>
<span id="cb372-22"><a href="integral-population-models.html#cb372-22" tabindex="-1"></a>    median_size_raw,</span>
<span id="cb372-23"><a href="integral-population-models.html#cb372-23" tabindex="-1"></a>    mean_rep_obs_log,</span>
<span id="cb372-24"><a href="integral-population-models.html#cb372-24" tabindex="-1"></a>    mean_rep_obs_raw,</span>
<span id="cb372-25"><a href="integral-population-models.html#cb372-25" tabindex="-1"></a>    var_rep_obs_log,</span>
<span id="cb372-26"><a href="integral-population-models.html#cb372-26" tabindex="-1"></a>    life_exp_median_obs,</span>
<span id="cb372-27"><a href="integral-population-models.html#cb372-27" tabindex="-1"></a>    max_rv</span>
<span id="cb372-28"><a href="integral-population-models.html#cb372-28" tabindex="-1"></a>  ), <span class="dv">4</span>)</span>
<span id="cb372-29"><a href="integral-population-models.html#cb372-29" tabindex="-1"></a>)</span>
<span id="cb372-30"><a href="integral-population-models.html#cb372-30" tabindex="-1"></a></span>
<span id="cb372-31"><a href="integral-population-models.html#cb372-31" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">=== LIFE-HISTORY SUMMARY ===</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## === LIFE-HISTORY SUMMARY ===</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="integral-population-models.html#cb374-1" tabindex="-1"></a><span class="fu">print</span>(summary_table, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##                            Metric Estimate
##        Population growth rate (λ)   0.9647
##           Mean size (stable, log)   0.2125
##            Mean size (stable, cm)   1.2368
##         Median size (stable, log)   0.1363
##          Median size (stable, cm)   1.1460
##      Mean reproductive size (log)   4.7830
##       Mean reproductive size (cm) 119.4663
##  Variance reproductive size (log)   0.0700
##       Expected lifetime at median 256.5872
##            Max reproductive value   1.0000</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="integral-population-models.html#cb376-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb376-2"><a href="integral-population-models.html#cb376-2" tabindex="-1"></a><span class="co"># 10. Visualizations</span></span>
<span id="cb376-3"><a href="integral-population-models.html#cb376-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb376-4"><a href="integral-population-models.html#cb376-4" tabindex="-1"></a></span>
<span id="cb376-5"><a href="integral-population-models.html#cb376-5" tabindex="-1"></a><span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_life_history.png&quot;</span>),</span>
<span id="cb376-6"><a href="integral-population-models.html#cb376-6" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">10</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb376-7"><a href="integral-population-models.html#cb376-7" tabindex="-1"></a></span>
<span id="cb376-8"><a href="integral-population-models.html#cb376-8" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>, <span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb376-9"><a href="integral-population-models.html#cb376-9" tabindex="-1"></a></span>
<span id="cb376-10"><a href="integral-population-models.html#cb376-10" tabindex="-1"></a><span class="co"># Plot 1: Expected lifetime vs log size</span></span>
<span id="cb376-11"><a href="integral-population-models.html#cb376-11" tabindex="-1"></a><span class="fu">plot</span>(size_classes, expected_remaining_life, </span>
<span id="cb376-12"><a href="integral-population-models.html#cb376-12" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb376-13"><a href="integral-population-models.html#cb376-13" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Size (log scale)&quot;</span>, </span>
<span id="cb376-14"><a href="integral-population-models.html#cb376-14" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Expected remaining lifetime (years)&quot;</span>,</span>
<span id="cb376-15"><a href="integral-population-models.html#cb376-15" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;A. Expected Lifetime by Size (Log)&quot;</span>,</span>
<span id="cb376-16"><a href="integral-population-models.html#cb376-16" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.main =</span> <span class="fl">1.3</span>)</span>
<span id="cb376-17"><a href="integral-population-models.html#cb376-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> median_size_log, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-18"><a href="integral-population-models.html#cb376-18" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mean_size_stable_log, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-19"><a href="integral-population-models.html#cb376-19" tabindex="-1"></a><span class="fu">text</span>(median_size_log, <span class="fu">max</span>(expected_remaining_life) <span class="sc">*</span> <span class="fl">0.9</span>,</span>
<span id="cb376-20"><a href="integral-population-models.html#cb376-20" tabindex="-1"></a>     <span class="fu">paste0</span>(<span class="st">&quot;Median</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">round</span>(life_exp_median_obs, <span class="dv">1</span>), <span class="st">&quot; yr&quot;</span>),</span>
<span id="cb376-21"><a href="integral-population-models.html#cb376-21" tabindex="-1"></a>     <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">font =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.9</span>)</span>
<span id="cb376-22"><a href="integral-population-models.html#cb376-22" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, </span>
<span id="cb376-23"><a href="integral-population-models.html#cb376-23" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Median&quot;</span>, <span class="st">&quot;Mean&quot;</span>),</span>
<span id="cb376-24"><a href="integral-population-models.html#cb376-24" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb376-25"><a href="integral-population-models.html#cb376-25" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb376-26"><a href="integral-population-models.html#cb376-26" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb376-27"><a href="integral-population-models.html#cb376-27" tabindex="-1"></a></span>
<span id="cb376-28"><a href="integral-population-models.html#cb376-28" tabindex="-1"></a><span class="co"># Plot 2: Expected lifetime vs raw size</span></span>
<span id="cb376-29"><a href="integral-population-models.html#cb376-29" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">exp</span>(size_classes), expected_remaining_life, </span>
<span id="cb376-30"><a href="integral-population-models.html#cb376-30" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb376-31"><a href="integral-population-models.html#cb376-31" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Size (cm)&quot;</span>, </span>
<span id="cb376-32"><a href="integral-population-models.html#cb376-32" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Expected remaining lifetime (years)&quot;</span>,</span>
<span id="cb376-33"><a href="integral-population-models.html#cb376-33" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;B. Expected Lifetime by Size (Raw)&quot;</span>,</span>
<span id="cb376-34"><a href="integral-population-models.html#cb376-34" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.main =</span> <span class="fl">1.3</span>)</span>
<span id="cb376-35"><a href="integral-population-models.html#cb376-35" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> median_size_raw, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-36"><a href="integral-population-models.html#cb376-36" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mean_size_stable_raw, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-37"><a href="integral-population-models.html#cb376-37" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, </span>
<span id="cb376-38"><a href="integral-population-models.html#cb376-38" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Median&quot;</span>, <span class="st">&quot;Mean&quot;</span>),</span>
<span id="cb376-39"><a href="integral-population-models.html#cb376-39" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb376-40"><a href="integral-population-models.html#cb376-40" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb376-41"><a href="integral-population-models.html#cb376-41" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb376-42"><a href="integral-population-models.html#cb376-42" tabindex="-1"></a></span>
<span id="cb376-43"><a href="integral-population-models.html#cb376-43" tabindex="-1"></a><span class="co"># Plot 3: Stable size distribution</span></span>
<span id="cb376-44"><a href="integral-population-models.html#cb376-44" tabindex="-1"></a><span class="fu">plot</span>(size_classes, stable_vec, </span>
<span id="cb376-45"><a href="integral-population-models.html#cb376-45" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>,</span>
<span id="cb376-46"><a href="integral-population-models.html#cb376-46" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Size (log scale)&quot;</span>, </span>
<span id="cb376-47"><a href="integral-population-models.html#cb376-47" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Proportion&quot;</span>,</span>
<span id="cb376-48"><a href="integral-population-models.html#cb376-48" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;C. Stable Size Distribution&quot;</span>,</span>
<span id="cb376-49"><a href="integral-population-models.html#cb376-49" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.main =</span> <span class="fl">1.3</span>)</span>
<span id="cb376-50"><a href="integral-population-models.html#cb376-50" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> median_size_log, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-51"><a href="integral-population-models.html#cb376-51" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> mean_size_stable_log, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb376-52"><a href="integral-population-models.html#cb376-52" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, </span>
<span id="cb376-53"><a href="integral-population-models.html#cb376-53" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Median&quot;</span>, <span class="st">&quot;Mean&quot;</span>),</span>
<span id="cb376-54"><a href="integral-population-models.html#cb376-54" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;green&quot;</span>),</span>
<span id="cb376-55"><a href="integral-population-models.html#cb376-55" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span>
<span id="cb376-56"><a href="integral-population-models.html#cb376-56" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb376-57"><a href="integral-population-models.html#cb376-57" tabindex="-1"></a></span>
<span id="cb376-58"><a href="integral-population-models.html#cb376-58" tabindex="-1"></a><span class="co"># Plot 4: Reproductive value</span></span>
<span id="cb376-59"><a href="integral-population-models.html#cb376-59" tabindex="-1"></a><span class="fu">plot</span>(size_classes, rv_vec, </span>
<span id="cb376-60"><a href="integral-population-models.html#cb376-60" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb376-61"><a href="integral-population-models.html#cb376-61" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Size (log scale)&quot;</span>, </span>
<span id="cb376-62"><a href="integral-population-models.html#cb376-62" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Reproductive value (scaled)&quot;</span>,</span>
<span id="cb376-63"><a href="integral-population-models.html#cb376-63" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;D. Reproductive Value by Size&quot;</span>,</span>
<span id="cb376-64"><a href="integral-population-models.html#cb376-64" tabindex="-1"></a>     <span class="at">cex.lab =</span> <span class="fl">1.2</span>, <span class="at">cex.main =</span> <span class="fl">1.3</span>)</span>
<span id="cb376-65"><a href="integral-population-models.html#cb376-65" tabindex="-1"></a><span class="fu">grid</span>()</span>
<span id="cb376-66"><a href="integral-population-models.html#cb376-66" tabindex="-1"></a></span>
<span id="cb376-67"><a href="integral-population-models.html#cb376-67" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="integral-population-models.html#cb378-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb378-2"><a href="integral-population-models.html#cb378-2" tabindex="-1"></a></span>
<span id="cb378-3"><a href="integral-population-models.html#cb378-3" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">✓ Figure saved!</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ✓ Figure saved!</code></pre>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="integral-population-models.html#cb380-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb380-2"><a href="integral-population-models.html#cb380-2" tabindex="-1"></a><span class="co"># 11. Export results</span></span>
<span id="cb380-3"><a href="integral-population-models.html#cb380-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb380-4"><a href="integral-population-models.html#cb380-4" tabindex="-1"></a></span>
<span id="cb380-5"><a href="integral-population-models.html#cb380-5" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb380-6"><a href="integral-population-models.html#cb380-6" tabindex="-1"></a>  summary_table,</span>
<span id="cb380-7"><a href="integral-population-models.html#cb380-7" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_life_history.csv&quot;</span>),</span>
<span id="cb380-8"><a href="integral-population-models.html#cb380-8" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb380-9"><a href="integral-population-models.html#cb380-9" tabindex="-1"></a>)</span>
<span id="cb380-10"><a href="integral-population-models.html#cb380-10" tabindex="-1"></a></span>
<span id="cb380-11"><a href="integral-population-models.html#cb380-11" tabindex="-1"></a>life_exp_detailed <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb380-12"><a href="integral-population-models.html#cb380-12" tabindex="-1"></a>  <span class="at">size_log =</span> size_classes,</span>
<span id="cb380-13"><a href="integral-population-models.html#cb380-13" tabindex="-1"></a>  <span class="at">size_raw_cm =</span> <span class="fu">exp</span>(size_classes),</span>
<span id="cb380-14"><a href="integral-population-models.html#cb380-14" tabindex="-1"></a>  <span class="at">expected_remaining_lifetime =</span> expected_remaining_life,</span>
<span id="cb380-15"><a href="integral-population-models.html#cb380-15" tabindex="-1"></a>  <span class="at">stable_distribution =</span> stable_vec,</span>
<span id="cb380-16"><a href="integral-population-models.html#cb380-16" tabindex="-1"></a>  <span class="at">reproductive_value =</span> rv_vec</span>
<span id="cb380-17"><a href="integral-population-models.html#cb380-17" tabindex="-1"></a>)</span>
<span id="cb380-18"><a href="integral-population-models.html#cb380-18" tabindex="-1"></a></span>
<span id="cb380-19"><a href="integral-population-models.html#cb380-19" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb380-20"><a href="integral-population-models.html#cb380-20" tabindex="-1"></a>  life_exp_detailed,</span>
<span id="cb380-21"><a href="integral-population-models.html#cb380-21" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_size_specific_metrics.csv&quot;</span>),</span>
<span id="cb380-22"><a href="integral-population-models.html#cb380-22" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb380-23"><a href="integral-population-models.html#cb380-23" tabindex="-1"></a>)</span>
<span id="cb380-24"><a href="integral-population-models.html#cb380-24" tabindex="-1"></a></span>
<span id="cb380-25"><a href="integral-population-models.html#cb380-25" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;✓ All results exported successfully!</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## ✓ All results exported successfully!</code></pre>
<p>Interesting! This figure is showing us size-dependent survival and its consequences for expected remaining lifetime in a size-structured Integral Projection Model (IPM). Each point shows the observed survival outcome (0 = died, 1 = survived) for an individual as a function of size at time t. Survival probability is high for small individuals but declines markedly at larger sizes, indicating that large individuals experience elevated mortality risk. This non-monotonic survival–size relationship directly shapes the expected remaining lifetime (ERL) curve derived from the IPM. Individuals at small sizes have long expected remaining lifetimes because they persist with high survival across multiple time steps, even if growth is slow. In contrast, individuals at larger sizes exhibit short expected remaining lifetimes, reflecting increased mortality once large size is reached. The dashed vertical line indicates the median size class, at which survival is approximately 50%, yielding an ERL near one time step. This pattern illustrates that, in size-structured populations, longevity is not necessarily associated with large size; instead, long expected lifetimes can arise from prolonged persistence at small sizes. The IPM faithfully translates this empirically observed survival–size relationship into emergent demographic properties, rather than imposing assumptions about monotonic size–survival relationships.</p>
<p>Now, let’s calculate transient dynamics! We have to use the original size distribution, and walk through an individual time step (rather than run to asymptotic population growth / stable size distribution).</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="integral-population-models.html#cb382-1" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb382-2"><a href="integral-population-models.html#cb382-2" tabindex="-1"></a><span class="co"># TRANSIENT DYNAMICS (LOG-SCALE STATE VARIABLE)</span></span>
<span id="cb382-3"><a href="integral-population-models.html#cb382-3" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb382-4"><a href="integral-population-models.html#cb382-4" tabindex="-1"></a><span class="fu">library</span>(ipmr)</span>
<span id="cb382-5"><a href="integral-population-models.html#cb382-5" tabindex="-1"></a></span>
<span id="cb382-6"><a href="integral-population-models.html#cb382-6" tabindex="-1"></a> <span class="co">#--------------------------------------------------------------</span></span>
<span id="cb382-7"><a href="integral-population-models.html#cb382-7" tabindex="-1"></a><span class="co"># 1) Extract mesh + kernels (ROBUST to ipmr storage details)</span></span>
<span id="cb382-8"><a href="integral-population-models.html#cb382-8" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb382-9"><a href="integral-population-models.html#cb382-9" tabindex="-1"></a></span>
<span id="cb382-10"><a href="integral-population-models.html#cb382-10" tabindex="-1"></a>P <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>P</span>
<span id="cb382-11"><a href="integral-population-models.html#cb382-11" tabindex="-1"></a>F <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>F</span>
<span id="cb382-12"><a href="integral-population-models.html#cb382-12" tabindex="-1"></a>K <span class="ot">&lt;-</span> P <span class="sc">+</span> F</span>
<span id="cb382-13"><a href="integral-population-models.html#cb382-13" tabindex="-1"></a></span>
<span id="cb382-14"><a href="integral-population-models.html#cb382-14" tabindex="-1"></a><span class="co"># The discretized matrix dimension is the truth</span></span>
<span id="cb382-15"><a href="integral-population-models.html#cb382-15" tabindex="-1"></a>n_mesh <span class="ot">&lt;-</span> <span class="fu">nrow</span>(K)</span>
<span id="cb382-16"><a href="integral-population-models.html#cb382-16" tabindex="-1"></a></span>
<span id="cb382-17"><a href="integral-population-models.html#cb382-17" tabindex="-1"></a><span class="co"># ---- Try to recover the mesh points in a way that matches K ----</span></span>
<span id="cb382-18"><a href="integral-population-models.html#cb382-18" tabindex="-1"></a><span class="co"># 1) Best case: row/col names are the mesh points</span></span>
<span id="cb382-19"><a href="integral-population-models.html#cb382-19" tabindex="-1"></a>size_classes <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(K)))</span>
<span id="cb382-20"><a href="integral-population-models.html#cb382-20" tabindex="-1"></a></span>
<span id="cb382-21"><a href="integral-population-models.html#cb382-21" tabindex="-1"></a><span class="co"># 2) If rownames aren&#39;t numeric, try colnames</span></span>
<span id="cb382-22"><a href="integral-population-models.html#cb382-22" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(size_classes) <span class="sc">!=</span> n_mesh <span class="sc">||</span> <span class="fu">anyNA</span>(size_classes)) {</span>
<span id="cb382-23"><a href="integral-population-models.html#cb382-23" tabindex="-1"></a>  size_classes <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(<span class="fu">as.numeric</span>(<span class="fu">colnames</span>(K)))</span>
<span id="cb382-24"><a href="integral-population-models.html#cb382-24" tabindex="-1"></a>}</span>
<span id="cb382-25"><a href="integral-population-models.html#cb382-25" tabindex="-1"></a></span>
<span id="cb382-26"><a href="integral-population-models.html#cb382-26" tabindex="-1"></a><span class="co"># 3) If still not valid, pull from ipmr environment (sa_1)</span></span>
<span id="cb382-27"><a href="integral-population-models.html#cb382-27" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(size_classes) <span class="sc">!=</span> n_mesh <span class="sc">||</span> <span class="fu">anyNA</span>(size_classes)) {</span>
<span id="cb382-28"><a href="integral-population-models.html#cb382-28" tabindex="-1"></a>  size_classes <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb382-29"><a href="integral-population-models.html#cb382-29" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(obs_ipm<span class="sc">$</span>env_list<span class="sc">$</span>main_env) <span class="sc">&amp;&amp;</span></span>
<span id="cb382-30"><a href="integral-population-models.html#cb382-30" tabindex="-1"></a>      <span class="fu">exists</span>(<span class="st">&quot;sa_1&quot;</span>, <span class="at">envir =</span> obs_ipm<span class="sc">$</span>env_list<span class="sc">$</span>main_env, <span class="at">inherits =</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb382-31"><a href="integral-population-models.html#cb382-31" tabindex="-1"></a>    sa_1_full <span class="ot">&lt;-</span> <span class="fu">get</span>(<span class="st">&quot;sa_1&quot;</span>, <span class="at">envir =</span> obs_ipm<span class="sc">$</span>env_list<span class="sc">$</span>main_env)</span>
<span id="cb382-32"><a href="integral-population-models.html#cb382-32" tabindex="-1"></a>    cand <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(sa_1_full)))</span>
<span id="cb382-33"><a href="integral-population-models.html#cb382-33" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(cand) <span class="sc">==</span> n_mesh) size_classes <span class="ot">&lt;-</span> cand</span>
<span id="cb382-34"><a href="integral-population-models.html#cb382-34" tabindex="-1"></a>  }</span>
<span id="cb382-35"><a href="integral-population-models.html#cb382-35" tabindex="-1"></a>}</span>
<span id="cb382-36"><a href="integral-population-models.html#cb382-36" tabindex="-1"></a></span>
<span id="cb382-37"><a href="integral-population-models.html#cb382-37" tabindex="-1"></a><span class="co"># 4) Last resort: reconstruct evenly spaced mesh from your domain bounds L, U</span></span>
<span id="cb382-38"><a href="integral-population-models.html#cb382-38" tabindex="-1"></a><span class="co">#    (works as long as you still have L and U in your workspace)</span></span>
<span id="cb382-39"><a href="integral-population-models.html#cb382-39" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.null</span>(size_classes) <span class="sc">||</span> <span class="fu">length</span>(size_classes) <span class="sc">!=</span> n_mesh <span class="sc">||</span> <span class="fu">anyNA</span>(size_classes)) {</span>
<span id="cb382-40"><a href="integral-population-models.html#cb382-40" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;L&quot;</span>, <span class="at">inherits =</span> <span class="cn">TRUE</span>) <span class="sc">||</span> <span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;U&quot;</span>, <span class="at">inherits =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb382-41"><a href="integral-population-models.html#cb382-41" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Could not recover mesh points. Ensure L and U exist, or that K has rownames/colnames.&quot;</span>)</span>
<span id="cb382-42"><a href="integral-population-models.html#cb382-42" tabindex="-1"></a>  }</span>
<span id="cb382-43"><a href="integral-population-models.html#cb382-43" tabindex="-1"></a>  size_classes <span class="ot">&lt;-</span> <span class="fu">seq</span>(L, U, <span class="at">length.out =</span> n_mesh)</span>
<span id="cb382-44"><a href="integral-population-models.html#cb382-44" tabindex="-1"></a>}</span>
<span id="cb382-45"><a href="integral-population-models.html#cb382-45" tabindex="-1"></a></span>
<span id="cb382-46"><a href="integral-population-models.html#cb382-46" tabindex="-1"></a><span class="co"># Final sanity checks</span></span>
<span id="cb382-47"><a href="integral-population-models.html#cb382-47" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">nrow</span>(K) <span class="sc">==</span> n_mesh, <span class="fu">ncol</span>(K) <span class="sc">==</span> n_mesh, <span class="fu">length</span>(size_classes) <span class="sc">==</span> n_mesh)</span>
<span id="cb382-48"><a href="integral-population-models.html#cb382-48" tabindex="-1"></a></span>
<span id="cb382-49"><a href="integral-population-models.html#cb382-49" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Mesh points:&quot;</span>, n_mesh, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Mesh points: 100</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="integral-population-models.html#cb384-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Domain (log):&quot;</span>, <span class="fu">round</span>(<span class="fu">range</span>(size_classes), <span class="dv">3</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Domain (log): 0.027 5.424</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="integral-population-models.html#cb386-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb386-2"><a href="integral-population-models.html#cb386-2" tabindex="-1"></a><span class="co"># 2) Initial population vector from observed sizes (LOG SCALE)</span></span>
<span id="cb386-3"><a href="integral-population-models.html#cb386-3" tabindex="-1"></a><span class="co">#    IMPORTANT: bins need to match the mesh discretization</span></span>
<span id="cb386-4"><a href="integral-population-models.html#cb386-4" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb386-5"><a href="integral-population-models.html#cb386-5" tabindex="-1"></a>observed_sizes_log <span class="ot">&lt;-</span> final_data<span class="sc">$</span>size_log[<span class="fu">is.finite</span>(final_data<span class="sc">$</span>size_log)]</span>
<span id="cb386-6"><a href="integral-population-models.html#cb386-6" tabindex="-1"></a></span>
<span id="cb386-7"><a href="integral-population-models.html#cb386-7" tabindex="-1"></a><span class="co"># Build bin edges as midpoints between mesh points (plus endpoints)</span></span>
<span id="cb386-8"><a href="integral-population-models.html#cb386-8" tabindex="-1"></a><span class="co"># This aligns a histogram with the discretized state space</span></span>
<span id="cb386-9"><a href="integral-population-models.html#cb386-9" tabindex="-1"></a>edges <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb386-10"><a href="integral-population-models.html#cb386-10" tabindex="-1"></a>  size_classes[<span class="dv">1</span>] <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> (size_classes[<span class="dv">2</span>] <span class="sc">-</span> size_classes[<span class="dv">1</span>]),</span>
<span id="cb386-11"><a href="integral-population-models.html#cb386-11" tabindex="-1"></a>  (size_classes[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> size_classes[<span class="sc">-</span>n_mesh]) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb386-12"><a href="integral-population-models.html#cb386-12" tabindex="-1"></a>  size_classes[n_mesh] <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (size_classes[n_mesh] <span class="sc">-</span> size_classes[n_mesh <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb386-13"><a href="integral-population-models.html#cb386-13" tabindex="-1"></a>)</span>
<span id="cb386-14"><a href="integral-population-models.html#cb386-14" tabindex="-1"></a></span>
<span id="cb386-15"><a href="integral-population-models.html#cb386-15" tabindex="-1"></a>hist_data <span class="ot">&lt;-</span> <span class="fu">hist</span>(observed_sizes_log, <span class="at">breaks =</span> edges, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb386-16"><a href="integral-population-models.html#cb386-16" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(hist_data<span class="sc">$</span>counts)</span>
<span id="cb386-17"><a href="integral-population-models.html#cb386-17" tabindex="-1"></a></span>
<span id="cb386-18"><a href="integral-population-models.html#cb386-18" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">sum</span>(n0) <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">stop</span>(<span class="st">&quot;Initial vector n0 has all zeros (no finite size_log values).&quot;</span>)</span>
<span id="cb386-19"><a href="integral-population-models.html#cb386-19" tabindex="-1"></a></span>
<span id="cb386-20"><a href="integral-population-models.html#cb386-20" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> n0 <span class="sc">/</span> <span class="fu">sum</span>(n0)  <span class="co"># normalize to proportions</span></span>
<span id="cb386-21"><a href="integral-population-models.html#cb386-21" tabindex="-1"></a></span>
<span id="cb386-22"><a href="integral-population-models.html#cb386-22" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;Initial population vector:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## Initial population vector:</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="integral-population-models.html#cb388-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Sum:&quot;</span>, <span class="fu">round</span>(<span class="fu">sum</span>(n0), <span class="dv">6</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Sum: 1</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="integral-population-models.html#cb390-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Non-zero bins:&quot;</span>, <span class="fu">sum</span>(n0 <span class="sc">&gt;</span> <span class="dv">0</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Non-zero bins: 43</code></pre>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="integral-population-models.html#cb392-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb392-2"><a href="integral-population-models.html#cb392-2" tabindex="-1"></a><span class="co"># 3) Asymptotic properties (dominant eigenvalue/eigenvector)</span></span>
<span id="cb392-3"><a href="integral-population-models.html#cb392-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb392-4"><a href="integral-population-models.html#cb392-4" tabindex="-1"></a>eig <span class="ot">&lt;-</span> <span class="fu">eigen</span>(K)</span>
<span id="cb392-5"><a href="integral-population-models.html#cb392-5" tabindex="-1"></a>lambda_asymptotic <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">Re</span>(eig<span class="sc">$</span>values))</span>
<span id="cb392-6"><a href="integral-population-models.html#cb392-6" tabindex="-1"></a>dom_idx <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">Re</span>(eig<span class="sc">$</span>values))</span>
<span id="cb392-7"><a href="integral-population-models.html#cb392-7" tabindex="-1"></a></span>
<span id="cb392-8"><a href="integral-population-models.html#cb392-8" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">Re</span>(eig<span class="sc">$</span>vectors[, dom_idx])</span>
<span id="cb392-9"><a href="integral-population-models.html#cb392-9" tabindex="-1"></a>w[w <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb392-10"><a href="integral-population-models.html#cb392-10" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">sum</span>(w) <span class="sc">&lt;=</span> <span class="dv">0</span>) {</span>
<span id="cb392-11"><a href="integral-population-models.html#cb392-11" tabindex="-1"></a>  <span class="co"># fallback: absolute value then normalize</span></span>
<span id="cb392-12"><a href="integral-population-models.html#cb392-12" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">Re</span>(eig<span class="sc">$</span>vectors[, dom_idx]))</span>
<span id="cb392-13"><a href="integral-population-models.html#cb392-13" tabindex="-1"></a>}</span>
<span id="cb392-14"><a href="integral-population-models.html#cb392-14" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">sum</span>(w)</span>
<span id="cb392-15"><a href="integral-population-models.html#cb392-15" tabindex="-1"></a></span>
<span id="cb392-16"><a href="integral-population-models.html#cb392-16" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Asymptotic lambda:&quot;</span>, <span class="fu">round</span>(lambda_asymptotic, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Asymptotic lambda: 0.9647</code></pre>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="integral-population-models.html#cb394-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb394-2"><a href="integral-population-models.html#cb394-2" tabindex="-1"></a><span class="co"># 4) One-step transient dynamics</span></span>
<span id="cb394-3"><a href="integral-population-models.html#cb394-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb394-4"><a href="integral-population-models.html#cb394-4" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(K <span class="sc">%*%</span> n0)</span>
<span id="cb394-5"><a href="integral-population-models.html#cb394-5" tabindex="-1"></a>lambda_1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(n1) <span class="sc">/</span> <span class="fu">sum</span>(n0)     <span class="co"># since sum(n0)=1, this is just sum(n1)</span></span>
<span id="cb394-6"><a href="integral-population-models.html#cb394-6" tabindex="-1"></a>n1_normalized <span class="ot">&lt;-</span> n1 <span class="sc">/</span> <span class="fu">sum</span>(n1)</span>
<span id="cb394-7"><a href="integral-population-models.html#cb394-7" tabindex="-1"></a></span>
<span id="cb394-8"><a href="integral-population-models.html#cb394-8" tabindex="-1"></a>deviation <span class="ot">&lt;-</span> n1_normalized <span class="sc">-</span> n0</span>
<span id="cb394-9"><a href="integral-population-models.html#cb394-9" tabindex="-1"></a></span>
<span id="cb394-10"><a href="integral-population-models.html#cb394-10" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">One-step dynamics:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## One-step dynamics:</code></pre>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="integral-population-models.html#cb396-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Lambda_1 (from observed n0):&quot;</span>, <span class="fu">round</span>(lambda_1, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Lambda_1 (from observed n0): 4.3125</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="integral-population-models.html#cb398-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Max deviation (|n1 - n0|):&quot;</span>, <span class="fu">round</span>(<span class="fu">max</span>(<span class="fu">abs</span>(deviation)), <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Max deviation (|n1 - n0|): 0.0853</code></pre>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="integral-population-models.html#cb400-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb400-2"><a href="integral-population-models.html#cb400-2" tabindex="-1"></a><span class="co"># 5) Reactivity + inertia</span></span>
<span id="cb400-3"><a href="integral-population-models.html#cb400-3" tabindex="-1"></a><span class="co">#    - &quot;Observed one-step amplification&quot; = lambda_1</span></span>
<span id="cb400-4"><a href="integral-population-models.html#cb400-4" tabindex="-1"></a><span class="co">#    - &quot;Worst-case one-step amplification bound&quot; for total abundance:</span></span>
<span id="cb400-5"><a href="integral-population-models.html#cb400-5" tabindex="-1"></a><span class="co">#         max(colSums(K)) for nonnegative K under L1 norm</span></span>
<span id="cb400-6"><a href="integral-population-models.html#cb400-6" tabindex="-1"></a><span class="co">#    - Inertia: compare total N(t) to lambda^t scaling</span></span>
<span id="cb400-7"><a href="integral-population-models.html#cb400-7" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb400-8"><a href="integral-population-models.html#cb400-8" tabindex="-1"></a><span class="co"># Worst-case one-step amplification (upper bound under L1)</span></span>
<span id="cb400-9"><a href="integral-population-models.html#cb400-9" tabindex="-1"></a>reactivity_bound <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colSums</span>(K))</span>
<span id="cb400-10"><a href="integral-population-models.html#cb400-10" tabindex="-1"></a></span>
<span id="cb400-11"><a href="integral-population-models.html#cb400-11" tabindex="-1"></a><span class="co"># Inertia via repeated multiplication (avoid %^%)</span></span>
<span id="cb400-12"><a href="integral-population-models.html#cb400-12" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">50</span><span class="dt">L</span></span>
<span id="cb400-13"><a href="integral-population-models.html#cb400-13" tabindex="-1"></a>nt <span class="ot">&lt;-</span> n0</span>
<span id="cb400-14"><a href="integral-population-models.html#cb400-14" tabindex="-1"></a><span class="cf">for</span> (tt <span class="cf">in</span> <span class="fu">seq_len</span>(T)) nt <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(K <span class="sc">%*%</span> nt)</span>
<span id="cb400-15"><a href="integral-population-models.html#cb400-15" tabindex="-1"></a></span>
<span id="cb400-16"><a href="integral-population-models.html#cb400-16" tabindex="-1"></a>inertia <span class="ot">&lt;-</span> <span class="fu">sum</span>(nt) <span class="sc">/</span> (lambda_asymptotic<span class="sc">^</span>T <span class="sc">*</span> <span class="fu">sum</span>(n0))</span>
<span id="cb400-17"><a href="integral-population-models.html#cb400-17" tabindex="-1"></a></span>
<span id="cb400-18"><a href="integral-population-models.html#cb400-18" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st">Transient metrics:</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Transient metrics:</code></pre>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="integral-population-models.html#cb402-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Reactivity (observed, 1-step):&quot;</span>, <span class="fu">round</span>(lambda_1, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Reactivity (observed, 1-step): 4.3125</code></pre>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="integral-population-models.html#cb404-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Reactivity (worst-case bound):&quot;</span>, <span class="fu">round</span>(reactivity_bound, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>##   Reactivity (worst-case bound): 10.7317</code></pre>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="integral-population-models.html#cb406-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;  Inertia (T = &quot;</span>, T, <span class="st">&quot;): &quot;</span>, <span class="fu">round</span>(inertia, <span class="dv">4</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>##   Inertia (T = 50): 4.1249</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="integral-population-models.html#cb408-1" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb408-2"><a href="integral-population-models.html#cb408-2" tabindex="-1"></a><span class="co"># 6) Summary table + export</span></span>
<span id="cb408-3"><a href="integral-population-models.html#cb408-3" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb408-4"><a href="integral-population-models.html#cb408-4" tabindex="-1"></a>transient_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb408-5"><a href="integral-population-models.html#cb408-5" tabindex="-1"></a>  <span class="at">Transition          =</span> trans_years,</span>
<span id="cb408-6"><a href="integral-population-models.html#cb408-6" tabindex="-1"></a>  <span class="at">Lambda_1_observed   =</span> <span class="fu">round</span>(lambda_1, <span class="dv">4</span>),</span>
<span id="cb408-7"><a href="integral-population-models.html#cb408-7" tabindex="-1"></a>  <span class="at">Reactivity_bound    =</span> <span class="fu">round</span>(reactivity_bound, <span class="dv">4</span>),</span>
<span id="cb408-8"><a href="integral-population-models.html#cb408-8" tabindex="-1"></a>  <span class="at">Inertia_T50         =</span> <span class="fu">round</span>(inertia, <span class="dv">4</span>),</span>
<span id="cb408-9"><a href="integral-population-models.html#cb408-9" tabindex="-1"></a>  <span class="at">Lambda_asymptotic   =</span> <span class="fu">round</span>(lambda_asymptotic, <span class="dv">4</span>),</span>
<span id="cb408-10"><a href="integral-population-models.html#cb408-10" tabindex="-1"></a>  <span class="at">T_used              =</span> T</span>
<span id="cb408-11"><a href="integral-population-models.html#cb408-11" tabindex="-1"></a>)</span>
<span id="cb408-12"><a href="integral-population-models.html#cb408-12" tabindex="-1"></a></span>
<span id="cb408-13"><a href="integral-population-models.html#cb408-13" tabindex="-1"></a><span class="fu">print</span>(transient_metrics)</span></code></pre></div>
<pre><code>##   Transition Lambda_1_observed Reactivity_bound Inertia_T50 Lambda_asymptotic T_used
## 1   20232024            4.3125          10.7317      4.1249            0.9647     50</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="integral-population-models.html#cb410-1" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;IPM_outputs&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb410-2"><a href="integral-population-models.html#cb410-2" tabindex="-1"></a></span>
<span id="cb410-3"><a href="integral-population-models.html#cb410-3" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb410-4"><a href="integral-population-models.html#cb410-4" tabindex="-1"></a>  transient_metrics,</span>
<span id="cb410-5"><a href="integral-population-models.html#cb410-5" tabindex="-1"></a>  <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_transient_metrics.csv&quot;</span>),</span>
<span id="cb410-6"><a href="integral-population-models.html#cb410-6" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb410-7"><a href="integral-population-models.html#cb410-7" tabindex="-1"></a>)</span>
<span id="cb410-8"><a href="integral-population-models.html#cb410-8" tabindex="-1"></a></span>
<span id="cb410-9"><a href="integral-population-models.html#cb410-9" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb410-10"><a href="integral-population-models.html#cb410-10" tabindex="-1"></a><span class="co"># 7) Visualization: deviation after one step</span></span>
<span id="cb410-11"><a href="integral-population-models.html#cb410-11" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb410-12"><a href="integral-population-models.html#cb410-12" tabindex="-1"></a>deviation_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb410-13"><a href="integral-population-models.html#cb410-13" tabindex="-1"></a>  <span class="at">size_log     =</span> size_classes,</span>
<span id="cb410-14"><a href="integral-population-models.html#cb410-14" tabindex="-1"></a>  <span class="at">size_raw_cm  =</span> <span class="fu">exp</span>(size_classes),</span>
<span id="cb410-15"><a href="integral-population-models.html#cb410-15" tabindex="-1"></a>  <span class="at">deviation    =</span> deviation,</span>
<span id="cb410-16"><a href="integral-population-models.html#cb410-16" tabindex="-1"></a>  <span class="at">initial      =</span> n0,</span>
<span id="cb410-17"><a href="integral-population-models.html#cb410-17" tabindex="-1"></a>  <span class="at">final        =</span> n1_normalized</span>
<span id="cb410-18"><a href="integral-population-models.html#cb410-18" tabindex="-1"></a>)</span>
<span id="cb410-19"><a href="integral-population-models.html#cb410-19" tabindex="-1"></a></span>
<span id="cb410-20"><a href="integral-population-models.html#cb410-20" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb410-21"><a href="integral-population-models.html#cb410-21" tabindex="-1"></a></span>
<span id="cb410-22"><a href="integral-population-models.html#cb410-22" tabindex="-1"></a>p_dev <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(deviation_df, <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> deviation, <span class="at">fill =</span> deviation <span class="sc">&gt;</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb410-23"><a href="integral-population-models.html#cb410-23" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb410-24"><a href="integral-population-models.html#cb410-24" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb410-25"><a href="integral-population-models.html#cb410-25" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;TRUE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#3B82F6&quot;</span>, <span class="st">&quot;FALSE&quot;</span> <span class="ot">=</span> <span class="st">&quot;#EF4444&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb410-26"><a href="integral-population-models.html#cb410-26" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb410-27"><a href="integral-population-models.html#cb410-27" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Deviation from stable size distribution after one time step&quot;</span>,</span>
<span id="cb410-28"><a href="integral-population-models.html#cb410-28" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">&quot;Observed 1-step growth (λ1) = &quot;</span>, <span class="fu">round</span>(lambda_1, <span class="dv">3</span>)),</span>
<span id="cb410-29"><a href="integral-population-models.html#cb410-29" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Size class (log scale)&quot;</span>,</span>
<span id="cb410-30"><a href="integral-population-models.html#cb410-30" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Final − Initial proportion&quot;</span></span>
<span id="cb410-31"><a href="integral-population-models.html#cb410-31" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb410-32"><a href="integral-population-models.html#cb410-32" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>)</span>
<span id="cb410-33"><a href="integral-population-models.html#cb410-33" tabindex="-1"></a></span>
<span id="cb410-34"><a href="integral-population-models.html#cb410-34" tabindex="-1"></a><span class="fu">print</span>(p_dev)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-84-1.png" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="integral-population-models.html#cb411-1" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb411-2"><a href="integral-population-models.html#cb411-2" tabindex="-1"></a>  <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">&quot;IPM_outputs/&quot;</span>, species_name, <span class="st">&quot;_&quot;</span>, trans_years, <span class="st">&quot;_transient_deviation.png&quot;</span>),</span>
<span id="cb411-3"><a href="integral-population-models.html#cb411-3" tabindex="-1"></a>  <span class="at">plot =</span> p_dev, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb411-4"><a href="integral-population-models.html#cb411-4" tabindex="-1"></a>)</span></code></pre></div>
<p>Sensitivity and vital rate calculations</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="integral-population-models.html#cb412-1" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-2"><a href="integral-population-models.html#cb412-2" tabindex="-1"></a><span class="co"># Sensitivity and Elasticity of λ</span></span>
<span id="cb412-3"><a href="integral-population-models.html#cb412-3" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-4"><a href="integral-population-models.html#cb412-4" tabindex="-1"></a><span class="co"># Sensitivity: ∂λ / ∂K_ij</span></span>
<span id="cb412-5"><a href="integral-population-models.html#cb412-5" tabindex="-1"></a><span class="co"># Elasticity: proportional sensitivity = (K_ij / λ) * sensitivity</span></span>
<span id="cb412-6"><a href="integral-population-models.html#cb412-6" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb412-7"><a href="integral-population-models.html#cb412-7" tabindex="-1"></a><span class="co"># Row sums of elasticity:</span></span>
<span id="cb412-8"><a href="integral-population-models.html#cb412-8" tabindex="-1"></a><span class="co">#   Contribution of individuals of a given size at time t</span></span>
<span id="cb412-9"><a href="integral-population-models.html#cb412-9" tabindex="-1"></a><span class="co"># Column sums:</span></span>
<span id="cb412-10"><a href="integral-population-models.html#cb412-10" tabindex="-1"></a><span class="co">#   Contribution of individuals entering a given size at time t+1</span></span>
<span id="cb412-11"><a href="integral-population-models.html#cb412-11" tabindex="-1"></a><span class="co"># Row sums are most commonly interpreted and plotted.</span></span>
<span id="cb412-12"><a href="integral-population-models.html#cb412-12" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-13"><a href="integral-population-models.html#cb412-13" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb412-14"><a href="integral-population-models.html#cb412-14" tabindex="-1"></a><span class="fu">library</span>(ipmr)</span>
<span id="cb412-15"><a href="integral-population-models.html#cb412-15" tabindex="-1"></a></span>
<span id="cb412-16"><a href="integral-population-models.html#cb412-16" tabindex="-1"></a><span class="co"># Combine kernels</span></span>
<span id="cb412-17"><a href="integral-population-models.html#cb412-17" tabindex="-1"></a>K <span class="ot">&lt;-</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>P <span class="sc">+</span> obs_ipm<span class="sc">$</span>sub_kernels<span class="sc">$</span>F</span>
<span id="cb412-18"><a href="integral-population-models.html#cb412-18" tabindex="-1"></a>n_size <span class="ot">&lt;-</span> <span class="fu">nrow</span>(K)</span>
<span id="cb412-19"><a href="integral-population-models.html#cb412-19" tabindex="-1"></a></span>
<span id="cb412-20"><a href="integral-population-models.html#cb412-20" tabindex="-1"></a><span class="co"># Eigen decomposition</span></span>
<span id="cb412-21"><a href="integral-population-models.html#cb412-21" tabindex="-1"></a>eig <span class="ot">&lt;-</span> <span class="fu">eigen</span>(K)</span>
<span id="cb412-22"><a href="integral-population-models.html#cb412-22" tabindex="-1"></a>ord <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">Re</span>(eig<span class="sc">$</span>values), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb412-23"><a href="integral-population-models.html#cb412-23" tabindex="-1"></a></span>
<span id="cb412-24"><a href="integral-population-models.html#cb412-24" tabindex="-1"></a>lambda_dom <span class="ot">&lt;-</span> <span class="fu">Re</span>(eig<span class="sc">$</span>values[ord[<span class="dv">1</span>]])</span>
<span id="cb412-25"><a href="integral-population-models.html#cb412-25" tabindex="-1"></a></span>
<span id="cb412-26"><a href="integral-population-models.html#cb412-26" tabindex="-1"></a><span class="co"># Right eigenvector (stable distribution)</span></span>
<span id="cb412-27"><a href="integral-population-models.html#cb412-27" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">Re</span>(eig<span class="sc">$</span>vectors[, ord[<span class="dv">1</span>]])</span>
<span id="cb412-28"><a href="integral-population-models.html#cb412-28" tabindex="-1"></a>w[w <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb412-29"><a href="integral-population-models.html#cb412-29" tabindex="-1"></a>w <span class="ot">&lt;-</span> w <span class="sc">/</span> <span class="fu">sum</span>(w)</span>
<span id="cb412-30"><a href="integral-population-models.html#cb412-30" tabindex="-1"></a></span>
<span id="cb412-31"><a href="integral-population-models.html#cb412-31" tabindex="-1"></a><span class="co"># Left eigenvector (reproductive value)</span></span>
<span id="cb412-32"><a href="integral-population-models.html#cb412-32" tabindex="-1"></a>eig_left <span class="ot">&lt;-</span> <span class="fu">eigen</span>(<span class="fu">t</span>(K))</span>
<span id="cb412-33"><a href="integral-population-models.html#cb412-33" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">Re</span>(eig_left<span class="sc">$</span>vectors[, ord[<span class="dv">1</span>]])</span>
<span id="cb412-34"><a href="integral-population-models.html#cb412-34" tabindex="-1"></a>v <span class="ot">&lt;-</span> v <span class="sc">/</span> <span class="fu">sum</span>(v <span class="sc">*</span> w)   <span class="co"># normalize so v · w = 1</span></span>
<span id="cb412-35"><a href="integral-population-models.html#cb412-35" tabindex="-1"></a></span>
<span id="cb412-36"><a href="integral-population-models.html#cb412-36" tabindex="-1"></a><span class="co"># Sensitivity and elasticity</span></span>
<span id="cb412-37"><a href="integral-population-models.html#cb412-37" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> <span class="fu">outer</span>(v, w)</span>
<span id="cb412-38"><a href="integral-population-models.html#cb412-38" tabindex="-1"></a>elasticity  <span class="ot">&lt;-</span> (K <span class="sc">/</span> lambda_dom) <span class="sc">*</span> sensitivity</span>
<span id="cb412-39"><a href="integral-population-models.html#cb412-39" tabindex="-1"></a></span>
<span id="cb412-40"><a href="integral-population-models.html#cb412-40" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-41"><a href="integral-population-models.html#cb412-41" tabindex="-1"></a><span class="co"># Prepare plotting data (INDEX-ALIGNED)</span></span>
<span id="cb412-42"><a href="integral-population-models.html#cb412-42" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-43"><a href="integral-population-models.html#cb412-43" tabindex="-1"></a></span>
<span id="cb412-44"><a href="integral-population-models.html#cb412-44" tabindex="-1"></a><span class="co"># Use indices or safe mesh extraction</span></span>
<span id="cb412-45"><a href="integral-population-models.html#cb412-45" tabindex="-1"></a>size_log <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(obs_ipm<span class="sc">$</span>env_list<span class="sc">$</span>main_env<span class="sc">$</span>sa_1)[<span class="fu">seq_len</span>(n_size)]</span>
<span id="cb412-46"><a href="integral-population-models.html#cb412-46" tabindex="-1"></a>size_raw <span class="ot">&lt;-</span> <span class="fu">exp</span>(size_log)</span>
<span id="cb412-47"><a href="integral-population-models.html#cb412-47" tabindex="-1"></a></span>
<span id="cb412-48"><a href="integral-population-models.html#cb412-48" tabindex="-1"></a>sens_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb412-49"><a href="integral-population-models.html#cb412-49" tabindex="-1"></a>  <span class="at">from_size =</span> size_log,</span>
<span id="cb412-50"><a href="integral-population-models.html#cb412-50" tabindex="-1"></a>  <span class="at">to_size   =</span> size_log</span>
<span id="cb412-51"><a href="integral-population-models.html#cb412-51" tabindex="-1"></a>)</span>
<span id="cb412-52"><a href="integral-population-models.html#cb412-52" tabindex="-1"></a>sens_df<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(sensitivity)</span>
<span id="cb412-53"><a href="integral-population-models.html#cb412-53" tabindex="-1"></a></span>
<span id="cb412-54"><a href="integral-population-models.html#cb412-54" tabindex="-1"></a>elas_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb412-55"><a href="integral-population-models.html#cb412-55" tabindex="-1"></a>  <span class="at">from_size =</span> size_log,</span>
<span id="cb412-56"><a href="integral-population-models.html#cb412-56" tabindex="-1"></a>  <span class="at">to_size   =</span> size_log</span>
<span id="cb412-57"><a href="integral-population-models.html#cb412-57" tabindex="-1"></a>)</span>
<span id="cb412-58"><a href="integral-population-models.html#cb412-58" tabindex="-1"></a>elas_df<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(elasticity)</span>
<span id="cb412-59"><a href="integral-population-models.html#cb412-59" tabindex="-1"></a></span>
<span id="cb412-60"><a href="integral-population-models.html#cb412-60" tabindex="-1"></a>row_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb412-61"><a href="integral-population-models.html#cb412-61" tabindex="-1"></a>  <span class="at">size_log =</span> size_log,</span>
<span id="cb412-62"><a href="integral-population-models.html#cb412-62" tabindex="-1"></a>  <span class="at">size_raw_cm =</span> size_raw,</span>
<span id="cb412-63"><a href="integral-population-models.html#cb412-63" tabindex="-1"></a>  <span class="at">elasticity_sum =</span> <span class="fu">rowSums</span>(elasticity)</span>
<span id="cb412-64"><a href="integral-population-models.html#cb412-64" tabindex="-1"></a>)</span>
<span id="cb412-65"><a href="integral-population-models.html#cb412-65" tabindex="-1"></a></span>
<span id="cb412-66"><a href="integral-population-models.html#cb412-66" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-67"><a href="integral-population-models.html#cb412-67" tabindex="-1"></a><span class="co"># Plots</span></span>
<span id="cb412-68"><a href="integral-population-models.html#cb412-68" tabindex="-1"></a><span class="co">#-------------------------------------------------</span></span>
<span id="cb412-69"><a href="integral-population-models.html#cb412-69" tabindex="-1"></a></span>
<span id="cb412-70"><a href="integral-population-models.html#cb412-70" tabindex="-1"></a>elas_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(elas_df, <span class="fu">aes</span>(from_size, to_size, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb412-71"><a href="integral-population-models.html#cb412-71" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb412-72"><a href="integral-population-models.html#cb412-72" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">&quot;Elasticity&quot;</span>) <span class="sc">+</span></span>
<span id="cb412-73"><a href="integral-population-models.html#cb412-73" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb412-74"><a href="integral-population-models.html#cb412-74" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Size at time t (log)&quot;</span>,</span>
<span id="cb412-75"><a href="integral-population-models.html#cb412-75" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Size at time t+1 (log)&quot;</span>,</span>
<span id="cb412-76"><a href="integral-population-models.html#cb412-76" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Elasticity matrix&quot;</span></span>
<span id="cb412-77"><a href="integral-population-models.html#cb412-77" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb412-78"><a href="integral-population-models.html#cb412-78" tabindex="-1"></a>  <span class="fu">theme_pubr</span>()</span>
<span id="cb412-79"><a href="integral-population-models.html#cb412-79" tabindex="-1"></a></span>
<span id="cb412-80"><a href="integral-population-models.html#cb412-80" tabindex="-1"></a>row_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(row_df, <span class="fu">aes</span>(size_log, elasticity_sum)) <span class="sc">+</span></span>
<span id="cb412-81"><a href="integral-population-models.html#cb412-81" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb412-82"><a href="integral-population-models.html#cb412-82" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb412-83"><a href="integral-population-models.html#cb412-83" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Size at time t (log scale)&quot;</span>,</span>
<span id="cb412-84"><a href="integral-population-models.html#cb412-84" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Sum of elasticities&quot;</span>,</span>
<span id="cb412-85"><a href="integral-population-models.html#cb412-85" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Contribution of size classes to λ&quot;</span></span>
<span id="cb412-86"><a href="integral-population-models.html#cb412-86" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb412-87"><a href="integral-population-models.html#cb412-87" tabindex="-1"></a>  <span class="fu">theme_pubr</span>()</span>
<span id="cb412-88"><a href="integral-population-models.html#cb412-88" tabindex="-1"></a></span>
<span id="cb412-89"><a href="integral-population-models.html#cb412-89" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(elas_plot, row_plot, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb412-90"><a href="integral-population-models.html#cb412-90" tabindex="-1"></a><span class="fu">print</span>(combined_plot)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-85-1.png" width="960" style="display: block; margin: auto;" /></p>
<p>And let’s check out vital rates!</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="integral-population-models.html#cb413-1" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-2"><a href="integral-population-models.html#cb413-2" tabindex="-1"></a><span class="co"># VITAL RATE UNCERTAINTY (LOG-SCALE STATE VARIABLE)</span></span>
<span id="cb413-3"><a href="integral-population-models.html#cb413-3" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-4"><a href="integral-population-models.html#cb413-4" tabindex="-1"></a></span>
<span id="cb413-5"><a href="integral-population-models.html#cb413-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb413-6"><a href="integral-population-models.html#cb413-6" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb413-7"><a href="integral-population-models.html#cb413-7" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb413-8"><a href="integral-population-models.html#cb413-8" tabindex="-1"></a><span class="fu">library</span>(ipmr)</span>
<span id="cb413-9"><a href="integral-population-models.html#cb413-9" tabindex="-1"></a></span>
<span id="cb413-10"><a href="integral-population-models.html#cb413-10" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb413-11"><a href="integral-population-models.html#cb413-11" tabindex="-1"></a><span class="co"># Helper</span></span>
<span id="cb413-12"><a href="integral-population-models.html#cb413-12" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb413-13"><a href="integral-population-models.html#cb413-13" tabindex="-1"></a>safe_boot_glm <span class="ot">&lt;-</span> <span class="cf">function</span>(formula, data, family) {</span>
<span id="cb413-14"><a href="integral-population-models.html#cb413-14" tabindex="-1"></a>  <span class="fu">tryCatch</span>(</span>
<span id="cb413-15"><a href="integral-population-models.html#cb413-15" tabindex="-1"></a>    <span class="fu">glm</span>(formula, <span class="at">data =</span> data, <span class="at">family =</span> family),</span>
<span id="cb413-16"><a href="integral-population-models.html#cb413-16" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span></span>
<span id="cb413-17"><a href="integral-population-models.html#cb413-17" tabindex="-1"></a>  )</span>
<span id="cb413-18"><a href="integral-population-models.html#cb413-18" tabindex="-1"></a>}</span>
<span id="cb413-19"><a href="integral-population-models.html#cb413-19" tabindex="-1"></a></span>
<span id="cb413-20"><a href="integral-population-models.html#cb413-20" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb413-21"><a href="integral-population-models.html#cb413-21" tabindex="-1"></a><span class="co"># Prediction grid (LOG SCALE)</span></span>
<span id="cb413-22"><a href="integral-population-models.html#cb413-22" tabindex="-1"></a><span class="co">#--------------------------------------------------------------</span></span>
<span id="cb413-23"><a href="integral-population-models.html#cb413-23" tabindex="-1"></a>size_seq_log <span class="ot">&lt;-</span> <span class="fu">seq</span>(</span>
<span id="cb413-24"><a href="integral-population-models.html#cb413-24" tabindex="-1"></a>  <span class="fu">min</span>(final_data<span class="sc">$</span>size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-25"><a href="integral-population-models.html#cb413-25" tabindex="-1"></a>  <span class="fu">max</span>(final_data<span class="sc">$</span>size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-26"><a href="integral-population-models.html#cb413-26" tabindex="-1"></a>  <span class="at">length.out =</span> <span class="dv">100</span></span>
<span id="cb413-27"><a href="integral-population-models.html#cb413-27" tabindex="-1"></a>)</span>
<span id="cb413-28"><a href="integral-population-models.html#cb413-28" tabindex="-1"></a></span>
<span id="cb413-29"><a href="integral-population-models.html#cb413-29" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb413-30"><a href="integral-population-models.html#cb413-30" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb413-31"><a href="integral-population-models.html#cb413-31" tabindex="-1"></a></span>
<span id="cb413-32"><a href="integral-population-models.html#cb413-32" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-33"><a href="integral-population-models.html#cb413-33" tabindex="-1"></a><span class="co"># SURVIVAL</span></span>
<span id="cb413-34"><a href="integral-population-models.html#cb413-34" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-35"><a href="integral-population-models.html#cb413-35" tabindex="-1"></a>boot_preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(size_seq_log), n_boot)</span>
<span id="cb413-36"><a href="integral-population-models.html#cb413-36" tabindex="-1"></a></span>
<span id="cb413-37"><a href="integral-population-models.html#cb413-37" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_boot)) {</span>
<span id="cb413-38"><a href="integral-population-models.html#cb413-38" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> final_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(final_data), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb413-39"><a href="integral-population-models.html#cb413-39" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">safe_boot_glm</span>(surv <span class="sc">~</span> size_log, boot_data, <span class="fu">binomial</span>())</span>
<span id="cb413-40"><a href="integral-population-models.html#cb413-40" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod)) {</span>
<span id="cb413-41"><a href="integral-population-models.html#cb413-41" tabindex="-1"></a>    boot_preds[, i] <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb413-42"><a href="integral-population-models.html#cb413-42" tabindex="-1"></a>      mod,</span>
<span id="cb413-43"><a href="integral-population-models.html#cb413-43" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> size_seq_log),</span>
<span id="cb413-44"><a href="integral-population-models.html#cb413-44" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb413-45"><a href="integral-population-models.html#cb413-45" tabindex="-1"></a>    )</span>
<span id="cb413-46"><a href="integral-population-models.html#cb413-46" tabindex="-1"></a>  }</span>
<span id="cb413-47"><a href="integral-population-models.html#cb413-47" tabindex="-1"></a>}</span>
<span id="cb413-48"><a href="integral-population-models.html#cb413-48" tabindex="-1"></a></span>
<span id="cb413-49"><a href="integral-population-models.html#cb413-49" tabindex="-1"></a>boot_df_surv <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb413-50"><a href="integral-population-models.html#cb413-50" tabindex="-1"></a>  <span class="at">size_log =</span> size_seq_log,</span>
<span id="cb413-51"><a href="integral-population-models.html#cb413-51" tabindex="-1"></a>  <span class="at">size_cm  =</span> <span class="fu">exp</span>(size_seq_log),</span>
<span id="cb413-52"><a href="integral-population-models.html#cb413-52" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-53"><a href="integral-population-models.html#cb413-53" tabindex="-1"></a>  <span class="at">lower  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-54"><a href="integral-population-models.html#cb413-54" tabindex="-1"></a>  <span class="at">upper  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb413-55"><a href="integral-population-models.html#cb413-55" tabindex="-1"></a>)</span>
<span id="cb413-56"><a href="integral-population-models.html#cb413-56" tabindex="-1"></a></span>
<span id="cb413-57"><a href="integral-population-models.html#cb413-57" tabindex="-1"></a>surv_uncertainty_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb413-58"><a href="integral-population-models.html#cb413-58" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> final_data,</span>
<span id="cb413-59"><a href="integral-population-models.html#cb413-59" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> surv),</span>
<span id="cb413-60"><a href="integral-population-models.html#cb413-60" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb413-61"><a href="integral-population-models.html#cb413-61" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boot_df_surv,</span>
<span id="cb413-62"><a href="integral-population-models.html#cb413-62" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> median),</span>
<span id="cb413-63"><a href="integral-population-models.html#cb413-63" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb413-64"><a href="integral-population-models.html#cb413-64" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boot_df_surv,</span>
<span id="cb413-65"><a href="integral-population-models.html#cb413-65" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb413-66"><a href="integral-population-models.html#cb413-66" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">fill =</span> <span class="st">&quot;skyblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-67"><a href="integral-population-models.html#cb413-67" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size (log cm)&quot;</span>,</span>
<span id="cb413-68"><a href="integral-population-models.html#cb413-68" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Survival probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-69"><a href="integral-population-models.html#cb413-69" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span>
<span id="cb413-70"><a href="integral-population-models.html#cb413-70" tabindex="-1"></a></span>
<span id="cb413-71"><a href="integral-population-models.html#cb413-71" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-72"><a href="integral-population-models.html#cb413-72" tabindex="-1"></a><span class="co"># FLOWERING PROBABILITY</span></span>
<span id="cb413-73"><a href="integral-population-models.html#cb413-73" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-74"><a href="integral-population-models.html#cb413-74" tabindex="-1"></a>boot_preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(size_seq_log), n_boot)</span>
<span id="cb413-75"><a href="integral-population-models.html#cb413-75" tabindex="-1"></a></span>
<span id="cb413-76"><a href="integral-population-models.html#cb413-76" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_boot)) {</span>
<span id="cb413-77"><a href="integral-population-models.html#cb413-77" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> final_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(final_data), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb413-78"><a href="integral-population-models.html#cb413-78" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">safe_boot_glm</span>(</span>
<span id="cb413-79"><a href="integral-population-models.html#cb413-79" tabindex="-1"></a>    fec1 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb413-80"><a href="integral-population-models.html#cb413-80" tabindex="-1"></a>    boot_data,</span>
<span id="cb413-81"><a href="integral-population-models.html#cb413-81" tabindex="-1"></a>    <span class="fu">binomial</span>()</span>
<span id="cb413-82"><a href="integral-population-models.html#cb413-82" tabindex="-1"></a>  )</span>
<span id="cb413-83"><a href="integral-population-models.html#cb413-83" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod)) {</span>
<span id="cb413-84"><a href="integral-population-models.html#cb413-84" tabindex="-1"></a>    boot_preds[, i] <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb413-85"><a href="integral-population-models.html#cb413-85" tabindex="-1"></a>      mod,</span>
<span id="cb413-86"><a href="integral-population-models.html#cb413-86" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> size_seq_log),</span>
<span id="cb413-87"><a href="integral-population-models.html#cb413-87" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb413-88"><a href="integral-population-models.html#cb413-88" tabindex="-1"></a>    )</span>
<span id="cb413-89"><a href="integral-population-models.html#cb413-89" tabindex="-1"></a>  }</span>
<span id="cb413-90"><a href="integral-population-models.html#cb413-90" tabindex="-1"></a>}</span>
<span id="cb413-91"><a href="integral-population-models.html#cb413-91" tabindex="-1"></a></span>
<span id="cb413-92"><a href="integral-population-models.html#cb413-92" tabindex="-1"></a>boot_df_fec1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb413-93"><a href="integral-population-models.html#cb413-93" tabindex="-1"></a>  <span class="at">size_log =</span> size_seq_log,</span>
<span id="cb413-94"><a href="integral-population-models.html#cb413-94" tabindex="-1"></a>  <span class="at">size_cm  =</span> <span class="fu">exp</span>(size_seq_log),</span>
<span id="cb413-95"><a href="integral-population-models.html#cb413-95" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-96"><a href="integral-population-models.html#cb413-96" tabindex="-1"></a>  <span class="at">lower  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-97"><a href="integral-population-models.html#cb413-97" tabindex="-1"></a>  <span class="at">upper  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb413-98"><a href="integral-population-models.html#cb413-98" tabindex="-1"></a>)</span>
<span id="cb413-99"><a href="integral-population-models.html#cb413-99" tabindex="-1"></a></span>
<span id="cb413-100"><a href="integral-population-models.html#cb413-100" tabindex="-1"></a>fec1_uncertainty_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb413-101"><a href="integral-population-models.html#cb413-101" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> final_data,</span>
<span id="cb413-102"><a href="integral-population-models.html#cb413-102" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> fec1),</span>
<span id="cb413-103"><a href="integral-population-models.html#cb413-103" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb413-104"><a href="integral-population-models.html#cb413-104" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boot_df_fec1,</span>
<span id="cb413-105"><a href="integral-population-models.html#cb413-105" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> median),</span>
<span id="cb413-106"><a href="integral-population-models.html#cb413-106" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb413-107"><a href="integral-population-models.html#cb413-107" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boot_df_fec1,</span>
<span id="cb413-108"><a href="integral-population-models.html#cb413-108" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb413-109"><a href="integral-population-models.html#cb413-109" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">fill =</span> <span class="st">&quot;plum&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-110"><a href="integral-population-models.html#cb413-110" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size (log cm)&quot;</span>,</span>
<span id="cb413-111"><a href="integral-population-models.html#cb413-111" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Flowering probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-112"><a href="integral-population-models.html#cb413-112" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span>
<span id="cb413-113"><a href="integral-population-models.html#cb413-113" tabindex="-1"></a></span>
<span id="cb413-114"><a href="integral-population-models.html#cb413-114" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-115"><a href="integral-population-models.html#cb413-115" tabindex="-1"></a><span class="co"># SEED PRODUCTION</span></span>
<span id="cb413-116"><a href="integral-population-models.html#cb413-116" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-117"><a href="integral-population-models.html#cb413-117" tabindex="-1"></a>boot_preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(size_seq_log), n_boot)</span>
<span id="cb413-118"><a href="integral-population-models.html#cb413-118" tabindex="-1"></a></span>
<span id="cb413-119"><a href="integral-population-models.html#cb413-119" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_boot)) {</span>
<span id="cb413-120"><a href="integral-population-models.html#cb413-120" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> final_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(final_data), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb413-121"><a href="integral-population-models.html#cb413-121" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">safe_boot_glm</span>(</span>
<span id="cb413-122"><a href="integral-population-models.html#cb413-122" tabindex="-1"></a>    fec2 <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb413-123"><a href="integral-population-models.html#cb413-123" tabindex="-1"></a>    boot_data,</span>
<span id="cb413-124"><a href="integral-population-models.html#cb413-124" tabindex="-1"></a>    <span class="fu">poisson</span>()</span>
<span id="cb413-125"><a href="integral-population-models.html#cb413-125" tabindex="-1"></a>  )</span>
<span id="cb413-126"><a href="integral-population-models.html#cb413-126" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(mod)) {</span>
<span id="cb413-127"><a href="integral-population-models.html#cb413-127" tabindex="-1"></a>    boot_preds[, i] <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb413-128"><a href="integral-population-models.html#cb413-128" tabindex="-1"></a>      mod,</span>
<span id="cb413-129"><a href="integral-population-models.html#cb413-129" tabindex="-1"></a>      <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> size_seq_log),</span>
<span id="cb413-130"><a href="integral-population-models.html#cb413-130" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">&quot;response&quot;</span></span>
<span id="cb413-131"><a href="integral-population-models.html#cb413-131" tabindex="-1"></a>    )</span>
<span id="cb413-132"><a href="integral-population-models.html#cb413-132" tabindex="-1"></a>  }</span>
<span id="cb413-133"><a href="integral-population-models.html#cb413-133" tabindex="-1"></a>}</span>
<span id="cb413-134"><a href="integral-population-models.html#cb413-134" tabindex="-1"></a></span>
<span id="cb413-135"><a href="integral-population-models.html#cb413-135" tabindex="-1"></a>boot_df_fec2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb413-136"><a href="integral-population-models.html#cb413-136" tabindex="-1"></a>  <span class="at">size_log =</span> size_seq_log,</span>
<span id="cb413-137"><a href="integral-population-models.html#cb413-137" tabindex="-1"></a>  <span class="at">size_cm  =</span> <span class="fu">exp</span>(size_seq_log),</span>
<span id="cb413-138"><a href="integral-population-models.html#cb413-138" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, median, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-139"><a href="integral-population-models.html#cb413-139" tabindex="-1"></a>  <span class="at">lower  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb413-140"><a href="integral-population-models.html#cb413-140" tabindex="-1"></a>  <span class="at">upper  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb413-141"><a href="integral-population-models.html#cb413-141" tabindex="-1"></a>)</span>
<span id="cb413-142"><a href="integral-population-models.html#cb413-142" tabindex="-1"></a></span>
<span id="cb413-143"><a href="integral-population-models.html#cb413-143" tabindex="-1"></a>fec2_uncertainty_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb413-144"><a href="integral-population-models.html#cb413-144" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> final_data,</span>
<span id="cb413-145"><a href="integral-population-models.html#cb413-145" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> fec2),</span>
<span id="cb413-146"><a href="integral-population-models.html#cb413-146" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb413-147"><a href="integral-population-models.html#cb413-147" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boot_df_fec2,</span>
<span id="cb413-148"><a href="integral-population-models.html#cb413-148" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> median),</span>
<span id="cb413-149"><a href="integral-population-models.html#cb413-149" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb413-150"><a href="integral-population-models.html#cb413-150" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boot_df_fec2,</span>
<span id="cb413-151"><a href="integral-population-models.html#cb413-151" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb413-152"><a href="integral-population-models.html#cb413-152" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">fill =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-153"><a href="integral-population-models.html#cb413-153" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size (log cm)&quot;</span>,</span>
<span id="cb413-154"><a href="integral-population-models.html#cb413-154" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Seed production&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-155"><a href="integral-population-models.html#cb413-155" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span>
<span id="cb413-156"><a href="integral-population-models.html#cb413-156" tabindex="-1"></a></span>
<span id="cb413-157"><a href="integral-population-models.html#cb413-157" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-158"><a href="integral-population-models.html#cb413-158" tabindex="-1"></a><span class="co"># GROWTH</span></span>
<span id="cb413-159"><a href="integral-population-models.html#cb413-159" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-160"><a href="integral-population-models.html#cb413-160" tabindex="-1"></a>boot_preds <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">length</span>(size_seq_log), n_boot)</span>
<span id="cb413-161"><a href="integral-population-models.html#cb413-161" tabindex="-1"></a></span>
<span id="cb413-162"><a href="integral-population-models.html#cb413-162" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(n_boot)) {</span>
<span id="cb413-163"><a href="integral-population-models.html#cb413-163" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> final_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(final_data), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb413-164"><a href="integral-population-models.html#cb413-164" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="cb413-165"><a href="integral-population-models.html#cb413-165" tabindex="-1"></a>    sizeNext_log <span class="sc">~</span> size_log <span class="sc">+</span> <span class="fu">I</span>(size_log<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb413-166"><a href="integral-population-models.html#cb413-166" tabindex="-1"></a>    <span class="at">data =</span> boot_data</span>
<span id="cb413-167"><a href="integral-population-models.html#cb413-167" tabindex="-1"></a>  )</span>
<span id="cb413-168"><a href="integral-population-models.html#cb413-168" tabindex="-1"></a>  boot_preds[, i] <span class="ot">&lt;-</span> <span class="fu">predict</span>(</span>
<span id="cb413-169"><a href="integral-population-models.html#cb413-169" tabindex="-1"></a>    mod,</span>
<span id="cb413-170"><a href="integral-population-models.html#cb413-170" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">size_log =</span> size_seq_log)</span>
<span id="cb413-171"><a href="integral-population-models.html#cb413-171" tabindex="-1"></a>  )</span>
<span id="cb413-172"><a href="integral-population-models.html#cb413-172" tabindex="-1"></a>}</span>
<span id="cb413-173"><a href="integral-population-models.html#cb413-173" tabindex="-1"></a></span>
<span id="cb413-174"><a href="integral-population-models.html#cb413-174" tabindex="-1"></a>boot_df_growth <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb413-175"><a href="integral-population-models.html#cb413-175" tabindex="-1"></a>  <span class="at">size_log =</span> size_seq_log,</span>
<span id="cb413-176"><a href="integral-population-models.html#cb413-176" tabindex="-1"></a>  <span class="at">size_cm  =</span> <span class="fu">exp</span>(size_seq_log),</span>
<span id="cb413-177"><a href="integral-population-models.html#cb413-177" tabindex="-1"></a>  <span class="at">median =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, median),</span>
<span id="cb413-178"><a href="integral-population-models.html#cb413-178" tabindex="-1"></a>  <span class="at">lower  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.025</span>),</span>
<span id="cb413-179"><a href="integral-population-models.html#cb413-179" tabindex="-1"></a>  <span class="at">upper  =</span> <span class="fu">apply</span>(boot_preds, <span class="dv">1</span>, quantile, <span class="fl">0.975</span>)</span>
<span id="cb413-180"><a href="integral-population-models.html#cb413-180" tabindex="-1"></a>)</span>
<span id="cb413-181"><a href="integral-population-models.html#cb413-181" tabindex="-1"></a></span>
<span id="cb413-182"><a href="integral-population-models.html#cb413-182" tabindex="-1"></a>growth_uncertainty_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb413-183"><a href="integral-population-models.html#cb413-183" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> final_data,</span>
<span id="cb413-184"><a href="integral-population-models.html#cb413-184" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> sizeNext_log),</span>
<span id="cb413-185"><a href="integral-population-models.html#cb413-185" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb413-186"><a href="integral-population-models.html#cb413-186" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> boot_df_growth,</span>
<span id="cb413-187"><a href="integral-population-models.html#cb413-187" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">y =</span> median),</span>
<span id="cb413-188"><a href="integral-population-models.html#cb413-188" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb413-189"><a href="integral-population-models.html#cb413-189" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> boot_df_growth,</span>
<span id="cb413-190"><a href="integral-population-models.html#cb413-190" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> size_log, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb413-191"><a href="integral-population-models.html#cb413-191" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.35</span>, <span class="at">fill =</span> <span class="st">&quot;darkseagreen3&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-192"><a href="integral-population-models.html#cb413-192" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Size (log cm)&quot;</span>,</span>
<span id="cb413-193"><a href="integral-population-models.html#cb413-193" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Size at t+1 (log cm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb413-194"><a href="integral-population-models.html#cb413-194" tabindex="-1"></a>  <span class="fu">theme_pubr</span>(<span class="at">base_size =</span> <span class="dv">16</span>)</span>
<span id="cb413-195"><a href="integral-population-models.html#cb413-195" tabindex="-1"></a></span>
<span id="cb413-196"><a href="integral-population-models.html#cb413-196" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-197"><a href="integral-population-models.html#cb413-197" tabindex="-1"></a><span class="co"># COMBINE</span></span>
<span id="cb413-198"><a href="integral-population-models.html#cb413-198" tabindex="-1"></a><span class="co">#==============================================================</span></span>
<span id="cb413-199"><a href="integral-population-models.html#cb413-199" tabindex="-1"></a>uncertainty_panel <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(</span>
<span id="cb413-200"><a href="integral-population-models.html#cb413-200" tabindex="-1"></a>  surv_uncertainty_plot,</span>
<span id="cb413-201"><a href="integral-population-models.html#cb413-201" tabindex="-1"></a>  fec1_uncertainty_plot,</span>
<span id="cb413-202"><a href="integral-population-models.html#cb413-202" tabindex="-1"></a>  fec2_uncertainty_plot,</span>
<span id="cb413-203"><a href="integral-population-models.html#cb413-203" tabindex="-1"></a>  growth_uncertainty_plot,</span>
<span id="cb413-204"><a href="integral-population-models.html#cb413-204" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb413-205"><a href="integral-population-models.html#cb413-205" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span></span>
<span id="cb413-206"><a href="integral-population-models.html#cb413-206" tabindex="-1"></a>)</span>
<span id="cb413-207"><a href="integral-population-models.html#cb413-207" tabindex="-1"></a></span>
<span id="cb413-208"><a href="integral-population-models.html#cb413-208" tabindex="-1"></a><span class="fu">print</span>(uncertainty_panel)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-86-1.png" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="test-your-knowledge-4" class="section level2 hasAnchor" number="17.11">
<h2><span class="header-section-number">17.11</span> Test your knowledge<a href="integral-population-models.html#test-your-knowledge-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Conceptual Understanding:</p>
<pre><code>1.  What is an Integral Projection Model (IPM), and how does it differ from a matrix population model?</code></pre>
<p>(Hint: think about state variables and discretization.)
2. Why must IPM census timing align with biologically meaningful life-cycle events?
Give one example of how poor timing could bias demographic estimates.
3. What characteristics make a variable suitable as a state variable in an IPM?
List at least three and briefly explain why each matters.
4. Explain why using more than one state variable can quickly make IPMs impractical.
What is meant by the “curse of dimensionality”?</p>
<p>Vital Rates and Model Structure:</p>
<pre><code>5.  Why is reproduction often modeled using a two-stage (hurdle) approach in plant IPMs?</code></pre>
<p>What biological processes do each stage represent?
6. In this case study, why was it problematic to use “height with reproductive structures” as the state variable for fecundity?
What kind of modeling issue does this introduce?
7. Why is it generally inappropriate to remove outliers from survival models but reasonable to consider removing them from growth models?</p>
<p>Statistical Modeling Choices:</p>
<pre><code>8.  Why were log transformations applied to size in most vital-rate models?</code></pre>
<p>What biological assumption does this reflect?
9. A quadratic growth model had lower AIC than a linear model. Why is it still important to visually inspect the fitted relationship before choosing it?
10. What does overdispersion indicate in a Poisson model, and why might a negative binomial model be preferred for seed production?</p>
<p>IPM Construction and Interpretation:</p>
<pre><code>11. What do the $P$ and $F$ kernels represent biologically?</code></pre>
<p>Give one example of a process captured in each.
12. Why must the size domain boundaries (L and U) extend slightly beyond the observed data range?
What problem does this help prevent?
13. What is eviction in an IPM, and why can it bias estimates of population growth rate if not corrected?
14. Compare truncation and reflection as eviction-correction strategies.
Under what biological assumptions would truncation be preferred?</p>
<p>Population Metrics:</p>
<pre><code>15. Interpret the meaning of $\lambda &lt; 1$, $\lambda = 1$, and $\lambda &gt; 1$ in the context of conservation management.
16. What is the stable size distribution, and why does it not describe short-term population behavior?
17. What does reproductive value tell us about individuals of different sizes?</code></pre>
<p>How might managers use this information?</p>
<p>Transient Dynamics:</p>
<pre><code>18. Explain the difference between asymptotic population growth ($\lambda$) and one-step transient growth ($\lambda_1$).
19. What does reactivity measure, and why can it be important even when $\lambda &lt; 1$?
20. How is inertia interpreted biologically in a conservation context?</code></pre>
<p>What does high inertia imply about population response to disturbance?</p>
<p>Sensitivity and Elasticity:</p>
<pre><code>21. What is the difference between sensitivity and elasticity of $\lambda$?</code></pre>
<p>Why are elasticities often preferred for interpretation?
22. What does the row sum of the elasticity matrix represent biologically?
23. Why might a size class have high elasticity even if few individuals occupy that size class?</p>
<p>Uncertainty and Inference:</p>
<pre><code>24. Why is bootstrapping particularly important for IPMs built from small populations?
25. Why were recruitment parameters held constant during the bootstrap in this analysis?
26. How do uncertainty bands around vital-rate curves help prevent over-interpretation of demographic results?</code></pre>
<p>Synthesis / Short Answer:</p>
<pre><code>27. Based on the IPM results, would you prioritize protecting small individuals or large individuals for this species?</code></pre>
<p>Justify your answer using survival, reproduction, or elasticity results.
28. Give one example of a management action that could be evaluated using this IPM framework and describe which vital rate it would most likely affect.</p>
</div>
<div id="assignment-5" class="section level2 hasAnchor" number="17.12">
<h2><span class="header-section-number">17.12</span> Assignment<a href="integral-population-models.html#assignment-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Using your data, build an ipm and calculate population dynamics!</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="population-sensation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatial-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/sarasouther/DataAnalysis/edit/main/18-IntegralProjectionModels.Rmd",
    "text": "Edit this page"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
